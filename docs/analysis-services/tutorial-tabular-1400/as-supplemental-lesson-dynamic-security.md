---
title: 'Analysis Services tutorial дополнительного занятия: динамическая безопасность | Документы Microsoft'
description: Описывает использование динамической безопасности с помощью фильтров строк в учебнике служб Analysis Services.
ms.prod_service: analysis-services, azure-analysis-services
services: analysis-services
ms.suite: pro-bi
documentationcenter: ''
author: Minewiskan
manager: kfile
editor: ''
tags: ''
ms.assetid: ''
ms.service: analysis-services
ms.devlang: NA
ms.topic: get-started-article
ms.tgt_pltfrm: NA
ms.workload: na
ms.date: 02/20/2018
ms.author: owend
monikerRange: '>= sql-analysis-services-2017 || = sqlallproducts-allversions'
ms.openlocfilehash: 268ead0e43a0223e66eeb85f803e86e70f4c237b
ms.sourcegitcommit: 7a6df3fd5bea9282ecdeffa94d13ea1da6def80a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="supplemental-lesson---dynamic-security"></a>Дополнительного занятия - динамической безопасности

[!INCLUDE[ssas-appliesto-sql2017-later-aas](../../includes/ssas-appliesto-sql2017-later-aas.md)]

В этом дополнительном занятии создается дополнительная роль, реализующая динамическую безопасность. Динамическая безопасность позволяет определять защиту на уровне строк с учетом имени или идентификатор входа пользователя, который находится в системе в данный момент. 
  
Для реализации динамической безопасности, добавлении таблицы в модель, содержащую имена тех пользователей, которые могут подключаться к модели и просматривать объекты и модели данных. Модели, созданные с помощью этого учебника находится в контексте Adventure Works; Тем не менее для выполнения этого занятия необходимо добавить таблицу, содержащую пользователей из собственного домена. Не обязательно пароли для имен пользователей, которые были добавлены. Чтобы создать таблицу EmployeeSecurity с небольшой выборкой пользователей из собственного домена, используется функция вставки данных из электронной таблицы Excel. В реальном сценарии таблица, содержащая имена пользователей обычно можно привести таблицу из фактической базы данных в качестве источника данных; Например, реальную таблицу DimEmployee.  
  
Две функции DAX используются для реализации динамической безопасности: [функция USERNAME (DAX)](http://msdn.microsoft.com/22dddc4b-1648-4c89-8c93-f1151162b93f) и [функция LOOKUPVALUE (DAX)](http://msdn.microsoft.com/73a51c4d-131c-4c33-a139-b1342d10caab). Эти функции, примененные к формуле фильтра строк, определяются в новой роли. С помощью функции LOOKUPVALUE, формула указывает значение из таблицы EmployeeSecurity. Формула передает значение его функции USERNAME, который указывает имя пользователя, выполнившего вход пользователя принадлежит этой роли. После этого пользователь может просматривать только те данные, которые пропускает фильтр строк роли. В этом случае укажите, что сотрудники отдела продаж могут просматривать только те данные Интернет-продаж для территорий продаж, в которых они являются членами.  
  
Эти задачи являются уникальными для сценария табличной модели Adventure Works, но они не могут иметь прямого отношения к реальному сценарию. Каждое задание включает дополнительные сведения, описывающие цель задания.  
  
Предполагаемое время выполнения данного занятия: **30 минут**  
  
## <a name="prerequisites"></a>предварительные требования  

В этой статье дополнительное занятие является частью учебника по табличному моделированию, который необходимо изучать по порядку. Прежде чем выполнять задания в этом дополнительном занятии, необходимо завершить все предыдущие занятия.  
  
## <a name="add-the-dimsalesterritory-table-to-the-aw-internet-sales-tabular-model-project"></a>Добавление таблицы dimSalesTerritory в проект табличной модели интернет-продаж AW  

Для реализации динамической безопасности для этого сценария Adventure Works, необходимо добавить две дополнительные таблицы в модель. Первая таблица, которая добавляется называется DimSalesTerritory (т Территория продаж) из той же базе данных AdventureWorksDW. Затем применять фильтр строк в таблице SalesTerritory, определяющий данные, которые можно просматривать вошедшего в систему пользователя.  
  
#### <a name="to-add-the-dimsalesterritory-table"></a>Добавление таблицы dimSalesTerritory  
  
1.  В обозревателе табличной модели > **источники данных**, щелкните правой кнопкой мыши подключение и нажмите кнопку **импорта новых таблиц**.  

    Если открылось диалоговое окно "Учетные данные олицетворения", введите учетные данные олицетворения, использованные на занятии 2.
  
2.  Выберите в навигаторе **DimSalesTerritory** , а затем выберите пункт **ОК**.    
  
3.  В редакторе запросов щелкните **DimSalesTerritory** запроса, а затем удалите **SalesTerritoryAlternateKey** столбца.  
  
7.  нажмите кнопку **Импортировать**;  
  
    Новая таблица добавляется в рабочую область модели. Объекты и данные из исходной таблицы DimSalesTerritory будут импортированы в табличной модели AW Internet Sales.  
  
9. После успешного импорта таблицы, нажмите кнопку **закрыть**.  

## <a name="add-a-table-with-user-name-data"></a>Добавление таблицы с именами пользователей  

Таблица DimEmployee в образце базы данных AdventureWorksDW содержит пользователей из домена AdventureWorks. Эти имена пользователей не существуют в вашей рабочей среде. Необходимо создать таблицу в модели, содержащей небольшую выборку (по крайней мере три) фактических пользователей из вашей организации. Затем можно добавить этих пользователей как членов в новую роль. Для выборки имен пользователей пароли не требуются, однако необходима имена реальных пользователей Windows из собственного домена.  
  
#### <a name="to-add-an-employeesecurity-table"></a>Чтобы добавить таблицу EmployeeSecurity  
  
1.  Откройте Microsoft Excel и создайте на листе.  
  
2.  Скопируйте следующую таблицу, включая строку заголовка, и вставьте ее в электронную таблицу.  

    ```
      |EmployeeId|SalesTerritoryId|FirstName|LastName|LoginId|  
      |---------------|----------------------|--------------|-------------|------------|  
      |1|2|<user first name>|<user last name>|\<domain\username>|  
      |1|3|<user first name>|<user last name>|\<domain\username>|  
      |2|4|<user first name>|<user last name>|\<domain\username>|  
      |3|5|<user first name>|<user last name>|\<domain\username>|  
    ```

3.  Замените имя, фамилию и домен\имя_пользователя имена и идентификаторы входа трех пользователей в вашей организации. Поместите того же пользователя на первые две строки для EmployeeId 1, в том, что пользователь относится к более чем одной территории продаж. Изменяйте поля EmployeeId и SalesTerritoryId.  
  
4.  Сохранить журнал как **SampleEmployee**.  
  
5.  На листе выберите все ячейки с данными о сотрудниках, включая заголовки, а затем щелкните правой кнопкой мыши выбранные данные и нажмите кнопку **копирования**.  
  
6.  В SSDT выберите **изменить** меню, а затем нажмите **вставить**.  
  
    Если вставить неактивен, щелкните любой столбец в любой таблице в окне конструктора моделей и повторите попытку.  
  
7.  В **Просмотр вставки** диалогового **имя таблицы**, тип **EmployeeSecurity**.  
  
8.  В **данные для вставки**, проверьте данные включают все пользовательские данные и заголовки из SampleEmployee листа.  
  
9. Убедитесь в том, что установлен флажок **Использовать первую строку в качестве заголовков столбцов** , и нажмите кнопку **ОК**.  
  
    Создается новую таблицу с именем EmployeeSecurity с данными о сотрудниках копируются SampleEmployee листа.  
  
## <a name="create-relationships-between-factinternetsales-dimgeography-and-dimsalesterritory-table"></a>Создание связей между таблицами FactInternetSales DimGeography и DimSalesTerritory  

Все таблицы FactInternetSales DimGeography и DimSalesTerritory содержат общий столбец SalesTerritoryId. Столбец SalesTerritoryId таблицы DimSalesTerritory содержит значения с другим идентификатором для каждой территории продаж.  
  
#### <a name="to-create-relationships-between-the-factinternetsales-dimgeography-and-the-dimsalesterritory-table"></a>Для создания связей между FactInternetSales DimGeography и таблицы DimSalesTerritory  
  
1.  В представлении диаграммы в **DimGeography** таблицы, нажмите и удерживайте **SalesTerritoryId** столбец, затем перетащите курсор в **SalesTerritoryId** столбца в **DimSalesTerritory** таблицы, а затем отпустите.  
  
2.  В **FactInternetSales** таблицы, нажмите и удерживайте **SalesTerritoryId** столбец, затем перетащите курсор в **SalesTerritoryId** столбца в **DimSalesTerritory** таблицы, а затем отпустите.  
  
    Обратите внимание, что свойство «активный» для этого отношения значение False, то есть оно неактивно. FactInternetSales таблица уже содержит другую активную связь.  
  
## <a name="hide-the-employeesecurity-table-from-client-applications"></a>Скрыть таблицу EmployeeSecurity из клиентских приложений  

В этой задаче скрыть таблицу EmployeeSecurity, поддерживая ее появления в списке полей клиентского приложения. Имейте в виду, что скрытие таблицы не безопасна. Пользователи могут запрашивать по-прежнему EmployeeSecurity таблицу данных, если они знают, как. Чтобы защитить данные таблицы EmployeeSecurity, препятствующие пользователям запрашивать любые данные, примените фильтр в одной из следующих задач.  
  
#### <a name="to-hide-the-employeesecurity-table-from-client-applications"></a>Чтобы скрыть таблицу EmployeeSecurity из клиентских приложений  
  
-   В конструкторе моделей в представлении диаграммы щелкните правой кнопкой мыши заголовок таблицы **Сотрудник** и выберите команду **Скрыть из набора клиентских средств**.  
  
## <a name="create-a-sales-employees-by-territory-user-role"></a>Создание пользовательской роли «Сотрудники отдела продаж по территории»  

В этой задаче Создание роли пользователя. Эта роль включает фильтр строк, определяющий, какие строки таблицы DimSalesTerritory отображаются для пользователей. В направлении один ко многим на другие таблицы, связанные с DimSalesTerritory применяется фильтр. Можно также применить фильтр, обеспечивающий безопасность всей таблицы EmployeeSecurity могли направлять к любой пользователь, который является членом роли.  
  
> [!NOTE]  
> Роль «Сотрудники отдела продаж по территории», создаваемая на этом занятии, ограничивает возможность членов, просматривающих данные продаж, территорией, к которой они относятся. При добавлении пользователя как члена сотрудники отдела продаж по территории, также существует как в роли для создания в [занятие 11: Создание ролей](../tutorial-tabular-1400/as-lesson-11-create-roles.md), вы получаете сочетание разрешений. Когда пользователь является членом нескольких ролей, он обладает всеми разрешениями, определенными для каждой из них. То есть пользователь имеет больше разрешений, определяемых комбинации ролей.  
  
#### <a name="to-create-a-sales-employees-by-territory-user-role"></a>Создание пользовательской роли «Сотрудники отдела продаж по территории»  
  
1.  В SSDT выберите **модель** меню, а затем нажмите **ролей**.  
  
2.  В **диспетчер ролей**, нажмите кнопку **New**.  
  
    В список будет добавлена новая роль с разрешением «Нет».  
  
3.  Щелкните новую роль, а затем в **имя** столбца, переименуйте роль в **сотрудники отдела продаж по территории**.  
  
4.  В столбце **Разрешения** щелкните раскрывающийся список и выберите разрешение **Чтение** .  
  
5.  Нажмите кнопку **элементы** , а затем щелкните **добавить**.  
  
6.  В **Выбор пользователя или группы** диалогового **введите выбираемого объекта**, введите имя пользователя первый пример, используемый при создании таблицы EmployeeSecurity. Щелкните **Проверить имена** , чтобы убедиться в том, что имя является действительным, и нажмите кнопку **ОК**.  
  
    Повторите этот шаг, добавляя другие выборки имен пользователей, используемые при создании таблицы EmployeeSecurity.  
  
7.  Нажмите кнопку **фильтры строк** вкладки.  
  
8.  Для **EmployeeSecurity** таблице в **фильтр DAX** столбца, введите следующую формулу:  
  
    ```
      =FALSE()  
    ```
  
    Эта формула указывает, что все столбцы решаются в false логическое условие. Не указаны столбцы в таблице EmployeeSecurity могут запрашиваться членом сотрудники отдела продаж по территории роли пользователя.  
  
9. Для **DimSalesTerritory** таблица, введите следующую формулу:  

    ```  
    ='Sales Territory'[Sales Territory Id]=LOOKUPVALUE('Employee Security'[Sales Territory Id], 
      'Employee Security'[Login Id], USERNAME(), 
      'Employee Security'[Sales Territory Id], 
      'Sales Territory'[Sales Territory Id]) 
    ```
  
    В этой формуле функция LOOKUPVALUE возвращает все значения для столбца DimEmployeeSecurity [SalesTerritoryId], где EmployeeSecurity [LoginId] совпадает с именем текущего пользователя имя пользователя Windows, а EmployeeSecurity [SalesTerritoryId] совпадает с DimSalesTerritory [SalesTerritoryId].  
  
    Набор идентификаторов, возвращенные функцией LOOKUPVALUE территории продаж затем используется для ограничения строк, отображаемых в таблице DimSalesTerritory. Отображаются только строки, где SalesTerritoryID для строки в набор идентификаторов, возвращенных функцией LOOKUPVALUE.  
  
10. В диспетчере роли щелкните **ОК**.  
  
## <a name="test-the-sales-employees-by-territory-user-role"></a>Тестирование пользовательской роли «Сотрудники отдела продаж по территории»  

В этой задаче используется анализ в Excel в SSDT можно протестировать эффективность сотрудники отдела продаж по территории роли пользователя. Можно указать один из имен пользователей, добавленных в таблицу EmployeeSecurity и в качестве члена роли. Это имя пользователя затем используется как имя реального пользователя в соединении, установленного между Excel и модели.  
  
#### <a name="to-test-the-sales-employees-by-territory-user-role"></a>Тестирование пользовательской роли «Сотрудники отдела продаж по территории»  
  
1.  В SSDT выберите **модель** меню, а затем нажмите **анализ в Excel**.  
  
2.  В диалоговом окне **Анализ в Excel** в поле **Укажите имя пользователя или роль для подключения к модели**выберите вариант **Другой пользователь Windows**и нажмите кнопку **Обзор**.  
  
3.  В **Выбор пользователя или группы** диалогового **введите имена выбираемых объектов**, введите имя пользователя, который включается в таблицу EmployeeSecurity и нажмите кнопку **проверить имена**.  
  
4.  Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно **Выбор пользователя или группы** , а затем кнопку **ОК** , чтобы закрыть диалоговое окно **Анализ в Excel** .  
  
    Excel откроет новую книгу. Сводная таблица создается автоматически. Список полей сводной таблицы включает большинство полей данных, доступных в новой модели.  
  
    Обратите внимание, что в таблице EmployeeSecurity не отображается в списке полей сводной таблицы. Скрытые этой таблицы от клиентских средств в предыдущей задаче.  
  
5.  В **поля** в списке **∑ Интернет-продаж** (меры) выберите **InternetTotalSales** мер. Меры, вводится в **значения** поля.  
  
6.  Выберите **SalesTerritoryId** столбец из **DimSalesTerritory** таблицы. Столбец, вводится в **метки строк** поля.  
  
    Обратите внимание, что цифры продаж появятся только для того региона, к которому относится имя пользователя. Если выбрать другой столбец, как и City из таблицы DimGeography как поле метки строки отображаются только города территории продаж, к которой относится пользователь.  
    Этот пользователь не может просмотреть или запросить данных Интернет-продаж для территорий, отличного от того, к которой они принадлежат. Это ограничение действует, так как фильтр строк определен для таблицы DimSalesTerritory в сотрудники отдела продаж по территории роли пользователя, защищает все данные, связанные с другими территориями продаж.  
  
## <a name="see-also"></a>См. также  

[USERNAME, функция (DAX)](https://msdn.microsoft.com/library/hh230954.aspx)  
[Функция LOOKUPVALUE (DAX)](https://msdn.microsoft.com/library/gg492170.aspx)  
[CUSTOMDATA, функция (DAX)](https://msdn.microsoft.com/library/hh213140.aspx)  
