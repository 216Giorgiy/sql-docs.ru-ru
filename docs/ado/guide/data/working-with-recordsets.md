---
title: Работа с наборами записей | Документы Microsoft
ms.prod: sql
ms.prod_service: drivers
ms.service: ''
ms.component: ado
ms.technology:
- drivers
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.suite: sql
ms.tgt_pltfrm: ''
ms.topic: conceptual
helpviewer_keywords:
- Recordset object [ADO]
ms.assetid: bdf9a56a-de4a-44de-9111-2f11ab7b16ea
caps.latest.revision: 13
author: MightyPen
ms.author: genemi
manager: craigg
ms.workload: Inactive
ms.openlocfilehash: e6e91a7596f2ad9e0e7e9cae31f28304809411f1
ms.sourcegitcommit: bb044a48a6af9b9d8edb178dc8c8bd5658b9ff68
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2018
---
# <a name="working-with-recordsets"></a>Работа с наборами записей
**Записей** объект имеет встроенные функции, которые позволяют изменить порядок данных в результирующем наборе для поиска конкретной записи на основе критериев, которые предоставляются и даже для оптимизации этих операций поиска с помощью индексов. Эти возможности доступны для использования зависит от поставщика и в некоторых случаях — например, [индекс](../../../ado/reference/ado-api/index-property.md) свойство — Структура самого источника данных.  
  
## <a name="arranging-data"></a>Упорядочение данных  
 Как правило, наиболее эффективный способ для упорядочивания данных в вашей **записей** — это указать предложение ORDER BY в команде SQL, который используется для возвращения результатов в его. Тем не менее, может потребоваться изменить порядок данных в **записей** уже создан. Можно использовать **сортировки** свойство, чтобы задать порядок, в какие строки **записей** проверено. Кроме того **фильтра** свойство определяет, какие строки будут доступны при обходе строк.  
  
 **Сортировки** Возвращает или задает свойство **строка** значение, указывающее поле имена в **записей** по которому выполняется сортировка. Имя каждого разделены точкой с запятой и при необходимости следует пробел и ключевое слово **ASC** (сортирует поля по возрастанию) или **DESC** (сортирует поля в порядке убывания). По умолчанию если нет ключевого слова не указан, поле сортируется по возрастанию.  
  
 Операция сортировки эффективна, так как данные не переупорядочить физически осуществляется в порядке, указанном с помощью индекса.  
  
 **Сортировки** свойства требуется [CursorLocation](../../../ado/reference/ado-api/cursorlocation-property-ado.md) свойству будет присвоено **adUseClient**. Временный индекс создается для каждого поля, указанного в **сортировки** свойства, если индекс еще не существует.  
  
 Установка **сортировки** свойства равным пустой строке приведет к сбросу исходный порядок строк и удалить временные индексы. Существующие индексы, не удаляются.  
  
 Предположим, что **записей** содержит три поля с именем *firstName*, *middleInitial*, и *lastName*. Задать **сортировки** свойства в строку «`lastName DESC, firstName ASC`», будет порядок **набора записей** по фамилиям в убывающем порядке, а затем по имени в порядке возрастания. Отчество учитывается.  
  
 Нет поля, на который ссылается строка критерии сортировки, можно назвать «ASC» или «DESC», так как эти имена конфликтуют с ключевыми словами **ASC** и **DESC**. Присвойте полю с конфликтующим именем псевдоним с помощью **AS** ключевое слово в запросе, который возвращает **записей**.  
  
 Дополнительные сведения о **записей** фильтрации, в разделе «Фильтрация результатов» далее в этом разделе.  
  
## <a name="finding-a-specific-record"></a>Поиск конкретной записи  
 ADO предоставляет [найти](../../../ado/reference/ado-api/find-method-ado.md) и [Seek](../../../ado/reference/ado-api/seek-method.md) методы для поиска определенной записи в **записей**. **Найти** метод поддерживается из-за множества поставщиков, но ограничена критерия поиска одной. **Seek** метод поддерживает поиск по нескольким критериям, но многие поставщики не поддерживается.  
  
 Индексы для полей можно повысить производительность **найти** метод и **сортировки** и **фильтра** свойства **записей** объект. Можно создать внутренний индекс **поле** , задавая его динамической [оптимизировать](../../../ado/reference/ado-api/optimize-property-dynamic-ado.md) свойство. Это динамическое свойство добавляется к **свойства** коллекцию **поле** объекта при установке [CursorLocation](../../../ado/reference/ado-api/cursorlocation-property-ado.md) свойства **adUseClient**. Помните, что этот индекс внутренний с ADO — не удается получить доступ к нему или использовать его для других целей. Кроме того, этот индекс отличается от [индекс](../../../ado/reference/ado-api/index-property.md) свойство **записей** объекта.  
  
 **Найти** метод быстро находит значение в столбце (поле) элемента **записей**. Часто можно повысить скорость **найти** метод для столбца с помощью **оптимизировать** свойства для создания индекса в ней.  
  
 **Найти** метод ограничивает поиска для одного поля. **Seek** метода необходимо иметь индекс и есть и другие ограничения также. Если необходимо выполнить поиск по нескольким полям, которые не являются основой для индекса или если поставщик не поддерживает индексы, можно ограничить результаты с помощью **фильтра** свойство **записей** объекта.  
  
### <a name="find"></a>Найти  
 **Найти** выполняет метод **записей** для строки, которая удовлетворяет указанного критерия. При необходимости можно указать направление поиска, начальную строку и смещение от начала строки. Если критерий текущей позиции строки имеет значение на найдено записи; в противном случае — значение позиции (начала или конца) из **записей**, в зависимости от направление поиска.  
  
 Можно указать только имя одного столбца для критерия. Другими словами этот метод не поддерживает поиск по нескольким столбцам.  
  
 Оператор сравнения для критерия может быть»**>**«(больше),»**\<**» (меньше), «=» (равно), «> =» (больше или равно), «< =» (меньше или равно),» <>» (не равно) или «Мне НРАВИТСЯ» (соответствие шаблону).  
  
 Значение критерия может быть строкой, число с плавающей запятой или даты. Строковых значений с разделителями с одинарные кавычки или знаками «#» (знак) (например, «состояние = «WA»» или «состояние = WA #»). Значения дат разделяются со знаками «#» (знак) (например, «start_date > # #7/22/97»).  
  
 Если оператор сравнения «мне нравится», строковое значение может содержать символ звездочки (*) для поиска одного или нескольких вхождений любого символа или подстроки. Например «состояние, как я\*"» соответствует Мэн и Массачусетского. Начальные и конечные звездочки также можно найти подстроке, которая содержится в значения. Например «состояния, такие как "\*как\*"» соответствует Аляска, как арканзас, так и Массачусетского.  
  
 Звездочки может использоваться только в конце строки критериев совместно или в начале и конце строки критериев, как показано выше. Нельзя использовать в качестве начальных подстановочный знак звездочка ("* str") или внедренные подстановочные ('s\*r "). Это приведет к ошибке.  
  
### <a name="seek-and-index"></a>Поиск и индекса  
 Используйте **Seek** метод вместе с **индекс** свойства, если базовый поставщик поддерживает индексы на **записей** объекта. Используйте [поддерживает](../../../ado/reference/ado-api/supports-method.md)**(adSeek)** метод, чтобы определить, поддерживает ли базовый поставщик **Seek**и **Supports(adIndex)** метод, чтобы определить, поддерживает ли поставщик индексов. (Например, [поставщик OLE DB для Microsoft Jet](../../../ado/guide/appendixes/microsoft-ole-db-provider-for-microsoft-jet.md) поддерживает **Seek** и **индекс**.)  
  
 Если **Seek** может не найти нужную строку ошибки не возникает и строка располагается в конце **записей**. Задать **индекс** свойства в нужный индекс перед выполнением этого метода.  
  
 Этот метод поддерживается только для серверных курсоров. Поиск не поддерживается, если [CursorLocation](../../../ado/reference/ado-api/cursorlocation-property-ado.md) значение свойства **записей** объект **adUseClient**.  
  
 Этот метод можно использовать только если **записей** объект был открыт с [CommandTypeEnum](../../../ado/reference/ado-api/commandtypeenum.md) значение **adCmdTableDirect**.  
  
## <a name="filtering-the-results"></a>Фильтрация результатов  
 **Найти** метод ограничивает поиска для одного поля. **Seek** метода необходимо иметь индекс и есть и другие ограничения также. Если необходимо выполнить поиск по нескольким полям, которые не являются основой для индекса или если поставщик не поддерживает индексы, можно ограничить результаты с помощью **фильтра** свойство **записей** объекта.  
  
 Используйте **фильтра** свойство, чтобы выборочно отсеять записей в **записей** объекта. Отфильтрованной **записей** становится текущий курсор, который означает, что записи, которые не удовлетворяют **фильтра** критерии недоступны в **записей** до **Фильтра** удаляется. Другие свойства, которые возвращают значения, основанные на текущий курсор повреждены, таких как **AbsolutePosition**, **AbsolutePage**, **RecordCount**, и  **PageCount**. Это, поскольку параметр **фильтра** свойство конкретное значение переходит к первой записи, которая удовлетворяет новое значение текущей записи.  
  
 **Фильтра** свойство принимает аргумент типа variant. Это значение представляет один из трех способов использования **фильтра** свойство: строка условий, **FilterGroupEnum** константой или массив закладки. Дополнительные сведения см. Далее в этом разделе фильтрация со строкой критерии фильтрации с константой и фильтрация с помощью закладок.  
  
> [!NOTE]
>  Если известно, необходимо выбрать данные, это обычно более эффективен, чтобы открыть **записей** инструкцией SQL, которая фактически фильтрует результирующий набор, не полагаясь на **фильтра** свойство.  
  
 Чтобы удалить фильтр из **записей**, используйте **adFilterNone** константой. Параметр **фильтра** строку нулевой длины ("») имеет тот же эффект, как с помощью **adFilterNone** константой.  
  
### <a name="filtering-with-a-criteria-string"></a>Фильтрация с помощью строки критериев  
 Строка критерий состоит из предложений в форме *FieldName оператор значение* (например, `"LastName = 'Smith'"`). Составные предложения можно создать путем объединения отдельных предложений с **AND** (например, `"LastName = 'Smith' AND FirstName = 'John'"`) и **или** (например, `"LastName = 'Smith' OR LastName = 'Jones'"`). Используйте следующие рекомендации для строк критериям:  
  
-   *FieldName* должно быть допустимым именем поля из **записей**. Если имя содержит пробелы, необходимо заключить имя в квадратные скобки.  
  
-   *Оператор* должен быть одним из следующих: **\<**, **>**, **\< =**, **>=** , **<>**, **=**, или **как**.  
  
-   *Значение* является значением, с которым нужно будет сравнить значения полей (например, `'Smith'`, `#8/24/95#`, `12.345`, или `$50.00`). Использовать одинарные кавычки (') со строками и символов (`#`) с датами. Для чисел можно использовать десятичного разделителя, знак доллара и экспоненциальное представление чисел. Если *оператор* — **как**, *значение* можно использовать подстановочные знаки. Только звездочка (\*) и знак процента (%) подстановочные знаки разрешены, и они должны быть последним символом в строке. *Значение* не может иметь значение null.  
  
    > [!NOTE]
    >  Для включения одинарные кавычки (') в фильтре *значение*, используйте две одинарные кавычки для представления одного. Например, для фильтрации по *O'Malley*, критерии строка должна быть `"col1 = 'O''Malley'"`. Чтобы включить одинарные кавычки в начале и конце значение фильтра, необходимо заключить строку в знаки фунта (#). Например, для фильтрации по *"1"*, критерии строка должна быть `"col1 = #'1'#"`.  
  
 Нет не очередность **AND** и **или**. Предложения можно группировать в скобки. Однако нельзя группировку предложений, соединенных **или** и затем присоединитесь к группе другое предложение с AND, как показано ниже.  
  
```  
(LastName = 'Smith' OR LastName = 'Jones') AND FirstName = 'John'  
```  
  
 Вместо этого можно следующим образом построить этот фильтр.  
  
```  
(LastName = 'Smith' AND FirstName = 'John') OR (LastName = 'Jones' AND FirstName = 'John')  
```  
  
 В **как** предложения, можно использовать подстановочный знак в начале и в конце шаблона (например, `LastName Like '*mit*'`) или только в конце шаблона (например, `LastName Like 'Smit*'`).  
  
### <a name="filtering-with-a-constant"></a>Фильтрация с помощью константы  
 Для фильтрации доступны следующие константы **наборы записей**.  
  
|Константа|Описание|  
|--------------|-----------------|  
|**adFilterAffectedRecords**|Фильтры для просмотра только записей, затронутых последней **удаление**, **Resync**, **UpdateBatch**, или **CancelBatch** вызова.|  
|**adFilterConflictingRecords**|Фильтры для просмотра записей, прошедших с последнего пакета обновления.|  
|**adFilterFetchedRecords**|Фильтры для просмотра записей в текущем кэше — то есть, результаты последнего вызова для получения записей из базы данных.|  
|**adFilterNone**|Удаляет текущий фильтр и восстанавливает все записи для просмотра.|  
|**adFilterPendingRecords**|Фильтры для просмотра только записей, были изменены, но еще не отправлены на сервер. Применимо только для режима обновления пакета.|  
  
 Константы фильтра упростить решения отдельных записей конфликты во время пакетный режим обновления, позволяя просмотреть, например, только те записи, которые были затронуты во время последнего **UpdateBatch** вызова метода, как показано в Ниже приведен пример.  
  
 `Attribute VB_Name = "modExaminingData"`  
  
### <a name="filtering-with-bookmarks"></a>Фильтрация с помощью закладок  
 Наконец, можно передать массив вариантов закладок для **фильтра** свойство. Этот результирующий курсор будет содержать только те записи, для которого закладки был передан в свойство. В следующем примере кода создается массив закладки из записей в **записей** имеющих «B» *ProductName* поля. Затем он передает массив, в который **фильтра** свойства и отображает сведения об итоговый отфильтрованные **набора записей**.  
  
```  
'BeginFilterBkmk  
Dim vBkmkArray() As Variant  
Dim i As Integer  
  
'Recordset created using "SELECT * FROM Products" as command.  
'So, we will check to see if ProductName has a capital B, and  
'if so, add to the array.  
i = 0  
Do While Not objRs.EOF  
    If InStr(1, objRs("ProductName"), "B") Then  
        ReDim Preserve vBkmkArray(i)  
        vBkmkArray(i) = objRs.Bookmark  
        i = i + 1  
        Debug.Print objRs("ProductName")  
    End If  
    objRs.MoveNext  
Loop  
  
'Filter using the array of bookmarks.  
objRs.Filter = vBkmkArray  
  
objRs.MoveFirst  
Do While Not objRs.EOF  
    Debug.Print objRs("ProductName")  
    objRs.MoveNext  
Loop  
'EndFilterBkmk  
```  
  
## <a name="creating-a-clone-of-a-recordset"></a>Создать клон набора записей  
 Используйте **клон** повторяющийся метод, чтобы создать несколько **записей** объектов, особенно в том случае, если вы хотите поддерживать более чем одна текущая запись в заданном наборе записей. С помощью **клон** метод является более эффективным, чем создание и открытие нового **записей** объект с тем же определением, что и исходный.  
  
 Текущая запись вновь созданный клон изначально устанавливается на первую запись. Указатель текущей записи в клонированного **записей** не синхронизирован с исходным или наоборот. Можно перемещаться независимо в каждом **записей**.  
  
 Изменения, вносимые в один **записей** объект видны во всех его клонов независимо от типа курсора. Однако после выполнения [Requery](../../../ado/reference/ado-api/requery-method.md) на исходном **записей**, клонов больше не будут синхронизированы с исходным.  
  
 Закрытие исходного **записей** не закрывает ее копии также не закрывает копии закройте исходные или любой из других копий.  
  
 Можно клонировать **записей** объекта, если он поддерживает закладки. Закладка значения являются взаимозаменяемыми; то есть закладки ссылку из одного **записей** относится к одной и той же записи в одном из его клонов.
