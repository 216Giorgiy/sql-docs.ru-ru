---
title: Сохранение данных с SQL Server, большие данные кластера в Kubernetes | Документация Майкрософт
description: ''
author: rothja
ms.author: jroth
manager: craigg
ms.date: 10/01/2018
ms.topic: conceptual
ms.prod: sql
ms.openlocfilehash: 629d7fd887e96013b17a5686ce82eb966044f240
ms.sourcegitcommit: 3da2edf82763852cff6772a1a282ace3034b4936
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2018
ms.locfileid: "48796914"
---
# <a name="data-persistence-with-sql-server-big-data-cluster-on-kubernetes"></a>Сохранение данных с кластером больших данных SQL Server в Kubernetes

[Постоянные тома](https://kubernetes.io/docs/concepts/storage/persistent-volumes/) предоставляют модель подключаемого модуля для хранения в Kubernetes, где, как предоставляется хранилища завершается не зависит от его потребления. Таким образом можно использовать собственное хранилище высокой доступности и подключить его к кластеру кластера SQL Server больших данных. Это дает полный контроль над тип хранилища, доступности и производительности, которые нужны. Kubernetes поддерживает различные типы решений хранения, включая Azure диски и файлы, NFS, локальное хранилище и многое другое.

## <a name="configure-persistent-volumes"></a>Настройка постоянные тома

— Способ работы с большими данными кластера SQL Server использует эти постоянные тома с помощью [классы хранения](https://kubernetes.io/docs/concepts/storage/storage-classes/). Можно создать классы хранения для разных видов хранилища и указать их во время развертывания кластера больших данных. Вы можете настроить какой класс хранилища должен использоваться для какой цели (пул). Кластер SQL Server больших данных создает [утверждения постоянного тома](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims) с именем класса указанное хранилище для каждого pod, требующий постоянные тома. Затем он подключает соответствующие постоянные тома в pod.

> [!NOTE]
> Для CTP-версии 2.0, только `ReadWriteOnce` поддерживается режим доступа для всего кластера.

## <a name="deployment-settings"></a>Параметры развертывания

Чтобы использовать постоянное хранилище во время развертывания, настройте **USE_PERSISTENT_VOLUME** и **STORAGE_CLASS_NAME** переменные среды перед запуском `mssqlctl create cluster` команды. **USE_PERSISTENT_VOLUME** присваивается `true` по умолчанию. Можно переопределить значение по умолчанию и присвойте ему значение `false` и, таким образом, большие данные кластера SQL Server использует emptyDir подключение. 

> [!WARNING]
> Работа без постоянного хранения может привести нефункциональные кластера. После перезапуска pod кластера метаданных и/или пользователя данные будут утеряны окончательно.

Если пользователем задан флаг в значение true, необходимо также указать **STORAGE_CLASS_NAME** как параметр во время развертывания.

## <a name="aks-storage-classes"></a>Классы хранения в AKS

AKS поставляется с [два класса встроенного хранилища](https://docs.microsoft.com/en-us/azure/aks/azure-disks-dynamic-pv) **по умолчанию** и **хранилище класса premium** вместе с динамическое средство подготовки для их. Можно указать одним из них или создать свой собственный класс хранения для развертывания кластера больших данных с помощью включено постоянное хранилище.

## <a name="minikube-storage-class"></a>Класс хранения Minikube

Minikube поставляется с встроенного хранилища класс с именем **стандартный** вместе с динамической подготовки для него.

## <a name="kubeadm"></a>Kubeadm

Kubeadm не поставляется с классом встроенного хранилища; Таким образом, мы создали сценария для настройки постоянного тома и классы хранения с помощью локального хранилища или [ладья](https://github.com/rook/rook) хранилища.

## <a name="on-premises-cluster"></a>Локальный кластер

Кластеры локальных очевидно не поставляются с любого класса встроенных хранилища, поэтому необходимо настроить [постоянные тома](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)/[виртуальную](https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/) заранее и затем используйте соответствующий классы хранения во время развертывания кластера больших данных в SQL Server.

# <a name="customize-storage-size-for-each-pool"></a>Настройка размера хранилища для каждого пула
По умолчанию размер постоянного тома, выделенные для каждого из модулей, подготовленных в кластере — 6 ГБ. Это можно настроить, задав переменную среды `STORAGE_SIZE` другое значение. Например, можно выполнить следующую команду, чтобы задать значение до 10 ГБ, перед запуском `mssqlctl create cluster command`.

```bash
export STORAGE_SIZE=10Gi
```

Также может иметь различные конфигурации для настройки постоянного хранилища, такие размеры постоянного тома для разных пулов в кластер и имя класса хранения. Например можно настроить постоянные тома, предоставляемым параметр ниже переменные среды перед развертыванием кластера для пула носителей, применяется другой класс хранения и пропускную способность:

```bash
export STORAGE_POOL_USE_PERSISTENT_VOLUME=true
export STORAGE_POOL_STORAGE_CLASS_NAME=premium-storage
export STORAGE_POOL_STORAGE_SIZE=100Gi
```

Ниже приведен полный список переменных среды, связанных с настройкой постоянное хранилище для кластера SQL Server, большие данные:

| Переменная среды | Значение по умолчанию | Описание |
|---|---|---|
| **USE_PERSISTENT_VOLUME** | true | `true` для использования утверждения постоянного тома Kubernetes для хранения pod. `false` Использование временных узлов хранилища для хранения pod. |
| **STORAGE_CLASS_NAME** | значение по умолчанию | Если `USE_PERSISTENT_VOLUME` является `true` это указывает на имя класса хранения Kubernetes для использования. |
| **STORAGE_SIZE** | 6gi | Если `USE_PERSISTENT_VOLUME` является `true`, это указывает размер постоянного тома для каждого модуля. |
| **DATA_POOL_USE_PERSISTENT_VOLUME** | USE_PERSISTENT_VOLUME | `true` Использование постоянного тома Kubernetes утверждения для групп POD в пул данных. `false` Использование временных узлов хранилища для модулей POD пула данных. |
| **DATA_POOL_STORAGE_CLASS_NAME** | STORAGE_CLASS_NAME | Указывает имя класса хранения Kubernetes для постоянного тома, связанные с модулей пула данных.|
| **DATA_POOL_STORAGE_SIZE** | STORAGE_SIZE |Указывает размер постоянного тома для каждого модуля в пуле данных. |
| **STORAGE_POOL_USE_PERSISTENT_VOLUME** | USE_PERSISTENT_VOLUME | `true` Использование постоянного тома Kubernetes утверждений для модулей в пуле носителей. `false` Использование временных узлов хранилища для модулей POD пула хранения.|
| **STORAGE_POOL_STORAGE_CLASS_NAME** | STORAGE_CLASS_NAME | TIndicates имя класса хранения Kubernetes для постоянного тома, связанные с модулей пула хранения. |
| **STORAGE_POOL_STORAGE_SIZE** | STORAGE_SIZE | Указывает размер постоянного тома для каждого модуля в пуле носителей. |

## <a name="next-steps"></a>Следующие шаги

Полную документацию о томах в Kubernetes см. в разделе [документации по Kubernetes на томах](https://kubernetes.io/docs/concepts/storage/volumes/).

Дополнительные сведения о развертывании кластера больших данных в SQL Server, см. в разделе [развертывание сервера SQL, большие данные кластера в Kubernetes](deployment-guidance.md).

