---
title: "Инструкция DBCC CHECKTABLE (Transact-SQL) | Документы Microsoft"
ms.date: 07/16/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
f1_keywords:
- CHECKTABLE_TSQL
- DBCC_CHECKTABLE_TSQL
- DBCC CHECKTABLE
- CHECKTABLE
dev_langs:
- TSQL
helpviewer_keywords:
- indexed views [SQL Server], DBCC CHECKTABLE
- page integrity checks [SQL Server]
- consistency [SQL Server], tables
- consistency [SQL Server], indexed views
- DBCC CHECKTABLE statement
- integrity [SQL Server]
- low overhead checks
- table integrity checks [SQL Server]
ms.assetid: 0d6cb620-eb58-4745-8587-4133a1b16994
caps.latest.revision: 89
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: af19e042e9e40bd92352a175394c442431959b0e
ms.contentlocale: ru-ru
ms.lasthandoff: 09/01/2017

---
# <a name="dbcc-checktable-transact-sql"></a>DBCC CHECKTABLE (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx_md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]Проверка целостности всех страниц и структур, составляющих таблицу или индексированное представление.
![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)
    
## <a name="syntax"></a>Синтаксис    
    
```sql
    
DBCC CHECKTABLE     
(    
    table_name | view_name    
    [ , { NOINDEX | index_id }    
     |, { REPAIR_ALLOW_DATA_LOSS | REPAIR_FAST | REPAIR_REBUILD }     
    ]     
)    
    [ WITH     
        { ALL_ERRORMSGS ]    
          [ , EXTENDED_LOGICAL_CHECKS ]     
          [ , NO_INFOMSGS ]    
          [ , TABLOCK ]     
          [ , ESTIMATEONLY ]     
          [ , { PHYSICAL_ONLY | DATA_PURITY } ]     
          [ , MAXDOP = number_of_processors ]    
        }    
    ]    
```    
    
## <a name="arguments"></a>Аргументы    
 *имя_таблицы* | *view_name*  
 Таблица или индексированное представление, для которой необходимо выполнять проверки целостности. Имена таблиц и представлений должны соответствовать правилам для [идентификаторы](../../relational-databases/databases/database-identifiers.md).  
    
 NOINDEX  
 Указывает, что тщательную проверку некластеризованных индексов для пользовательских таблиц выполнять не следует. Это уменьшает общее время выполнения. Аргумент NOINDEX не оказывает влияния на проверки системных таблиц, поскольку проверки целостности для индексов всех системных таблиц выполняются всегда.  
    
 *index_id*  
 Идентификатор индекса, для которого выполняются проверки целостности. Если *index_id* указан, инструкция DBCC CHECKTABLE выполняет проверки целостности только для этого индекса, включая кучу или кластеризованный индекс.  
    
 REPAIR_ALLOW_DATA_LOSS | REPAIR_FAST | REPAIR_REBUILD  
 Указывает, что инструкции DBCC CHECKTABLE следует исправлять обнаруженные ошибки. Для использования параметра исправления база данных должна быть открыта в однопользовательском режиме.  
    
 REPAIR_ALLOW_DATA_LOSS  
 Пытается устранить все обнаруженные ошибки. Эти исправления могут привести к частичной потере данных.  
    
 REPAIR_FAST  
 Синтаксис сохраняется только в целях обратной совместимости. Действия по восстановлению не выполняются.  
    
 REPAIR_REBUILD  
 Выполняет действия по восстановлению данных, которые можно выполнить без риска их потери. Это может быть быстрое восстановление (например, восстановление отсутствующих строк в некластеризованных индексах) или более ресурсоемкие операции (например, перестроение индекса).  
 Этот аргумент не исправляет ошибки, связанные с данными FILESTREAM.  
    
 > [!NOTE]  
 >  Используйте аргументы REPAIR только как последнее средство. Для устранения ошибок рекомендуется восстановление из резервной копии. Операции восстановления не учитывают никакие ограничения, которые могут существовать для таблиц или между таблицами. Если указанная таблица включена в одно или несколько ограничений, рекомендуется выполнить инструкцию DBCC CHECKCONSTRAINTS после операции восстановления. Если необходимо использовать аргументы REPAIR, выполните инструкцию DBCC CHECKTABLE без параметра восстановления, чтобы узнать требуемый уровень восстановления. При использовании уровня REPAIR_ALLOW_DATA_LOSS рекомендуется создать резервную копию базы данных перед выполнением инструкции DBCC CHECKTABLE с данным параметром.  
    
 ALL_ERRORMSGS  
 Отображает неограниченное число ошибок. Все сообщения об ошибках выводятся по умолчанию. Указание или пропуск этого параметра не приводит к изменениям.  
    
 EXTENDED_LOGICAL_CHECKS  
 При уровне совместимости 100 ([!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]) и выше выполняются проверки логической согласованности индексированных представлений, XML-индексов и пространственных индексов, если они есть.  
 Дополнительные сведения см. в части «Выполнение логических проверок целостности индексов» подраздела «Замечания» далее в этом разделе.  
    
 NO_INFOMSGS  
 Подавляет вывод всех информационных сообщений.  
    
 TABLOCK  
 Указывает инструкции DBCC CHECKTABLE использовать разделяемую блокировку таблицы вместо создания внутреннего моментального снимка базы данных. Аргумент TABLOCK позволяет ускорить работу инструкции DBCC CHECKTABLE в условиях высокой загрузки, но снижает текущую согласованность данных для таблицы во время выполнения этой инструкции.  
    
 ESTIMATEONLY  
 Отображает предполагаемый размер пространства tempdb, необходимый для запуска инструкции DBCC CHECKTABLE с все заданные параметры.  
    
 PHYSICAL_ONLY  
 Ограничивает область проверки целостностью физической структуры страниц, заголовков записей и физической структуры сбалансированных деревьев. Параметр предназначен для выполнения облегченной проверки физической согласованности таблицы, а также может выявлять поврежденные страницы и общие сбои оборудования, которые могут привести к потере данных. Полный запуск инструкции DBCC CHECKTABLE может занять значительно больше времени, чем в предыдущих версиях. Это вызвано следующими причинами.  
 -   Логические проверки стали более сложными.  
 -   Усложнился ряд базовых структур, нуждающихся в проверке.  
 -   Добавлено много новых проверок для поддержки новых функций.  
   
 Иными словами, указание аргумента PHYSICAL_ONLY может существенно снизить время выполнения инструкции DBCC CHECKTABLE для больших таблиц и поэтому рекомендуется для частого использования в рабочих системах. Также рекомендуется периодически производить полный запуск инструкции DBCC CHECKTABLE. Периодичность запуска зависит от факторов, индивидуальных для каждого предприятия и каждой производственной среды. Аргумент PHYSICAL_ONLY всегда неявно включает аргумент NO_INFOMSGS и не должен указываться вместе с параметрами исправления ошибок.  
    
 > [!NOTE]  
 >  Указание аргумента PHYSICAL_ONLY приводит к пропуску инструкцией DBCC CHECKTABLE всех проверок данных FILESTREAM.  
    
 DATA_PURITY  
 Указание значения аргумента приводит к выполнению инструкцией DBCC CHECKTABLE проверки таблицы на недействительность или выход из допустимого диапазона значений столбцов. Например, инструкция DBCC CHECKTABLE обнаруживает столбцы со значениями даты и времени, размер которого больше или меньше допустимого диапазона для **datetime** тип данных; или **десятичное** или приблизительных числовых данных типа столбцы со значениями масштаба или точности, которые являются недопустимыми.  
 Проверки целостности значений столбцов включены по умолчанию, и для них не требуется указывать параметр DATA_PURITY. Для баз данных, обновляемых с предыдущих версий [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], имеется возможность использовать инструкцию DBCC CHECKTABLE WITH DATA_PURITY для нахождения и исправления ошибок для заданной таблицы, однако проверки столбцов-значений таблицы запрещены по умолчанию до тех пор, пока инструкция DBCC CHECKDB WITH DATA_PURITY работает с базой данных без ошибок. После этого инструкции DBCC CHECKDB и DBCC CHECKTABLE проверяют целостность данных в столбцах-значениях по умолчанию.  
 Ошибки проверки, передаваемые при наличии этого параметра, не могут быть устранены с помощью параметров восстановления DBCC. Сведения об устранении этих ошибок вручную см. в статье базы знаний 923247: [ошибки 2570 инструкции DBCC, устранение неполадок в SQL Server 2005 и более поздних версиях](http://support.microsoft.com/kb/923247).  
 Если указан аргумент PHYSICAL_ONLY, проверка целостности значений в столбцах не выполняется.  
    
 MAXDOP  
 **Применяется к**: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 2014 SP2 через [текущей версии](http://go.microsoft.com/fwlink/p/?LinkId=299658).  
 Переопределяет **максимальная степень параллелизма** параметр конфигурации **sp_configure** для инструкции. MAXDOP может превысить значение, настроенное с помощью хранимой процедуры sp_configure. Если MAXDOP превышает значение, настроенное с помощью регулятора ресурсов, компонент Database Engine использует значение MAXDOP регулятора ресурсов, описанное в инструкцию ALTER WORKLOAD GROUP (Transact-SQL). Все семантические правила, используемые параметром конфигурации max degree of parallelism, применимы при использовании указания запроса MAXDOP. Дополнительные сведения см. в разделе [Настройка параметра конфигурации сервера max degree of parallelism](../../database-engine/configure-windows/configure-the-max-degree-of-parallelism-server-configuration-option.md).  
    
 > [!CAUTION]  
 >  Если значение MAXDOP равно нулю, то сервер выбирает максимальную степень параллелизма.  
    
## <a name="remarks"></a>Замечания    
    
> [!NOTE]    
>  Чтобы выполнить инструкцию DBCC CHECKTABLE для каждой таблицы в базе данных, используйте [инструкции DBCC CHECKDB](../../t-sql/database-console-commands/dbcc-checkdb-transact-sql.md).    
    
Для указанной таблицы инструкция DBCC CHECKTABLE выполняет следующие проверки.
-   Верны ли ссылки на страницы данных индекса, на страницы данных в строке, на превышающие размер страницы данные строки и на страницы больших объектов.    
-   Верен ли порядок сортировки индексов.    
-   Согласованы ли указатели.    
-   Обоснованы ли данные, содержащиеся на каждой из страниц, в том числе вычисляемые столбцы.    
-   Обоснованы ли смещения страниц.    
-   Все ли строки в базовой таблице имеют совпадающие строки в некластеризованных индексах, и наоборот.    
-   Все ли строки в секционированной таблице или индексе находятся в соответствующих секциях.    
-   Связать уровень согласованность между файловой системой и таблицей при хранении **varbinary(max)** данные в файловой системе, с помощью FILESTREAM.    
    
## <a name="performing-logical-consistency-checks-on-indexes"></a>Выполнение проверок логической целостности индексов    
Процедура проверки логической целостности индексов зависит от уровня совместимости базы данных следующим образом.
-   При уровне совместимости 100 ([!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]) и выше.    
    -   Если не указан NOINDEX, DBCC CHECKTABLE выполняет как физические, так и логические проверки целостности отдельной таблицы и всех ее некластеризованных индексов. Однако в XML-индексах, пространственных индексах и индексированных представлениях по умолчанию выполняются только проверки физической целостности.    
    -   Если указан параметр WITH EXTENDED_LOGICAL_CHECKS, выполняются логические проверки в индексированных представлениях, XML-индексах и пространственных индексах (при их наличии). По умолчанию проверки физической согласованности выполняются раньше, чем проверки логической согласованности. Если также указан параметр NOINDEX, выполняются только проверки логической согласованности.    
         Они проверяют согласованность внутренней таблицы индексов или объекта индекса с пользовательской таблицей, на которую он указывает. Для поиска выбросов создается внутренний запрос, выполняющий полную проверку пересечения внутренних и пользовательских таблиц. Выполнение этого запроса может крайне отрицательно сказаться на производительности, а ход его выполнения невозможно отследить. Поэтому рекомендуется указывать параметр WITH EXTENDED_LOGICAL_CHECKS только в тех случаях, когда возможно возникновение проблем с индексированием, не связанных с физическими повреждениями, или при неверных контрольных суммах на уровне страниц, или же при подозрении на повреждение оборудования на уровне столбцов.    
    -   Если это отфильтрованный индекс, инструкция DBCC CHECKDB выполняет проверку целостности, чтобы убедиться, что записи индекса удовлетворяют условию предиката фильтра.   
      
- Начиная с SQL Server 2016, дополнительные проверки на материализованные вычисляемые столбцы, столбцы определяемого пользователем ТИПА и Фильтруемые индексы не будет выполняться по умолчанию, чтобы избежать ресурсоемких выражение вычисления. Это изменение значительно сокращает время CHECKDB для базы данных, содержащие эти объекты. Однако всегда выполняется проверки физической согласованности этих объектов. Только в том случае, если указан параметр EXTENDED_LOGICAL_CHECKS вычисления выражений выполняются в дополнение к уже присутствует логические проверки (индексированного представления, XML-индексов и пространственных индексах) как часть параметра EXTENDED_LOGICAL_CHECKS.
-  Если уровень совместимости меньше либо равен 90 и не указан NOINDEX, DBCC CHECKTABLE выполняет как физические, так и логические проверки целостности отдельной таблицы или индексированного представления и всех его некластеризованных и XML-индексов. Пространственные индексы не поддерживаются.
    
 **Чтобы узнать, уровень совместимости базы данных**    
[Просмотр или изменение уровня совместимости базы данных](../../relational-databases/databases/view-or-change-the-compatibility-level-of-a-database.md)    
    
## <a name="internal-database-snapshot"></a>Моментальный снимок внутренней базы данных    
Для обеспечения согласованности транзакций, необходимой для выполнения этих проверок, инструкция DBCC CHECKTABLE использует внутренний моментальный снимок базы данных. Дополнительные сведения см. в разделе [Просмотр размера разреженного файла моментального снимка базы данных &#40; Transact-SQL &#41; ](../../relational-databases/databases/view-the-size-of-the-sparse-file-of-a-database-snapshot-transact-sql.md) и в разделе «DBCC внутренней базы данных моментальных снимков использование» [DBCC &#40; Transact-SQL &#41; ](../../t-sql/database-console-commands/dbcc-transact-sql.md).
Если моментальный снимок не может быть создан или указана подсказка TABLOCK, инструкция DBCC CHECKTABLE запрашивает совмещаемую блокировку таблицы, чтобы обеспечить необходимую согласованность.
    
> [!NOTE]    
> Если инструкция DBCC CHECKTABLE выполняется для базы данных tempdb, он должен получить совмещаемую блокировку таблицы. Это обусловлено тем, что по соображениям, связанным с производительностью, моментальные снимки базы данных недоступны для базы данных tempdb. Это означает, что нельзя достичь требуемой согласованности транзакций.    
    
## <a name="checking-and-repairing-filestream-data"></a>Проверка и восстановление данных FILESTREAM    
При включении FILESTREAM для базы данных и таблицы, при необходимости можно сохранить **varbinary(max)** больших двоичных объектов (BLOB) в файловой системе. При использовании инструкции DBCC CHECKTABLE для таблицы, хранящей данные типа BLOB в файловой системе, DBCC проверяет согласованность между файловой системой и базой данных на уровне ссылок.
Например, если таблица содержит **varbinary(max)** столбец, который использует атрибут FILESTREAM, инструкция DBCC CHECKTABLE проверит, что имеется взаимно-однозначное сопоставление между системные каталоги файлов и файлов и строк таблицы, столбцы и столбец значения. DBCC CHECKTABLE может исправить повреждения при задании параметра REPAIR_ALLOW_DATA_LOSS. При восстановлении повреждений FILESTREAM инструкция DBCC удаляет все строки таблиц, в которых отсутствуют данные файловой системы, а также все каталоги и файлы, которые не сопоставлены строкам, столбцам и значениям столбцов в таблицах.
    
## <a name="checking-objects-in-parallel"></a>Проверка объектов в параллельном режиме    
По умолчанию инструкция DBCC CHECKTABLE выполняет проверку объектов параллельно. Степень параллелизма определяется автоматически обработчиком запросов. Максимальная степень параллелизма настраивается точно так же, как и для параллельных запросов. Чтобы ограничить максимальное количество процессоров, доступных для проверки DBCC, используется [sp_configure](../../relational-databases/system-stored-procedures/sp-configure-transact-sql.md). Дополнительные сведения см. в разделе [Настройка параметра конфигурации сервера max degree of parallelism](../../database-engine/configure-windows/configure-the-max-degree-of-parallelism-server-configuration-option.md).
Параллельную проверку можно отключить с помощью флага трассировки 2528. Дополнительные сведения см. в разделе [Флаги трассировки (Transact-SQL)](../../t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql.md).
    
> [!NOTE]    
>  Во время выполнения операции DBCC CHECKTABLE байты, сохраненные в столбце побайтно упорядоченного определяемого пользователем типа, должны совпасть с вычисленной сериализацией значения пользовательского типа. В противном случае процедура DBCC CHECKTABLE сообщит о несогласованности.    
    
## <a name="understanding-dbcc-error-messages"></a>Основные сведения о сообщениях об ошибках DBCC    
После завершения выполнения инструкции DBCC CHECKTABLE заносится сообщение в журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. При успешном выполнении команды DBCC сообщается об успешном завершении и количестве времени, затраченном на выполнение команды. Если выполнение команды DBCC прерывается до завершения проверки по причине ошибки, сообщение указывает на прерывание команды и приводит значение состояния и количество времени, затраченного на выполнение команды. В следующей таблице перечислены и описаны значения состояний, которые могут быть включены в сообщение.
    
|Состояние|Description|    
|-----------|-----------------|    
|0|Возникла ошибка с номером 8930. Это указывает на повреждение метаданных, вызвавшее прекращение выполнения команды DBCC.|    
|1|Возникла ошибка с номером 8967. Внутренняя ошибка DBCC.|    
|2|При аварийном восстановлении базы данных произошла ошибка.|    
|3|Это указывает на повреждение метаданных, вызвавшее прекращение выполнения команды DBCC.|    
|4|Обнаружено нарушение доступа или утверждения.|    
|5|Возникла неизвестная ошибка, которая привела к прекращению выполнения команды DBCC.|    
    
## <a name="error-reporting"></a>Отчет об ошибках    
Файл мини-дампа (SQLDUMP*nnnn*.txt) создается в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] каталог ЖУРНАЛА всякий раз, когда инструкция DBCC CHECKTABLE обнаруживает ошибку повреждения. При включении сбора данных об использовании компонентов и отчета об ошибках для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], файл автоматически отправляется корпорации Майкрософт [!INCLUDE[msCoName](../../includes/msconame-md.md)]. Собранные данные используются для улучшения функциональности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].
Файл дампа содержит результаты выполнения инструкции DBCC CHECKTABLE и дополнительные диагностические сведения. Доступ к этому файлу ограничен списками управления доступом на уровне пользователей. Доступ ограничен [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] учетная запись службы и члены роли sysadmin. По умолчанию роль sysadmin содержит всех членов группы Windows BUILTIN\Administrators и группы локальных администраторов. В случае ошибки процесса сбора данных команда DBCC не завершается ошибкой.
    
## <a name="resolving-errors"></a>Разрешение ошибок    
 Если инструкция DBCC CHECKTABLE выдает какие-либо ошибки, рекомендуется восстановить базу данных из резервной копии, а не запускать параметр REPAIR с параметрами исправления ошибок. Если резервная копия отсутствует, исправить выданные ошибки можно запуском параметра REPAIR. В конце списка ошибок указано, какой из параметров REPAIR следует использовать. Однако исправление ошибок с параметром REPAIR_ALLOW_DATA_LOSS может потребовать удаления некоторых страниц, которые могут содержать данные.    
Исправление ошибок может быть выполнено в пользовательской транзакции, позволяя откатить произведенные изменения. При выполнении отката исправлений база данных снова будет содержать ошибки и ее необходимо будет восстановить из резервной копии. После завершения исправления всех ошибок создайте резервную копию базы данных.
    
## <a name="result-sets"></a>Результирующие наборы    
Инструкция DBCC CHECKTABLE возвращает следующий результирующий набор. Тот же результирующий набор возвращается как при указании только имени таблицы, так и при указании любых параметров.
    
```sql
DBCC results for 'HumanResources.Employee'.    
There are 288 rows in 13 pages for object 'Employee'.    
DBCC execution completed. If DBCC printed error messages, contact your system administrator.    
```    
    
Инструкция DBCC CHECKTABLE возвращает следующий результирующий набор, если указан параметр ESTIMATEONLY:
    
```sql
Estimated TEMPDB space needed for CHECKTABLES (KB)     
--------------------------------------------------     
21    
(1 row(s) affected)    
DBCC execution completed. If DBCC printed error messages, contact your system administrator.    
```    
    
## <a name="permissions"></a>Permissions    
Пользователь должен быть владельцем таблицы или быть членом фиксированной серверной роли sysadmin, db_owner фиксированной роли базы данных или роли базы данных db_ddladmin.    
    
## <a name="examples"></a>Примеры    
    
### <a name="a-checking-a-specific-table"></a>A. Проверка указанной таблицы    
Следующий пример проверяет целостность страниц данных `HumanResources.Employee` в таблицу [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] базы данных.
    
```sql    
DBCC CHECKTABLE ('HumanResources.Employee');    
GO    
```    
    
### <a name="b-performing-a-low-overhead-check-of-the-table"></a>Б. Выполнение облегченной проверки таблицы    
 В следующем примере выполняется облегченной проверки `Employee` в таблицу [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] базы данных.    
    
```sql    
DBCC CHECKTABLE ('HumanResources.Employee') WITH PHYSICAL_ONLY;    
GO    
```    
    
### <a name="c-checking-a-specific-index"></a>В. Проверка указанного индекса    
 В следующем примере производится проверка указанного индекса, полученного из `sys.indexes`.    
    
```sql    
DECLARE @indid int;    
SET @indid = (SELECT index_id     
              FROM sys.indexes    
              WHERE object_id = OBJECT_ID('Production.Product')    
                    AND name = 'AK_Product_Name');    
DBCC CHECKTABLE ('Production.Product',indid);    
```    
    
## <a name="see-also"></a>См. также:    
[DBCC (Transact-SQL)](../../t-sql/database-console-commands/dbcc-transact-sql.md)  
 [DBCC CHECKDB (Transact-SQL)](../../t-sql/database-console-commands/dbcc-checkdb-transact-sql.md)    
    
  

