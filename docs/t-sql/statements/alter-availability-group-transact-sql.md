---
title: "ALTER AVAILABILITY GROUP (Transact-SQL) | Документы Microsoft"
ms.custom: 
ms.date: 10/16/2017
ms.prod: sql-non-specified
ms.prod_service: sql-database
ms.service: 
ms.component: t-sql|statements
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
f1_keywords:
- ALTER_AVAILABILITY_GROUP_TSQL
- ALTER_AVAILABILITY_TSQL
- ALTER AVAILABILITY GROUP
- ALTER AVAILABILITY
dev_langs: TSQL
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- ALTER AVAILABILITY GROUP statement
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], Transact-SQL statements
ms.assetid: f039d0de-ade7-4aaf-8b7b-d207deb3371a
caps.latest.revision: "152"
author: MikeRayMSFT
ms.author: mikeray
manager: jhubbard
ms.workload: On Demand
ms.openlocfilehash: c31f7eef71570c9c25afe19e26779943678ff509
ms.sourcegitcommit: 66bef6981f613b454db465e190b489031c4fb8d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2017
---
# <a name="alter-availability-group-transact-sql"></a>ALTER AVAILABILITY GROUP (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2012-xxxx-xxxx-xxx-md.md)]

  Изменяет в существующей группы доступности Always On [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Большинство аргументов ALTER AVAILABILITY GROUP поддерживаются только в текущей первичной реплике. Однако аргументы JOIN, FAILOVER и FORCE_FAILOVER_ALLOW_DATA_LOSS поддерживаются только во вторичных репликах.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```SQL  
  
ALTER AVAILABILITY GROUP group_name   
  {  
     SET ( <set_option_spec> )   
   | ADD DATABASE database_name   
   | REMOVE DATABASE database_name  
   | ADD REPLICA ON <add_replica_spec>   
   | MODIFY REPLICA ON <modify_replica_spec>  
   | REMOVE REPLICA ON <server_instance>  
   | JOIN  
   | JOIN AVAILABILITY GROUP ON <add_availability_group_spec> [ ,...2 ]  
   | MODIFY AVAILABILITY GROUP ON <modify_availability_group_spec> [ ,...2 ]  
   | GRANT CREATE ANY DATABASE  
   | DENY CREATE ANY DATABASE  
   | FAILOVER  
   | FORCE_FAILOVER_ALLOW_DATA_LOSS   | ADD LISTENER ‘dns_name’ ( <add_listener_option> )  
   | MODIFY LISTENER ‘dns_name’ ( <modify_listener_option> )  
   | RESTART LISTENER ‘dns_name’  
   | REMOVE LISTENER ‘dns_name’  
   | OFFLINE  
  }  
[ ; ]  
  
<set_option_spec> ::=   
    AUTOMATED_BACKUP_PREFERENCE = { PRIMARY | SECONDARY_ONLY| SECONDARY | NONE }  
  | FAILURE_CONDITION_LEVEL  = { 1 | 2 | 3 | 4 | 5 }   
  | HEALTH_CHECK_TIMEOUT = milliseconds  
  | DB_FAILOVER  = { ON | OFF }   
  | REQUIRED_SYNCHRONIZED_SECONDARIES_TO_COMMIT = { integer }
  
<server_instance> ::=   
 { 'system_name[\instance_name]' | 'FCI_network_name[\instance_name]' }  
  
<add_replica_spec>::=  
  <server_instance> WITH  
    (  
       ENDPOINT_URL = 'TCP://system-address:port',  
       AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT | CONFIGURATION_ONLY },  
       FAILOVER_MODE = { AUTOMATIC | MANUAL }   
       [ , <add_replica_option> [ ,...n ] ]  
    )   
  
  <add_replica_option>::=  
       SEEDING_MODE = { AUTOMATIC | MANUAL }   
     | BACKUP_PRIORITY = n  
     | SECONDARY_ROLE ( {   
          ALLOW_CONNECTIONS = { NO | READ_ONLY | ALL }   
        | READ_ONLY_ROUTING_URL = 'TCP://system-address:port'   
          } )  
     | PRIMARY_ROLE ( {   
          ALLOW_CONNECTIONS = { READ_WRITE | ALL }   
        | READ_ONLY_ROUTING_LIST = { ( ‘<server_instance>’ [ ,...n ] ) | NONE }   
          } )  
     | SESSION_TIMEOUT = seconds  
  
<modify_replica_spec>::=  
  <server_instance> WITH  
    (    
       ENDPOINT_URL = 'TCP://system-address:port'   
     | AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT }   
     | FAILOVER_MODE = { AUTOMATIC | MANUAL }   
     | SEEDING_MODE = { AUTOMATIC | MANUAL }   
     | BACKUP_PRIORITY = n  
     | SECONDARY_ROLE ( {   
          ALLOW_CONNECTIONS = { NO | READ_ONLY | ALL }   
        | READ_ONLY_ROUTING_URL = 'TCP://system-address:port'   
          } )  
     | PRIMARY_ROLE ( {   
          ALLOW_CONNECTIONS = { READ_WRITE | ALL }   
        | READ_ONLY_ROUTING_LIST = { ( ‘<server_instance>’ [ ,...n ] ) | NONE }   
          } )  
     | SESSION_TIMEOUT = seconds  
    )   
  
<add_availability_group_spec>::=  
 <ag_name> WITH  
    (  
       LISTENER_URL = 'TCP://system-address:port',  
       AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT },  
       FAILOVER_MODE = MANUAL,  
       SEEDING_MODE = { AUTOMATIC | MANUAL }  
    )  
  
<modify_availability_group_spec>::=  
 <ag_name> WITH  
    (  
       LISTENER = 'TCP://system-address:port'  
       | AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT }  
       | SEEDING_MODE = { AUTOMATIC | MANUAL }  
    )  
  
<add_listener_option> ::=  
   {  
      WITH DHCP [ ON ( <network_subnet_option> ) ]  
    | WITH IP ( { ( <ip_address_option> ) } [ , ...n ] ) [ , PORT = listener_port ]  
   }  
  
  <network_subnet_option> ::=  
     ‘four_part_ipv4_address’, ‘four_part_ipv4_mask’    
  
  <ip_address_option> ::=  
     {   
        ‘four_part_ipv4_address’, ‘four_part_ipv4_mask’  
      | ‘ipv6_address’  
     }  
  
<modify_listener_option>::=  
    {  
       ADD IP ( <ip_address_option> )   
     | PORT = listener_port  
    }  
  
```  
  
## <a name="arguments"></a>Аргументы  
 *имя_группы*  
 Указывает имя новой группы доступности. *имя_группы* должен быть допустимым [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] идентификатор и оно должно быть уникальным во всех группах доступности в кластере WSFC.  
  
 AUTOMATED_BACKUP_PREFERENCE  **=**  {ОСНОВНОЙ | SECONDARY_ONLY | ВТОРИЧНЫЙ | НЕТ}  
 Указывает приоритет, согласно которому задание резервного копирования вычисляет первичную реплику при выборе места для создания резервных копий. Вы можете написать скрипт для того, чтобы задание резервного копирования учитывало приоритет автоматического резервного копирования. Важно понимать, что приоритет не определяется [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], поэтому он не влияет на выполнение нерегламентированного резервного копирования.  
  
 Поддерживается только в первичной реплике.  
  
 Возможны следующие значения.  
  
 PRIMARY  
 Указывает, что резервное копирования должно всегда выполняться на первичной реплике. Данный параметр является полезным, если вам требуются такие функции резервного копирования, как создание разностных резервных копий, которые не поддерживаются при выполнении резервного копирования на вторичной реплике.  
  
> [!IMPORTANT]  
>  Если планируется использовать доставку журналов для подготовки баз данных-получателей для группы доступности, задайте параметру автоматизированного резервного копирования значение **Первичная** до тех пор, пока все базы данных-получатели не будут подготовлены и присоединены к группе доступности.  
  
 SECONDARY_ONLY  
 Указывает, что резервное копирование никогда не выполняется на первичной реплике. Если первичная реплика является единственной репликой, находящейся в режиме «в сети», резервное копирование не будет выполняться.  
  
 SECONDARY  
 Указывает, что резервное копирование должно выполняться на вторичной реплике, за исключением тех случаев, когда в режиме «в сети» находится только первичная реплика. В этом случае резервное копирование будет выполняться на первичной реплике. Это поведение по умолчанию.  
  
 None  
 Указывает, что вы предпочитаете, чтобы задания резервного копирования пропускали реплики доступности при выборе реплики для создания резервных копий. Примечание. Задания резервного копирования могут учитывать другие факторы, например приоритет резервного копирования каждой реплики доступности в сочетании с ее состоянием работоспособности и соединения.  
  
> [!IMPORTANT]  
>  Принудительного применения параметра AUTOMATED_BACKUP_PREFERENCE не существует. Интерпретация данного приоритета зависит от логики (при ее наличии), которая внесена в задания резервного копирования для баз данных в указанной группе доступности. Параметр автоматического резервного копирования не влияет на выполнение нерегламентированного резервного копирования. Дополнительные сведения см. в разделе [Настройка резервного копирования в репликах доступности &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/configure-backup-on-availability-replicas-sql-server.md).  
  
> [!NOTE]  
>  Чтобы просмотреть автоматического резервного копирования для существующей группы доступности, выберите **automated_backup_preference** или **automated_backup_preference_desc** столбец [ sys.availability_groups](../../relational-databases/system-catalog-views/sys-availability-groups-transact-sql.md) представления каталога. Кроме того [sys.fn_hadr_backup_is_preferred_replica &#40; Transact-SQL &#41; ](../../relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql.md) может использоваться для определения предпочитаемой репликой резервного копирования.  Эта функция всегда возвращает значение 1 при наличии хотя бы одной реплики, даже если `AUTOMATED_BACKUP_PREFERENCE = NONE`.  
  
 FAILURE_CONDITION_LEVEL  **=**  {1 | 2 | **3** | 4 | 5}  
 Указывает, какие условия сбоя могут запустить автоматический переход на другой ресурс в этой группе доступности. FAILURE_CONDITION_LEVEL задается на уровне группы, но только на репликах доступности, настроенных для режима доступности синхронной фиксации (AVAILIBILITY_MODE  **=**  SYNCHRONOUS_COMMIT). Кроме того, условия сбоя могут запустить автоматический переход на другой ресурс только в том случае, если первичная и Вторичная реплики настроены на режим автоматического перехода на другой ресурс (FAILOVER_MODE  **=**  АВТОМАТИЧЕСКОГО) и Вторичная реплика в данный момент синхронизирована с первичной репликой.  
  
 Поддерживается только в первичной реплике.  
  
 Уровни условий сбоя (1–5) варьируются от наименее ограничительного уровня 1 до наиболее ограничительного уровня 5. Заданный уровень условий включает в себя ограничения всех предыдущих уровней. Таким образом, наиболее строгий уровень 5 включает в себя ограничения уровней с 1 по 4, уровень 4 содержит ограничения уровней с 1 по 3 и т. д. Уровни условий сбоя описаны в следующей таблице.  
  
|Level|Условия сбоя|  
|-----------|-----------------------|  
|1|Указывает, что следует запустить автоматический переход на другой ресурс при возникновении любой из следующих ситуаций.<br /><br /> Служба [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] остановлена.<br /><br /> Аренда группы доступности для подключения к кластеру WSFC истекла, поскольку от экземпляра сервера не было получено сообщение ACK. Дополнительные сведения см. в разделе [Принцип работы. Время ожидания аренды AlwaysOn в SQL Server](http://blogs.msdn.com/b/psssql/archive/2012/09/07/how-it-works-sql-server-Always%20On-lease-timeout.aspx).|  
|2|Указывает, что следует запустить автоматический переход на другой ресурс при возникновении любой из следующих ситуаций.<br /><br /> Экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не подключается к кластеру, а определяемый пользователем порог HEALTH_CHECK_TIMEOUT группы доступности превышен.<br /><br /> Реплика доступности находится в неисправном состоянии.|  
|3|Указывает, что следует запустить автоматический переход на другой ресурс в случае появления критических внутренних ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], таких как потерянные спин-блокировки, серьезные нарушения доступа для записи или формирование слишком больших дампов.<br /><br /> Это поведение по умолчанию.|  
|4|Указывает, что следует запустить автоматический переход на другой ресурс в случае появления не столь серьезных внутренних ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], например устойчивое состояние нехватки памяти в пуле внутренних ресурсов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|5|Указывает, что следует запустить автоматический переход на другой ресурс при любом удовлетворяющим условиям состоянии сбоя, включая:<br /><br /> Исчерпание рабочих потоков SQL Engine.<br /><br /> Обнаружение неразрешимой взаимоблокировки.|  
  
> [!NOTE]  
>  Отсутствие ответа экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на клиентские запросы не является существенным для групп доступности.  
  
 Значения FAILURE_CONDITION_LEVEL и HEALTH_CHECK_TIMEOUT определяют *гибкой политики отработки отказа* для заданной группы. Данная гибкая политика отработки отказа предоставляет гранулярное управление условиями, которые могут вызвать автоматический переход на другой ресурс. Дополнительные сведения см. в разделе [гибкая политика отработки отказа для автоматического перехода на другой ресурс для группы доступности &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/flexible-automatic-failover-policy-availability-group.md).  
  
 HEALTH_CHECK_TIMEOUT  **=**  *миллисекунд*  
 Указывает время ожидания (в миллисекундах) для [sp_server_diagnostics](../../relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql.md) системные хранимые процедуры возвращают сведения о состоянии сервера, прежде чем кластер WSFC признает, что экземпляр сервера работает медленно или завис. HEALTH_CHECK_TIMEOUT задано на уровне группы, но только на репликах доступности, настроенных для режима доступности синхронной фиксации с автоматическим переходом на другой (AVAILIBILITY_MODE  **=**  СИНХРОННОЙ _COMMIT).  Более того, истечения времени ожидания проверки работоспособности можно запустить автоматический переход на другой ресурс только в том случае, если первичная и Вторичная реплики настроены на режим автоматического перехода на другой ресурс (FAILOVER_MODE  **=**  АВТОМАТИЧЕСКОГО) и сервер-получатель реплика синхронизируется с первичной репликой.  
  
 Значение параметра HEALTH_CHECK_TIMEOUT по умолчанию — 30 000 миллисекунд (30 секунд). Минимальное значение — 15 000 миллисекунд (15 секунд), а максимальное значение — 4 294 967 295 миллисекунд.  
  
 Поддерживается только в первичной реплике.  
  
> [!IMPORTANT]  
>  **sp_server_diagnostics** не выполняет проверку работоспособности на уровне базы данных.  
  
 DB_FAILOVER  **=**  {ON | {OFF}  
 Задает ответ, выполняемое при первичной реплике базы данных находится в автономном режиме. Если задано значение ON, любое состояние, отличное от ONLINE для базы данных в группе доступности инициирует автоматический переход на другой. Если этот параметр имеет значение OFF, только работоспособности экземпляра используется для запуска автоматического перехода на другой ресурс.  
 
 Дополнительные сведения о параметре см. в разделе [параметр обнаружения работоспособности уровня базы данных](../../database-engine/availability-groups/windows/sql-server-always-on-database-health-detection-failover-option.md) 

 
 REQUIRED_SYNCHRONIZED_SECONDARIES_TO_COMMIT   
 Появился в SQL Server 2017 г. Позволяет задать минимальное число синхронных вторичных реплик, необходимые для фиксации, прежде чем основной фиксирует транзакцию. Гарантирует, что транзакции SQL Server будет ожидать до момента журналы транзакций будут обновлены на минимальное число вторичных реплик. Значение по умолчанию — 0, что дает то же поведение, что SQL Server 2016. Минимальное значение — 0. Максимальное значение — количество реплик минус 1. Этот параметр относится к репликам в режиме синхронной фиксации. Когда реплики находятся в режиме синхронной фиксации, операций записи на первичной реплике ждать до записи на вторичных репликах синхронной фиксации в журнал транзакций базы данных реплики. Если SQL Server, на котором размещена вторичная реплика перестает отвечать, SQL Server, на котором размещена первичная реплика отметит, вторичная реплика не СИНХРОНИЗИРОВАНЫ и продолжить. При отвечать на запросы база данных переходит в оперативный режим будет в состоянии «не синхронизировано» и реплика помечается как имеющий неполадки до основного можно вновь сделать ее синхронной. Данный параметр гарантирует, что первичная реплика не продолжится до минимальное число реплик, которые были зафиксированы каждой транзакции. Если минимальное число реплик недоступен фиксации на сервере-источнике завершится ошибкой. Для типа кластера `EXTERNAL` параметр изменяется при добавлении группы доступности для ресурса кластера. В разделе [высокий уровень доступности и защиты данных в конфигурации группы доступности](../../linux/sql-server-linux-availability-group-ha.md).
  
 Добавление базы данных *имя_базы_данных*  
 Задает список из одной или нескольких пользовательских баз данных, которые нужно добавить в группу доступности. Эти базы данных должны размещаться в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], где размещается текущая первичная реплика. Можно указать несколько баз данных для группы доступности, но каждая база данных может принадлежать только к одной группе доступности. Сведения о типе баз данных, которые могут поддерживаться группой доступности см. в разделе [условия, ограничения и рекомендации для групп доступности AlwaysOn &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md). Чтобы узнать, какие локальные базы данных уже принадлежит к группе доступности, в разделе **replica_id** столбца в [sys.databases](../../relational-databases/system-catalog-views/sys-databases-transact-sql.md) представления каталога.  
  
 Поддерживается только в первичной реплике.  
  
> [!NOTE]  
>  После создания группы доступности необходимо подключиться к каждому экземпляру сервера, где размещается вторичная реплика, а затем подготовить каждую базу данных-получатель и включить ее в группу доступности. Дополнительные сведения см. в статье [Запуск перемещения данных для базы данных-получателя AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/start-data-movement-on-an-always-on-secondary-database-sql-server.md).  
  
 УДАЛИТЬ базу данных *имя_базы_данных*  
 Удаляет указанную базу данных-источник и соответствующие базы данных-получатели из группы доступности. Поддерживается только в первичной реплике.  
  
 Сведения о рекомендуемых дальнейшие действия после удаления базы данных доступности из группы доступности см. в разделе [удалить базы данных-источника из группы доступности &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/remove-a-primary-database-from-an-availability-group-sql-server.md).  
  
 ADD REPLICA ON  
 Задает до восьми экземпляров SQL Server для размещения вторичных реплик в группе доступности.  Каждая реплика задается по адресу экземпляра своего сервера, за которым следует предложение WITH (…).  
  
 Поддерживается только в первичной реплике.  
  
 Необходимо включить каждую новую вторичную реплику в группу доступности. Дополнительные сведения см. в описании параметра JOIN далее в этом разделе.  
  
 \<экземпляр сервера >  
 Задает адрес экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , на котором размещена реплика. Формат адреса зависит от вида экземпляра (именованный или по умолчанию) и типа экземпляра (изолированный или экземпляр отказоустойчивого кластера). Синтаксис:  
  
 { '*системное_имя*[\\*имя_экземпляра*]' | '*сетевое_имя_FCI*[\\*имя_экземпляра*]' }  
  
 Этот адрес состоит из следующих компонентов:  
  
 *системное_имя*  
 Имя NetBIOS компьютера, на котором расположен целевой экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот компьютер должен быть узлом кластера WSFC.  
  
 *сетевое_имя_FCI*  
 Это сетевое имя, используемое для доступа к отказоустойчивому кластеру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Используйте его, если экземпляр сервера является участником — партнером по обеспечению отработки отказа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Выполнение SELECT [@@SERVERNAME ](../../t-sql/functions/servername-transact-sql.md) в FCI экземпляр сервера возвращает всю его "*FCI_network_name*[\\*имя_экземпляра*]" строки (который является Полное имя реплики).  
  
 *имя_экземпляра*  
 Имя экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , размещенного на *СИСТЕМНОЕ_ИМЯ* или *FCI_network_name* с включенной функцией Always On. Для экземпляра сервера по умолчанию указывать параметр *имя_экземпляра* не обязательно. В именах экземпляров не учитывается регистр символов. На экземпляре изолированного сервера, этот параметр имеет значение, возвращаемое при выполнении инструкции SELECT [@@SERVERNAME](../../t-sql/functions/servername-transact-sql.md).  
  
 \  
 Разделитель, используемый только при указании *имя_экземпляра*, чтобы отделить от *СИСТЕМНОЕ_ИМЯ* или *FCI_network_name*.  
  
 Сведения о компонентах, необходимых для узлов WSFC и экземпляры сервера в разделе [условия, ограничения и рекомендации для групп доступности AlwaysOn &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).  
  
 ENDPOINT_URL = "TCP: / /*системный_адрес*:*порт*"  
 Указывает URL-адрес [конечной точки зеркального отображения базы данных](../../database-engine/database-mirroring/the-database-mirroring-endpoint-sql-server.md) на экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , где будет размещаться реплика доступности, вы добавляете или изменяете.  
  
 ENDPOINT_URL обязательно требуется в предложении ADD REPLICA ON и является необязательным в предложении MODIFY REPLICA ON.  Дополнительные сведения см. в разделе [Указание URL-адреса конечной точки при добавлении или изменении реплики доступности (SQL Server)](../../database-engine/availability-groups/windows/specify-endpoint-url-adding-or-modifying-availability-replica.md).  
  
 **"**TCP**://***системный_адрес***:***порт***"**  
 Задает URL-адрес для конечной точки или URL-адрес маршрутизации, доступный только для чтения. Параметры URL-адреса:  
  
 *system-address*  
 Это строка, такая как адрес системы, полное доменное имя или IP-адрес, однозначно идентифицирующий целевую компьютерную систему.  
  
 *port*  
 Номер порта, связанный с конечной точкой зеркального отображения экземпляра сервера (для параметра ENDPOINT_URL), или номер порта, используемый компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)] в экземпляре сервера (для параметра READ_ONLY_ROUTING_URL).  
  
 AVAILABILITY_MODE  **=**  {SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT НЕ БОЛЕЕ ЧЕМ | CONFIGURATION_ONLY}  
 Указывает, должна ли первичная реплика ждать подтверждения фиксации (записи) записей журнала на диск от вторичной реплики перед тем, как фиксировать транзакцию в указанной базе данных. Фиксация транзакций в других базах данных, расположенных в этой первичной реплике, может выполняться независимо.  
  
 SYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика может фиксировать транзакции только после их записи на данной вторичной реплике (режим синхронной фиксации). Вы можете указать SYNCHRONOUS_COMMIT не более чем для трех реплик, включая первичную.  
  
 ASYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика фиксирует транзакции без ожидания записи журнала на данной вторичной реплике (режим доступности синхронной фиксации). Вы можете указать ASYNCHRONOUS_COMMIT не более чем для пяти реплик доступности, включая первичную реплику.  

 CONFIGURATION_ONLY указывает, что первичная реплика синхронно фиксировать метаданные конфигурации группы доступности к базе данных master в этой реплике. Реплика не будет содержать данные пользователя. Этот параметр:

- Может размещаться в любом выпуске SQL Server, включая экспресс-выпуск.
- Требуется реплики CONFIGURATION_ONLY должен иметь тип конечной точки зеркального отображения данных `WITNESS`.
- Не может быть изменен.
- Не является допустимым при `CLUSTER_TYPE = WSFC`. 

   Дополнительные сведения см. в разделе [конфигурации реплицируют только](../../linux/sql-server-linux-availability-group-ha.md).
    
 AVAILABILITY_MODE обязательно требуется в предложении ADD REPLICA ON и является необязательным в предложении MODIFY REPLICA ON. Дополнительные сведения см. в статье [Режимы доступности (группы доступности AlwaysOn)](../../database-engine/availability-groups/windows/availability-modes-always-on-availability-groups.md).  
  
 FAILOVER_MODE  **=**  {АВТОМАТИЧЕСКОГО | ВРУЧНУЮ}  
 Указывает режим отработки отказов определяемой реплики доступности.  
  
 AUTOMATIC  
 Включает автоматический переход на другой ресурс. AUTOMATIC поддерживается, только если указан параметр AVAILABILITY_MODE = SYNCHRONOUS_COMMIT. Значение AUTOMATIC можно задать для двух реплик доступности, включая первичную.  
  
> [!NOTE]  
>  Экземпляры отказоустойчивого кластера SQL Server не поддерживают автоматический переход на другой ресурс с учетом групп доступности, поэтому любая реплика доступности, размещенная в них, должна быть настроена для перехода на другой ресурс вручную.  
  
 MANUAL  
 Обеспечивает переход на другой ресурс вручную или принудительно (*Принудительная отработка отказа*) администратором базы данных.  
  
 FAILOVER_MODE обязательно требуется в предложении ADD REPLICA ON и является необязательным в предложении MODIFY REPLICA ON. Существует два вида перехода на другой ресурс вручную: переход на другой ресурс вручную без потери данных и принудительный переход на другой ресурс (с возможной потерей данных), которые поддерживаются в зависимости от различных условий.  Дополнительные сведения см. далее в подразделе [Отработка отказа и режимы отработки отказа (группы доступности AlwaysOn)](../../database-engine/availability-groups/windows/failover-and-failover-modes-always-on-availability-groups.md).  
  
 SEEDING_MODE  **=**  {АВТОМАТИЧЕСКОГО | ВРУЧНУЮ}  
 Указывает, как вторичная реплика изначально заполняется данными.  
  
 AUTOMATIC  
 Позволяет прямого присвоения начальных значений. Этот метод будет инициализировать вторичную реплику по сети. Этот метод не требует резервного копирования и восстановления копии базы данных-источника в реплике.  
  
> [!NOTE]  
>  Для прямого присвоения начальных значений, необходимо разрешить создание базы данных во вторичной реплике, вызвав **ALTER AVAILABILITY GROUP** с **GRANT CREATE ANY DATABASE** параметр.  
  
 MANUAL  
 Указывает ручного заполнения (по умолчанию). Этот метод требуется для создания резервной копии базы данных на первичной реплике и вручную восстановите эту резервную копию на вторичной реплике.  
  
 BACKUP_PRIORITY**=***n*  
 Указывает приоритет выполнения резервного копирования на данной реплике по отношению к другим репликам из той же группы доступности. Значение представляет собой целое число в диапазоне от 0 до 100. Данные величины имеют следующие значения:  
  
-   1..100 показывает, что реплику доступности можно выбрать для выполнения резервного копирования. 1 указывает минимальный приоритет, 100 — наивысший приоритет. При BACKUP_PRIORITY = 1 реплика доступности будет выбрана для создания резервных копий только в том случае, если реплики доступности с более высоким приоритетом отсутствуют.  
  
-   Значение 0 указывает, что эта реплика доступности никогда не будет использоваться для создания резервных копий. Этот параметр может быть полезным, например, для исключения удаленной реплики доступности, создание резервных копий на которой нежелательно.  
  
 Дополнительные сведения см. в статье [Активные вторичные реплики, резервное копирование во вторичных репликах (группы доступности Always On)](../../database-engine/availability-groups/windows/active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).  
  
 SECONDARY_ROLE **(** ... **)**  
 Задает параметры роли, которые будут действовать, если эта реплика доступности в данный момент имеет вторичную роль (то есть когда реплика является вторичной). В скобках укажите один или два параметра вторичной роли. Если указываются оба параметра, используйте список с разделителями-запятыми.  
  
 Параметры вторичной роли:  
  
 ALLOW_CONNECTIONS  **=**  {НЕТ | READ_ONLY | ALL}  
 Указывает, могут ли базы данных заданной реплики доступности, играющей роль вторичной (т. е. служащей вторичной репликой), принимать соединения от клиентов. Может принимать одно из следующих значений:  
  
 NO  
 Для баз данных-получателей этой реплики соединения пользователя не разрешаются. Для них не разрешен доступ для чтения. Это поведение по умолчанию.  
  
 READ_ONLY  
 Разрешаются только соединения с базами данных во вторичной реплике, в которых свойство «назначение приложения» равно **ReadOnly**. Дополнительные сведения об этом свойстве см. в разделе [Using Connection String Keywords with SQL Server Native Client](../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md).  
  
 ALL  
 К базам данных во вторичной реплике разрешаются все соединения на доступ только для чтения.  
  
 Дополнительные сведения см. в разделе [Активные вторичные реплики: доступные только для чтения вторичные реплики (группы доступности AlwaysOn)](../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).  
  
 READ_ONLY_ROUTING_URL **= "**TCP**://***системный_адрес***:***порт***"**  
 Указывает URL-адрес, используемый для маршрутизации запросов на соединение с намерением чтения к этой реплике доступности. Этот URL-адрес прослушивается компонентом ядра СУБД SQL Server. Обычно экземпляр по умолчанию компонента ядра СУБД SQL Server прослушивает TCP-порт 1433.  
  
 Для именованного экземпляра, номер порта можно получить путем запроса **порт** и **type_desc** столбцы [sys.dm_tcp_listener_states](../../relational-databases/system-dynamic-management-views/sys-dm-tcp-listener-states-transact-sql.md) динамическое административное представление. Экземпляр сервера использует прослушиватель Transact-SQL (**type_desc = «TSQL»**).  
  
 Дополнительные сведения о вычислении URL маршрутизации только для чтения для реплики доступности см. в разделе [вычисление значения read_only_routing_url для AlwaysOn](http://blogs.msdn.com/b/mattn/archive/2012/04/25/calculating-read-only-routing-url-for-Always%20On.aspx).  
  
> [!NOTE]  
>  Для именованного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] прослушиватель Transact-SQL должен быть настроен для использования определенного порта. Дополнительные сведения см. в разделе [Настройка сервера для прослушивания указанного TCP-порта (диспетчер конфигурации SQL Server)](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md).  
  
 PRIMARY_ROLE **(** ... **)**  
 Задает параметры роли, которые будут действовать, если эта реплика доступности в данный момент имеет первичную роль (то есть когда реплика является первичной). В скобках укажите один или два параметра первичной роли. Если указываются оба параметра, используйте список с разделителями-запятыми.  
  
 Параметры первичной роли:  
  
 ALLOW_CONNECTIONS  **=**  {READ_WRITE | ALL}  
 Указывает тип соединений, которые принимаются от клиентов базами данных заданной реплики доступности, которая играет роль первичной. Это может быть один из следующих типов:  
  
 READ_WRITE  
 Соединения, у которых свойство "Назначение приложения" равно **ReadOnly** , не разрешены.  Если свойство «Назначение приложения» имеет значение **ReadWrite** или не задано, то соединение разрешено. Дополнительные сведения о свойстве соединения «Назначение приложения» см. в разделе [Using Connection String Keywords with SQL Server Native Client](../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md).  
  
 ALL  
 Разрешаются все соединения с базами данных в первичной реплике. Это поведение по умолчанию.  
  
 READ_ONLY_ROUTING_LIST  **=**  { **("**\<экземпляр_сервера >**"** [ **,**... *n* ] **)** | НЕТ}  
 Задает список экземпляров сервера (с разделителями-запятыми), на которых будут размещаться реплики доступности для этой группы доступности, удовлетворяющие следующим требованиям при работе во вторичной роли.  
  
-   Настроены для разрешения всех соединений или соединений только для чтения (см. выше аргумент ALLOW_CONNECTIONS параметра SECONDARY_ROLE).  
  
-   Определен URL-адрес маршрутизации только для чтения (см. выше аргумент READ_ONLY_ROUTING_URL параметра SECONDARY_ROLE).  
  
 READ_ONLY_ROUTING_LIST имеет следующие значения.  
  
 \<экземпляр сервера >  
 Задает адрес экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], где размещается вторичная реплика доступности, которая доступна для чтения при работе во вторичной роли.  
  
 Используйте список с разделителями-запятыми, чтобы указать все экземпляры сервера, где может размещаться доступная для чтения вторичная реплика. При маршрутизации только для чтения будет учитываться порядок, в котором экземпляры сервера заданы в списке. Если включить экземпляр сервера, где размещается реплика, в список маршрутизации только для чтения, то обычно рекомендуется поместить этот экземпляр сервера в конец списка, чтобы подключения с намерением чтения направлялись на вторичную реплику, если она доступна.  
  
 Начиная с версии [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)], вы можете балансировать нагрузку запросов доступ только для чтения на вторичные реплики для чтения. Можно указать, установив реплики в наборе вложенных скобок в списке маршрутизации только для чтения. Дополнительные сведения и примеры см. в разделе [Настройка балансировки нагрузки между репликами только для чтения](../../database-engine/availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md#loadbalancing).  
  
 None  
 Указывает, что, когда эта реплика доступности является первичной, маршрутизация только для чтения не поддерживается. Это поведение по умолчанию. При использовании с параметром MODIFY REPLICA ON это значение отключает существующий список (если он есть).  
  
 SESSION_TIMEOUT  **=**  *секунд*  
 Указывает интервал времени ожидания сеанса в секундах. Если этот параметр не определить, интервал времени по умолчанию — 10 секунд. Минимальное значение составляет 5 секунд.  
  
> [!IMPORTANT]  
>  Рекомендуется установить интервал времени ожидания в 10 секунд или более.  
  
 Дополнительные сведения о времени ожидания сеанса см. в разделе [Обзор из группы доступности AlwaysOn &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).  
  
 MODIFY REPLICA ON  
 Изменяет любую реплику группы доступности. Список реплик для изменения содержит адрес экземпляра сервера с предложением WITH (…) для каждой реплики.  
  
 Поддерживается только в первичной реплике.  
  
 REMOVE REPLICA ON  
 Удаляет указанную вторичную реплику из группы доступности. Текущая первичная реплика не может быть удалена из группы доступности. После удаления реплика перестает получать данные. Принадлежащие ей базы данных-получатели удаляются из группы доступности и переходят в состояние RESTORING.  
  
 Поддерживается только в первичной реплике.  
  
> [!NOTE]  
>  Если удаляется недоступная или сбойная реплика, то после ее возвращения в режим «в сети» она больше не будет относиться к этой группе доступности.  
  
 JOIN  
 Приводит к созданию вторичной реплики локальным экземпляром сервера в указанной группе доступности.  
  
 Поддерживается только во вторичной реплике, которая еще не включена в группу доступности.  
  
 Дополнительные сведения см. в статьях [Присоединение вторичной реплики к группе доступности (SQL Server)](../../database-engine/availability-groups/windows/join-a-secondary-replica-to-an-availability-group-sql-server.md).  
  
 FAILOVER  
 Инициирует переход группы доступности на другой ресурс вручную без потери данных с переходом на вторичную реплику, к которой вы подключились. Реплика, на которой вводится команда отработки отказа цели отработки отказа называется.  Цель перехода на другой ресурс примет на себя роль первичной, восстановит собственные копии каждой базы данных и переведет их в режим «в сети» в качестве баз данных-источников. Бывшая первичная реплика параллельно переходит в роль вторичной, а ее базы данных становятся базами данных-получателями и немедленно приостанавливаются. Эти роли могут меняться местами при последовательных сбоях.  
  
 Поддерживается только во вторичной реплике с синхронной фиксацией, которая в данный момент синхронизирована с первичной репликой. Заметьте, что для синхронизации вторичной реплики первичная реплика также должна работать в режиме синхронной фиксации.  
  
> [!NOTE]  
>  Команда отработки отказа завершает работу сразу после того, как цель перехода принимает команду. Однако восстановление базы данных происходит асинхронно после того, как группа доступности закончит отработку отказа.  
  
 Сведения об ограничениях, предварительные условия и рекомендации по выполнению плановую отработку отказа вручную, в разделе [выполнения плановой отработки отказа вручную для группы доступности &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/perform-a-planned-manual-failover-of-an-availability-group-sql-server.md).  
  
 FORCE_FAILOVER_ALLOW_DATA_LOSS  
 > [!CAUTION]  
>  Принудительная обработка отказа, которая может привести к потере некоторых данных, используется исключительно в качестве метода аварийного восстановления. Поэтому настоятельно рекомендуется выполнять принудительную отработку отказа только в том случае, если первичная реплика не выполняется и можно пойти на риск потери данных, а также когда требуется срочно восстановить группу доступности.  
  
 Поддерживается только в реплике, роль которой находится в состоянии SECONDARY или RESOLVING. --Реплика, на которой вводится команда отработки отказа называется *цели отработки отказа*.  
  
 Принудительная обработка отказа группы доступности с возможной потерей данных и переходом на другой указанный ресурс. Цель перехода на другой ресурс примет на себя роль первичной, восстановит собственные копии каждой базы данных и переведет их в режим «в сети» в качестве баз данных-источников. Во всех оставшихся вторичных репликах все базы данных-получатели будут приостановлены до их возобновления вручную. Если бывшая первичная реплика станет доступной, она переключится в роль вторичной; ее базы данных станут базами данных-получателями и будут приостановлены.  
  
> [!NOTE]  
>  Команда отработки отказа завершает работу сразу после того, как цель перехода принимает команду. Однако восстановление базы данных происходит асинхронно после того, как группа доступности закончит отработку отказа.  
  
 Сведения об ограничениях, предварительных условиях и рекомендациях для принудительной отработки отказа и влиянии принудительной отработки отказа на бывшей основной базы данных в группе доступности. в разделе [выполнение принудительной отработки отказа вручную группы доступности Группы &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).  
  
 Добавление ПРОСЛУШИВАТЕЛЯ **"***dns_name***" (** \<параметр_добавления_прослушивателя > **)**  
 Определяет новый прослушиватель группы доступности. Поддерживается только в первичной реплике.  
  
> [!IMPORTANT]  
>  Перед созданием первого прослушивателя настоятельно рекомендуется ознакомиться с [Создание или настройка прослушивателя группы доступности &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).  
>   
>  После создания прослушивателя для заданной группы доступности настоятельно рекомендуется выполнить следующие действия.  
>   
>  -   Попросите сетевого администратора зарезервировать IP-адрес, который будет использоваться только этим прослушивателем.  
> -   Передайте имя узла DNS прослушивателя разработчикам приложения для использования в строке подключения при запросе клиентских соединений к данной группе доступности.  
  
 *dns_name*  
 Указывает имя узла DNS для прослушивателя группы доступности. Имя DNS прослушивателя должно быть уникальным в домене и в NetBIOS.  
  
 *dns_name* является строковым значением. Это имя может содержать только буквы, цифры, дефисы (-) и знаки подчеркивания (_) в любом порядке. В именах узлов DNS учитывается регистр. Максимальная длина равна 63 символам.  
  
 Мы рекомендуем указывать строку, которая поддается толкованию. Например, для группы доступности с именем `AG1`понятным именем узла DNS будет `ag1-listener`.  
  
> [!IMPORTANT]  
>  NetBIOS распознает только первые 15 символов в dns_name. При наличии двух кластеров WSFC, которые управляются одной службой Active Directory, и попытке создать в обоих кластерах прослушивателей группы доступности с именами, содержащими более 15 символов, и одинаковым префиксом из 15 символов возникнет ошибка, указывающая, что не удалось подключиться к ресурсу с именем виртуальной сети. Дополнительные сведения о правилах именования префиксов для имен DNS см. в разделе [Присвоение имен доменов](http://technet.microsoft.com/library/cc731265\(WS.10\).aspx).  
  
 ПРИСОЕДИНЕНИЕ К ГРУППЕ ДОСТУПНОСТИ НА  
 Присоединяет к *распределенной группы доступности*. При создании распределенной группы доступности группы доступности в кластере, где она создана является первичной группы доступности. Группы доступности, которая присоединяется к группе доступности является вторичной группы доступности.  
  
 \<ag_name >  
 Указывает имя группы доступности, содержащийся в одной половине распределенной группы доступности.  
  
 ПРОСЛУШИВАТЕЛЬ **= "**TCP**://***системный_адрес***:***порт***"**  
 Указывает URL-адрес для прослушивателя, связанного с группой доступности.  
  
 Предложение ПРОСЛУШИВАТЕЛЯ является обязательным.  
  
 **"**TCP**://***системный_адрес***:***порт***"**  
 Указывает URL-адрес для прослушивателя, связанного с группой доступности. Параметры URL-адреса:  
  
 *system-address*  
 — Это строка, такие как имя системы, полное доменное имя или IP-адрес, однозначно идентифицирующий прослушивателя.  
  
 *port*  
 — Номер порта, который связан с конечной точкой зеркального отображения для группы доступности. Обратите внимание, что это не порта прослушивателя.  
  
 AVAILABILITY_MODE  **=**  {SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT НЕ БОЛЕЕ ЧЕМ}  
 Указывает, имеет ли первичная реплика ожидания вторичной группы доступности для подтверждения фиксации (записи) записи журнала на диск, прежде чем первичная реплика может фиксировать транзакцию в указанной базе данных.  
  
 SYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика будет ожидать фиксации транзакции, пока они не зафиксированы во вторичной группе доступности. Можно указать SYNCHRONOUS_COMMIT до двух групп доступности, включая первичной группы доступности.  
  
 ASYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика фиксирует транзакции, не дожидаясь этой вторичной группы доступности зафиксирует журнал. Можно указать asynchronous_commit не более чем до двух групп доступности, включая первичной группы доступности.  
  
 Предложение AVAILABILITY_MODE является обязательным.  
  
 FAILOVER_MODE  **=**  {ВРУЧНУЮ}  
 Указывает режим отработки отказа распределенной группы доступности.  
  
 MANUAL  
 Обеспечивает переход на другой ресурс вручную или Принудительный переход на другой ресурс вручную (обычно называется *Принудительная отработка отказа*) администратором базы данных.  
  
 Во вторичной группе доступности автоматический переход на другой ресурс не поддерживается.  
  
 SEEDING_MODE **=**  {АВТОМАТИЧЕСКОГО | ВРУЧНУЮ}  
 Указывает, как изначально заполнена вторичной группы доступности.  
  
 AUTOMATIC  
 Включение автоматического заполнения. Этот метод будет инициализировать во вторичной группе доступности по сети. Этот метод не требует резервного копирования и восстановления копии базы данных-источника на репликах вторичной группы доступности.  
  
 MANUAL  
 Указывает заполнение вручную. Этот метод необходимо создать резервную копию базы данных на первичной реплике и вручную восстановите эту резервную копию на реплику группы доступности вторичной.  
  
 ИЗМЕНЕНИЕ ГРУППЫ ДОСТУПНОСТИ НА  
 Изменяет параметры группы доступности группы доступности. Содержит список групп доступности, чтобы изменить имя группы доступности и WITH предложения (...) для каждой группы доступности.  
  
> [!IMPORTANT]  
>  Эта команда должна быть повторена на первичной группы доступности и экземпляров вторичной доступности группы.  
  
 ПРЕДОСТАВЬТЕ СОЗДАНИЕ ЛЮБОЙ БАЗЫ ДАННЫХ  
 Позволяет использовать группы доступности для создания баз данных от имени первичной реплике, которая поддерживает прямое присвоение начальных значений (SEEDING_MODE = AUTOMATIC). Этот параметр следует запускать на каждой вторичной реплике, которая поддерживает прямое присвоение начальных значений, после этого получатель присоединяется к группе доступности.  Требуется разрешение CREATE ANY DATABASE.  
  
 ЗАПРЕТИТЬ СОЗДАНИЕ ЛЮБОЙ БАЗЫ ДАННЫХ  
 Удаляет возможность создания баз данных от имени первичной реплики группы доступности.  
  
 \<параметр_добавления_прослушивателя >  
 ADD LISTENER принимает один из следующих параметров.  
  
 С использованием протокола DHCP [ON { **("***four_part_ipv4_address***«,»***four_part_ipv4_mask***")** }]  
 Указывает, что прослушиватель группы доступности будет использовать протокол DHCP.  Дополнительно можно использовать предложение ON, чтобы определить сеть, для которой будет создан прослушиватель. Протокол DHCP имеет ограничение на работу только с одной подсетью для каждого экземпляра сервера, на котором размещается реплика доступности в группе доступности.  
  
> [!IMPORTANT]  
>  Использовать протокол DHCP в производственной среде не рекомендуется. Если во время простоя аренда IP-адреса протокола DHCP истечет, то на регистрацию нового сетевого IP-адреса протокола DHCP, связанного с именем DNS-прослушивателя, уйдет дополнительное время, что скажется на производительности клиента. Однако протокол DHCP полезен при настройке среды разработки и проверки и позволяет проверить базовые функции групп доступности и их интеграцию с приложениями.  
  
 Например:  
  
 `WITH DHCP ON ('10.120.19.0','255.255.254.0')`  
  
 С IP-адресом **(** { **("***four_part_ipv4_address***«,»***four_part_ipv4_mask* **')** | **("***ipv6_address***")** } [ **,** ...  *n*  ] **)** [ **,** ПОРТ  **=**  *listener_port* ]  
 Указывает, что вместо использования протокола DHCP прослушиватель группы доступности будет использовать один или несколько статических IP-адресов. Чтобы создать группу доступности, охватывающую несколько подсетей, в конфигурации прослушивателя должен присутствовать один статический IP-адрес для каждой подсети. Для конкретной подсети статический IP-адрес может иметь формат IPv4 или IPv6. Свяжитесь с администратором сети, чтобы получить статический IP-адрес для каждой подсети, в которой будет размещена реплика доступности для новой группы доступности.  
  
 Например:  
  
 `WITH IP ( ('10.120.19.155','255.255.254.0') )`  
  
 *four_part_ipv4_address*  
 Задает IPv4-адрес, состоящий из четырех частей, для прослушивателя группы доступности. Например, `10.120.19.155`.  
  
 *four_part_ipv4_mask*  
 Задает IPv4-маску, состоящую из четырех частей, для прослушивателя группы доступности. Например, `255.255.254.0`.  
  
 *ipv6_address*  
 Задает IPv6-адрес для прослушивателя группы доступности. Например, `2001::4898:23:1002:20f:1fff:feff:b3a3`.  
  
 ПОРТ  **=**  *listener_port*  
 Указывает номер порта —*listener_port*— для использования прослушивателя группы доступности, который задается с помощью предложения WITH IP. Параметр PORT является необязательным.  
  
 По умолчанию поддерживается номер порта 1433. Однако из соображений безопасности, рекомендуется использовать другой номер порта.  
  
 Например: `WITH IP ( ('2001::4898:23:1002:20f:1fff:feff:b3a3') ) , PORT = 7777`.  
  
 MODIFY LISTENER **"***dns_name***" (** \<modify_listener_option > **)**  
 Изменяет существующий прослушиватель для данной группы доступности. Поддерживается только в первичной реплике.  
  
 \<modify_listener_option >  
 MODIFY LISTENER принимает один из следующих параметров:  
  
 Добавить IP { **("***four_part_ipv4_address***«,»***four_part_ipv4_mask***")**  |  **("**dns_name*ipv6_address***")** }  
 Добавляет указанный IP-адрес прослушивателя группы доступности, определяемое *dns_name*.  
  
 ПОРТ  **=**  *listener_port*  
 См. описание этого аргумента ранее в этом разделе.  
  
 ПЕРЕЗАПУСК ПРОСЛУШИВАТЕЛЯ **"***dns_name***"**  
 Перезапускает прослушиватель, который связан с указанным именем DNS. Поддерживается только в первичной реплике.  
  
 Удаление ПРОСЛУШИВАТЕЛЯ **"***dns_name***"**  
 Удаляет прослушиватель, который связан с указанным именем DNS. Поддерживается только в первичной реплике.  
  
 OFFLINE  
 Переводит группу доступности из режима «в сети» в режим «вне сети». У баз данных с синхронной фиксацией потеря данных невозможна.  
  
 После перехода группы доступности в режим «вне сети» ее базы данных становятся недоступными для клиентов, и невозможно перевести группу доступности обратно в режим «в сети». Таким образом, используйте параметр OFFLINE только во время миграции с [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] при переносе группы доступности на другой ресурс кластера WSFC.  
  
 Дополнительные сведения см. в разделе [занять доступности группы вне сети &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/take-an-availability-group-offline-sql-server.md).  
  
## <a name="prerequisites-and-restrictions"></a>Требования и ограничения  
 Сведения о предварительных требованиях и ограничениях на репликах доступности и на их компьютерах и экземплярах сервера, в разделе [условия, ограничения и рекомендации для групп доступности AlwaysOn &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).  
  
 Сведения об ограничениях на инструкции AVAILABILITY GROUP языка Transact-SQL см. в разделе [Обзор из инструкции Transact-SQL для групп доступности AlwaysOn &#40; SQL Server &#41; ](../../database-engine/availability-groups/windows/transact-sql-statements-for-always-on-availability-groups.md).  
  
## <a name="security"></a>безопасность  
  
### <a name="permissions"></a>Разрешения  
 Необходимо разрешение ALTER AVAILABILITY GROUP для группы доступности, разрешение CONTROL AVAILABILITY GROUP, разрешение ALTER ANY AVAILABILITY GROUP или разрешение CONTROL SERVER.  
  
## <a name="examples"></a>Примеры  
  
###  <a name="Join_Secondary_Replica"></a> A. Присоединение вторичной реплики к группе доступности  
 В следующем примере рассматривается присоединение вторичной реплики, с которой установлено соединение, к группе доступности `AccountsAG`.  
  
```SQL  
ALTER AVAILABILITY GROUP AccountsAG JOIN;  
GO  
```  
  
###  <a name="Force_Failover"></a> Б. Принудительный переход на другой ресурс группы доступности  
 В следующем примере выполняется принудительный переход группы доступности `AccountsAG` на вторичную реплику, с которой установлено соединение.  
  
```SQL
ALTER AVAILABILITY GROUP AccountsAG FORCE_FAILOVER_ALLOW_DATA_LOSS;  
GO  
```  
  
## <a name="see-also"></a>См. также:  
 [CREATE AVAILABILITY GROUP (Transact-SQL)](../../t-sql/statements/create-availability-group-transact-sql.md)   
 [ALTER DATABASE SET HADR (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql-set-hadr.md)   
 [DROP AVAILABILITY GROUP &#40; Transact-SQL &#41;](../../t-sql/statements/drop-availability-group-transact-sql.md)   
 [sys.availability_replicas &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-availability-replicas-transact-sql.md)   
 [sys.availability_groups &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-availability-groups-transact-sql.md)   
 [Поиск и устранение неисправностей конфигурации групп доступности #40; SQL Server &#41;](../../database-engine/availability-groups/windows/troubleshoot-always-on-availability-groups-configuration-sql-server.md)   
 [Обзор групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)   
 [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](../../database-engine/availability-groups/windows/listeners-client-connectivity-application-failover.md)  
  
  
