---
title: "table_constraint (Transact-SQL) | Документы Microsoft"
ms.custom: 
ms.date: 05/05/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine, sql-database
ms.service: 
ms.component: t-sql|statements
ms.reviewer: 
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
f1_keywords:
- CONSTRAINT_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- table_constraint
ms.assetid: ac2a11e0-cc77-4e27-b107-4fe5bc6f5195
caps.latest.revision: 59
author: edmacauley
ms.author: edmaca
manager: craigg
ms.workload: On Demand
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: 7f5265366f28f302e69a178f45baa4464efa1bfd
ms.contentlocale: ru-ru
ms.lasthandoff: 09/01/2017

---
# <a name="alter-table-tableconstraint-transact-sql"></a>Table_constraint ALTER TABLE (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-asdb-xxxx-xxx-md.md)]

  Указывает первичный ключ, UNIQUE, FOREIGN KEY, ограничение CHECK или определение DEFAULT, добавляемой в таблицу с помощью свойства [ALTER TABLE](../../t-sql/statements/alter-table-transact-sql.md).  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
[ CONSTRAINT constraint_name ]   
{   
    { PRIMARY KEY | UNIQUE }   
        [ CLUSTERED | NONCLUSTERED ]   
        (column [ ASC | DESC ] [ ,...n ] )  
        [ WITH FILLFACTOR = fillfactor   
        [ WITH ( <index_option>[ , ...n ] ) ]  
        [ ON { partition_scheme_name ( partition_column_name ... )  
          | filegroup | "default" } ]   
    | FOREIGN KEY   
        ( column [ ,...n ] )  
        REFERENCES referenced_table_name [ ( ref_column [ ,...n ] ) ]   
        [ ON DELETE { NO ACTION | CASCADE | SET NULL | SET DEFAULT } ]   
        [ ON UPDATE { NO ACTION | CASCADE | SET NULL | SET DEFAULT } ]   
        [ NOT FOR REPLICATION ]   
    | DEFAULT constant_expression FOR column [ WITH VALUES ]   
    | CHECK [ NOT FOR REPLICATION ] ( logical_expression )  
}  
```  
  
## <a name="arguments"></a>Аргументы  
 CONSTRAINT  
 Указывает начало определения ограничений PRIMARY KEY, UNIQUE, FOREIGN KEY и CHECK, а также предложения DEFAULT.  
  
 *constraint_name*  
 Имя ограничения. Имена ограничений должны подчиняться правилам для [идентификаторы](../../relational-databases/databases/database-identifiers.md), за исключением того, что имя не может начинаться со знака номера (#). Если аргумент constraint_name не указан, то ограничению присваивается имя, формируемое системой.  
  
 PRIMARY KEY  
 Ограничение, выполняющее принудительную проверку целостности сущностей для указанного столбца или столбцов при использовании уникального индекса. Для каждой таблицы может быть создано только одно ограничение PRIMARY KEY.  
  
 UNIQUE  
 Ограничение, обеспечивающее целостность сущностей для указанного столбца или столбцов при использовании уникального индекса.  
  
 CLUSTERED | NONCLUSTERED  
 Указывает, что для ограничения PRIMARY KEY или UNIQUE создается кластеризованный или некластеризованный индекс. По умолчанию ограничения PRIMARY KEY имеют значение CLUSTERED. По умолчанию ограничения UNIQUE имеют значение NONCLUSTERED.  
  
 Если кластеризованное ограничение или индекс уже созданы в таблице, значение CLUSTERED не может быть задано. Если кластеризованное ограничение или индекс уже существует в таблице, ограничения PRIMARY KEY по умолчанию имеют значение NONCLUSTERED.  
  
 Столбцы, имеющие **ntext**, **текст**, **varchar(max)**, **nvarchar(max)**, **varbinary(max)**, **xml**, или **изображение** типов данных не может быть указаны как столбцы для индекса.  
  
 *столбец*  
 Столбец или список столбцов в скобках, используемые в новом ограничении.  
  
 [ **ASC** | DESC]  
 Указывает порядок сортировки столбца или столбцов, участвующих в ограничениях таблицы. Значение по умолчанию — ASC.  
  
 С коэффициентом ЗАПОЛНЕНИЯ  **=**  *fillfactor*  
 Указывает, насколько полно компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] должен заполнять каждую страницу индекса, используемую для хранения индексных данных. Определяемый пользователем *fillfactor* может принимать значения от 1 до 100. Если значение не задано, по умолчанию принимается значение 0.  
  
> [!IMPORTANT]  
>  Документации с FILLFACTOR = *fillfactor* освобождает как единственного параметра индекса, который применяется к ограничениям PRIMARY KEY или UNIQUE, сохраняется для обеспечения обратной совместимости, но не документируется таким образом в будущем. Другие параметры индекса можно указать в [index_option](../../t-sql/statements/alter-table-index-option-transact-sql.md) предложением инструкции ALTER TABLE.  
  
 ON { *partition_scheme_name***(***partition_column_name***)** | *файловой группы* |  **»**по умолчанию**»** }  
 **Область применения**: начиная с [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 Указывает место хранения индекса, созданного для ограничения. Если *partition_scheme_name* указан, индекс секционируется и секции сопоставляются с файловыми группами, которые задаются параметром *partition_scheme_name*. Если *файловой группы* указан, индекс создается в именованной файловой группе. Если **»**по умолчанию**»** указан или если ON не определен вообще, индекс создается в той же файловой группе, что и таблица. Если при добавлении кластеризованного индекса для ограничений PRIMARY KEY или UNIQUE указано предложение ON, то вся таблица перемещается в указанную файловую группу в момент создания этого индекса.  
  
 В этом контексте по умолчанию не является ключевым словом. он представляет собой идентификатор файловой группы по умолчанию и должен иметь разделители, как в выражениях ON **»**по умолчанию**»** или ON **[**по умолчанию**]**. Если **»**по умолчанию**»** указан, параметр QUOTED_IDENTIFIER должен иметь значение ON для текущего сеанса. Это параметр по умолчанию.  
  
 FOREIGN KEY REFERENCES  
 Ограничение, обеспечивающее ссылочную целостность данных в столбце. Ограничения FOREIGN KEY требуют, чтобы любое значение в столбце обязательно существовало в указанном столбце ссылочной таблицы.  
  
 *referenced_table_name*  
 Таблица, на которую ссылается ограничение FOREIGN KEY.  
  
 *ref_column*  
 Столбец или список столбцов в скобках, на которые ссылается новое ограничение FOREIGN KEY.  
  
 ON DELETE { **ВМЕШАТЕЛЬСТВО** | CASCADE | SET NULL | SET DEFAULT}  
 Указывает, какое действие производится над строками изменяемой таблицы, если эти строки имеют ссылочную связь, и строка, на которую имеется ссылка, удаляется из родительской таблицы. Параметр по умолчанию — NO ACTION.  
  
 NO ACTION  
 Компонент [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] формирует ошибку, и выполняется откат операции удаления строки из родительской таблицы.  
  
 CASCADE  
 Если из родительской таблицы удаляется строка, соответствующие ей строки удаляются и из ссылающейся таблицы.  
  
 SET NULL  
 Все значения, составляющие внешний ключ, при удалении соответствующей строки родительской таблицы устанавливаются в значение NULL. Для выполнения этого ограничения внешние ключевые столбцы должны допускать значения NULL.  
  
 SET DEFAULT  
 Все значения, содержащие внешний ключ, при удалении соответствующей строки родительской таблицы устанавливаются в значения по умолчанию. Для выполнения этого ограничения все внешние ключевые столбцы должны иметь определения по умолчанию. Если столбец допускает значения NULL и значение по умолчанию явно не определено, значением столбца по умолчанию становится NULL.  
  
 Не следует использовать параметр CASCADE, если таблица будет включена в публикацию слиянием, в которой используются логические записи. Дополнительные сведения о логических записях см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
 Действие ON DELETE CASCADE не может быть определено, если в изменяемой таблице уже существует триггер INSTEAD OF ON DELETE.  
  
 Например, в [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] базы данных, **ProductVendor** таблица имеет ссылочную связь с **поставщика** таблицы. **ProductVendor.VendorID** ссылок на внешние ключи **Vendor.VendorID** первичного ключа.  
  
 Если при выполнении инструкции DELETE для строки в **поставщика** таблицы и действие ON DELETE CASCADE указан для **ProductVendor.VendorID**, [!INCLUDE[ssDE](../../includes/ssde-md.md)] проверяет наличие одного или нескольких зависимых строк в **ProductVendor** таблицы. Если они существуют, зависимые строки в **ProductVendor** таблица будет удалена, кроме строки в **поставщика** таблицы.  
  
 И наоборот, если указано NO ACTION [!INCLUDE[ssDE](../../includes/ssde-md.md)] вызывает ошибку и откатывает действие delete по **поставщика** строк при наличии хотя бы одна строка в **ProductVendor** таблице, ссылающейся на него.  
  
 ПРИ ОБНОВЛЕНИИ { **ВМЕШАТЕЛЬСТВО** | CASCADE | SET NULL | SET DEFAULT}  
 Указывает, какое действие совершается над строками в изменяемой таблице, когда эти строки имеют ссылочную связь и строка родительской таблицы, на которую указывает ссылка, обновляется. Параметр по умолчанию — NO ACTION.  
  
 NO ACTION  
 Компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] возвращает ошибку, а обновление строки родительской таблицы откатывается.  
  
 CASCADE  
 Соответствующие строки обновляются в ссылающейся таблице, если эта строка обновляется в родительской таблице.  
  
 SET NULL  
 Всем значениям, составляющим внешний ключ, присваивается значение NULL, когда обновляется соответствующая строка в родительской таблице. Для выполнения этого ограничения внешние ключевые столбцы должны допускать значения NULL.  
  
 SET DEFAULT  
 Всем значениям, составляющим внешний ключ, присваивается их значение по умолчанию, когда обновляется соответствующая строка в родительской таблице. Для выполнения этого ограничения все внешние ключевые столбцы должны иметь определения по умолчанию. Если столбец допускает значения NULL и значение по умолчанию явно не определено, значением столбца по умолчанию становится NULL.  
  
 Не следует использовать параметр CASCADE, если таблица будет включена в публикацию слиянием, в которой используются логические записи. Дополнительные сведения о логических записях см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
 Действия ON UPDATE CASCADE, SET NULL и SET DEFAULT не могут быть определены, если в изменяемой таблице уже существует триггер INSTEAD OF для условия ON UPDATE.  
  
 Например, в [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] базы данных, **ProductVendor** таблица имеет ссылочную связь с **поставщика** таблицы. **ProductVendor.VendorID** ссылок на внешние ключи **Vendor.VendorID** первичного ключа.  
  
 Если при выполнении инструкции UPDATE для строки в **поставщика** таблицы и действие ON UPDATE CASCADE задан для **ProductVendor.VendorID**, [!INCLUDE[ssDE](../../includes/ssde-md.md)] проверяет наличие одного или нескольких зависимых строк в **ProductVendor** таблицы. Если они существуют, зависимые строки в **ProductVendor** таблица будет обновлена, а также строки в **поставщика** таблицы.  
  
 И наоборот, если указано NO ACTION [!INCLUDE[ssDE](../../includes/ssde-md.md)] вызывает ошибку и откатывает операцию обновления **поставщика** строк при наличии хотя бы одна строка в **ProductVendor** таблице, ссылающейся на него.  
  
 NOT FOR REPLICATION  
 **Область применения**: начиная с [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 Может быть определено для ограничений FOREIGN KEY и CHECK. Если ограничение сопровождается этим предложением, оно не выполняется, когда агенты репликации выполняют операции вставки, обновления или удаления.  
  
 DEFAULT  
 Задает значение по умолчанию для столбца. Определения DEFAULT могут использоваться для указания значений по умолчанию для новых столбцов в существующих строках данных. Определения DEFAULT нельзя добавить столбцы, имеющие **timestamp** тип данных, свойство IDENTITY, существующим определением DEFAULT или привязанное значение по умолчанию. Если для столбца задано значение по умолчанию, необходимо удалить его перед заданием нового умолчания. Если для столбца определяемого пользователем типа указано значение по умолчанию, тип должен поддерживать неявное преобразование из *constant_expression* для определяемого пользователем типа. Для сохранения совместимости с более ранними версиями сервера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] значению DEFAULT может быть присвоено имя ограничения.  
  
 *constant_expression*  
 Имеет значение-литерал, значение NULL или системная функция, которая используется в качестве значения столбца по умолчанию. Если *constant_expression* используется в сочетании со столбцом определяемого [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] определяемого пользователем типа реализация типа должна поддерживать неявное преобразование из *constant_ выражение* для определяемого пользователем типа.  
  
 ДЛЯ *столбца*  
 Определяет столбец, связанный с определением DEFAULT уровня таблицы.  
  
 WITH VALUES  
 Указывает, что значение, заданное по умолчанию *constant_expression* сохраняется в новом столбце, добавляемом к существующим строкам. Оператор WITH VALUES может быть указан только в том случае, если указан параметр DEFAULT в предложении ADD столбца. Если добавленный столбец допускает значения NULL и указан оператор WITH VALUES, новый столбец, добавленный к существующим строкам, заполняется значением по умолчанию. Если оператор WITH VALUES не указан для столбцов, допускающих значение NULL, новый столбец для существующих строк заполняется значением NULL. Если новый столбец не допускает значения NULL, значение по умолчанию сохраняется во всех строках независимо от того, указан оператор WITH VALUES или нет.  
  
 CHECK  
 Ограничение, обеспечивающее целостность домена путем ограничения возможных значений, которые могут быть введены в столбец или столбцы.  
  
 *Logical_Expression*  
 Логическое выражение, используемое в ограничении CHECK и возвращающее значения TRUE или FALSE. *Logical_Expression* используется в ограничениях CHECK не могут ссылаться на другую таблицу но может ссылаться на другие столбцы в той же таблицы в той же строке. Выражение не может ссылаться на псевдоним типа данных.  
  
## <a name="remarks"></a>Замечания  
 При добавлении новых ограничений FOREIGN KEY или CHECK все существующие данные проверяются на соответствие ограничениям, если не указан параметр WITH NOCHECK. В том случае, если обнаруживаются нарушения, выполнение ALTER TABLE завершается с ошибкой. При добавлении к существующему столбцу ограничений PRIMARY KEY или UNIQUE все данные в столбце должны быть уникальны. Если будут обнаружены повторяющиеся значения, ALTER TABLE завершится неудачно. При добавлении ограничения PRIMARY KEY или UNIQUE наличие параметра WITH NOCHECK не имеет значения.  
  
 Каждое ограничение PRIMARY KEY и UNIQUE создает индекс. Число ограничений UNIQUE и PRIMARY KEY не может вызвать превышение предельного количества индексов в таблице (999 некластеризованных и 1 кластеризованный). Ограничения внешнего ключа не вызывают автоматического создания индекса. Однако столбцы внешних ключей часто используются в критериях соединения запросов посредством сопоставления столбца или столбцов из ограничения внешнего ключа одной таблицы со столбцом или столбцами первичного или уникального ключей в другой таблице. Индекс по столбцам таблицы внешнего ключа позволяет компоненту [!INCLUDE[ssDE](../../includes/ssde-md.md)] быстро находить связанные данные в таблице внешних ключей.  
  
## <a name="examples"></a>Примеры  
 Примеры см. в разделе [ALTER TABLE &#40; Transact-SQL &#41; ](../../t-sql/statements/alter-table-transact-sql.md).  
  
## <a name="see-also"></a>См. также:  
 [ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md)  
  
  

