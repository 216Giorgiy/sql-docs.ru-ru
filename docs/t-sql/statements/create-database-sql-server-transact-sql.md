---
title: "Создание базы данных (SQL Server Transact-SQL) | Документы Microsoft"
ms.custom: 
ms.date: 08/10/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
f1_keywords:
- DATABASE_TSQL
- DATABASE
- CONTAINMENT_TSQL
- CREATE DATABASE
- CREATE_DATABASE_TSQL
- CONTAINS_FILESTREAM_TSQL
- CONTAINS FILESTREAM
- CONTAINMENT
dev_langs:
- TSQL
helpviewer_keywords:
- snapshots [SQL Server database snapshots], creating
- databases [SQL Server], creating
- model database [SQL Server], database creation
- mounted drives [SQL Server]
- CREATE DATABASE
- CREATE DATABASE statement
- file creation [SQL Server]
- creating databases
- containment
- filegroups [SQL Server], database creation
- database creation [SQL Server], CREATE DATABASE statement
- moving databases
- attaching databases [SQL Server], CREATE DATABASE...FOR ATTACH
ms.assetid: 29ddac46-7a0f-4151-bd94-75c1908c89f8
caps.latest.revision: 212
author: BYHAM
ms.author: rickbyh
manager: jhubbard
ms.workload: Active
ms.translationtype: MT
ms.sourcegitcommit: aecf422ca2289b2a417147eb402921bb8530d969
ms.openlocfilehash: de8574d6d4f2322c63743828b7b8a03d4e6fa576
ms.contentlocale: ru-ru
ms.lasthandoff: 10/24/2017

---
# <a name="create-database-sql-server-transact-sql"></a>CREATE DATABASE (SQL Server Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx_md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  Создает новую базу данных и файлы, используемые для ее хранения, создает моментальный снимок базы данных или присоединяет базу данных, составленную из отсоединенных файлов ранее созданной базы данных.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
      Create a database  
CREATE DATABASE database_name   
[ CONTAINMENT = { NONE | PARTIAL } ]  
[ ON   
      [ PRIMARY ] <filespec> [ ,...n ]   
      [ , <filegroup> [ ,...n ] ]   
      [ LOG ON <filespec> [ ,...n ] ]   
]   
[ COLLATE collation_name ]  
[ WITH  <option> [,...n ] ]  
[;]  
  
<option> ::=  
{  
      FILESTREAM ( <filestream_option> [,...n ] )  
    | DEFAULT_FULLTEXT_LANGUAGE = { lcid | language_name | language_alias }  
    | DEFAULT_LANGUAGE = { lcid | language_name | language_alias }  
    | NESTED_TRIGGERS = { OFF | ON }  
    | TRANSFORM_NOISE_WORDS = { OFF | ON}  
    | TWO_DIGIT_YEAR_CUTOFF = <two_digit_year_cutoff>   
    | DB_CHAINING { OFF | ON }  
    | TRUSTWORTHY { OFF | ON }  
}  
  
<filestream_option> ::=  
{  
      NON_TRANSACTED_ACCESS = { OFF | READ_ONLY | FULL }  
    | DIRECTORY_NAME = 'directory_name'   
}  
  
<filespec> ::=   
{  
(  
    NAME = logical_file_name ,  
    FILENAME = { 'os_file_name' | 'filestream_path' }   
    [ , SIZE = size [ KB | MB | GB | TB ] ]   
    [ , MAXSIZE = { max_size [ KB | MB | GB | TB ] | UNLIMITED } ]   
    [ , FILEGROWTH = growth_increment [ KB | MB | GB | TB | % ] ]  
)  
}  
  
<filegroup> ::=   
{  
FILEGROUP filegroup name [ [ CONTAINS FILESTREAM ] [ DEFAULT ] | CONTAINS MEMORY_OPTIMIZED_DATA ]  
    <filespec> [ ,...n ]  
}  
  
<service_broker_option> ::=  
{  
    ENABLE_BROKER  
  | NEW_BROKER  
  | ERROR_BROKER_CONVERSATIONS  
}  
  
```  
  
```  
  
      Attach a database  
CREATE DATABASE database_name   
    ON <filespec> [ ,...n ]   
    FOR { { ATTACH [ WITH <attach_database_option> [ , ...n ] ] }  
        | ATTACH_REBUILD_LOG }  
[;]  
  
<attach_database_option> ::=  
{  
      <service_broker_option>  
    | RESTRICTED_USER  
    | FILESTREAM ( DIRECTORY_NAME = { 'directory_name' | NULL } )  
}  
  
```  
  
```  
  
      Create a database snapshot  
CREATE DATABASE database_snapshot_name   
    ON   
    (  
        NAME = logical_file_name,  
        FILENAME = 'os_file_name'   
    ) [ ,...n ]   
    AS SNAPSHOT OF source_database_name  
[;]  
```  
  
## <a name="arguments"></a>Аргументы  
 *database_name*  
 Имя новой базы данных. Имена баз данных должно быть уникальным в рамках экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и соответствовать правилам для [идентификаторы](../../relational-databases/databases/database-identifiers.md).  
  
 *database_name* не может превышать 128 символов, если для файла журнала не указано логическое имя. Если имя файла логического журнала не указан, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] приводит к возникновению ошибки *логическое_имя_файла* и *имя_файла_ос* для журнала путем добавления суффикса к *имя_базы_данных*. Это ограничивает *имя_базы_данных* для 123 символами, чтобы формируемое логическое имя файла составляет не более 128 символов.  
  
 Если имя файла данных не указан, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использует *имя_базы_данных* как *логическое_имя_файла* и в качестве *имя_файла_ос*. Путь по умолчанию берется из реестра. Путь по умолчанию можно изменить с помощью **свойства сервера (страница «Параметры базы данных»)** в [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]. Изменение пути по умолчанию требует перезапуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
 CONTAINMENT = { NONE | PARTIAL }  

**Применяется к**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
 Указывает состояние включения базы данных. NONE = неавтономная база данных. PARTIAL = частично автономная база данных.  
  
 ON  
 Указывает, что дисковые файлы, используемые для хранения разделов данных в базе данных, файлов данных, определяются явно. ON требуется, если за ним следует список разделенных запятыми \<filespec > элементы, которые определяют файлы данных первичной файловой группы. Список файлов в первичной файловой группе может следовать необязательный, разделенных запятыми список \<файловая группа > элементы, которые определяют файловые группы пользователей и их файлы.  
  
 PRIMARY  
 Указывает, что связанный \<filespec > список определяет первичный файл. Первый файл, указанный в \<filespec > запись в первичная файловая группа становится первичным файлом. В базе данных может быть только один первичный файл. Дополнительные сведения см. в статье [Database Files and Filegroups](../../relational-databases/databases/database-files-and-filegroups.md).  
  
 Если параметр PRIMARY не указан, то первый файл списка в инструкции CREATE DATABASE становится первичным файлом.  
  
 LOG ON  
 Указывает, что дисковые файлы, используемые для хранения журнала базы данных, то есть файлы журналов, определяются явно. LOG ON следует список разделенных запятыми \<filespec > элементы, которые определяют файлы журналов. Если параметр LOG ON не указан, автоматически создается один файл журнала, размер которого определяется большей из следующих двух величин: 512 КБ или 25 процентов от суммы размеров всех файлов данных в базе данных. Этот файл помещается в местоположение для журнала по умолчанию. Сведения об этом местоположении см. в разделе [Просмотр или изменение расположения по умолчанию для данных и файлов журнала &#40; SQL Server Management Studio &#41; ](../../database-engine/configure-windows/view-or-change-the-default-locations-for-data-and-log-files.md).  
  
 Параметр LOG ON не может указываться для моментального снимка базы данных.  
  
 COLLATE *collation_name*  
 Задает параметры сортировки по умолчанию для базы данных. Именем параметров сортировки может быть либо имя параметров сортировки Windows, либо имя параметров сортировки SQL. Если параметр не указан, базе данных назначаются параметры сортировки по умолчанию для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Имя параметров сортировки не может указываться для моментального снимка базы данных.  
  
 Имя параметров сортировки не может указываться с предложениями FOR ATTACH и FOR ATTACH_REBUILD_LOG. Сведения о способах изменения параметров сортировки подсоединенной базы данных, посетите [веб-сайте Майкрософт](http://go.microsoft.com/fwlink/?linkid=16419&kbid=325335).  
  
 Дополнительные сведения об именах параметров сортировки Windows и SQL см. в разделе [COLLATE &#40; Transact-SQL &#41; ](~/t-sql/statements/collations.md).  
  
> [!NOTE]  
>  Сортировка в автономных базах данных отличается от неавтономных баз данных. См. в разделе [параметры сортировки в автономной базе данных](../../relational-databases/databases/contained-database-collations.md) для получения дополнительной информации.  
  
 С \<параметр >  
 -   **\<filestream_options >** 
  
     NON_TRANSACTED_ACCESS = { **OFF** | READ_ONLY | ПОЛНЫЙ}  
**Область применения**: начиная с [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].
  
     Указывает уровень нетранзакционного доступа FILESTREAM к базе данных.  
  
    |Значение|Описание|  
    |-----------|-----------------|  
    |OFF|Нетранзакционный доступ отключен.|  
    |READONLY|Данные FILESTREAM в этой базе данных могут быть считаны нетранзакционными процессами.|  
    |ПОЛНОЕ|Полный нетранзакционный доступ к FILESTREAM FileTable включен.|  
  
     Имя_каталога = \<directory_name > **применяется к**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
     Имя каталога, совместимое с Windows. Это имя должно быть уникально среди всех имен Database_Directory в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Проверка уникальности выполняется с учетом регистра, независимо от параметров сортировки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот параметр необходимо назначить до создания FileTable в этой базе данных.  
  
 Следующие параметры разрешаются, только если параметр CONTAINMENT установлен в состояние PARTIAL. Если параметр CONTAINMENT установлен в состояние NONE, возникнут ошибки.  
  
-   **DEFAULT_FULLTEXT_LANGUAGE = \<lcid > | \<название языка > | \<псевдоним языка >**  
  
**Применяется к**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
     See [Configure the default full-text language Server Configuration Option](../../database-engine/configure-windows/configure-the-default-full-text-language-server-configuration-option.md) for a full description of this option.  
  
-   **DEFAULT_LANGUAGE = \<lcid > | \<название языка > | \<псевдоним языка >**  
  
**Применяется к**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
     See [Configure the default language Server Configuration Option](../../database-engine/configure-windows/configure-the-default-language-server-configuration-option.md) for a full description of this option.  
  
-   **NESTED_TRIGGERS = {OFF | ON}**  
  
**Применяется к**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
     See [Configure the nested triggers Server Configuration Option](../../database-engine/configure-windows/configure-the-nested-triggers-server-configuration-option.md) for a full description of this option.  
  
-   **TRANSFORM_NOISE_WORDS = {OFF | ON}**  
  
**Применяется к**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
     See [transform noise words Server Configuration Option](../../database-engine/configure-windows/transform-noise-words-server-configuration-option.md)for a full description of this option.  
  
-   **TWO_DIGIT_YEAR_CUTOFF = {2049 | \<любой год от 1753 до 9999 >}**  
  
     Четыре цифры, обозначающие год. Значение по умолчанию — 2049. В разделе [Настройка two digit year cutoff Server Configuration Option](../../database-engine/configure-windows/configure-the-two-digit-year-cutoff-server-configuration-option.md) полное описание этого параметра.  
  
-   **DB_CHAINING {OFF | ON}**  
  
     Если указано значение ON, то база данных может быть источником или целевой базой данных в межбазовой цепочке владения.  
  
     Если задано значение OFF, то база данных не может участвовать в межбазовых цепочках владения. Значение по умолчанию — OFF.  
  
    > [!IMPORTANT]  
    >  Экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] распознает эту настройку, если параметр сервера cross db ownership chaining имеет значение 0 (OFF). Если параметр cross db ownership chaining имеет значение 1 (ON), то все пользовательские базы данных могут участвовать в межбазовых цепочках владения, вне зависимости от значения этого параметра. Этот параметр задается с помощью [sp_configure](../../relational-databases/system-stored-procedures/sp-configure-transact-sql.md).  
  
     Для задания этого параметра необходимо членство в предопределенной роли сервера sysadmin. Параметр DB_CHAINING не может быть задан для системных баз данных: master, model, tempdb.  
  
-   **TRUSTWORTHY {OFF | ON}**  
  
     Если задано значение ON, то модули базы данных (например, представления, определяемые пользователем функции и хранимые процедуры), в которых используется контекст олицетворения, могут обращаться к ресурсам, расположенным за пределами базы данных.  
  
     Если задано значение OFF, то модули базы данных в контексте олицетворения не могут обращаться к ресурсам, расположенным за пределами базы данных. Значение по умолчанию — OFF.  
  
     Параметр TRUSTWORTHY устанавливается в значение OFF при каждом присоединении базы данных.  
  
     По умолчанию для всех системных баз данных, кроме msdb, параметр TRUSTWORTHY установлен в значение OFF. Оно не изменяется для баз данных model и tempdb. Рекомендуется никогда не устанавливать параметр TRUSTWORTHY в состояние ON для базы данных master.  
  
     Для задания этого параметра необходимо членство в предопределенной роли сервера sysadmin.  
  
 FOR ATTACH [WITH \< параметр_присоединения_базы_данных >] Указывает, что база данных создается путем [присоединение](../../relational-databases/databases/database-detach-and-attach-sql-server.md) существующего набора файлов операционной системы. Должен существовать \<filespec > запись, которая указывает первичный файл. Единственным других \<filespec > необходимые записи — это те для любые файлы, которые имеют путь отличается от того базы данных был при первом создании или последнем присоединении. Объект \<filespec > записи должен быть указан для этих файлов.  
  
 Для параметра FOR ATTACH необходимо выполнение следующих условий.  
  
-   Должны быть доступны все файлы данных (MDF и NDF).  
  
-   Если существует несколько файлов журналов, все они должны быть доступны.  
  
 Если база данных, доступная для чтения и записи, располагает единственным файлом журнала, который недоступен в текущий момент, а также если база данных была закрыта в отсутствие пользователей или открытых транзакций перед операцией присоединения, то параметр FOR ATTACH автоматически перестраивает файл журнала и обновляет первичный файл. Однако журнал невозможно перестроить в базе данных, доступной только для чтения, так как нельзя обновить первичный файл. Поэтому, если присоединяется база данных только для чтения, журнал которой недоступен, необходимо указать в предложении FOR ATTACH файлы журнала или файлы.  
  
> [!NOTE]  
>  База данных, созданная в более поздней версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , не может быть присоединена в ранних версиях.  
  
 В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] любые полнотекстовые файлы, являющиеся частью присоединяемой базы данных, будут присоединены вместе с базой данных. Чтобы задать новый путь полнотекстового каталога, следует указать новое местоположение без имени полнотекстового файла операционной системы. Дополнительные сведения см. в разделе «Примеры».  
  
 Присоединение базы данных, содержащей параметр FILESTREAM «Directory Name» в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] предложит экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для Проверьте уникальность имени Database_Directory. Если это не так, то операция присоединения завершается с ошибкой, «имя FILESTREAM Database_Directory \<имя > не является уникальным в данном экземпляре SQL Server». Чтобы избежать этой ошибки, необязательный параметр *directory_name*, должны быть переданы в этой операции.  
  
 Параметр FOR ATTACH не может указываться для моментального снимка базы данных.  
  
 В предложении FOR ATTACH может указываться параметр RESTRICTED_USER. Предложение RESTRICTED_USER позволяет подключаться к базе данных только членам предопределенных ролей базы данных db_owner и dbcreator и предопределенной роли сервера sysadmin, количество соединений при этом не ограничивается. Пользователям, не соответствующим этому условию, подключение не разрешается.  
  
 Если база данных использует [!INCLUDE[ssSB](../../includes/sssb-md.md)], могут использоваться с \<service_broker_option > в предложении FOR ATTACH: 
  
 \<service_broker_option > элементы управления [!INCLUDE[ssSB](../../includes/sssb-md.md)] доставки сообщений и [!INCLUDE[ssSB](../../includes/sssb-md.md)] идентификатор для базы данных. Параметры [!INCLUDE[ssSB](../../includes/sssb-md.md)] могут указываться только при использовании предложения FOR ATTACH.  
  
 ENABLE_BROKER  
 Определяет, что для указанной базы данных включен компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)]. То есть, запуск доставки сообщений и параметр is_broker_enabled устанавливается в значение true в представлении каталога sys.databases. В базе данных сохраняется существующий идентификатор компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)].  
  
 NEW_BROKER  
 Создает новое значение service_broker_guid в представлении каталога sys.databases и восстановленной базе данных, после чего завершает все конечные точки диалога, очищая их. Посредник включен, но сообщения удаленным конечным точкам диалога не отправляются. Все маршруты, ссылающиеся на старый идентификатор компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)], необходимо создать повторно с новым идентификатором.  
  
 ERROR_BROKER_CONVERSATIONS  
 Завершает все диалоги, находящиеся в состоянии ошибки, которые были присоединены к базе данных или восстановлены. Посредник отключается до завершения этой операции, после чего вновь включается. В базе данных сохраняется существующий идентификатор компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)].  
  
 При подключении реплицируемой базы данных, которая была скопирована, а не отсоединена, необходимо учитывать следующее.  
  
-   При подключении базы данных к тому же экземпляру и версии сервера, к которому была подключена оригинальная база данных, не требуется никаких дополнительных действий.  
  
-   Если присоединить базу данных на том же экземпляре сервера, но с обновленной версии, необходимо выполнить [sp_vupgrade_replication](../../relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql.md) обновить репликацию после завершения операции присоединения.  
  
-   При присоединении базы данных на другом экземпляре сервера, независимо от версии, необходимо выполнить [sp_removedbreplication](../../relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql.md) удалить репликацию после завершения операции присоединения.  
  
> [!NOTE]  
>  Присоединение работает с **vardecimal** формат хранения, но [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] должен быть обновлен по крайней [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] с пакетом обновления 2. Присоединение баз данных, использующих формат хранения vardecimal версий ранее [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] невозможно. Дополнительные сведения о **vardecimal** формата хранения в разделе [сжатие данных](../../relational-databases/data-compression/data-compression.md).  
  
 При первом присоединении базы данных к новому экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]или ее восстановлении копия главного ключа базы данных (зашифрованная главным ключом службы) еще не хранится на сервере. Необходимо расшифровать главный ключ базы данных с помощью инструкции **OPEN MASTER KEY** . Как только главный ключ базы данных будет расшифрован, появится возможность разрешить автоматическую расшифровку в будущем с помощью инструкции **ALTER MASTER KEY REGENERATE** , чтобы оставить на сервере копию главного ключа базы данных, зашифрованного с помощью главного ключа службы. После обновления базы данных с переходом от более ранней версии главный ключ базы данных должен быть создан повторно для использования нового алгоритма шифрования AES. Дополнительные сведения о повторном создании главного ключа базы данных см. в статье [ALTER MASTER KEY (Transact-SQL)](../../t-sql/statements/alter-master-key-transact-sql.md). Время, необходимое для повторного создания главного ключа базы данных с обновлением до алгоритма шифрования AES, зависит от числа объектов, защищаемых главным ключом базы данных. Повторное создание главного ключа базы данных с обновлением до алгоритма шифрования AES необходимо произвести только один раз. Это никак не повлияет на последующие операции повторного создания, выполняемые в соответствии со стратегией смены ключей. Дополнительные сведения об обновлении базы данных с помощью присоединения см. в разделе [обновление базы данных с помощью отсоединения и присоединения &#40; Transact-SQL &#41; ](../../relational-databases/databases/upgrade-a-database-using-detach-and-attach-transact-sql.md).  
  
 **Примечание по безопасности** рекомендуется не присоединять базы данных из неизвестных или ненадежных источников. В этих базах данных может содержаться вредоносный код, вызывающий выполнение непредусмотренных инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] или появление ошибок из-за изменения схемы или физической структуры базы данных. Прежде чем использовать базу данных из неизвестного или ненадежного источника, запустите [инструкции DBCC CHECKDB](../../t-sql/database-console-commands/dbcc-checkdb-transact-sql.md) в базе данных на тестовом сервере, а также Изучите код, например хранимые процедуры или другой пользовательский код, в базе данных.  
  
> [!NOTE]  
>  **TRUSTWORTHY** и **DB_CHAINING** не оказывают влияния при присоединении базы данных.  
  
 FOR ATTACH_REBUILD_LOG  
 Указывает, что база данных создана путем присоединения существующего набора файлов операционной системы. Этот параметр применяется только в базах данных, доступных для чтения и записи. Должен существовать  *\<filespec >* запись, указывающая первичный файл. Если один или несколько файлов журналов транзакций отсутствуют, то файл журнала перестраивается. Параметр ATTACH_REBUILD_LOG автоматически создает новый файл журнала с размером 1 МБ. Этот файл помещается в местоположение для журнала по умолчанию. Сведения об этом местоположении см. в разделе [Просмотр или изменение расположения по умолчанию для данных и файлов журнала &#40; SQL Server Management Studio &#41; ](../../database-engine/configure-windows/view-or-change-the-default-locations-for-data-and-log-files.md).  
  
> [!NOTE]  
>  Если файлы журналов доступны, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] использует их, не перестраивая файлы журнала.  
  
 Для параметра FOR ATTACH_REBUILD_LOG необходимо следующее.  
  
-   Чистое завершение работы базы данных.  
  
-   Должны быть доступны все файлы данных (MDF и NDF).  
  
> [!IMPORTANT]  
>  Эта операция разрывает цепочку резервных копий журнала. Рекомендуется выполнить полное резервное копирование базы данных после завершения операции. Дополнительные сведения см. в разделе [BACKUP (Transact-SQL)](../../t-sql/statements/backup-transact-sql.md).  
  
 Как правило, параметр FOR ATTACH_REBUILD_LOG используется при копировании базы данных, доступной для чтения и записи и обладающей большим журналом, на другой сервер, где копия будет использоваться преимущественно или исключительно для операций чтения. Поэтому для журнала требуется меньше места, чем в случае исходной базы данных.  
  
 Параметр FOR ATTACH_REBUILD_LOG не может указываться для моментального снимка базы данных.  
  
 Дополнительные сведения о присоединении и отсоединении баз данных см. в разделе [отсоединение базы данных и присоединить &#40; SQL Server &#41; ](../../relational-databases/databases/database-detach-and-attach-sql-server.md).  
  
 \<filespec >  
 Управляет свойствами файла.  
  
 ИМЯ *логическое_имя_файла*  
 Задает логическое имя файла. Параметр NAME требуется при указании параметра FILENAME во всех случаях, кроме указания одного из предложений FOR ATTACH. Файловая группа FILESTREAM не может иметь имя PRIMARY.  
  
 *логическое_имя_файла*  
 Логическое имя, используемое в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] при обращении к файлу. *Логическое_имя_файла* должно быть уникальным в базе данных и соответствовать правилам для [идентификаторы](../../relational-databases/databases/database-identifiers.md). Имя может быть символом или константой Юникода, а также обычным идентификатором или идентификатором с разделителями.  
  
 Имя файла { **"***имя_файла_ос***"** | **"***filestream_path* **'** }  
 Задает имя файла в операционной системе (физическое имя).  
  
 **"** *имя_файла_ос* **"**  
 Путь и имя файла, используемые операционной системой при создании файла. Файл должен находиться на одном из следующих устройств: на локальном сервере, где установлен [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], в сети хранения данных [SAN] или в сети на основе iSCSI. Указанный путь должен существовать до выполнения инструкции CREATE DATABASE. Дополнительные сведения см. в подразделе «Файлы и файловые группы базы данных» раздела «Примечания».  
  
 Параметры SIZE, MAXSIZE и FILEGROWTH доступны, если путь к файлу указан в формате UNC.  
  
 Если файл находится в необработанной секции *имя_файла_ос* необходимо указать только букву диска существующей необработанной секции. В каждой необработанной секции может быть создан только один файл данных.  
  
 Файлы данных не следует размещать в файловых системах со сжатием, за исключением случаев, когда файлы являются вторичными и доступны только для чтения или вся база данных доступна только для чтения. Файлы журналов ни в коем случае не должны размещаться в сжатых файловых системах.  
  
 **"** *filestream_path* **"**  
 Для файловой группы FILESTREAM параметр FILENAME указывает путь, где будут храниться данные FILESTREAM. Должен существовать путь вплоть до последнего каталога, но последний каталог существовать не должен. Например, если указать путь «C:\MyFiles\MyFilestreamData», папка «C:\MyFiles» должна существовать до запуска инструкции ALTER DATABASE, а папка «MyFilestreamData» — не должна.  
  
 Файловую группу и файл (`<filespec>`) необходимо создавать в одной инструкции.  
  
 Свойства SIZE и FILEGROWTH к файловой группе FILESTREAM неприменимы.  
  
 РАЗМЕР *размер*  
 Указывает размер файла.  
  
 РАЗМЕР не может быть указано при *имя_файла_ос* указан в формате UNC. Свойство SIZE к файловой группе FILESTREAM не применяется.  
  
 *размер*  
 Задает начальный размер файла.  
  
 Когда *размер* не задан для первичного файла [!INCLUDE[ssDE](../../includes/ssde-md.md)] использует размер первичного файла в базе данных модели. Размер модели по умолчанию — 8 МБ (начиная с версии [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)]) или 1 МБ (для более ранних версий). Когда указан вторичный файл данных или файл журнала, но *размер* не указан для файла, [!INCLUDE[ssDE](../../includes/ssde-md.md)] задает размер файла 8 МБ (начиная с версии [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)]) или 1 МБ (для более ранних версий). Размер, указанный для первичного файла, не должен быть менее размера первичного файла базы данных model.  
  
 Можно использовать суффиксы килобайт (KB), мегабайт (MB), гигабайт (GB) и терабайт (TB). По умолчанию — MБ. Укажите целое число (без дробной части). *Размер* — это целочисленное значение. Для значений, превышающих 2 147 483 647, используйте более крупные единицы измерения.  
  
 Параметр MAXSIZE *max_size*  
 Задает максимальный размер, до которого может расти файл. Параметр MAXSIZE не может быть указано при *имя_файла_ос* указан в формате UNC.  
  
 *max_size*  
 Максимальный размер файла. Можно использовать суффиксы KB, MB, GB и TB. По умолчанию — MБ. Укажите целое число (без дробной части). Если *max_size* не указан, файл будет увеличиваться до заполнения диска. *Max_size* — это целочисленное значение. Для значений, превышающих 2 147 483 647, используйте более крупные единицы измерения.  
  
 UNLIMITED  
 Указывает, что файл может расти вплоть до заполнения диска. В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] файл журнала, для которого задано неограниченное увеличение размера, имеет максимальный размер 2 ТБ, а файл данных — 16 ТБ.  
  
> [!NOTE]  
>  Ограничения размера отсутствуют, если этот параметр указан для контейнера FILESTREAM. Размер продолжает увеличиваться до полного заполнения диска.  
  
 FILEGROWTH *growth_increment*  
 Задает автоматический шаг роста файла. Значение параметра FILEGROWTH для файла не может превосходить значение параметра MAXSIZE. FILEGROWTH не может быть указано при *имя_файла_ос* указан в формате UNC. Свойство FILEGROWTH к файловой группе FILESTREAM не применяется.  
  
 *growth_increment*  
 Объем пространства, добавляемого к файлу каждый раз, когда требуется увеличение пространства.  
  
 Значение может быть указано в килобайтах, мегабайтах, гигабайтах, терабайтах или процентах (%). Если указано число без суффикса MB, KB или %, то по умолчанию используется MB. Если размер указан в процентах (%), то шаг роста это заданная часть в процентах от размера файла во время этого файла. Указанный размер округляется до ближайших 64 КБ, а минимальное значение — 64 КБ.  
  
 Значение 0 указывает, что автоматическое приращение отключено и добавление пространства запрещено.  
  
 Если параметр FILEGROWTH не задан, доступны следующие значения по умолчанию:  
  
|Version|Значения по умолчанию|  
|-------------|--------------------|  
|Начало[!INCLUDE[ssSQL15](../../includes/sssql15-md.md)]|Данные 64 МБ. Файлы журналов 64 МБ.|  
|Начало[!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]|Данные 1 МБ. Файлы журнала 10%.|  
|До версии[!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]|Данные 10%. Файлы журнала 10%.|  
  
 \<файловая группа >  
 Управляет свойствами файловой группы. Файловая группа не может указываться для моментального снимка базы данных.  
  
 Файловая ГРУППА *filegroup_name*  
 Логическое имя файловой группы.  
  
 *filegroup_name*  
 *filegroup_name* должно быть уникальным в базе данных и не может быть имена системных PRIMARY или PRIMARY_LOG. Имя может быть символом или константой Юникода, а также обычным идентификатором или идентификатором с разделителями. Имя должно соответствовать правилам для [идентификаторы](../../relational-databases/databases/database-identifiers.md).  
  
 CONTAINS FILESTREAM  
 Указывает, что файловая группа хранит большие двоичные объекты (BLOB) FILESTREAM в файловой системе.  
  
 CONTAINS MEMORY_OPTIMIZED_DATA  

**Применяется к**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] через[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
 Указывает, что файловая группа хранит данные memory_optimized в файловой системе. Дополнительные сведения см. в разделе [In-Memory OLTP (оптимизация в памяти)](../../relational-databases/in-memory-oltp/in-memory-oltp-in-memory-optimization.md). В каждой базе данных может присутствовать только одна файловая группа MEMORY_OPTIMIZED_DATA. Примеры кода для создания для хранения данных, оптимизированных для памяти файловую группу, в разделе [создание таблиц, оптимизированных для памяти и в собственном коде хранимых процедур, скомпилированных в](../../relational-databases/in-memory-oltp/creating-a-memory-optimized-table-and-a-natively-compiled-stored-procedure.md).  
  
 DEFAULT  
 Задает именованную файловую группу как файловую группу по умолчанию в базе данных.  
  
 *имя_моментального_снимка_базы_данных*  
 Имя нового моментального снимка базы данных. Имена моментальных снимков баз данных должны быть уникальны внутри экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и соответствовать правилам для идентификаторов. *имя_моментального_снимка_базы_данных* не может превышать 128 символов.  
  
 ON **(** имя  **=**  *логическое_имя_файла***,** FILENAME **= "**  *имя_файла_ос***")** [ **,**... *n* ]  
 При создании моментального снимка базы данных указывает список файлов в базе данных-источнике. Для работы моментального снимка все файлы данных должны задаваться отдельно. Однако не разрешается указывать файлы журналов для моментальных снимков базы данных. В моментальных снимках базы данных не поддерживаются файловые группы FILESTREAM. Если файл данных FILESTREAM задействован в предложении CREATE DATABASE ON, выполнение этой инструкции завершится сбоем и приведет к возникновению ошибки.  
  
 Для описания NAME и FILENAME и их значений см. в описаниях эквивалент \<filespec > значения.  
  
> [!NOTE]  
>  При создании моментального снимка базы данных, другой \<filespec > Параметры и ключевое слово PRIMARY не допускаются.  
  
 AS SNAPSHOT OF *имя_исходной_базы_данных*  
 Указывает, что база данных, в процессе создания моментального снимка базы данных из исходной базы данных, указанной *имя_исходной_базы_данных*. Моментальный снимок и база данных-источник должны находиться в одном экземпляре.  
  
 Дополнительные сведения см. в подразделе «Моментальные снимки базы данных» раздела «Примечания».  
  
## <a name="remarks"></a>Замечания  
 [Базы данных master](../../relational-databases/databases/master-database.md) необходимо создавать резервную копию каждый раз, когда создан, изменен или удалении пользовательской базы данных.  
  
 Инструкция CREATE DATABASE должна выполняться в режиме автоматической фиксации (режим управления транзакциями по умолчанию) и не может применяться в явной или неявной транзакции.  
  
 Для создания базы данных и файлов, в которых будет храниться база данных, можно использовать одну инструкцию CREATE DATABASE. В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] инструкция CREATE DATABASE реализуется посредством следующих действий:  
  
1.  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Использует копию [базы данных model](../../relational-databases/databases/model-database.md) для инициализации базы данных и ее метаданные.  
  
2.  Базе данных назначается идентификатор GUID компонента Service Broker.  
  
3.  Затем компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] заполняет остальную часть базы данных пустыми страницами, за исключением страниц, содержащих внутренние данные с описанием способа использования пространства в базе данных.  
  
 В экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]может быть задано не более 32 767 баз данных.  
  
 У каждой базы данных есть владелец, который может выполнять специальные действия в базе данных. Владельцем является пользователь, создавший базу данных. Владелец базы данных может быть изменен с помощью [sp_changedbowner](../../relational-databases/system-stored-procedures/sp-changedbowner-transact-sql.md).  

Некоторые функции базы данных зависят от возможности или предоставлять возможности файловой системы для обеспечения полной функциональности базы данных. Некоторые примеры компонентов, зависящих от файла набор характеристик системы.
- DBCC CHECKDB
- FILESTREAM
- Оперативное резервное копирование с помощью VSS и файлов моментальных снимков
- Создание моментального снимка базы данных
- Файловая группа данных, оптимизированного для памяти
   
## <a name="database-files-and-filegroups"></a>Файлы и файловые группы базы данных  
 Каждой базе данных имеется по крайней мере два файла *первичный файл* и *файла журнала транзакций*и по крайней мере одну файловую группу. Для каждой базы данных может указываться не более 32 767 файлов и 32 767 файловых групп.  
  
 При создании базы данных файлы данных следует делать как можно большего размера в соответствии с максимальным предполагаемым объемом данных в базе данных.  
  
 Для хранения файлов базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] рекомендуется использовать сеть хранения данных (SAN), сеть на основе iSCSI или локально подключенный диск, так как в этой конфигурации достигаются оптимальные производительность и надежность [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
## <a name="database-snapshots"></a>Моментальные снимки базы данных  
 Можно использовать инструкцию CREATE DATABASE можно создать только для чтения представление, *моментальный снимок базы данных* из *базы данных-источника*. Моментальный снимок базы данных согласован с базой данных-источником на уровне транзакций в том виде, в котором она существовала в момент создания моментального снимка. База данных-источник может иметь несколько моментальных снимков.  
  
> [!NOTE]  
>  При создании моментального снимка инструкция CREATE DATABASE не может обращаться к файлам журналов, файлам вне сети, восстанавливаемым файлам и несуществующим файлам.  
  
 Если создание моментального снимка базы данных не удается, моментальный снимок помечается как подозрительный и подлежит удалению. Дополнительные сведения см. в разделе [DROP DATABASE &#40; Transact-SQL &#41; ](../../t-sql/statements/drop-database-transact-sql.md).  
  
 Каждый моментальный снимок существует до тех пор, пока не будет удален с помощью инструкции DROP DATABASE.  
  
 Дополнительные сведения см. в разделе [Моментальные снимки базы данных (SQL Server)](../../relational-databases/databases/database-snapshots-sql-server.md).  
  
## <a name="database-options"></a>Параметры базы данных  
 Каждый раз при создании базы данных автоматически устанавливаются несколько параметров базы данных. Список этих параметров см. в разделе [параметры ALTER DATABASE SET &#40; Transact-SQL &#41; ](../../t-sql/statements/alter-database-transact-sql-set-options.md).  
  
## <a name="the-model-database-and-creating-new-databases"></a>База данных model и создание новых баз данных  
 Все определяемые пользователем объекты в [базы данных model](../../relational-databases/databases/model-database.md) , копируются во все создаваемые базы данных. В базу данных model можно добавлять любые объекты, такие как таблицы, представления, хранимые процедуры, типы данных и т. д., которые войдут в состав всех вновь созданных баз данных.  
  
 Если база данных-создание *имя_базы_данных* инструкция указана без дополнительных параметров размера, первичного файла данных выполняется тот же размер, что и первичный файл базы данных модели.  
  
 Если не указан параметр FOR ATTACH, то каждая новая база данных наследует значения параметров из базы данных model. Например, автоматическое сжатие базы данных параметр имеет значение **true** в модели и создания новых баз данных. Если изменить параметры в базе данных model, то эти новые параметры будут использоваться во вновь создаваемых базах данных. Операции, вносящие изменения в базу данных model, не влияют на существующие базы данных. Если параметр FOR ATTACH задан в инструкции CREATE DATABASE, то новая база данных наследует значения параметров исходной базы данных.  
  
## <a name="viewing-database-information"></a>Просмотр сведений о базе данных  
 Для возврата сведений о базах данных, файлах и файловых группах можно использовать представления каталогов, системные функции и системные хранимые процедуры. Дополнительные сведения см. в разделе [Системные представления (Transact-SQL)](http://msdn.microsoft.com/library/35a6161d-7f43-4e00-bcd3-3091f2015e90).  
  
## <a name="permissions"></a>Permissions  
 Необходимо разрешение CREATE DATABASE, CREATE ANY DATABASE или ALTER ANY DATABASE.  
  
 В целях сохранения управления над использованием диска в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]разрешение на создание баз данных обычно предоставляется небольшому числу учетных записей входа.  
  
 В следующем примере предоставляется разрешение на создание базы данных для пользователя Fay базы данных.  
  
```  
USE master;  
GO  
GRANT CREATE DATABASE TO [Fay];  
GO  
```  
  
### <a name="permissions-on-data-and-log-files"></a>Разрешения на файлы данных и журналов  
 В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для файлов данных и журналов каждой базы данных заданы некоторые разрешения. Следующие разрешения задаются при применении следующих операций к базе данных:  
  
|||  
|-|-|  
|Создан|Изменение для добавления нового файла|  
|Присоединение|Создание резервной копии|  
|Отсоединение|Восстановление|  
  
 Эти разрешения предотвращают случайное повреждение файлов, хранящихся в каталоге с открытыми разрешениями.  
  
> [!NOTE]  
>  [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssExpressEd2005](../../includes/ssexpressed2005-md.md)] не задает разрешения на файлы данных и файлы журнала.  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-creating-a-database-without-specifying-files"></a>A. Создание базы данных без указания файлов  
 В следующем примере создается база данных `mytest` и соответствующие первичный файл и файл журнала транзакций. Поскольку оператор не имеет \<filespec > элементов первичного файла базы данных — это размер первичного файла базы данных модели. Размер журнала транзакций устанавливается как наибольшее из следующих значений: 512 КБ или 25 % размера первичного файла данных. Поскольку параметр MAXSIZE не задан, файлы могут увеличиваться до заполнения всего свободного места на диске. Этот пример также демонстрирует, как удалить базу данных `mytest`, если она существует, перед созданием базы данных `mytest`.  
  
```  
USE master;  
GO  
CREATE DATABASE mytest;  
GO  
-- Verify the database files and sizes  
SELECT name, size, size*1.0/128 AS [Size in MBs]   
FROM sys.master_files  
WHERE name = N'mytest';  
GO  
  
```  
  
### <a name="b-creating-a-database-that-specifies-the-data-and-transaction-log-files"></a>Б. Создание базы данных, в которой заданы файлы данных и журнала транзакций  
 В следующем примере создается база данных `Sales`. Поскольку ключевое слово PRIMARY не использовано, поэтому первый файл (`Sales_dat`) становится первичным файлом. Поскольку в параметре SIZE для файла `Sales_dat` не заданы суффиксы MB и KB, используется значение MB и пространство выделяется в мегабайтах. Резервную копию базы данных `Sales_log` выделено в мегабайтах, потому что суффикс `MB` явно указан в параметре `SIZE` .  
  
```tsql  
USE master;  
GO  
CREATE DATABASE Sales  
ON   
( NAME = Sales_dat,  
    FILENAME = 'C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\DATA\saledat.mdf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 5 )  
LOG ON  
( NAME = Sales_log,  
    FILENAME = 'C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\DATA\salelog.ldf',  
    SIZE = 5MB,  
    MAXSIZE = 25MB,  
    FILEGROWTH = 5MB ) ;  
GO  
```  
  
### <a name="c-creating-a-database-by-specifying-multiple-data-and-transaction-log-files"></a>В. Создание базы данных, в которой указаны несколько файлов данных и журналов транзакций  
 Следующий пример создает базу данных `Archive`, имеющую 3 файла данных объемом по `100-MB` каждый и два файла журнала транзакций по `100-MB`. Первичный файл является первым файлом в списке и явно задан ключевым словом `PRIMARY`. Файлы журналов транзакций заданы следующими ключевыми словами `LOG ON`. Обратите внимание на расширения, используемые для файлов в параметре `FILENAME`: `.mdf` для первичных файлов данных, `.ndf` для вторичных файлов данных и `.ldf` для файлов журнала транзакций. В этом примере база данных размещается на диске `D:`, а не вместе с базой данных `master`.  
  
```tsql  
USE master;  
GO  
CREATE DATABASE Archive   
ON  
PRIMARY    
    (NAME = Arch1,  
    FILENAME = 'D:\SalesData\archdat1.mdf',  
    SIZE = 100MB,  
    MAXSIZE = 200,  
    FILEGROWTH = 20),  
    ( NAME = Arch2,  
    FILENAME = 'D:\SalesData\archdat2.ndf',  
    SIZE = 100MB,  
    MAXSIZE = 200,  
    FILEGROWTH = 20),  
    ( NAME = Arch3,  
    FILENAME = 'D:\SalesData\archdat3.ndf',  
    SIZE = 100MB,  
    MAXSIZE = 200,  
    FILEGROWTH = 20)  
LOG ON   
   (NAME = Archlog1,  
    FILENAME = 'D:\SalesData\archlog1.ldf',  
    SIZE = 100MB,  
    MAXSIZE = 200,  
    FILEGROWTH = 20),  
   (NAME = Archlog2,  
    FILENAME = 'D:\SalesData\archlog2.ldf',  
    SIZE = 100MB,  
    MAXSIZE = 200,  
    FILEGROWTH = 20) ;  
GO  
```  
  
### <a name="d-creating-a-database-that-has-filegroups"></a>Г. Создание базы данных с файловыми группами  
 В следующем примере создается база данных `Sales`, в которой есть следующие файловые группы.  
  
-   Первичная файловая группа с файлами `Spri1_dat` и `Spri2_dat`. Для этих файлов задана величина приращения FILEGROWTH, равная `15%`.  
  
-   Файловая группа с именем `SalesGroup1` и файлами `SGrp1Fi1` и `SGrp1Fi2`.  
  
-   Файловая группа с именем `SalesGroup2` и файлами `SGrp2Fi1` и `SGrp2Fi2`.  
  
 В этом примере файлы данных и журналов размещаются на различных дисках с целью повышения производительности.  
  
```tsql  
USE master;  
GO  
CREATE DATABASE Sales  
ON PRIMARY  
( NAME = SPri1_dat,  
    FILENAME = 'D:\SalesData\SPri1dat.mdf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 15% ),  
( NAME = SPri2_dat,  
    FILENAME = 'D:\SalesData\SPri2dt.ndf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 15% ),  
FILEGROUP SalesGroup1  
( NAME = SGrp1Fi1_dat,  
    FILENAME = 'D:\SalesData\SG1Fi1dt.ndf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 5 ),  
( NAME = SGrp1Fi2_dat,  
    FILENAME = 'D:\SalesData\SG1Fi2dt.ndf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 5 ),  
FILEGROUP SalesGroup2  
( NAME = SGrp2Fi1_dat,  
    FILENAME = 'D:\SalesData\SG2Fi1dt.ndf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 5 ),  
( NAME = SGrp2Fi2_dat,  
    FILENAME = 'D:\SalesData\SG2Fi2dt.ndf',  
    SIZE = 10,  
    MAXSIZE = 50,  
    FILEGROWTH = 5 )  
LOG ON  
( NAME = Sales_log,  
    FILENAME = 'E:\SalesLog\salelog.ldf',  
    SIZE = 5MB,  
    MAXSIZE = 25MB,  
    FILEGROWTH = 5MB ) ;  
GO  
```  
  
### <a name="e-attaching-a-database"></a>Д. Присоединение базы данных.  
 В следующем примере база данных `Archive`, созданная в примере Е, отсоединяется, а затем присоединяется с помощью предложения `FOR ATTACH`. База данных `Archive` была определена с несколькими файлами данных и журналов. Однако поскольку местоположение файлов не изменилось со времени их создания, в предложении `FOR ATTACH` должен быть задан только первичный файл. Начиная с [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] любые полнотекстовые файлы, являющиеся частью присоединяемой базы данных, будут присоединены вместе с базой данных.  
  
```tsql  
USE master;  
GO  
sp_detach_db Archive;  
GO  
CREATE DATABASE Archive  
      ON (FILENAME = 'D:\SalesData\archdat1.mdf')   
      FOR ATTACH ;  
GO  
```  
  
### <a name="f-creating-a-database-snapshot"></a>Е. Создание моментального снимка базы данных.  
 В следующем примере создается моментальный снимок базы данных `sales_snapshot0600`. Моментальный снимок базы данных предназначен только для чтения, поэтому нельзя задать файл журнала. В соответствии с синтаксисом задается каждый файл базы данных-источника, а файловые группы не указываются.  
  
 База данных-источник для этого примера — `Sales`, созданная в примере Г.  
  
```tsql  
USE master;  
GO  
CREATE DATABASE sales_snapshot0600 ON  
    ( NAME = SPri1_dat, FILENAME = 'D:\SalesData\SPri1dat_0600.ss'),  
    ( NAME = SPri2_dat, FILENAME = 'D:\SalesData\SPri2dt_0600.ss'),  
    ( NAME = SGrp1Fi1_dat, FILENAME = 'D:\SalesData\SG1Fi1dt_0600.ss'),  
    ( NAME = SGrp1Fi2_dat, FILENAME = 'D:\SalesData\SG1Fi2dt_0600.ss'),  
    ( NAME = SGrp2Fi1_dat, FILENAME = 'D:\SalesData\SG2Fi1dt_0600.ss'),  
    ( NAME = SGrp2Fi2_dat, FILENAME = 'D:\SalesData\SG2Fi2dt_0600.ss')  
AS SNAPSHOT OF Sales ;  
GO  
```  
  
### <a name="g-creating-a-database-and-specifying-a-collation-name-and-options"></a>Ж. Создание базы данных и назначение имени и параметров сортировки  
 В следующем примере создается база данных `MyOptionsTest`. Указано имя параметров сортировки, а параметрам `TRUSTYWORTHY` и `DB_CHAINING` присвоено значение `ON`.  
  
```tsql  
USE master;  
GO  
IF DB_ID (N'MyOptionsTest') IS NOT NULL  
DROP DATABASE MyOptionsTest;  
GO  
CREATE DATABASE MyOptionsTest  
COLLATE French_CI_AI  
WITH TRUSTWORTHY ON, DB_CHAINING ON;  
GO  
--Verifying collation and option settings.  
SELECT name, collation_name, is_trustworthy_on, is_db_chaining_on  
FROM sys.databases  
WHERE name = N'MyOptionsTest';  
GO  
  
```  
  
### <a name="h-attaching-a-full-text-catalog-that-has-been-moved"></a>З. Присоединение перемещенного полнотекстового каталога  
 В следующем примере показано, как присоединить полнотекстовый каталог `AdvWksFtCat` наряду с файлами данных и журнала `AdventureWorks2012`. В этом примере полнотекстовый каталог перемещается из расположения по умолчанию в новое расположение `c:\myFTCatalogs`. Файлы данных и журналов остаются в расположениях по умолчанию.  
  
```tsql  
USE master;  
GO  
--Detach the AdventureWorks2012 database  
sp_detach_db AdventureWorks2012;  
GO  
-- Physically move the full text catalog to the new location.  
--Attach the AdventureWorks2012 database and specify the new location of the full-text catalog.  
CREATE DATABASE AdventureWorks2012 ON   
    (FILENAME = 'c:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\Data\AdventureWorks2012_data.mdf'),   
    (FILENAME = 'c:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\Data\AdventureWorks2012_log.ldf'),  
    (FILENAME = 'c:\myFTCatalogs\AdvWksFtCat')  
FOR ATTACH;  
GO  
```  
  
### <a name="i-creating-a-database-that-specifies-a-row-filegroup-and-two-filestream-filegroups"></a>И. Создание базы данных, имеющей файловую группу строк и две файловые группы FILESTREAM  
 В следующем примере создается база данных `FileStreamDB`. Эта база данных создается с одной файловой группой строк и двумя файловыми группами FILESTREAM. Каждая файловая группа содержит один файл.  
  
-   Группа `FileStreamDB_data` содержит данные строк. В нее входит один файл `FileStreamDB_data.mdf`, расположенный в пути по умолчанию.  
  
-   Группа `FileStreamPhotos` содержит данные FILESTREAM. В нее входит два контейнера данных FILESTREAM, `FSPhotos`, расположенный в папке `C:\MyFSfolder\Photos`, и `FSPhotos2`, расположенный в папке `D:\MyFSfolder\Photos`. Она отмечена как файловая группа FILESTREAM по умолчанию.  
  
-   Группа `FileStreamResumes` содержит данные FILESTREAM. Она содержит один контейнер данных FILESTREAM — `FSResumes`, расположенный в папке `C:\MyFSfolder\Resumes`.  
  
```tsql  
USE master;  
GO  
-- Get the SQL Server data path.  
DECLARE @data_path nvarchar(256);  
SET @data_path = (SELECT SUBSTRING(physical_name, 1, CHARINDEX(N'master.mdf', LOWER(physical_name)) - 1)  
                  FROM master.sys.master_files  
                  WHERE database_id = 1 AND file_id = 1);  
  
 -- Execute the CREATE DATABASE statement.   
EXECUTE ('CREATE DATABASE FileStreamDB  
ON PRIMARY   
    (  
    NAME = FileStreamDB_data   
    ,FILENAME = ''' + @data_path + 'FileStreamDB_data.mdf''  
    ,SIZE = 10MB  
    ,MAXSIZE = 50MB  
    ,FILEGROWTH = 15%  
    ),  
FILEGROUP FileStreamPhotos CONTAINS FILESTREAM DEFAULT  
    (  
    NAME = FSPhotos  
    ,FILENAME = ''C:\MyFSfolder\Photos''  
-- SIZE and FILEGROWTH should not be specified here.  
-- If they are specified an error will be raised.  
, MAXSIZE = 5000 MB  
    ),  
    (  
      NAME = FSPhotos2  
      , FILENAME = ''D:\MyFSfolder\Photos''  
      , MAXSIZE = 10000 MB  
     ),  
FILEGROUP FileStreamResumes CONTAINS FILESTREAM  
    (  
    NAME = FileStreamResumes  
    ,FILENAME = ''C:\MyFSfolder\Resumes''  
    )   
LOG ON  
    (  
    NAME = FileStream_log  
    ,FILENAME = ''' + @data_path + 'FileStreamDB_log.ldf''  
    ,SIZE = 5MB  
    ,MAXSIZE = 25MB  
    ,FILEGROWTH = 5MB  
    )'  
);  
GO  
```  
  
### <a name="j-creating-a-database-that-has-a-filestream-filegroup-with-multiple-files"></a>К. Создание базы данных, имеющей файловую группу FILESTREAM с несколькими файлами  
 В следующем примере создается база данных `BlobStore1`. Эта база данных создается с одной файловой группой строк и одной файловой группой FILESTREAM, `FS`. Файловая группа FILESTREAM содержит два файла, `FS1` и `FS2`. Затем выполняется изменение базы данных путем добавления третьего файла, `FS3`, в файловую группу FILESTREAM.  
  
```tsql  
USE master;  
GO  
  
CREATE DATABASE [BlobStore1]  
CONTAINMENT = NONE  
ON PRIMARY   
(   
    NAME = N'BlobStore1',   
    FILENAME = N'C:\BlobStore\BlobStore1.mdf',  
    SIZE = 100MB,  
    MAXSIZE = UNLIMITED,  
    FILEGROWTH = 1MB  
),   
FILEGROUP [FS] CONTAINS FILESTREAM DEFAULT   
(  
    NAME = N'FS1',  
    FILENAME = N'C:\BlobStore\FS1',  
    MAXSIZE = UNLIMITED  
),   
(  
    NAME = N'FS2',  
    FILENAME = N'C:\BlobStore\FS2',  
    MAXSIZE = 100MB  
)  
LOG ON   
(  
    NAME = N'BlobStore1_log',  
    FILENAME = N'C:\BlobStore\BlobStore1_log.ldf',  
    SIZE = 100MB,  
    MAXSIZE = 1GB,  
    FILEGROWTH = 1MB  
);  
GO  
  
ALTER DATABASE [BlobStore1]  
ADD FILE  
(  
    NAME = N'FS3',  
    FILENAME = N'C:\BlobStore\FS3',  
    MAXSIZE = 100MB  
)  
TO FILEGROUP [FS];  
GO  
```  
  
## <a name="see-also"></a>См. также:  
 [ALTER DATABASE (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql.md)   
 [Присоединение и отсоединение базы данных (SQL Server)](../../relational-databases/databases/database-detach-and-attach-sql-server.md)   
 [DROP DATABASE (Transact-SQL)](../../t-sql/statements/drop-database-transact-sql.md)   
 [EVENTDATA (Transact-SQL)](../../t-sql/functions/eventdata-transact-sql.md)   
 [sp_changedbowner &#40; Transact-SQL &#41;](../../relational-databases/system-stored-procedures/sp-changedbowner-transact-sql.md)   
 [sp_detach_db &#40; Transact-SQL &#41;](../../relational-databases/system-stored-procedures/sp-detach-db-transact-sql.md)   
 [Хранимая процедура sp_removedbreplication &#40; Transact-SQL &#41;](../../relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql.md)   
 [Моментальные снимки базы данных (SQL Server)](../../relational-databases/databases/database-snapshots-sql-server.md)   
 [Перемещение файлов базы данных](../../relational-databases/databases/move-database-files.md)   
 [Базы данных](../../relational-databases/databases/databases.md)   
 [Данные большого двоичного объекта (SQL Server)](../../relational-databases/blob/binary-large-object-blob-data-sql-server.md)  


