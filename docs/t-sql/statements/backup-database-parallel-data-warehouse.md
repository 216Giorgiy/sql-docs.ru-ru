---
title: "Резервное копирование базы данных (Parallel Data Warehouse) | Документы Microsoft"
ms.custom: 
ms.date: 03/14/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 73c8d465-b36b-4727-b9f3-368e98677c64
caps.latest.revision: 11
author: barbkess
ms.author: barbkess
manager: jhubbard
ms.workload: Inactive
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: 4fb36fd89c02ff9ddd5bc33825a387b53ab6e174
ms.contentlocale: ru-ru
ms.lasthandoff: 09/01/2017

---
# <a name="backup-database-parallel-data-warehouse"></a>Резервное копирование базы данных (параллельное хранилище данных)
[!INCLUDE[tsql-appliesto-xxxxxx-xxxx-xxxx-pdw_md](../../includes/tsql-appliesto-xxxxxx-xxxx-xxxx-pdw-md.md)]

  Создает резервную копию [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] базы данных и сохраняет отключение устройства резервного копирования в сети, определяемый пользователем. Используйте эту инструкцию с [ВОССТАНОВЛЕНИЕ базы данных &#40; Параллельное хранилище данных &#41; ](../../t-sql/statements/restore-database-parallel-data-warehouse.md) для аварийного восстановления или копирования базы данных с одного устройства.  
  
 **Перед началом**, в разделе «Получение и Настройка архивации сервера» в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 Существует два типа резервных копий в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]. Объект *полной резервной копии* представляет собой резервную копию всей [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] базы данных. Объект *разностная резервная копия* включает только изменения, внесенные с момента последнего полного резервного копирования. Резервная копия пользовательской базы данных включает в себя пользователей базы данных и ролей базы данных. Резервная копия базы данных master включает имена входа.  
  
 Дополнительные сведения о [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] резервных копий базы данных см. в разделе «Резервное копирование и восстановление» в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "значок ссылки на раздел") [синтаксические обозначения Transact-SQL &#40; Transact-SQL &#41;](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
      Create a full backup of a user database or the master database.  
BACKUP DATABASE database_name  
    TO DISK = '\\UNC_path\backup_directory'  
    [ WITH [ ( ]  <with_options> [ ,...n ]  [ ) ] ]  
[;]  
  
Create a differential backup of a user database.  
BACKUP DATABASE database_name  
    TO DISK = '\\UNC_path\backup_directory'  
    WITH [ ( ] DIFFERENTIAL   
    [ , <with_options> [ ,...n ] [ ) ]  
[;]  
  
<with_options> ::=  
    DESCRIPTION = 'text'  
    | NAME = 'backup_name'  
  
```  
  
## <a name="arguments"></a>Аргументы  
 *database_name*  
 Имя базы данных, для которого требуется создать резервную копию. Базы данных может быть базой данных master или пользовательской базы данных.  
  
 ДИСК = "\\\\*UNC_path*\\*backup_directory*"  
 Сетевой путь к каталогу, к которому [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] будет записывать файлы резервной копии. Например "\\\xxx.xxx.xxx.xxx\backups\2012\Monthly\08.2012.Mybackup".  
  
-   Путь к имени каталога резервного копирования уже должен существовать и должен быть указан как полное универсальные правила именования пути (UNC).  
  
-   Каталог резервного копирования, *backup_directory*, не должен существовать до запуска команды резервного копирования. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]создаст каталог резервного копирования.  
  
-   Путь к каталогу резервного копирования не может быть локальный путь и не может быть местоположению на любом из [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] узлы устройств.  
  
-   Максимальная длина UNC-путь и имя каталога резервного копирования составляет 200 символов.  
  
-   Сервер или узла необходимо указать IP-адрес.  Нельзя указывать его как имя узла или сервера.  
  
 Описание = **"***текст***"**  
 Задает текстовое описание резервного копирования. Максимальная длина текста составляет 255 символов.  
  
 Описание хранится в метаданных и будет отображаться после восстановления заголовка резервной копии с помощью инструкции RESTORE HEADERONLY.  
  
 ИМЯ = **"***резервного копирования _name***"**  
 Указывает имя резервной копии. Имя резервной копии может отличаться от имени базы данных.  
  
-   Длина имени не может превышать 128 символов.  
  
-   Не может содержать путь.  
  
-   Должно начинаться с буквы или цифры, символ или символ подчеркивания (_). Специальные символы, которые разрешено — символ подчеркивания (\_), дефис (-) или пробел (). Имена резервных копий не может заканчиваться пробелом.  
  
-   Инструкция завершится ошибкой, если *backup_name* уже существует в указанном расположении.  
  
 Это имя хранится в метаданных и будет отображаться после восстановления заголовка резервной копии с помощью инструкции RESTORE HEADERONLY.  
  
 DIFFERENTIAL (разностная)  
 Указывает, создана разностная резервная копия пользовательской базы данных. Если не указано, значение по умолчанию — полное резервное копирование. Имя разностной резервной копии не обязательно должно совпадать с именем полной резервной копии. Для отслеживания разностной резервной копии и соответствующая полная резервная копия, рекомендуется использовать имя, совпадающее с «полная» или diff добавляется.  
  
 Например:  
  
 `BACKUP DATABASE Customer TO DISK = '\\xxx.xxx.xxx.xxx\backups\CustomerFull';`  
  
 `BACKUP DATABASE Customer TO DISK = '\\xxx.xxx.xxx.xxx\backups\CustomerDiff' WITH DIFFERENTIAL;`  
  
## <a name="permissions"></a>Permissions  
 Требуется **BACKUP DATABASE** разрешения или членства в **db_backupoperator** предопределенной роли базы данных. Базы данных master не удается создать резервную копию, но обычный пользователь, который был добавлен в **db_backupoperator** предопределенной роли базы данных. База данных master только резервное копирование по **sa**, администратор структуры или члены **sysadmin** предопределенной роли сервера.  
  
 Требуется учетная запись Windows, имеющую разрешение на доступ, создание и запись в каталоге резервных копий. Необходимо также сохранить имя учетной записи Windows и пароль в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]. Чтобы добавить эти сетевые учетные данные для [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], используйте [sp_pdw_add_network_credentials &#40; Хранилище данных SQL &#41; ](../../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md) хранимой процедуры.  
  
 Дополнительные сведения об управлении учетными данными в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], в разделе [безопасности](#Security) раздела.  
  
## <a name="error-handling"></a>Обработка ошибок  
 Резервное копирование базы данных ошибок при следующих условиях:  
  
-   Недостаточно разрешений пользователя создать резервную копию.  
  
-   [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]не имеет необходимых разрешений в сетевое расположение, где будет храниться резервная копия.  
  
-   Базы данных не существует.  
  
-   Целевой каталог уже существует в общей сетевой папке.  
  
-   Целевой общий сетевой ресурс недоступен.  
  
-   Целевой сетевую папку не имеет достаточно места для резервного копирования. Команда резервного КОПИРОВАНИЯ базы данных не подтверждает наличие места на диске до инициирования резервного копирования, благодаря чему приводит к ошибке места на диске во время выполнения резервного КОПИРОВАНИЯ базы данных. В случае нехватки места на диске [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] выполняет откат команды BACKUP DATABASE. Чтобы уменьшить размер базы данных, запустите [: параметр DBCC (хранилище данных SQL Azure)](../../t-sql/database-console-commands/dbcc-shrinklog-azure-sql-data-warehouse.md)  
  
-   Попытка запустить архивацию в рамках транзакции.  
  
## <a name="general-remarks"></a>Общие замечания  
 Прежде чем выполнять резервной копии базы данных, используйте [: параметр DBCC (хранилище данных SQL Azure)](../../t-sql/database-console-commands/dbcc-shrinklog-azure-sql-data-warehouse.md) для уменьшения размера базы данных. 
 
 Объект [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] резервная копия хранится как набор нескольких файлов в том же каталоге.  
  
 Разностная резервная копия обычно занимает меньше времени, чем полное резервное копирование и может выполняться более часто. При нескольких разностных резервных копий основаны на одной полной резервной копии, каждая разностная резервная копия включает все изменения в предыдущую разностную резервную копию.  
  
 Если отменить команду резервного КОПИРОВАНИЯ, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] приведет к удалению целевой каталог и все файлы, созданные для резервного копирования. Если [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] потере сетевого подключения к общей папке, не может выполнить откат.  
  
 Полные резервные копии и разностные резервные копии хранятся в разных каталогах. Соглашения об именовании не применяются для указания вместе принадлежат полной резервной копии и разностной резервной копии. Вы можете отслеживать через свои собственные соглашения об именовании. Кроме того вы можно отслеживать с помощью параметра с описание добавляется описание, а затем с помощью инструкции RESTORE HEADERONLY для получения описания.  
  
## <a name="limitations-and-restrictions"></a>Ограничения  
 Невозможно выполнить разностное резервное копирование базы данных master. Поддерживаются только полные резервные копии базы данных master.  
  
 Файлы резервной копии хранятся в формате подходит только для восстановления резервной копии, чтобы [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] устройства с помощью [ВОССТАНОВЛЕНИЕ базы данных &#40; Параллельное хранилище данных &#41; ](../../t-sql/statements/restore-database-parallel-data-warehouse.md) инструкции.  
  
 Резервное копирование при помощи инструкции BACKUP DATABASE не может использоваться для передачи сведений о данных или пользователя SMP [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] баз данных. Для этой функции можно использовать функцию копирования удаленной таблицы. Дополнительные сведения см. в разделе «Удаленный копирование таблицы» в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]использует [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] технология резервного копирования и восстановления баз данных резервного копирования. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]параметры резервного копирования предварительно настроен на использование сжатия резервной копии. Невозможно задать параметры резервного копирования, такие как сжатие, контрольная сумма, размер блока и число буферов.  
  
 Только одну резервную копию базы данных или восстановления можно запустить в любой момент времени на устройстве. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]в очередь команды backup или restore до текущей резервной копии или завершения восстановления.  
  
 Целевого устройства для восстановления резервной копии требуется по крайней мере столько вычислительных узлов в качестве исходного устройства. Целевой объект может включать несколько вычислительных узлов, чем устройства источника, но не может иметь меньшее количество вычислительных узлов.  
  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]не отслеживает расположение и имена резервных копий, поскольку резервные копии хранятся выключать устройство.  
  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]Отслеживание успешности резервного копирования базы данных.  
  
 Разностная резервная копия допускается только в том случае, если последней полной резервной копии успешно завершено. Например предположим, что в понедельник создать полную резервную копию базы данных Sales и успешного завершения резервного копирования. Затем во вторник создать полную резервную копию базы данных Sales, и происходит сбой. После такого сбоя не может затем Создание разностной резервной копии на основе полной резервной копии в понедельник. Сначала необходимо создать успешно полной резервной копии перед созданием разностной резервной копии.  
  
## <a name="metadata"></a>Метаданные  
 Эти динамические административные представления содержат сведения о всех резервного копирования, восстановления и операции загрузки. Сведения, сохраняются после перезагрузки системы.  
  
-   [sys.pdw_loader_backup_runs &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-pdw-loader-backup-runs-transact-sql.md)  
  
-   [sys.pdw_loader_backup_run_details &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-pdw-loader-backup-run-details-transact-sql.md)  
  
-   [sys.pdw_loader_run_stages &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-pdw-loader-run-stages-transact-sql.md)  
  
## <a name="performance"></a>Производительность  
 Создание резервной копии, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] первый создает резервную копию метаданных, а затем выполняет параллельных операций резервного копирования базы данных, хранящихся на вычислительных узлах. Данные копируются напрямую из каждого вычислительных узлов в каталог резервного копирования. Для достижения наилучшей производительности для переноса данных из вычислительных узлов в каталоге резервных копий [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] управляет количеством вычислительных узлов, которые копируются данные одновременно.  
  
## <a name="locking"></a>Блокировка  
 Осуществляет блокировку ExclusiveUpdate объект базы данных.  
  
##  <a name="Security"></a> Безопасность  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]резервные копии не хранятся на устройстве. Таким образом ИТ-специалисты отвечает за управление всеми аспектами безопасности резервного копирования. Например, сюда относятся управление безопасности резервного копирования данных, безопасность сервера, используемого для хранения резервных копий и безопасность сетевой инфраструктуры, который подключается к серверу резервного копирования для [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] устройства.  
  
 **Управление учетными данными в сети**  
  
 Доступ к сети в каталог резервного копирования на основе стандартных Windows файла безопасности для управления доступом. Прежде чем выполнять резервное копирование, необходимо создать или указать учетную запись Windows, которая будет использоваться для проверки подлинности [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] в каталог резервного копирования. Эта учетная запись windows, требуется разрешение для доступа, создания и записи в каталог резервного копирования.  
  
> [!IMPORTANT]  
>  Чтобы снизить риски безопасности, с данными, рекомендуется назначить одну учетную запись Windows исключительно для выполнения резервного копирования и восстановления. Разрешить этой учетной записи необходимо предоставить разрешения на папку резервного копирования и нигде больше.  
  
 Вам необходимо сохранить имя пользователя и пароль в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] , запустив [sp_pdw_add_network_credentials &#40; Хранилище данных SQL &#41; ](../../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md) хранимой процедуры. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]Диспетчер учетных данных Windows использует для хранения и шифрование имен пользователей и паролей на узел элемента управления и вычислительных узлов. Учетные данные не архивируются с помощью команды BACKUP DATABASE.  
  
 Чтобы удалить учетные данные сети из [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], в разделе [sp_pdw_remove_network_credentials &#40; Хранилище данных SQL &#41; ](../../relational-databases/system-stored-procedures/sp-pdw-remove-network-credentials-sql-data-warehouse.md).  
  
 Чтобы получить список всех сетевые учетные данные, хранящиеся в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], используйте [sys.dm_pdw_network_credentials &#40; Transact-SQL &#41; ](../../relational-databases/system-dynamic-management-views/sys-dm-pdw-network-credentials-transact-sql.md) динамическое административное представление.  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-add-network-credentials-for-the-backup-location"></a>A. Добавьте сетевые учетные данные для папки резервного копирования  
 Создание резервной копии, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] должен иметь разрешения на чтение и запись в каталог резервного копирования. Следующий пример демонстрирует добавление учетные данные для пользователя. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]для сохранения эти учетные данные и использовать их для резервного копирования и операциями восстановления.  
  
> [!IMPORTANT]  
>  По соображениям безопасности рекомендуется создать одну учетную запись домена исключительно с целью создания резервных копий.  
  
```  
EXEC sp_pdw_add_network_credentials 'xxx.xxx.xxx.xxx', 'domain1\backupuser', '*****';  
```  
  
### <a name="b-remove-network-credentials-for-the-backup-location"></a>Б. Удалить сетевые учетные данные для папки резервного копирования  
 В следующем примере показано, как удалить учетные данные пользователя домена с [!INCLUDE[ssPDW](../../includes/sspdw-md.md)].  
  
```  
EXEC sp_pdw_remove_network_credentials 'xxx.xxx.xxx.xxx';  
```  
  
### <a name="c-create-a-full-backup-of-a-user-database"></a>В. Создайте полную резервную копию пользовательской базы данных  
 Следующий пример создает полную резервную копию пользовательской базы данных счета. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]создаст каталог Invoices2013 и будет сохранять файлы резервных копий для \\\10.192.63.147\backups\yearly\Invoices2013Full каталога.  
  
```  
BACKUP DATABASE Invoices TO DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full';  
```  
  
### <a name="d-create-a-differential-backup-of-a-user-database"></a>Г. Создание разностной резервной копии пользовательской базы данных  
 В следующем примере создается разностная резервная копия, включая все изменения, внесенные с момента последнего полного резервного копирования базы данных счета. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]будет создан \\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Diff каталога, к которой будут храниться файлы. Сведения о заголовке резервной копии будет храниться описание «2013 счета разностная резервная копия».  
  
 Разностная резервная копия только будет выполнен успешно, если последней полной резервной копии счетов-фактур успешно завершена.  
  
```  
BACKUP DATABASE Invoices TO DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Diff'  
    WITH DIFFERENTIAL,   
    DESCRIPTION = 'Invoices 2013 differential backup';  
```  
  
### <a name="e-create-a-full-backup-of-the-master-database"></a>Д. Создание полной резервной копии базы данных master  
 В следующем примере создается полная резервная копия базы данных master и сохраняет его в каталоге "\\\10.192.63.147\backups\2013\daily\20130722\master".  
  
```  
BACKUP DATABASE master TO DISK = '\\xxx.xxx.xxx.xxx\backups\2013\daily\20130722\master';  
```  
  
### <a name="f-create-a-backup-of-appliance-login-information"></a>Е. Создайте резервную копию устройства учетные данные.  
 Базы данных master хранит сведения об имени входа устройства. Для создания резервной копии, необходимые для резервного копирования главного сведения об имени входа устройства.  
  
 В следующем примере создается полная резервная копия базы данных master.  
  
```  
BACKUP DATABASE master TO DISK = '\\xxx.xxx.xxx.xxx\backups\2013\daily\20130722\master'  
WITH (   
    DESCRIPTION = 'Master Backup 20130722',  
    NAME = 'login-backup'  
)  
;  
```  
  
## <a name="see-also"></a>См. также:  
 [ВОССТАНОВЛЕНИЕ базы данных &#40; Параллельное хранилище данных &#41;](../../t-sql/statements/restore-database-parallel-data-warehouse.md)  
  
  

