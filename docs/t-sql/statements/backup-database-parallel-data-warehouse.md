---
title: BACKUP DATABASE (Parallel Data Warehouse) | Документы Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: pdw
ms.reviewer: ''
ms.suite: sql
ms.technology: t-sql
ms.tgt_pltfrm: ''
ms.topic: conceptual
ms.assetid: 73c8d465-b36b-4727-b9f3-368e98677c64
caps.latest.revision: 11
author: CarlRabeler
ms.author: carlrab
manager: craigg
monikerRange: '>= aps-pdw-2016 || = sqlallproducts-allversions'
ms.openlocfilehash: 41ad9d69b045a149bf6adad58f16f881ccc5d98e
ms.sourcegitcommit: 05e18a1e80e61d9ffe28b14fb070728b67b98c7d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/04/2018
ms.locfileid: "37783485"
---
# <a name="backup-database-parallel-data-warehouse"></a>BACKUP DATABASE (Parallel Data Warehouse)
[!INCLUDE[tsql-appliesto-xxxxxx-xxxx-xxxx-pdw-md](../../includes/tsql-appliesto-xxxxxx-xxxx-xxxx-pdw-md.md)]

  Создает резервную копию базы данных [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] и сохраняет резервную копию за пределами устройства, в указанном пользователем расположении в сети. Используйте эту инструкцию вместе с [RESTORE DATABASE (Parallel Data Warehouse)](../../t-sql/statements/restore-database-parallel-data-warehouse.md) для аварийного восстановления или копирования базы данных с одного устройства на другое.  
  
 **Перед началом работы** изучите статью "Получение и настройка сервера резервного копирования" в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 В среде [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] существует два типа резервных копий. *Полная резервная копия базы данных* — это резервная копия всей базы данных [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]. *Разностная резервная копия* сохраняет только те изменения, которые были внесены с момента последнего полного резервного копирования. Резервная копия пользовательской базы данных включает пользователей базы данных и роли базы данных. Резервная копия базы данных master включает данные для входа.  
  
 Дополнительные сведения о резервном копировании баз данных [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] см. в разделе "Резервное копирование и восстановление" в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL (Transact-SQL)](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
      Create a full backup of a user database or the master database.  
BACKUP DATABASE database_name  
    TO DISK = '\\UNC_path\backup_directory'  
    [ WITH [ ( ]  <with_options> [ ,...n ]  [ ) ] ]  
[;]  
  
Create a differential backup of a user database.  
BACKUP DATABASE database_name  
    TO DISK = '\\UNC_path\backup_directory'  
    WITH [ ( ] DIFFERENTIAL   
    [ , <with_options> [ ,...n ] [ ) ]  
[;]  
  
<with_options> ::=  
    DESCRIPTION = 'text'  
    | NAME = 'backup_name'  
  
```  
  
## <a name="arguments"></a>Аргументы  
 *database_name*  
 Имя базы данных для создания резервной копии. Можно создать резервную копию базы данных master или пользовательской базы данных.  
  
 TO DISK = '\\\\*UNC_path*\\*backup_directory*'  
 Сетевой путь к каталогу, в который [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] запишет файлы резервной копии. Например, '\\\xxx.xxx.xxx.xxx\backups\2012\Monthly\08.2012.Mybackup'.  
  
-   Путь к имени каталога резервного копирования должен уже существовать; его необходимо указать как полный путь UNC.  
  
-   Каталог резервного копирования, *backup_directory*, не должен существовать до запуска команды резервного копирования. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] создаст каталог резервного копирования.  
  
-   Путь к каталогу резервного копирования не может быть локальным путем или расположением на любом из узлов устройства [!INCLUDE[ssPDW](../../includes/sspdw-md.md)].  
  
-   Максимальная длина пути UNC и имени каталога резервного копирования равна 200 символов.  
  
-   Для сервера или узла необходимо указать IP-адрес.  Невозможно указать для них имя хоста или сервера.  
  
 DESCRIPTION = **'***text***'**  
 Задает текстовое описание резервной копии. Максимальная длина текста составляет 255 символов.  
  
 Описание хранится в метаданных и отображается, если заголовок резервной копии восстанавливается с помощью инструкции RESTORE HEADERONLY.  
  
 NAME = **'***backup _name***'**  
 Задает имя резервной копии. Имя резервной копии может отличаться от имени базы данных.  
  
-   Длина имени не может превышать 128 символов.  
  
-   Не может содержать путь.  
  
-   Должно начинаться с буквы, цифры или подчеркивания (_). Разрешенные специальные символы: подчеркивание (\_), дефис (-) или пробел ( ). Имена резервных копий не могут заканчиваться пробелом.  
  
-   Выполнение инструкции завершится ошибкой, если *backup_name* уже существует в заданном расположении.  
  
 Это имя хранится в метаданных и отображается, если заголовок резервной копии восстанавливается с помощью инструкции RESTORE HEADERONLY.  
  
 DIFFERENTIAL (разностная)  
 Указывает, что необходимо создать разностную резервную копию пользовательской базы данных. Если не задать этот параметр, по умолчанию выполняется полное резервное копирование базы данных. Имя разностной резервной копии не обязательно должно совпадать с именем полной резервной копии. Для отслеживания разностной резервной копии и соответствующей ей полной резервной копии рекомендуется использовать одно и то же имя с добавлением diff или full соответственно.  
  
 Пример:  
  
 `BACKUP DATABASE Customer TO DISK = '\\xxx.xxx.xxx.xxx\backups\CustomerFull';`  
  
 `BACKUP DATABASE Customer TO DISK = '\\xxx.xxx.xxx.xxx\backups\CustomerDiff' WITH DIFFERENTIAL;`  
  
## <a name="permissions"></a>Разрешения  
 Требуется разрешение **BACKUP DATABASE** или участие в предопределенной роли базы данных **db_backupoperator**. Создать резервную копию базы данных master может только обычный пользователь, добавленный в предопределенную роль базы данных **db_backupoperator**. Создать резервную копию базы данных master может только роль **sa**, администратор структуры или участники предопределенной роли базы данных **sysadmin**.  
  
 Требуется учетная запись Windows с разрешениями на доступ к каталогу резервного копирования, создание такого каталога и запись в него. Необходимо также сохранить имя учетной записи Windows и пароль в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]. Чтобы добавить эти сетевые учетные данные для [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], используйте хранимую процедуру [sp_pdw_add_network_credentials (хранилище данных SQL)](../../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md).  
  
 Дополнительные сведения об управлении учетными данными в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] см. в разделе [Безопасность](#Security).  
  
## <a name="error-handling"></a>Обработка ошибок  
 Ошибки BACKUP DATABASE возникают в следующих ситуациях:  
  
-   Недостаточно разрешений пользователя для создания резервной копии.  
  
-   [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] не имеет необходимых разрешений в сетевом расположении, где будет храниться резервная копия.  
  
-   База данных не существует.  
  
-   Целевой каталог уже существует в общей сетевой папке.  
  
-   Целевая общая сетевая папка недоступна.  
  
-   В целевой общей сетевой папке недостаточно места для хранения резервной копии. Команда BACKUP DATABASE не подтверждает, что дискового пространства достаточно, прежде чем запустить резервное копирование, из-за чего при выполнении инструкции BACKUP DATABASE может возникнуть ошибка нехватки места. В случае нехватки места на диске [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] выполняет откат команды BACKUP DATABASE. Чтобы уменьшить размер базы данных, запустите [DBCC SHRINKLOG (хранилище данных SQL Azure)](../../t-sql/database-console-commands/dbcc-shrinklog-azure-sql-data-warehouse.md)  
  
-   Попытка запустить резервное копирование в рамках транзакции.  
  
## <a name="general-remarks"></a>Общие замечания  
 Прежде чем выполнять резервное копирование базы данных, воспользуйтесь инструкцией [DBCC SHRINKLOG (хранилище данных SQL Azure)](../../t-sql/database-console-commands/dbcc-shrinklog-azure-sql-data-warehouse.md), чтобы уменьшить размер базы данных. 
 
 Резервная копия [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] хранится в качестве набора файлов в том же каталоге.  
  
 Разностная резервная копия обычно создается быстрее, чем полная, создавать такие копии можно чаще. Если на одной полной резервной копии основано несколько разностных, каждая из последних включает все изменения из предыдущей разностной резервной копии.  
  
 Если отменить команду BACKUP, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] удалит целевой каталог и все файлы, созданные для этой резервной копии. Если [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] теряет сетевое подключение к папке, выполнить откат невозможно.  
  
 Полные резервные копии и разностные резервные копии хранятся в разных каталогах. Соглашения об именовании не применяются для указания, что полная и разностная резервные копии связаны. Для отслеживания этого можно использовать собственные соглашения об именовании. Кроме того, это можно отследить, воспользовавшись инструкцией WITH DESCRIPTION для добавления описания, а затем воспользовавшись инструкцией RESTORE HEADERONLY для извлечения описания.  
  
## <a name="limitations-and-restrictions"></a>Ограничения  
 Невозможно создать разностную резервную копию базы данных master. Поддерживается только создание полных резервных копий базы данных master.  
  
 Файлы резервных копий хранятся в формате, который подходит только для восстановления резервной копии на устройстве [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] с использованием инструкции [RESTORE DATABASE (Parallel Data Warehouse)](../../t-sql/statements/restore-database-parallel-data-warehouse.md).  
  
 Резервное копирование, выполненное при помощи инструкции BACKUP DATABASE, невозможно использовать для передачи данных или пользовательских сведений в базы данных SMP [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Для этого можно воспользоваться функцией копирования удаленной таблицы. Дополнительные сведения см. в разделе "Копирование удаленной таблицы" в разделе [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] использует технологию резервного копирования [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для создания резервных копий и восстановления баз данных. Параметры резервного копирования [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] преднастроены для сжатия резервных копий. Невозможно задать параметры резервного копирования, такие как сжатие, контрольная сумма, размер блока и число буферов.  
  
 На устройстве не может одновременно выполняться несколько операций резервного копирования или восстановления базы данных. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] помещает команды резервного копирования или восстановления в очередь до тех пор, пока текущая команда резервного копирования или восстановления не будет выполнена.  
  
 Целевое устройство для восстановления резервной копии должно иметь не меньше вычислительных узлов, чем исходное. Целевое устройство может иметь больше вычислительных узлов, чем исходное, но не меньше.  
  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] не отслеживает расположение и имена резервных копий, поскольку резервные копии хранятся за пределами устройства.  
  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] отслеживает успешное или неудачное резервное копирование баз данных.  
  
 Разностную резервную копию можно создать только в том случае, если успешно выполнено последнее полное резервное копирование. Предположим, что в понедельник вы создали полную резервную копию базы данных "Продажи", резервное копирование было выполнено успешно. Затем во вторник вы пытаетесь создать полную резервную копию базы данных "Продажи", и операция завершается сбоем. После этого сбоя невозможно создать разностную резервную копию на основе полной резервной копии, созданной в понедельник. Перед созданием разностной резервной копии необходимо успешно создать полную резервную копию.  
  
## <a name="metadata"></a>Метаданные  
 Эти динамические административные представления содержат сведения обо всех операциях резервного копирования, восстановления и загрузки. Эта информация сохраняется и после перезапуска системы.  
  
-   [sys.pdw_loader_backup_runs (Transact-SQL)](../../relational-databases/system-catalog-views/sys-pdw-loader-backup-runs-transact-sql.md)  
  
-   [sys.pdw_loader_backup_run_details (Transact-SQL)](../../relational-databases/system-catalog-views/sys-pdw-loader-backup-run-details-transact-sql.md)  
  
-   [sys.pdw_loader_run_stages (Transact-SQL)](../../relational-databases/system-catalog-views/sys-pdw-loader-run-stages-transact-sql.md)  
  
## <a name="performance"></a>Производительность  
 При создании резервной копии [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] сначала создает резервные копии метаданных, а затем выполняет параллельное резервное копирование данных базы данных, которые хранятся на вычислительных узлах. Данные копируются напрямую из каждого вычислительного узла в каталог резервного копирования. Чтобы обеспечить максимальную производительность при переносе данных из вычислительных узлов в каталог резервного копирования, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] контролирует число вычислительных узлов, которые параллельно копируют данные.  
  
## <a name="locking"></a>Блокировка  
 Осуществляет блокировку ExclusiveUpdate объекта DATABASE.  
  
##  <a name="Security"></a> безопасность  
 Резервные копии [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] не хранятся на устройстве. Следовательно, ИТ-специалисты отвечают за управление всеми аспектами безопасности резервных копий. Например, сюда относится управление безопасностью данными резервного копирования, безопасностью сервера, на котором хранятся резервные копии и безопасностью сетевой инфраструктуры, подключающей сервер резервного копирования к устройству [!INCLUDE[ssPDW](../../includes/sspdw-md.md)].  
  
 **Управление сетевыми учетными данными**  
  
 Сетевой доступ к каталогу резервного копирования осуществляется по стандартным принципам безопасности при обмене файлами в Windows. Прежде чем выполнять резервное копирование, необходимо создать или указать учетную запись Windows, которая будет использоваться для проверки подлинности [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] в каталоге резервного копирования. Эта учетная запись Windows должна иметь разрешения на доступ к каталогу резервного копирования, создание такого каталога и запись в него.  
  
> [!IMPORTANT]  
>  Чтобы снизить риски безопасности в работе с данными, рекомендуется назначить одну учетную запись Windows исключительно для выполнения резервного копирования и восстановления. Предоставьте этой учетной записи разрешения исключительно для расположения резервного копирования.  
  
 Необходимо сохранить имя пользователя и пароль в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], выполнив хранимую процедуру [sp_pdw_add_network_credentials (хранилище данных SQL)](../../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md). [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] использует диспетчер учетных данных Windows для хранения и шифрования имен пользователей и паролей в узле управления и в вычислительных узлах. Учетные данные не архивируются с помощью команды BACKUP DATABASE.  
  
 Чтобы удалить сетевые учетные данные из [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], см. раздел [sp_pdw_remove_network_credentials (хранилище данных SQL)](../../relational-databases/system-stored-procedures/sp-pdw-remove-network-credentials-sql-data-warehouse.md).  
  
 Чтобы перечислить все сетевые учетные данные, хранимые в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], воспользуйтесь динамическим административным представлением [sys.dm_pdw_network_credentials (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-pdw-network-credentials-transact-sql.md).  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-add-network-credentials-for-the-backup-location"></a>A. Добавление сетевых учетных данных для расположения резервного копирования  
 Чтобы создать резервную копию, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] должен иметь разрешения на чтение и запись в каталоге резервного копирования. В следующем примере показано добавление учетных данных для пользователя. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] сохранит эти учетные данные и будет использовать их для операций резервного копирования и восстановления.  
  
> [!IMPORTANT]  
>  По соображениям безопасности рекомендуется создать одну доменную учетную запись исключительно с целью создания резервных копий.  
  
```  
EXEC sp_pdw_add_network_credentials 'xxx.xxx.xxx.xxx', 'domain1\backupuser', '*****';  
```  
  
### <a name="b-remove-network-credentials-for-the-backup-location"></a>Б. Удаление сетевых учетных данных для расположения резервного копирования  
 В следующем примере показано удаление учетных данных для доменного пользователя из [!INCLUDE[ssPDW](../../includes/sspdw-md.md)].  
  
```  
EXEC sp_pdw_remove_network_credentials 'xxx.xxx.xxx.xxx';  
```  
  
### <a name="c-create-a-full-backup-of-a-user-database"></a>В. Создание полной резервной копии пользовательской базы данных  
 В следующем примере создается полная резервная копия пользовательской базы данных "Счета". [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] создаст каталог Invoices2013 и сохранит файлы резервной копии в каталог \\\10.192.63.147\backups\yearly\Invoices2013Full.  
  
```  
BACKUP DATABASE Invoices TO DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full';  
```  
  
### <a name="d-create-a-differential-backup-of-a-user-database"></a>Г. Создание разностной резервной копии пользовательской базы данных  
 В следующем примере создается разностная резервная копия, которая содержит все изменения, внесенные с момента последнего полного резервного копирования базы данных "Счета". [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] создаст каталог \\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Diff, в котором будут сохранены файлы. Описание Invoices 2013 differential backup будет сохранено вместе с информацией о заголовке резервной копии.  
  
 Разностная резервная копия будет создана успешно только в том случае, если успешно выполнено предыдущее полное резервное копирование базы данных "Счета".  
  
```  
BACKUP DATABASE Invoices TO DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Diff'  
    WITH DIFFERENTIAL,   
    DESCRIPTION = 'Invoices 2013 differential backup';  
```  
  
### <a name="e-create-a-full-backup-of-the-master-database"></a>Д. Создание полной резервной копии базы данных master  
 В следующем примере создается полная резервная копия базы данных master и сохраняется в каталоге \\\10.192.63.147\backups\2013\daily\20130722\master.  
  
```  
BACKUP DATABASE master TO DISK = '\\xxx.xxx.xxx.xxx\backups\2013\daily\20130722\master';  
```  
  
### <a name="f-create-a-backup-of-appliance-login-information"></a>Е. Создайте резервную копию данных для входа на устройство.  
 Данные для входа на устройство хранятся в базе данных master. Для резервного копирования данных для входа на устройство потребуется создать резервную копию базы данных master.  
  
 В следующем примере создается полная резервная копия базы данных master.  
  
```  
BACKUP DATABASE master TO DISK = '\\xxx.xxx.xxx.xxx\backups\2013\daily\20130722\master'  
WITH (   
    DESCRIPTION = 'Master Backup 20130722',  
    NAME = 'login-backup'  
)  
;  
```  
  
## <a name="see-also"></a>См. также:  
 [RESTORE DATABASE (Parallel Data Warehouse)](../../t-sql/statements/restore-database-parallel-data-warehouse.md)  
  
  
