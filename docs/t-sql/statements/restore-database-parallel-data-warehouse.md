---
title: "ВОССТАНОВЛЕНИЕ базы данных (Parallel Data Warehouse) | Документы Microsoft"
ms.custom: 
ms.date: 03/17/2017
ms.prod: sql-non-specified
ms.prod_service: pdw
ms.service: 
ms.component: t-sql|statements
ms.reviewer: 
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: d915bfc1-e392-4a3a-9d94-08682cf3c864
caps.latest.revision: 
author: barbkess
ms.author: barbkess
manager: craigg
ms.workload: Inactive
ms.openlocfilehash: 5ba8aa12f38fce6ac00f88f0015008da25a59b88
ms.sourcegitcommit: 9e6a029456f4a8daddb396bc45d7874a43a47b45
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2018
---
# <a name="restore-database-parallel-data-warehouse"></a>ВОССТАНОВЛЕНИЕ базы данных (параллельное хранилище данных)
[!INCLUDE[tsql-appliesto-xxxxxx-xxxx-xxxx-pdw-md](../../includes/tsql-appliesto-xxxxxx-xxxx-xxxx-pdw-md.md)]

  Восстанавливает [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] пользовательской базы данных из резервной копии базы данных для [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] устройства. База данных восстанавливается из резервной копии, ранее созданным [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] [резервной копии базы данных &#40; Параллельное хранилище данных &#41; ](../../t-sql/statements/backup-database-parallel-data-warehouse.md) команды. Для резервного копирования и восстановления для создания плана аварийного восстановления или переместить базы данных с одного устройства.  
  
> [!NOTE]  
>  Восстановления базы данных master включает восстановление устройства учетные данные. Чтобы восстановить главный, используйте [восстановить базу данных master &#40; Transact-SQL &#41; ](../../relational-databases/backup-restore/restore-the-master-database-transact-sql.md) страницы в **Configuration Manager** средства. Администратор с доступом к узлу элемента управления могут выполнять эту операцию.  
  
 Дополнительные сведения о [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] резервных копий базы данных см. в разделе «Резервное копирование и восстановление» в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "значок ссылки на раздел") [синтаксические обозначения Transact-SQL &#40; Transact-SQL &#41;](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
      Restore the master database  
-- Use the Configuration Manager tool.  
  
Restore a full user database backup.  
RESTORE DATABASE database_name   
    FROM DISK = '\\UNC_path\full_backup_directory'  
[;]  
  
Restore a full user database backup and then a differential backup.  
RESTORE DATABASE database_name  
    FROM DISK = '\\UNC_path\differential_backup_directory'   
    WITH [ ( ] BASE = '\\UNC_path\full_backup_directory' [ ) ]   
[;]  
  
Restore header information for a full or differential user database backup.  
RESTORE HEADERONLY   
    FROM DISK = '\\UNC_path\backup_directory'  
[;]  
```  
  
## <a name="arguments"></a>Аргументы  
 ВОССТАНОВЛЕНИЕ базы данных *имя_базы_данных*  
 Задает восстановление пользовательской базы данных в базу данных с именем *имя_базы_данных*. Восстановленная база данных может иметь имя, отличное от исходной базы данных, которая была создана резервная копия. *database_name* не может уже существовать в качестве базы данных на целевом устройстве. Дополнительные сведения о разрешенных имен баз данных, см. в разделе «Правила именования объектов» в [!INCLUDE[pdw-product-documentation](../../includes/pdw-product-documentation-md.md)].  
  
 Восстановление пользовательской базы данных восстанавливает резервную копию всей базы данных и при необходимости восстановление разностной резервной копии с устройством. Восстановление пользовательской базы данных включает в себя восстановление базы данных пользователей и ролей базы данных.  
  
 С диска = "\\\\*UNC_path*\\*backup_directory*"  
 Сетевой путь к каталогу, из которого [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] восстановит файлы резервной копии. Например, с диска = "\\\xxx.xxx.xxx.xxx\backups\2012\Monthly\08.2012.Mybackup".  
  
 *backup_directory*  
 Задает имя каталога, который содержит полную или разностную резервную копию. Например можно выполнить операцию RESTORE HEADERONLY полной или разностной резервной копии.  
  
 *full_backup_directory*  
 Задает имя каталога, который содержит полную резервную копию.  
  
 *differential_backup_directory*  
 Задает имя каталога, содержащего разностной резервной копии.  
  
-   Каталог пути и резервного копирования уже должен существовать и должен быть указан как полное универсальные правила именования пути (UNC).  
  
-   Путь к каталогу резервного копирования не может быть локальный путь и не может быть местоположению на любом из [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] узлы устройств.  
  
-   Максимальная длина UNC-путь и имя каталога резервного копирования составляет 200 символов.  
  
-   Сервер или узла необходимо указать IP-адрес.  
  
 инструкция RESTORE HEADERONLY  
 Указывает, возвращать только данные заголовка резервной копии базы данных для одного пользователя. В других полях заголовок содержит текстовое описание резервного копирования и имя резервной копии. Имя резервной копии необходимо задать для нее имя каталога, в котором хранятся файлы резервной копии.  
  
 Результаты инструкции RESTORE HEADERONLY созданный [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] результатов инструкции RESTORE HEADERONLY. Результат имеет более 50 столбцов, которые используют не все [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]. Описание столбцов в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] результатов инструкции RESTORE HEADERONLY см. в разделе [RESTORE HEADERONLY &#40; Transact-SQL &#41; ](../../t-sql/statements/restore-statements-headeronly-transact-sql.md).  
  
## <a name="permissions"></a>Разрешения  
 Требуется **CREATE ANY DATABASE** разрешение.  
  
 Требуется учетная запись Windows, имеющую разрешение на доступ и чтение из каталога резервного копирования. Необходимо также сохранить имя учетной записи Windows и пароль в [!INCLUDE[ssPDW](../../includes/sspdw-md.md)].  
  
1.  Чтобы проверить учетные данные уже существует, используйте [sys.dm_pdw_network_credentials &#40; Transact-SQL &#41; ](../../relational-databases/system-dynamic-management-views/sys-dm-pdw-network-credentials-transact-sql.md).  
  
2.  Чтобы добавить или обновить учетные данные, используйте [sp_pdw_add_network_credentials &#40; Хранилище данных SQL &#41; ](../../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md).  
  
3.  Чтобы удалить учетные данные из [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], используйте [sp_pdw_remove_network_credentials &#40; Хранилище данных SQL &#41; ](../../relational-databases/system-stored-procedures/sp-pdw-remove-network-credentials-sql-data-warehouse.md).  
  
## <a name="error-handling"></a>Обработка ошибок  
 Команда RESTORE DATABASE приводит к ошибкам при следующих условиях:  
  
-   Имя базы данных для восстановления уже существует на целевом устройстве. Чтобы избежать этого, выберите уникальное имя базы данных или удалить существующую базу данных перед запуском восстановления.  
  
-   Имеется недопустимый набор файлов резервных копий в каталоге резервных копий.  
  
-   Разрешения на вход, недостаточно для восстановления базы данных.  
  
-   [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]не имеет необходимых разрешений в сетевое расположение, где расположены файлы резервной копии.  
  
-   Сетевое расположение каталога резервного копирования не существует или недоступен.  
  
-   Нет недостаточно места на диске для вычислительных узлов или узел элемента управления. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]не подтверждает наличие места на диске на устройства перед запуском процесса восстановления. Таким образом можно создать ошибку места на диске во время выполнения инструкции RESTORE DATABASE. В случае нехватки места на диске [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] откат восстановления.  
  
-   Целевого устройства, на который восстанавливается база данных имеет меньшее количество вычислительных узлов, чем устройства источника, из которого был резервную копию базы данных.  
  
-   Восстановление базы данных выполняется попытка с в рамках транзакции.  
  
## <a name="general-remarks"></a>Общие замечания  
 [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]отслеживает успешность восстановления базы данных. Перед восстановлением разностной резервной копии, [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] проверяет, успешно завершено восстановление всей базы данных.  
  
 После восстановления базы данных пользователей будет иметь уровень совместимости базы данных 120. Это верно для всех баз данных независимо от их исходный уровень совместимости.  
  
 **Восстановление на устройстве с большим числом вычислительных узлов**  
Запустите [: параметр DBCC (хранилище данных SQL Azure)](../../t-sql/database-console-commands/dbcc-shrinklog-azure-sql-data-warehouse.md) после восстановления базы данных из меньшего размера, чтобы увеличить устройства, поскольку распространения приведет к увеличению журнала транзакций.  

Восстановление резервной копии на устройстве с большим числом вычислительных узлов роста размера выделенной базы данных, пропорционально количеству вычислительных узлов.  
  
Например, при восстановлении 60 ГБ базы данных с двумя узлами устройства (30 ГБ на каждом узле) к устройству 6 узел [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] создает базу данных 180 ГБ (6 узлы с 30 ГБ на каждом узле) на устройстве, 6-узла. [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]изначально восстанавливает базу данных до 2 узлов в соответствии с исходной конфигурацией и перераспределяет данные для всех узлов 6.  
  
 После распространения каждый вычислительный узел содержит меньше фактических данных и большего объема свободного пространства, чем каждом вычислительном узле, на устройстве меньше исходного. Используйте дополнительное место для добавления данных в базу данных. Если размер восстановленной базы данных больше, чем необходимо, можно использовать [инструкции ALTER DATABASE &#40; Параллельное хранилище данных &#41; ](../../t-sql/statements/alter-database-parallel-data-warehouse.md) уменьшить размеры файлов базы данных.  
  
## <a name="limitations-and-restrictions"></a>Ограничения  
 Эти ограничения и ограничения устройства источника является устройства, из которого была создана резервная копия базы данных и целевого устройства — устройство, к которому база данных будет восстановлена.  
  
 Восстановление базы данных не перестраивает статистики автоматически.  
  
 Инструкции только один ВОССТАНОВЛЕНИЕ базы данных или резервная копия базы данных могут работать на устройстве в любой момент времени. Если несколько инструкций backup и restore отправляются параллельно, устройство будет поместить их в очередь и их обработка по одной за раз.  
  
 Можно восстановить только резервную копию базы данных для [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] целевой устройством, которое имеет тот же номер или дополнительные вычислительные узлы, чем исходного устройства. Целевого устройства не может иметь меньшее количество вычислительных узлов, чем исходного устройства.  
  
 Нельзя восстановить резервную копию, была создана на устройстве, с SQL Server 2012 PDW оборудования на устройстве с SQL Server 2008 R2 оборудования. Это справедливо даже в том случае, если устройство изначально была приобретена с SQL Server 2008 R2 PDW оборудования и программного обеспечения SQL Server 2012 PDW теперь работает.  
  
## <a name="locking"></a>Блокировка  
 Получает эксклюзивную блокировку на объект базы данных.  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-simple-restore-examples"></a>A. Простые примеры RESTORE  
 В следующем примере восстанавливается полная резервная копия для `SalesInvoices2013` базы данных. Файлы резервной копии хранятся в \\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full каталога. SalesInvoices2013 базы данных не может уже существовать на целевом устройстве или эта команда завершится с ошибкой.  
  
```  
RESTORE DATABASE SalesInvoices2013  
FROM DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full';  
```  
  
### <a name="b-restore-a-full-and-differential-backup"></a>Б. Восстановление полной и разностной резервной копии  
 В следующем примере восстанавливается полная и разностная резервная копия в базе данных SalesInvoices2013  
  
 Восстановления полной резервной копии базы данных из полной резервной копии, который хранится в "\\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full" каталог. После успешного выполнения восстановления разностная резервная копия восстанавливается в базе данных SalesInvoices2013.  Разностная резервная копия хранится в "\\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Diff" каталог.  
  
```  
RESTORE DATABASE SalesInvoices2013  
    FROM DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Diff'  
    WITH BASE = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full'  
[;]  
  
```  
  
### <a name="c-restoring-the-backup-header"></a>В. Восстановление в заголовке резервной копии  
 В этом примере восстанавливаются данные заголовка резервной копии базы данных "\\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full". Результаты команды в одну строку данных для резервного копирования Invoices2013Full.  
  
```  
RESTORE HEADERONLY  
    FROM DISK = '\\xxx.xxx.xxx.xxx\backups\yearly\Invoices2013Full'  
[;]  
```  
  
 Данные заголовка можно использовать для проверки содержимого резервной копии, или чтобы убедиться в том, что устройства цели восстановления совместима с исходного устройства резервного копирования, прежде чем пытаться восстановить резервную копию.  
  
## <a name="see-also"></a>См. также  
 [Резервное копирование базы данных &#40; Параллельное хранилище данных &#41;](../../t-sql/statements/backup-database-parallel-data-warehouse.md)  
  
  
