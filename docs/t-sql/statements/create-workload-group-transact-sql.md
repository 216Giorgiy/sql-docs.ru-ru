---
title: "СОЗДАТЬ ГРУППУ рабочей НАГРУЗКИ (Transact-SQL) | Документы Microsoft"
ms.custom: 
ms.date: 01/04/2018
ms.prod: sql-non-specified
ms.prod_service: sql-database
ms.service: 
ms.component: t-sql|statements
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
f1_keywords:
- WORKLOAD GROUP
- WORKLOAD_GROUP_TSQL
- CREATE WORKLOAD GROUP
- CREATE_WORKLOAD_GROUP_TSQL
dev_langs: TSQL
helpviewer_keywords: CREATE WORKLOAD GROUP statement
ms.assetid: d949e540-9517-4bca-8117-ad8358848baa
caps.latest.revision: "47"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 3554f6c282ba3ef551fd8592ede4c97f6d29b358
ms.sourcegitcommit: 4aeedbb88c60a4b035a49754eff48128714ad290
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2018
---
# <a name="create-workload-group-transact-sql"></a>CREATE WORKLOAD GROUP (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  Создает группу рабочей нагрузки регулятора ресурсов и связывает ее с пулом ресурсов регулятора ресурсов. Регулятор ресурсов доступен не во всех выпусках [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Сведения о функциях, поддерживаемых различными выпусками [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], см. в статье [Возможности, поддерживаемые выпусками SQL Server 2016](~/sql-server/editions-and-supported-features-for-sql-server-2016.md).  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "значок ссылки на раздел") [синтаксические обозначения Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
CREATE WORKLOAD GROUP group_name  
[ WITH  
    ( [ IMPORTANCE = { LOW | MEDIUM | HIGH } ]  
      [ [ , ] REQUEST_MAX_MEMORY_GRANT_PERCENT = value ]  
      [ [ , ] REQUEST_MAX_CPU_TIME_SEC = value ]  
      [ [ , ] REQUEST_MEMORY_GRANT_TIMEOUT_SEC = value ]   
      [ [ , ] MAX_DOP = value ]  
      [ [ , ] GROUP_MAX_REQUESTS = value ] )  
 ]  
[ USING {   
    [ pool_name | "default" ]    
    [ [ , ] EXTERNAL external_pool_name | "default" ] ]   
    } ]  
[ ; ]  
```  
  
## <a name="arguments"></a>Аргументы  
 *имя_группы*  
 Определяемое пользователем имя группы рабочей нагрузки. *имя_группы* является алфавитно-цифровым, может иметь длину до 128 символов, должны быть уникальными в рамках экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]и должны соответствовать правилам для [идентификаторы](../../relational-databases/databases/database-identifiers.md).  
  
 ВАЖНОСТЬ = {LOW | **СРЕДНИЙ** | ВЫСОКИЙ УРОВЕНЬ}  
 Указывает относительную важность запроса в группе рабочей нагрузки. Важность представлена одним из следующих значений, причем значением по умолчанию является MEDIUM.  
  
-   LOW  
-   MEDIUM (по умолчанию);    
-   HIGH.  
  
> [!NOTE]  
> Внутри системы каждое значение важности хранится в виде числа, используемого для вычислений.  
  
 Значение IMPORTANCE локально для пула ресурсов; группы рабочей нагрузки разной важности внутри одного пула ресурсов влияют друг на друга, но не влияют на рабочие группы в других пулов ресурсов.  
  
 REQUEST_MAX_MEMORY_GRANT_PERCENT =*значение*  
 Указывает максимальное количество памяти, которое может понадобиться одному запросу из пула. Это процентное соотношение относительно к размеру пула ресурсов, указанного в MAX_MEMORY_PERCENT.  
  
> [!NOTE]  
> Указанное значение ссылается только на доступную для выполнения запроса память.  
  
 *значение* должно быть 0 или положительным целым числом. Допустимые значения для *значение* — от 0 до 100. Значение по умолчанию для *значение* — 25.  
  
 Следует отметить следующее.  
  
-   Установка *значение* 0 запрещает запросы с операциями SORT и HASH JOIN в группах рабочей нагрузки, определяемых пользователем.  
  
-   Не рекомендуется использовать значение *значение* более 70, так как серверу не удается выделить достаточно памяти, если выполняются другие параллельные запросы. Со временем это может привести к ошибке 8645 (истечение времени ожидания запроса).  
  
> [!NOTE]  
>  Если требования к памяти запроса превышают ограничение, заданное этим параметром, сервер выполняет следующие действия.  
>   
>  Для определяемых пользователем групп рабочей нагрузки сервер пытается снизить степень параллелизма для запроса, пока требования к памяти не снизятся до ограничения, либо пока степень параллелизма не станет равной 1. Если в этом случае требования к запросам памяти по-прежнему превышают ограничение, возникает ошибка 8657.  
>   
>  Для внутренних групп рабочей нагрузки и группы по умолчанию сервер разрешает запросу получить необходимый объем памяти.  
>   
>  Учтите, что в обоих случаях может возникнуть ошибка 8645 (истечение времени ожидания), если на сервере недостаточно физической памяти.  
  
 REQUEST_MAX_CPU_TIME_SEC =*значение*  
 Указывает максимальное количество времени ЦП в секундах, которое может использоваться запросом. *значение* должно быть 0 или положительным целым числом. Значение по умолчанию для *значение* равно 0, что означает неограниченное время.  
  
> [!NOTE]  
> По умолчанию регулятора ресурсов не помешает запрос продолжать, если превышено максимально допустимое время. Однако будет сформировано событие. Дополнительные сведения см. в разделе [класс событий превышает пороговое значение ЦП](../../relational-databases/event-classes/cpu-threshold-exceeded-event-class.md).  

> [!IMPORTANT]
> Начиная с [!INCLUDE[ssSQL17](../../includes/sssql17-md.md)] CU3 и с помощью [2422 флаг трассировки](../../t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql.md), при превышении максимального времени регулятор ресурсов приведет к прерыванию запроса. 
  
 REQUEST_MEMORY_GRANT_TIMEOUT_SEC =*значение*  
 Задает максимальное время (в секундах), в течение которого запрос может ожидать выделения памяти (памяти рабочего буфера).  
  
> [!NOTE]  
>  При истечении времени ожидания предоставления памяти запрос не всегда завершается ошибкой. Запрос завершится ошибкой только в случае, если одновременно запущено слишком много запросов. В остальных случаях запрос может получить лишь минимальный объем памяти, что приведет к снижению его производительности.  
  
 *значение* должно быть 0 или положительным целым числом. Значение по умолчанию для *значение*, 0, использует внутренние вычисления, основанные на затратах запроса для определения максимального времени.  
  
 MAX_DOP =*значение*  
 Указывает максимальную степень параллелизма (DOP) для параллельных запросов. *значение* должно быть 0 или положительным целым числом. Допустимые значения для *значение* — от 0 до 64. Значение по умолчанию для *значение*, 0, использует глобальные настройки. MAX_DOP обрабатывается следующим образом.  
  
-   Использование MAX_DOP в качестве указания запроса эффективно до тех пор, пока его значение не превышает значения MAX_DOP группы рабочей нагрузки. Если значение указания запроса MAXDOP превышает значение, которое настроено с помощью регулятора ресурсов, компонент Database Engine использует значение MAXDOP регулятора ресурсов.  
  
-   MAX_DOP в качестве указания запроса всегда переопределяет вызов хранимой процедуры sp_configure 'max degree of parallelism'.  
  
-   Группа рабочей нагрузки MAX_DOP переопределяет вызов хранимой процедуры sp_configure 'max degree of parallelism'.  
  
-   Если запрос помечен как последовательный на стадии компиляции, изменить его статус на параллельный во время выполнения невозможно независимо от параметров группы рабочей нагрузки или хранимой процедуры sp_configure.  
  
-   После того как DOP настроен, он может быть только снижен при нехватке доступной памяти. Перенастройка группы рабочей нагрузки невидима при ожидании в очереди на предоставление памяти.  
  
 GROUP_MAX_REQUESTS =*значение*  
 Указывает максимальное число одновременных запросов, разрешенных для выполнения в группе рабочей нагрузки. *значение* должно быть 0 или положительным целым числом. Значение по умолчанию для *значение*(0) означает отсутствие ограничений. Если достигнуто максимальное количество параллельных запросов, пользователь из этой группы сможет войти в систему, но переводится в состоянии ожидания до тех пор, пока количество параллельных запросов не станет меньше указанного значения.  
  
 С помощью { *pool_name* | **«default»** }  
 Связывает группу рабочей нагрузки с пулом ресурсов, определяемых пользователем, определяется *pool_name*. При этом группа рабочей нагрузки помещается в пул ресурсов. Если *pool_name* отсутствует, или если не используется аргумент USING, группа рабочей нагрузки помещается в стандартный пул регулятора ресурсов по умолчанию.  
  
 Слово «default» является зарезервированным словом и при использовании с аргументом USING должно быть заключено в кавычки ("") либо квадратные скобки ([]).  
  
> [!NOTE]  
>  Все стандартные группы рабочей нагрузки и пулы ресурсов используют имена в нижнем регистре, например «default». Это необходимо учитывать при работе с серверами, где параметры сортировки учитывают регистр символов. Серверы, параметры сортировки которых не учитывают регистр (например, SQL_Latin1_General_CP1_CI_AS), будут рассматривать строки «default» и «Default» как одинаковые.  
  
 ВНЕШНИЕ external_pool_name | «default»  
 **Область применения**: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (с[!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] по [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]).  
  
 Группа рабочей нагрузки можно указать внешнего пула ресурсов. Можно определить группу рабочей нагрузки и связать с пулами 2:  
  
-   Пул ресурсов для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] рабочих нагрузок и запросов  
  
-   Внешнего пула ресурсов для внешних процессов. Дополнительные сведения см. в разделе [sp_execute_external_script &#40; Transact-SQL &#41; ](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md).  
  
## <a name="remarks"></a>Remarks  
 REQUEST_MEMORY_GRANT_PERCENT: Для использования большего объема памяти рабочей области, чем было предоставлено изначально для повышения производительности разрешено создание индексов. Эта специальная обработка поддерживается регулятором ресурсов в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Однако изначально предоставленная память и любая дополнительная выделенная память ограничены пулом ресурсов и настройками группы рабочей нагрузки.  
  
 **Создание индекса для секционированной таблицы**  
  
 Объем памяти, затрачиваемой на создание индекса в невыровненной секционированной таблице, пропорционален количеству секций, охватываемых индексом. Если общий объем необходимой памяти превышает предел на запрос (REQUEST_MAX_MEMORY_GRANT_PERCENT), устанавливаемый регулятором ресурсов для группы рабочей нагрузки, создание такого индекса может завершиться ошибкой. Настройки группы рабочей нагрузки по умолчанию позволяют запросу превосходить установленный для запросов предел памяти, нужной при запуске. Поэтому пользователь может запустить тот же процесс создания индекса в группе рабочей нагрузки по умолчанию, если в пуле ресурсов по умолчанию достаточно памяти, настроенной для выполнения такого запроса.  
  
## <a name="permissions"></a>Разрешения  
 Необходимо разрешение CONTROL SERVER.  
  
## <a name="examples"></a>Примеры  
 В следующем примере демонстрируется, как создать группу рабочей нагрузки с именем `newReports`. Для этой группы используются параметры по умолчанию регулятора ресурсов, и она располагается в пуле по умолчанию регулятора ресурсов. В примере указывается пул `default`, однако это не является обязательным.  
  
```  
CREATE WORKLOAD GROUP newReports  
    USING "default" ;  
GO  
```  
  
## <a name="see-also"></a>См. также:  
 [ALTER WORKLOAD GROUP (Transact-SQL)](../../t-sql/statements/alter-workload-group-transact-sql.md)   
 [DROP WORKLOAD GROUP (Transact-SQL)](../../t-sql/statements/drop-workload-group-transact-sql.md)   
 [CREATE RESOURCE POOL (Transact-SQL)](../../t-sql/statements/create-resource-pool-transact-sql.md)   
 [ALTER RESOURCE POOL (Transact-SQL)](../../t-sql/statements/alter-resource-pool-transact-sql.md)   
 [DROP RESOURCE POOL (Transact-SQL)](../../t-sql/statements/drop-resource-pool-transact-sql.md)   
 [ALTER RESOURCE GOVERNOR (Transact-SQL)](../../t-sql/statements/alter-resource-governor-transact-sql.md)  
  
  

