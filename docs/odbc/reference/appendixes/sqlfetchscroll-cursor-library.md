---
title: "SQLFetchScroll (библиотека курсоров) | Документы Microsoft"
ms.custom: 
ms.date: 01/19/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology:
- drivers
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- SQLFetchScroll function [ODBC], Cursor Library
ms.assetid: 4417e57c-31dd-475e-8fe9-eab00a459c80
caps.latest.revision: 11
author: MightyPen
ms.author: genemi
manager: jhubbard
ms.workload: Inactive
ms.translationtype: MT
ms.sourcegitcommit: f7e6274d77a9cdd4de6cbcaef559ca99f77b3608
ms.openlocfilehash: 85647e81245e8e5e76e79cd285bc73b8ff6fb364
ms.contentlocale: ru-ru
ms.lasthandoff: 09/09/2017

---
# <a name="sqlfetchscroll-cursor-library"></a>SQLFetchScroll (библиотека курсоров)
> [!IMPORTANT]  
>  Этот компонент будет удален в будущих версиях Windows. Избегайте использования этой возможности в новых разработках и запланируйте изменение приложений, которые сейчас ее используют. Корпорация Майкрософт рекомендует использовать функциональность курсора драйвера.  
  
 В этом разделе рассматриваются вопросы применения **SQLFetchScroll** функции в библиотеку курсоров. Общие сведения о **SQLFetchScroll**, в разделе [функция SQLFetchScroll](../../../odbc/reference/syntax/sqlfetchscroll-function.md).  
  
 Библиотека курсоров реализует **SQLFetchScroll** многократно вызывая **SQLFetch** в драйвере. Он передает данные, получаемые от драйвера буферы строк, предоставленных приложением. Кэширует данные в памяти и диска-файлах. Когда приложение запрашивает новый набор строк, библиотеку курсоров загружает его при необходимости из драйвера (если она не была получена ранее) или кэша (если ранее выбранных). Наконец библиотеку курсоров поддерживает состояние кэшированных данных и возвращает эти сведения в приложение в массив состояния строк.  
  
 При использовании библиотеки курсоров вызовы **SQLFetchScroll** невозможно комбинировать с вызовами либо **SQLFetch** или **SQLExtendedFetch**.  
  
 При использовании библиотеки курсоров вызовы **SQLFetchScroll** , поддерживаемые одновременно для ODBC 2.* x* и для ODBC 3.* x* драйверы.  
  
## <a name="rowset-buffers"></a>Буферы строк  
 Библиотека курсоров позволяет оптимизировать передачу данных с помощью драйвера в буфер строк, предоставленных приложением, если:  
  
-   Приложение использует привязку на уровне строки.  
  
-   Существуют байты не неиспользуемые между полями в структуре приложения, объявленных для хранения строки данных.  
  
-   Поля, в котором **SQLFetch** или **SQLFetchScroll** возвращает длины/индикатора для столбца после буфера для этого столбца и перед буфер для следующего столбца. Эти поля являются необязательными.  
  
 Когда приложение запрашивает новый набор строк, библиотеку курсоров извлекает данные из своего кэша и драйвера при необходимости. Если наборы строк нового и старого перекрываются, библиотеку курсоров можно оптимизировать его производительность, используя данные из перекрывающихся разделы буферы строк. Таким образом несохраненные изменения в буферы строк будут потеряны наборы строк нового и старого перекрываются и эти изменения накладывающиеся разделы буферы строк. Чтобы сохранить изменения, приложение выполняет инструкции позиционированного обновления.  
  
 Обратите внимание, что библиотека курсоров всегда обновляет буферы строк с данными из кэша, когда приложение вызывает **SQLFetchScroll** с *FetchOrientation* аргументу присвоено SQL_FETCH_RELATIVE и *FetchOffset* аргумент присвоено значение 0.  
  
 Библиотека курсоров поддерживает вызов метода **SQLSetStmtAttr** с *атрибута* из SQL_ATTR_ROW_ARRAY_SIZE, чтобы изменить размер набора строк при открытом курсоре. Новый размер набора строк вступят в силу при очередном **SQLFetchScroll** вызывается.  
  
## <a name="result-set-membership"></a>Членство в результирующий набор  
 Библиотека курсоров извлекает данные из драйвер только тогда, когда приложение запрашивает ее. В зависимости от источника данных и параметр атрибута инструкции SQL_CONCURRENCY это приводит к следующим последствиям:  
  
-   Данные, извлекаемые библиотеку курсоров могут отличаться от данных, которые были доступны во время выполнения инструкции. Например после открытия курсора, некоторые драйверы можно получить строки, вставленные в точке за текущей позицией курсора.  
  
-   Данные в результирующем наборе может быть заблокировано для источника данных для библиотеки курсоров и поэтому недоступным для других пользователей.  
  
 После библиотеку курсоров кэшировал строки данных, он не может обнаружить изменения этой строки в базовом источнике данных (за исключением позиционированные обновления и удаления, работающие с того же курсора кэша). Это происходит потому, что для вызовов **SQLFetchScroll**, библиотека курсоров никогда не refetches данные из источника данных. Вместо этого он refetches данные из своего кэша.  
  
## <a name="scrolling"></a>Прокрутка  
 Библиотека курсоров поддерживает следующие типы выборки в **SQLFetchScroll**.  
  
|Тип курсора|Типы выборки|  
|-----------------|-----------------|  
|Однонаправленный|SQL_FETCH_NEXT|  
|Статические|SQL_FETCH_NEXT<br /><br /> SQL_FETCH_PRIOR<br /><br /> SQL_FETCH_FIRST<br /><br /> SQL_FETCH_LAST<br /><br /> SQL_FETCH_RELATIVE<br /><br /> SQL_FETCH_ABSOLUTE<br /><br /> ИНСТРУКЦИЯ SQL_FETCH_BOOKMARK|  
  
## <a name="errors"></a>ошибки  
 Когда **SQLFetchScroll** вызывается и один из вызовов **SQLFetch** возвращает значение SQL_ERROR, продолжается библиотеки курсоров следующим образом. После завершения этих шагов, библиотеку курсоров продолжает работу.  
  
1.  Вызовы **SQLGetDiagRec** для получения сведений об ошибке из драйвера и отправляет это как запись диагностики диспетчера драйверов.  
  
2.  Задает поле SQL_DIAG_ROW_NUMBER диагностическая запись с соответствующим значением.  
  
3.  Задает поле SQL_DIAG_COLUMN_NUMBER диагностическая запись в соответствующее значение, если это применимо; в противном случае он устанавливает значение 0.  
  
4.  Задает значение для строки по ошибке в массиве строк состояния для SQL_ROW_ERROR.  
  
 После курсора называется библиотеки **SQLFetch** несколько раз в своей реализации **SQLFetchScroll**, ошибки или предупреждения, возвращенные один из вызовов **SQLFetch** будет создана диагностическая запись и может быть получен путем вызова **SQLGetDiagRec**. Если данные были усечены, если оно получено, усеченных данных будет теперь находятся в кэше библиотеку курсоров. Последующие вызовы **SQLFetchScroll** для прокрутки для строки с усеченных данных будет возвращать усеченные данные и предупреждение не возникает, так как данные извлекаются из кэша библиотеку курсоров. Для отслеживания длину данных, возвращаются ли данные, возвращаемые в буфер был усечен определения, приложение должно связаться буфер длины/индикатора.  
  
## <a name="bookmark-operations"></a>Операции закладки  
 Библиотека курсоров поддерживает вызов метода **SQLFetchScroll** с *FetchOrientation* из SQL_FETCH_BOOKMARK. Оно также поддерживает указание смещение в *FetchOffset* аргумент, который может использоваться в операции закладки. Это только операции закладки, которые поддерживает библиотеку курсоров. Библиотека курсоров не поддерживает вызов **SQLBulkOperations**.  
  
 Если задан атрибут инструкции SQL_ATTR_USE_BOOKMARKS и привязанное к столбцу закладки приложения, библиотеки курсоров создает закладку фиксированной длины и возвращает его в приложение. Библиотека курсоров создает и обслуживает закладки, которые он использует; он не использует закладки, содержащиеся в источнике данных. Когда **SQLFetchScroll** вызывается для получения блок данных, которые уже были переданы из источника данных, он получает данные из кэша библиотеки курсоров. В результате закладки, используемые при обращении к **SQLFetchScroll** с *FetchOrientation* из SQL_FETCH_BOOKMARK должно быть создано и обслуживается библиотеку курсоров.  
  
## <a name="interaction-with-other-functions"></a>Взаимодействие с другими функциями  
 Приложение должно вызвать **SQLFetch** или **SQLFetchScroll** до подготавливает или выполняет любой располагается инструкции update или delete.

