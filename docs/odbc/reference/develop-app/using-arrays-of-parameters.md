---
title: Использование массивов параметров | Документы Microsoft
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: drivers
ms.service: ''
ms.component: odbc
ms.reviewer: ''
ms.suite: sql
ms.technology:
- drivers
ms.tgt_pltfrm: ''
ms.topic: conceptual
helpviewer_keywords:
- arrays of parameter values [ODBC]
- parameter arrays [ODBC]
ms.assetid: 5a28be88-e171-4f5b-bf4d-543c4383c869
caps.latest.revision: 5
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: fe2d85bd347477c0acc775a4f071968d6d8b15d6
ms.sourcegitcommit: 2ddc0bfb3ce2f2b160e3638f1c2c237a898263f4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="using-arrays-of-parameters"></a>Использование массивов параметров
Использование массивов параметров, приложение вызывает **SQLSetStmtAttr** с *атрибута* аргумент SQL_ATTR_PARAMSET_SIZE, чтобы указать число наборов параметров. Он вызывает **SQLSetStmtAttr** с *атрибута* аргумент SQL_ATTR_PARAMS_PROCESSED_PTR, чтобы указать адрес переменной, в котором драйвер может возвращать число наборов параметров обработки Задает, включая ошибки. Он вызывает **SQLSetStmtAttr** с *атрибута* аргумент SQL_ATTR_PARAM_STATUS_PTR, чтобы она указывала на массив, в котором для возвращения сведений о состоянии для каждой строки значений параметров. Драйвер хранит эти адреса в структуре, которую он поддерживает для инструкции.  
  
> [!NOTE]  
>  В ODBC 2. *x*, **SQLParamOptions** был вызван для указания нескольких значений для параметра. В ODBC 3. *x*, вызов **SQLParamOptions** будет заменен вызовы **SQLSetStmtAttr** для задания атрибутов SQL_ATTR_PARAMSET_SIZE и SQL_ATTR_PARAMS_PROCESSED_ARRAY .  
  
 Перед выполнением инструкции, приложение задает значение каждого элемента каждого связанного массива. При выполнении инструкции, драйвер использует сведения, хранению для получения значений параметров и их отправки в источник данных; Если это возможно драйвер должен отправить эти значения как массивы. Несмотря на то, что использование массивов параметров лучше всего реализуется путем выполнения инструкции SQL, со всеми параметрами в массиве, с помощью одного вызова к источнику данных, эта возможность доступна не широко СУБД сегодня. Однако драйверы можно смоделировать его, выполнив инструкцию SQL несколько раз, каждый с одним набором параметров.  
  
 Прежде чем приложение использует массивы параметров, необходимо убедиться, что они поддерживаются драйверы, используемые приложением. Для этого имеется два способа.  
  
-   Используйте только те драйверы, которые поддерживают массивы параметров. Приложение можно жестко закодировать имена этих драйверов или пользователя можно настроить на использование только эти драйверы. Пользовательские приложения и вертикальные приложения обычно используют ограниченный набор драйверов.  
  
-   Проверьте наличие поддержки массивов параметров во время выполнения. Драйвер поддерживает массивы параметров, если существует возможность установить атрибут инструкции sql_attr_paramset_size задайте значение больше 1. Универсальные приложения и вертикальные приложения обычно проверки поддержки массивов параметров во время выполнения.  
  
 Можно определить доступность результирующих наборов в параметризованных выполнения и количество строк, вызвав **SQLGetInfo** параметры SQL_PARAM_ARRAY_ROW_COUNTS и SQL_PARAM_ARRAY_SELECTS. Для **вставить**, **обновление**, и **удалить** инструкций, параметр SQL_PARAM_ARRAY_ROW_COUNTS, допустимы ли количество отдельных строк (по одному для каждого набора параметров) Доступные (SQL_PARC_BATCH) или ли свертки количество строк в одну (SQL_PARC_NO_BATCH). Для **ВЫБЕРИТЕ** инструкций, параметр SQL_PARAM_ARRAY_SELECTS том, доступен ли результирующий набор для каждого набора параметров (SQL_PAS_BATCH) или только один результирующий набор доступных (SQL_PAS_NO_BATCH). Если драйвер не допускает результат генерации набор операторов для выполнения с помощью массива параметров, SQL_PARAM_ARRAY_SELECTS возвращает SQL_PAS_NO_SELECT. Это данные, определяемые источником ли массивы параметров можно использовать с других типов инструкций, особенно в том случае, поскольку использование параметров в следующих инструкциях будет, определяемые источником данных и не выполнить SQL-грамматику ODBC.  
  
 Массив, на который указывает атрибут инструкции SQL_ATTR_PARAM_OPERATION_PTR можно пропускать строки параметров. Если элемент массива имеет значение SQL_PARAM_IGNORE, набор параметров, соответствующей этому элементу исключается из **SQLExecute** или **SQLExecDirect** вызова. Массив, на который указывает атрибут SQL_ATTR_PARAM_OPERATION_PTR выделяется и заполняться в приложение и чтение драйвером. Если извлеченных строк используются в качестве входных параметров, можно использовать значения массив состояния строк в массиве параметров операции.  
  
## <a name="error-processing"></a>Ошибка при обработке  
 При возникновении ошибки во время выполнения инструкции, выполнение функции возвращает ошибку и присваивает переменной номеров строк в номер строки, содержащей ошибку. Это данные, определяемые источником ли все строки, за исключением того, набор ошибок, выполняются или выполняются ли все строки до (но не после) набор ошибок. Так как он обрабатывает наборы параметров, драйвер задает буфера, заданного атрибутом инструкции SQL_ATTR_PARAMS_PROCESSED_PTR для количество строк, обрабатываемых в настоящее время. Если все наборы, за исключением того, выполняются набор ошибок, драйвер задает этот буфер SQL_ATTR_PARAMSET_SIZE после обработки всех строк.  
  
 Если инструкции sql_attr_param_status_ptr **SQLExecute** или **SQLExecDirect** возвращает *массив состояний параметров,* предоставляющее состояние для каждого набора параметров. Массив состояний параметров выделяется приложением и заполнить драйвером. Его элементы указывают ли инструкция SQL была выполнена успешно для строки параметров или от того, произошла ли ошибка при обработке набор параметров. Если произошла ошибка, драйвер задает соответствующее значение в массиве параметров состояния для SQL_PARAM_ERROR и возвращает значение SQL_SUCCESS_WITH_INFO. Приложение может проверить массив состояния, чтобы определить, какие строки были обработаны. С помощью номера строк, приложение часто исправьте ошибку и возобновлять обработку.  
  
 Как использовать массив состояний параметров определяется параметры SQL_PARAM_ARRAY_ROW_COUNTS и SQL_PARAM_ARRAY_SELECTS, возвращенный вызовом к **SQLGetInfo**. Для **вставить**, **обновление**, и **удалить** инструкций, массив состояний параметров заносится сведения о состоянии, если SQL_PARC_BATCH возвращается для SQL_PARAM_ARRAY_ ROW_COUNTS, но не возвращается SQL_PARC_NO_BATCH. Для **ВЫБЕРИТЕ** инструкций, массив состояний параметров заполняется в случае SQL_PAS_BATCH возвращается для SQL_PARAM_ARRAY_SELECT, но не возвращается SQL_PAS_NO_BATCH или SQL_PAS_NO_SELECT.  
  
## <a name="data-at-execution-parameters"></a>Параметры данных времени выполнения  
 Если какой-либо значения в массиве длины/индикатора значение SQL_DATA_AT_EXEC, ни результатом SQL_LEN_DATA_AT_EXEC (*длина*) макрос, данные для этих значений отправляются с **SQLPutData** обычным способом. Так как они не являются очевидным следующие аспекты этого процесса берете на себя специальных комментариев:  
  
-   Драйвер возвращает SQL_NEED_DATA, его необходимо настроить адрес переменной номеров строк в строку, для которой требуется данных. Как и в случае однозначного приложение нельзя делать никаких предположений о порядке, в котором драйвер будет запрашивать значения параметров в рамках единого набора параметров. При возникновении ошибки в процессе выполнения параметра данных времени выполнения, номер строки, на которой возникла ошибка, состояние для строки в массив состояния строк, определяемое имеет значение буфера, заданного атрибутом инструкции SQL_ATTR_PARAMS_PROCESSED_PTR значение SQL_PARAM_ERROR, а также при вызове инструкции sql_attr_param_status_ptr **SQLExecute**, **SQLExecDirect**, **SQLParamData**, или  **SQLPutData** возвращает значение SQL_ERROR. Содержимое данного буфера не определено, если **SQLExecute**, **SQLExecDirect**, или **SQLParamData** возвращают значение SQL_STILL_EXECUTING.  
  
-   Так как драйвер не интерпретирует значение в *ParameterValuePtr* аргумент **SQLBindParameter** для параметров данных во время выполнения, если приложение содержит указатель на массив,  **SQLParamData** не извлечения и возврата в приложение элемент этого массива. Вместо этого он возвращает скалярное значение приложение передано. Это означает значение, возвращаемое **SQLParamData** является недостаточно указать параметр, для которой приложение необходимо отправить данные; того, приложение должно учитывать номер текущей строки.  
  
     Когда только некоторые из элементов в массиве параметров параметров данных времени выполнения, приложение должно передать адрес массива в *ParameterValuePtr* , содержащий элементы для всех параметров. Этот массив интерпретируется обычно для параметров, которые не являются параметрами данных во время выполнения. Для параметров данных во время выполнения, а значение, **SQLParamData** предоставляет для приложения, который обычно может использоваться для определения данных, драйвер запрашивает в этом случае, это всегда адрес массива.
