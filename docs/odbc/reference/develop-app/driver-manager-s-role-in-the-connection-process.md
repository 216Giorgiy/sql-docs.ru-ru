---
title: "Диспетчер драйверов &#39; s роль в процессе подключения | Документы Microsoft"
ms.custom: 
ms.date: 01/19/2017
ms.prod: sql-non-specified
ms.prod_service: drivers
ms.service: 
ms.component: reference
ms.reviewer: 
ms.suite: sql
ms.technology: drivers
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- driver manager [ODBC], role in connection process
- connecting to data source [ODBC], driver manager
- connecting to driver [ODBC], driver manager
- ODBC driver manager [ODBC]
ms.assetid: 77c05630-5a8b-467d-b80e-c705dc06d601
caps.latest.revision: "7"
author: MightyPen
ms.author: genemi
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 797d3439b378cb5caef62af019352ff6797fdb43
ms.sourcegitcommit: 7f8aebc72e7d0c8cff3990865c9f1316996a67d5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2017
---
# <a name="driver-manager39s-role-in-the-connection-process"></a>Диспетчер драйверов &#39; s роль в процессе подключения
Помните, что приложения не вызывают функции драйверов напрямую. Вместо этого они вызывают функции диспетчера драйверов с тем же именем, и диспетчер драйверов вызывает функции драйвера. Как правило это происходит почти мгновенно. Например, приложение вызывает **SQLExecute** диспетчера драйверов и после нескольких проверок ошибок, диспетчер драйверов вызывает **SQLExecute** в драйвере.  
  
 Процесс подключения отличается. Когда приложение вызывает **SQLAllocHandle** параметры SQL_HANDLE_ENV и SQL_HANDLE_DBC, функция выделяет обрабатывает только диспетчера драйверов. Диспетчер драйверов вызывает эту функцию в драйвере, потому что не знает, какой драйвер для вызова. Аналогично Если приложение передает дескриптор подключения не подключенными к **SQLSetConnectAttr** или **SQLGetConnectAttr**только диспетчера драйверов выполняет функцию. Он сохраняет или получает значение атрибута из соединения обработки и возвращает SQLSTATE 08003 (соединение не открыто), при получении значения для атрибута не задано и для ODBC, который не определяет значение по умолчанию.  
  
 Когда приложение вызывает **SQLConnect**, **SQLDriverConnect**, или **SQLBrowseConnect**, диспетчер драйверов сначала определяет, какой драйвер следует использовать. Затем он проверяет, чтобы определить, загружен ли в настоящий момент драйвер для подключения:  
  
-   Если драйвер не загружается в соединении, диспетчер драйверов проверяет ли указанный драйвер загружается через другое соединение в той же среде. Если нет, диспетчер драйверов загружает драйвер на подключение и вызывает **SQLAllocHandle** в драйвере с параметром SQL_HANDLE_ENV.  
  
     Диспетчер драйверов вызывает **SQLAllocHandle** в драйвере с параметром SQL_HANDLE_DBC, он был ли только что загруженный. Если приложение любых атрибутов соединения, диспетчер драйверов вызывает **SQLSetConnectAttr** в драйвере; при возникновении ошибки функция подключения диспетчера драйверов возвращает SQLSTATE IM006 (драйвера  **SQLSetConnectAttr** сбой). Наконец диспетчер драйверов вызывает функцию подключения в драйвере.  
  
-   Если указанный драйвер загружается в соединении, диспетчер драйверов вызывает функцию подключения в драйвере. В этом случае драйвер необходимо убедиться, все атрибуты соединения для соединения Ведение их текущих параметров.  
  
-   Если другой драйвер загружается в соединении, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере для освобождения соединения. Если отсутствуют другие соединения, использующие драйвер, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере, чтобы освободить среду и выгружает драйвер. Диспетчер драйверов выполняет те же операции, как при не загружается драйвер для подключения.  
  
 Диспетчер драйверов заблокирует дескриптора среды (*henv*) перед вызовом драйвер **SQLAllocHandle** и **SQLFreeHandle** при *HandleType* равно **SQL_HANDLE_DBC**.  
  
 Когда приложение вызывает **SQLDisconnect**, диспетчер драйверов вызывает **SQLDisconnect** в драйвере. Тем не менее оно оставляет драйвер загружен в случае, если приложение подключается к драйверу. Когда приложение вызывает **SQLFreeHandle** с параметром SQL_HANDLE_DBC, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере. Если драйвер не используется для любых других соединений, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере с SQL_HANDLE_ENV параметр и выгружает драйвер.
