---
title: Функция SQLCancel | Документы Microsoft
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: drivers
ms.service: ''
ms.component: odbc
ms.reviewer: ''
ms.suite: sql
ms.technology:
- drivers
ms.tgt_pltfrm: ''
ms.topic: conceptual
apiname:
- SQLCancel
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLCancel
helpviewer_keywords:
- SQLCancel function [ODBC]
ms.assetid: ac0b5972-627f-4440-8c5a-0e8da728726d
caps.latest.revision: 23
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: 6de4f3c962371ebb56cba1e65a77d02baf4ef166
ms.sourcegitcommit: 2ddc0bfb3ce2f2b160e3638f1c2c237a898263f4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="sqlcancel-function"></a>SQLCancel, функция
**Соответствия**  
 Появился в версии: Полное соответствие стандартам 1.0 ODBC: ISO-92  
  
 **Сводка**  
 **SQLCancel** отменяет обработку на инструкции.  
  
 Чтобы отменить обработку на соединение или оператор, используйте [SQLCancelHandle функция](../../../odbc/reference/syntax/sqlcancelhandle-function.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
SQLRETURN SQLCancel(  
     SQLHSTMT     StatementHandle);  
```  
  
## <a name="arguments"></a>Аргументы  
 *StatementHandle*  
 [Вход] Дескриптор инструкции.  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, значение SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLCancel** возвращает значение SQL_ERROR или SQL_SUCCESS_WITH_INFO, соответствующее значение SQLSTATE можно получить, вызвав **SQLGetDiagRec** с *HandleType* из SQL_ HANDLE_STMT и *обработки* из *StatementHandle*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые **SQLCancel** и описание каждого из них в контексте этой функции; нотации «(DM)» предшествует описания SQLSTATE, возвращаемых диспетчером драйверов. Код возврата, связанные с каждым из значений SQLSTATE — это SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, относящиеся к драйверу. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|HY000|Общая ошибка|Произошла ошибка, для которой было нет определенных SQLSTATE и для которого был определен SQLSTATE не зависит от реализации. Сообщение об ошибке, возвращенные [SQLGetDiagRec](../../../odbc/reference/syntax/sqlgetdiagrec-function.md) в аргументе  *\*MessageText* буфера описывает ошибку и его причины.|  
|HY001|Ошибка выделения памяти|Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY010|Ошибка последовательности функций|(DM) был вызван асинхронно выполняемой функции для дескриптора соединения, с которым связан *StatementHandle*. Выполняется при этом асинхронной функция **SQLCancel** была вызвана функция.<br /><br /> (DM) отменить операцию не удалось, так как асинхронная операция выполняется в дескрипторе соединения, связанный с *StatementHandle*.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, поскольку базовые объекты памяти будет недоступен, возможно из-за нехватки памяти.|  
|HY018|Сервер отклонил запрос отмены|Сервер отклонил запрос на отмену.|  
|HY117|Соединение будет приостановлена из-за неизвестной транзакции состояния. Только отключиться и разрешены функции, доступные только для чтения.|(DM) Дополнительные сведения о состоянии приостановки см. в разделе [функция SQLEndTran](../../../odbc/reference/syntax/sqlendtran-function.md).|  
|HYT01|Время ожидания соединения истекло|Время ожидания соединения истекло раньше, чем ответил на запрос источника данных. Время ожидания задается с помощью **SQLSetConnectAttr**, sql_attr_connection_timeout не учитывается.|  
|IM001|Драйвер не поддерживает эту функцию|Драйвер (DM), связанные с *StatementHandle* не поддерживает функцию.|  
  
## <a name="comments"></a>Комментарии  
 **SQLCancel** можно отменить следующие типы обработки для инструкции:  
  
-   Функция, работающего асинхронно на инструкцию.  
  
-   Функция для инструкции, которая требуются данные.  
  
-   Функции, работающей на инструкцию в другом потоке.  
  
 В ODBC 2. *x*, если приложение вызывает **SQLCancel** Если обработка не выполняется в операторе **SQLCancel** действует так же, как **SQLFreeStmt** с параметром SQL_CLOSE; Это поведение определяется только для полноты и приложения должны вызывать метод **SQLFreeStmt** или **SQLCloseCursor** закрытия курсора.  
  
 Когда **SQLCancel** вызывается для отмены функции работающего асинхронно в инструкции или функции в операторе, очистку данных потребностей, диагностических записях, отправленная функции отмены и **SQLCancel**  отправляет свой собственный диагностические записи; когда **SQLCancel** вызова функции, работающей на инструкцию в другом потоке, однако он не снимите, чтобы отменить диагностические записи приводимого отменено функции и не не Учет собственный диагностических записей.  
  
## <a name="canceling-asynchronous-processing"></a>Отмена асинхронной обработки  
 После приложение вызывает функцию асинхронно, то вызывается функция несколько раз, чтобы определить, является ли обработка завершилась. Если функция по-прежнему обрабатывается, возвращается значение SQL_STILL_EXECUTING. Если функция завершения обработки, он возвращает другого кода.  
  
 После любого вызова функции, которая возвращает значение SQL_STILL_EXECUTING, приложение может вызвать **SQLCancel** отменить функции. Если запрос на отмену успешна, драйвер возвращает SQL_SUCCESS. Это сообщение указывает на функцию фактически отмены; Указывает, что запрос на отмену был обработан. Когда или отменяется Если функция является зависящих от драйвера и зависит от источника данных. Приложение должно продолжить вызывать и первоначальная функция, пока код возврата не SQL_STILL_EXECUTING. — Если функция была успешно отменена, код возврата SQL_ERROR и SQLSTATE HY008 (операция отменена). Если функция выполнена его обычной обработки, код возврата равен SQL_SUCCESS или SQL_SUCCESS_WITH_INFO, если функция выполнена успешно или SQL_ERROR и SQLSTATE, отличные от HY008 (операция отменена) при вызове функции произошел сбой.  
  
> [!NOTE]  
>  В ODBC 3.5 вызов **SQLCancel** при обработка не выполняется в операторе не рассматривается как **SQLFreeStmt** с параметром SQL_CLOSE, но имеет никаких действий не происходит. Чтобы закрыть курсор, приложение должно вызывать **SQLCloseCursor**, а не **SQLCancel**.  
  
 Дополнительные сведения об асинхронной обработки см. в разделе [асинхронное выполнение](../../../odbc/reference/develop-app/asynchronous-execution-polling-method.md).  
  
## <a name="canceling-functions-that-need-data"></a>Отмена функций, которым требуется данных  
 После **SQLExecute** или **SQLExecDirect** возвращает SQL_NEED_DATA и до отправки данных для всех параметров данных во время выполнения, приложение может вызвать **SQLCancel** Отмена выполнения инструкции. После отмены инструкции приложение может вызвать **SQLExecute** или **SQLExecDirect** еще раз. Дополнительные сведения см. в разделе [SQLBindParameter](../../../odbc/reference/syntax/sqlbindparameter-function.md).  
  
 После **SQLBulkOperations** или **SQLSetPos** возвращает SQL_NEED_DATA и до отправки данных для всех столбцов данных времени выполнения, приложение может вызвать **SQLCancel** Чтобы отменить операцию. После отмены операции, приложение может вызвать **SQLBulkOperations** или **SQLSetPos** попытку; Отмена не влияет на состояние курсора или текущей позиции курсора. Дополнительные сведения см. в разделе [SQLBulkOperations](../../../odbc/reference/syntax/sqlbulkoperations-function.md) или [SQLSetPos](../../../odbc/reference/syntax/sqlsetpos-function.md).  
  
## <a name="canceling-functions-executing-on-another-thread"></a>Отмена функции выполнение на другой поток  
 Многопоточные приложения приложение может отменить функцию, которая выполняется в другом потоке. Чтобы отменить функцию, приложение вызывает **SQLCancel** с одного дескриптора инструкции, что целевой функцией, но в другом потоке. Как отменить функция зависит от драйвера и операционной системы. Как и Отмена работающего асинхронно, код возврата функции **SQLCancel** указывает, является ли драйвер успешно обработан запрос. Могут быть возвращены только SQL_SUCCESS или SQL_ERROR; диагностические данные не возвращаются. Если отменяется и первоначальная функция, он возвращает значение SQL_ERROR и SQLSTATE HY008 (операция отменена).  
  
 Если выполняется инструкция SQL выполняется при **SQLCancel** в другом потоке для отмены выполнения инструкции является возможность успешного выполнения и возвращаемое значение SQL_SUCCESS во время отмены также выполняется успешно. В этом случае диспетчер драйверов предполагается закрытия курсора, открыт при выполнении инструкции по "Отмена", поэтому приложения не смогут использовать курсор.  
  
 Дополнительные сведения о работе с потоками см. в разделе [многопоточность](../../../odbc/reference/develop-app/multithreading.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Привязка буфер к параметру|[Функция SQLBindParameter](../../../odbc/reference/syntax/sqlbindparameter-function.md)|  
|Выполнение массовой операции вставки или обновления|[Функция SQLBulkOperations](../../../odbc/reference/syntax/sqlbulkoperations-function.md)|  
|Отменяет функции работающего асинхронно на дескриптор соединения, в дополнение к функциям **SQLCancel**.|[Функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md)|  
|Выполнение инструкции SQL|[Функция SQLExecDirect](../../../odbc/reference/syntax/sqlexecdirect-function.md)|  
|Выполнения подготовленной инструкции SQL|[Функция SQLExecute](../../../odbc/reference/syntax/sqlexecute-function.md)|  
|Освобождение дескриптора инструкции|[SQLFreeStmt](../../../odbc/reference/syntax/sqlfreestmt-function.md)|  
|Получение поля диагностики записи или поля диагностики заголовка|[Функция SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md)|  
|Получение нескольких полей структуры диагностических данных|[Функция SQLGetDiagRec](../../../odbc/reference/syntax/sqlgetdiagrec-function.md)|  
|Возвращает следующий параметр для отправки данных|[Функция SQLParamData](../../../odbc/reference/syntax/sqlparamdata-function.md)|  
|Отправка данных параметра во время выполнения|[Функция SQLPutData](../../../odbc/reference/syntax/sqlputdata-function.md)|  
|Поместить курсор в наборе строк, обновление данных в наборе строк или удаления данных в результирующем наборе|[Функция SQLSetPos](../../../odbc/reference/syntax/sqlsetpos-function.md)|  
  
## <a name="see-also"></a>См. также  
 [Справочник по API-интерфейса ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
