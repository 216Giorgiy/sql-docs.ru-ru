---
title: "Функция SQLBrowseConnect | Документы Microsoft"
ms.custom: 
ms.date: 01/19/2017
ms.prod: sql-non-specified
ms.prod_service: drivers
ms.service: 
ms.component: reference
ms.reviewer: 
ms.suite: sql
ms.technology: drivers
ms.tgt_pltfrm: 
ms.topic: article
apiname: SQLBrowseConnect
apilocation: sqlsrv32.dll
apitype: dllExport
f1_keywords: SQLBrowseConnect
helpviewer_keywords: SQLBrowseConnect function [ODBC]
ms.assetid: b7f1be66-e6c7-4790-88ec-62b7662103c0
caps.latest.revision: "36"
author: MightyPen
ms.author: genemi
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 839cf9ec1e802d0bce8da8cc0134bf89b0646bb2
ms.sourcegitcommit: 7f8aebc72e7d0c8cff3990865c9f1316996a67d5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2017
---
# <a name="sqlbrowseconnect-function"></a>Функция SQLBrowseConnect
**Соответствия**  
 Появился в версии: Полное соответствие стандартам 1.0 ODBC: ODBC  
  
 **Сводка**  
 **SQLBrowseConnect** поддерживает итерационный метод обнаружения и перечисление атрибутов и значений атрибутов, необходимых для подключения к источнику данных. Каждый вызов **SQLBrowseConnect** возвращает последовательные уровни атрибутов и значений атрибутов. Когда перечислены все уровни, завершения подключения к источнику данных и возвращается полная строка подключения **SQLBrowseConnect**. Код возврата SQL_SUCCESS или SQL_SUCCESS_WITH_INFO указывает, что указаны все сведения о соединении и приложение теперь подключен к источнику данных.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
SQLRETURN SQLBrowseConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr);  
```  
  
## <a name="arguments"></a>Аргументы  
 *ConnectionHandle*  
 [Вход] Дескриптор соединения.  
  
 *InConnectionString*  
 [Вход] Обзор строку подключения для запроса (в разделе "*InConnectionString* аргумент» в «Комментарии»).  
  
 *StringLength1*  
 [Вход] Длина **InConnectionString* в символах.  
  
 *OutConnectionString*  
 [Выход] Указатель на буфер символов возврата Обзор результирующей строки подключения (в разделе «*OutConnectionString* аргумент» в «Комментарии»).  
  
 Если *OutConnectionString* имеет значение NULL, *StringLength2Ptr* по-прежнему возвращает общее число символов (за исключением символа конечное значение null, символьные данные) для возврата в буфер Указывает *OutConnectionString*.  
  
 *BufferLength*  
 [Вход] Длина в символах, из **OutConnectionString* буфера.  
  
 *StringLength2Ptr*  
 [Выход] Общее число символов (за исключением конечное значение null), доступных для возврата в \* *OutConnectionString*. Если количество символов вернуть больше или равно *BufferLength*, строку подключения в \* *OutConnectionString* усекается до  *BufferLength* за вычетом длины символ конечное значение null.  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NEED_DATA, SQL_ERROR, SQL_INVALID_HANDLE или SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLBrowseConnect** возвращает значение SQL_ERROR, SQL_SUCCESS_WITH_INFO или SQL_NEED_DATA, соответствующее значение SQLSTATE можно получить, вызвав **SQLGetDiagRec** с *HandleType* значение sql_handle_stmt и *дескриптор ConnectionHandle*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые **SQLBrowseConnect** и описание каждого из них в контексте этой функции; нотации «(DM)» предшествует описания SQLSTATE, возвращаемых диспетчером драйверов. Код возврата, связанные с каждым из значений SQLSTATE — это SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Description|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, относящиеся к драйверу. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01004|Строка справа усечение данных|Буфер \* *OutConnectionString* не был достаточно велик, чтобы вернуть всей обзора результирующую строку подключения, поэтому строка была усечена. Буфер **StringLength2Ptr* содержит длину неусеченный Обзор результирующей строки подключения. (Функция возвращает значение SQL_NEED_DATA.)|  
|01S00|Недопустимый атрибут строки соединения|Ключевое слово недопустимый атрибут был указан в строке подключения обзора запроса (*InConnectionString*). (Функция возвращает значение SQL_NEED_DATA.)<br /><br /> Ключевое слово атрибут был указан в строке подключения обзора запроса (*InConnectionString*), не применяется к текущему уровню соединения. (Функция возвращает значение SQL_NEED_DATA.)|  
|01S02|Значение изменено|Драйвер не поддерживает указанное значение *ValuePtr* аргумент в **SQLSetConnectAttr** и заменить примерно такое же значение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|08001|Клиенту не удается установить соединение|Драйвер не удалось установить соединение с источником данных.|  
|08002|Имя подключения используется|(DM) указанное подключение уже была использована для установления соединения с источником данных и подключение было открыто.|  
|08004|Сервер отклонил соединение|Источник данных отклонены установление соединения по причинам, определяемого реализацией.|  
|08S01|Сбой связи|Сбой в канале связи между драйвером и источника данных, к которому драйвер при попытке подключиться перед обработкой функции было завершено.|  
|28000|Недопустимая спецификация авторизации|Идентификатор пользователя и строка авторизации либо оба, как указано в обзора запроса строки подключения (*InConnectionString*), нарушены ограничения, определенные в источнике данных.|  
|HY000|Общая ошибка|Произошла ошибка, для которой было нет определенных SQLSTATE и для которого был определен SQLSTATE не зависит от реализации. Сообщение об ошибке, возвращенные **SQLGetDiagRec** в  *\*MessageText* буфера описывает ошибку и его причины.|  
|HY001|Ошибка выделения памяти|Диспетчер драйверов (DM) не удалось выделить память, необходимую для поддержки выполнения или завершения функции.<br /><br /> Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Операция отменена|Асинхронная операция была отменена, вызвав [SQLCancelHandle функция](../../../odbc/reference/syntax/sqlcancelhandle-function.md). Затем, и первоначальная функция была снова вызвана на *ConnectionHandle*.<br /><br /> Операция была отменена, вызвав **SQLCancelHandle** на *ConnectionHandle* из другого потока в многопоточных приложениях.|  
|HY010|Ошибка последовательности функций|(DM) был вызван асинхронно выполняемой функции (не данный файл) для *ConnectionHandle* и все еще выполняется, при вызове этой функции.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, поскольку базовые объекты памяти будет недоступен, возможно из-за нехватки памяти.|  
|HY090|Недопустимая длина строки или буфера|(DM) значение, указанное в аргументе *StringLength1* меньше 0 и не может быть равно SQL_NTS.<br /><br /> (DM) значение, указанное в аргументе *BufferLength* был меньше 0.|  
|HY114|Драйвер не поддерживает подключение функция level асинхронного выполнения|(DM) приложение включен асинхронной операции на дескрипторе соединения перед подключением. Драйвер не поддерживает асинхронные операции для дескриптора соединения.|  
|HYT00|Время ожидания истекло|Для подключения к источнику данных завершено истечения времени ожидания входа в систему. Время ожидания задается с помощью **SQLSetConnectAttr**, параметре.|  
|HYT01|Время ожидания соединения истекло|Время ожидания соединения истекло раньше, чем ответил на запрос источника данных. Время ожидания задается с помощью **SQLSetConnectAttr**, sql_attr_connection_timeout не учитывается.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, соответствующий заданным именем источника данных не поддерживает функцию.|  
|IM002|Не удалось найти источник данных и не указан драйвер по умолчанию|Имя, указанное в строке подключения Обзор запроса источника данных (интеллектуальный анализ данных) (*InConnectionString*) не найден в сведениях о системе, а также была ли определение драйвера по умолчанию.<br /><br /> (DM) ODBC данных по умолчанию драйвер сведения об источнике и не удалось найти сведения о системе.|  
|IM003|Не удалось загрузить указанный драйвер|(DM) драйвер, перечисленные в спецификации источника данных сведений о системе или указанных в **ДРАЙВЕР** ключевое слово не найден или не может быть загружена по другой причине.|  
|IM004|Драйвера **SQLAllocHandle** на _ENV SQL_HANDLE сбой|(DM) во время **SQLBrowseConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *HandleType* SQL_HANDLE_ENV и драйвер возвращается Произошла ошибка.|  
|IM005|Драйвера **SQLAllocHandle** на SQL_HANDLE_DBC сбой|(DM) во время **SQLBrowseConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *HandleType* SQL_HANDLE_DBC и драйвер возвращается Произошла ошибка.|  
|IM006|Драйвера **SQLSetConnectAttr** сбой|(DM) во время **SQLBrowseConnect**, диспетчер драйверов называемая драйвером **SQLSetConnectAttr** функции и драйвер вернул ошибку.|  
|IM009|Не удается загрузить трансляции (DLL)|Драйверу не удалось загрузить трансляции (DLL), указанный для источника данных или для подключения.|  
|IM010|Слишком длинное имя источника данных|(DM), значение атрибута для ключевого слова DSN был более SQL_MAX_DSN_LENGTH символов.|  
|IM011|Слишком длинное имя драйвера|(DM) значение атрибута для ключевое слово DRIVER были длиннее 255 символов.|  
|IM012|Синтаксическая ошибка ДРАЙВЕРА ключевое слово|(DM) пару ключ значение для ключевое слово DRIVER содержит синтаксическую ошибку.|  
|IM014|Указанное имя DSN содержит несоответствие архитектуры драйверов и приложения|32-разрядное приложение (DM) использует имя источника данных, подключение к 64-разрядный драйвер; и наоборот.|  
|IM017|В режиме асинхронное уведомление отключена опроса|При использовании модели уведомление опроса отключен.|  
|IM018|**SQLCompleteAsync** не был вызван для завершения предыдущей асинхронной операции на этот дескриптор.|Если предыдущего вызова функции с дескриптором возвращает SQL_STILL_EXECUTING и уведомлений в режиме **SQLCompleteAsync** должен вызываться для этого после обработки и выполнения операции с дескриптором.|  
|S1118|Драйвер не поддерживает асинхронное уведомление|Если драйвер не поддерживает асинхронное уведомление, нельзя вернуть SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="inconnectionstring-argument"></a>Аргумент InConnectionString  
 Обзор запроса строки подключения имеет следующий синтаксис:  
  
 *Строка подключения* :: = *атрибута*[;] &#124; *атрибута*; *подключения stringattribute* :: = *ключевое слово атрибут*=*значение атрибута* &#124; ДРАЙВЕР = [{}]*значение атрибута [*}]*ключевое слово атрибут* :: = DSN &#124; UID &#124; PWD &#124; *драйвер определенные keywordattribute значений атрибутов* :: = *символ stringdriver определенные атрибут-ключевое слово* :: = *идентификатор*  
  
 где *символьной строки* имеет ноль или более символов; *идентификатор* имеет один или несколько символов. *ключевое слово атрибут* не учитывает регистр; *значение атрибута* может учитываться регистр; и значение **DSN** ключевое слово не состоит из одних пробелов. Из-за соединения строки и инициализации файл грамматики, ключевые слова и атрибут значения, содержащие символы **[] {} (),? \*=! @** следует избегать. Из-за грамматики в сведениях о системе, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов. Для ODBC 2. *x* драйвера, значение атрибута для ключевое слово DRIVER можно заключать в фигурные скобки.  
  
 Если все ключевые слова повторяются в строке подключения запрос обзора, драйвер использует значение, связанное с первого вхождения ключевого слова. Если **DSN** и **ДРАЙВЕР** ключевые слова включаются в ту же строку подключения для запроса обзора, диспетчер драйверов и драйвер использовать любой ключевое слово встречается первый.  
  
 Сведения о выборе приложения источник данных или драйвер см [Выбор источника данных или драйвер](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md).  
  
## <a name="outconnectionstring-argument"></a>Аргумент OutConnectionString  
 Обзор результирующей строки соединения является списком атрибутов соединения. Атрибут соединения состоит из ключевого слова атрибута и соответствующее значение атрибута. Обзор результирующей строки подключения имеет следующий синтаксис:  
  
 *Строка подключения* :: = *атрибута*[;] &#124; *атрибута*; *подключения stringattribute* :: = [\*]*ключевое слово атрибут = атрибут valueattribute ключевое слово* :: = *ODBC атрибута ключевое слово* &#124; *driver-defined-attribute-keywordODBC-attribute-keyword* = {UID &#124; PWD} [:*локализованные идентификатор*]*-определенные атрибут-ключевое слово driver* :: = *идентификатор*[:*локализованные идентификатор*]*значение атрибута* :: = {*списка значений атрибута*} &#124;? (Фигурных скобок является литералом, они возвращаются с помощью драйвера.) *списка значений атрибута* :: = *символьной строки* [:*локализованные символьная строка*] &#124; *символьной строки* [:*локализованные символьная строка*], *списка значений атрибута*  
  
 где *символьной строки* и *локализованные символьная строка* иметь ноль или более символов; *идентификатор* и *локализованные идентификатор* имеют один или несколько символов. *ключевое слово атрибут* не учитывает регистр; и *значение атрибута* может учитываться регистр. Из-за соединения строки инициализации файл грамматики, ключевые слова, идентификаторы локализованные и значения атрибутов, содержать символы **[] {} (),? \*=! @** следует избегать. Из-за грамматики в сведениях о системе, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов.  
  
 Согласно следующим правилам семантического используется синтаксис строки соединения для обзора результат:  
  
-   Если звездочка (\*) предшествует *ключевое слово атрибут*, *атрибута* является необязательным и может быть опущен в следующем вызове **SQLBrowseConnect**.  
  
-   Ключевые слова атрибута **UID** и **PWD** имеют одинаковое значение, определенное в **SQLDriverConnect**.  
  
-   Объект *-определенные атрибут-ключевое слово driver* именует тип атрибута, для которого может быть указано значение атрибута. Например, может быть **сервера**, **базы данных**, **узла**, или **СУБД**.  
  
-   *Ключевые слова ODBC атрибута* и *драйвер пользователем атрибут-ключевые слова* содержит локализованные или понятные версию ключевое слово. Это может использоваться приложениями как метка в диалоговом окне. Тем не менее **UID**, **PWD**, или *идентификатор* отдельно должен использоваться при передаче обзора строка запроса к драйверу.  
  
-   {*Списка значений атрибута*} является допустимым для соответствующего перечисления фактических значений *ключевое слово атрибут*. Обратите внимание, что фигурные скобки ({}) не указывают список вариантов; они возвращаются с помощью драйвера. Например он может быть список имен серверов или список имен баз данных.  
  
-   Если *значение атрибута* — один вопросительный знак (?), одно значение соответствует *ключевое слово атрибут*. Например, UID = бакалавра; PWD = Sesame.  
  
-   Каждый вызов **SQLBrowseConnect** возвращает только сведения, необходимые для удовлетворения следующего уровня процесса подключения. Драйвер связывает сведения о состоянии с дескриптором соединения, чтобы контекст всегда можно определить при каждом вызове.  
  
## <a name="using-sqlbrowseconnect"></a>С помощью SQLBrowseConnect  
 **SQLBrowseConnect** требуется выделенное соединение. Диспетчер драйверов загружает драйвер, который был указан в или и соответствующее имя источника данных, указанный в строке подключения обзора начального запроса; сведения о, когда это происходит, см. в разделе «Комментарии» в [SQLConnect, функция](../../../odbc/reference/syntax/sqlconnect-function.md). Драйвер может установить соединение с источником данных во время просмотра. Если **SQLBrowseConnect** возвращает значение SQL_ERROR, ожидающих, соединения прерываются, и соединение возвращается в несвязанной состояние.  
  
> [!NOTE]  
>  **SQLBrowseConnect** не поддерживает пулы соединений. Если **SQLBrowseConnect** , называется пул подключений включен SQLSTATE HY000 будет возвращаться (ошибка).  
  
 Когда **SQLBrowseConnect** вызывается первый раз в соединении, должен содержать строку подключения для запроса обзора **DSN** ключевое слово или **ДРАЙВЕР** ключевое слово. Если строка подключения обзора запрос содержит **DSN** ключевое слово, диспетчер драйверов находит соответствующий спецификации источника данных сведения о системе:  
  
-   Если диспетчер драйверов находит соответствующий спецификации источника данных, он загружает соответствующий драйвер DLL. драйвер может получать сведения об источнике данных из сведений о системе.  
  
-   Если диспетчер драйверов не удается найти соответствующий спецификации источника данных, он находит спецификации источника данных по умолчанию и загружает соответствующий драйвер DLL. драйвер может получать сведения об источнике данных по умолчанию из сведений о системе. «DEFAULT» будет передано драйвер для источника данных.  
  
-   Если нет спецификации источника данных по умолчанию, диспетчер драйверов не удалось найти соответствующие спецификации источника данных, он возвращает значение SQL_ERROR с SQLSTATE IM002 (источник данных не найден и не указан драйвер, по умолчанию).  
  
 Если строка подключения обзора запрос содержит **ДРАЙВЕР** ключевое слово, диспетчер драйверов загружает указанный драйвер; он не будет пытаться найти источник данных в сведениях о системе. Поскольку **ДРАЙВЕР** ключевое слово не использует сведения из сведений о системе, драйвер должен определить такое количество ключевых слов, чтобы драйвер могли подключаться к источнику данных с помощью только данные в строках подключения запрос обзора.  
  
 При каждом вызове **SQLBrowseConnect**, приложение указывает значение атрибута соединения в строке соединения запроса обзора. Драйвер возвращает последовательные уровни атрибутов и значений атрибутов в строке подключения обзора результат; он возвращает SQL_NEED_DATA, при условии, что существуют атрибуты соединения, которые еще не был перечислен в строке подключения запрос обзора. Приложение использует содержимое Обзор результирующей строки подключения для создания строки подключения обзора запрос для следующего вызова **SQLBrowseConnect**. Все обязательные атрибуты (те не предшествует символ звездочки в *OutConnectionString* аргумент) должны быть включены в следующем вызове **SQLBrowseConnect**. Приложение не подходит для использования содержимого предыдущего обзора результирующие строки соединения при формировании строки подключения текущего обзора запроса; то есть он не может задавать различные значения для атрибутов, установленных в предыдущих уровней.  
  
 При перечислении всех уровней подключений и связанные с ними атрибуты драйвер возвращает SQL_SUCCESS, подключения к источнику данных и в приложение возвращается полная строка подключения. Строка подключения подходит для использования в сочетании с **SQLDriverConnect**, с параметром SQL_DRIVER_NOPROMPT другое подключение. Полная строка соединения не может использоваться в другой вызов **SQLBrowseConnect**, но при этом; Если **SQLBrowseConnect** снова, вызывается вся последовательность вызовов необходимо будет повторить.  
  
 **SQLBrowseConnect** также возвращает значение SQL_NEED_DATA, если восстанавливаемые, некритичные ошибки во время процесса обзора; например, неправильный пароль или атрибута ключевое слово, предоставляемой приложением. Когда возвращается значение SQL_NEED_DATA и обзор результирующей строки подключения не изменился, произошла ошибка и приложение может вызвать **SQLGetDiagRec** для возврата SQLSTATE для ошибки во время просмотра. Это позволяет приложению исправьте атрибут и продолжить обзора.  
  
 Приложение может завершить процесс обзора в любое время путем вызова **SQLDisconnect**. Драйвер будет завершения всех необработанных транзакций и возврата соединения в несвязанной состояние.  
  
 Если включены асинхронной операции на дескриптор соединения **SQLBrowseConnect** также может возвращать значение SQL_STILL_EXECUTING. Если возвращается значение SQL_NEED_DATA, приложение должно использовать **SQLDisconnect** для отмены обзора процесса. Если **SQLBrowseConnect** возвращает SQL_STILL_EXECUTING, приложение должно использовать **SQLCancelHandle** отменить выполняющуюся операцию. Вызов **SQLCancelHandle** после функция возвращает SQL_NEED_DATA не оказывает влияния.  
  
 Дополнительные сведения см. в разделе [соединение с помощью SQLBrowseConnect](../../../odbc/reference/develop-app/connecting-with-sqlbrowseconnect.md).  
  
 Если драйвер поддерживает **SQLBrowseConnect**, должен содержать раздел ключевое слово driver сведений о системе для драйвера **ConnectFunctions** значение ключевого слова с третьего знака «Y».  
  
## <a name="code-example"></a>Пример кода  
  
> [!NOTE]  
>  Если вы подключаетесь к поставщик источника данных, который поддерживает проверку подлинности Windows, следует указать `Trusted_Connection=yes` вместо идентификатора и пароля пользователя в строке подключения.  
  
 В следующем примере приложение вызывает **SQLBrowseConnect** несколько раз. Каждый раз **SQLBrowseConnect** возвращает SQL_NEED_DATA, он передает обратно сведения о данных, он должен в \* *OutConnectionString*. Приложение передает *OutConnectionString* его подпрограмму **GetUserInput** (не показано). **GetUserInput** анализирует данные, создает и отображает диалоговое окно и возвращает данные, введенные пользователем в \* *InConnectionString*. Приложение передает информацию о пользователе для драйвера в следующем вызове **SQLBrowseConnect**. После его предоставил всю необходимую информацию для подключения к источнику данных драйвера **SQLBrowseConnect** возвращает SQL_SUCCESS и приложение выполняется.  
  
 Более подробный пример для подключения к драйверу SQL Server путем вызова **SQLBrowseConnect**, в разделе [пример обозревателя SQL Server](../../../odbc/reference/develop-app/sql-server-browsing-example.md).  
  
 Например для подключения к данным источника продаж, возможны следующие действия. Во-первых, приложение передает следующую строку, чтобы **SQLBrowseConnect**:  
  
```  
"DSN=Sales"  
```  
  
 Диспетчер драйверов Загрузка драйвера, связанный с источником данных продаж. Затем он вызывает драйвер **SQLBrowseConnect** функции с теми же аргументами, полученное от приложения. Драйвер возвращает следующую строку в **OutConnectionString*:  
  
```  
"HOST:Server={red,blue,green};UID:ID=?;PWD:Password=?"  
```  
  
 Приложение передает эту строку, чтобы его **GetUserInput** сопоставление, который создает диалоговое окно запрашивает пользователя для выбора сервера синий, красный или зеленый и введите идентификатор пользователя и пароль. Сопоставление передает введенные пользователем данные обратно в \* *InConnectionString*, который приложение передает **SQLBrowseConnect**:  
  
```  
"HOST=red;UID=Smith;PWD=Sesame"  
```  
  
 **SQLBrowseConnect** использует эти сведения для подключения к серверу красный как Smith паролем Sesame, а затем возвращает следующую строку в **OutConnectionString*:  
  
```  
"*DATABASE:Database={SalesEmployees,SalesGoals,SalesOrders}"  
```  
  
 Приложение передает эту строку, чтобы его **GetUserInput** подпрограмм, который создает диалоговое окно пользователю предлагается выбрать базу данных. Empdata выбирает пользователь и приложение вызывает **SQLBrowseConnect** последний раз с помощью этой строки:  
  
```  
"DATABASE=SalesOrders"  
```  
  
 Это заключительная часть сведения, необходимые драйверу для соединения с источником данных; **SQLBrowseConnect** возвращает SQL_SUCCESS, и **OutConnectionString* содержит полную строку подключения:  
  
```  
// SQLBrowseConnect_Function.cpp  
// compile with: odbc32.lib  
#include <windows.h>  
#include <sqltypes.h>  
#include <sqlext.h>  
  
#define BRWS_LEN 100  
SQLHENV henv;  
SQLHDBC hdbc;  
SQLHSTMT hstmt;  
SQLRETURN retcode;  
SQLCHAR szConnStrIn[BRWS_LEN], szConnStrOut[BRWS_LEN];  
SQLSMALLINT cbConnStrOut;  
  
void GetUserInput(SQLCHAR * szConnStrOut, SQLCHAR * szConnStrIn) {}  
  
int main() {  
   // Allocate the environment handle.  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);        
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
      // Set the version environment attribute.  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
         // Allocate the connection handle.  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            // Call SQLBrowseConnect until it returns a value other than SQL_NEED_DATA   
            // (pass data source name the first time).  If SQL_NEED_DATA is returned, call GetUserInput   
            // (not shown) to build a dialog from the values in szConnStrOut.  The user-supplied values   
            // are returned in szConnStrIn, which is passed in the next call to SQLBrowseConnect.  
  
            strcpy_s((char*)szConnStrIn, _countof(szConnStrIn), "DSN=Sales");  
            do {  
               retcode = SQLBrowseConnect(hdbc, szConnStrIn, SQL_NTS,  
                  szConnStrOut, BRWS_LEN, &cbConnStrOut);  
               if (retcode == SQL_NEED_DATA)  
                  GetUserInput(szConnStrOut, szConnStrIn);  
            } while (retcode == SQL_NEED_DATA);  
  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO){  
  
               // Allocate the statement handle.  
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);  
  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO)  
                  // Process data after successful connection  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               SQLDisconnect(hdbc);  
            }  
         }  
         SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
      }  
   }  
   SQLFreeHandle(SQL_HANDLE_ENV, henv);  
}  
```  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение дескриптора соединения|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Подключение к источнику данных|[Функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Соединение с источником данных, используется поле строки или диалоговое окно соединения|[Функция SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md)|  
|Возврат описания драйверов и атрибуты|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение дескриптора соединения|[Функция SQLFreeHandle](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API-интерфейса ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
