---
title: Функция SQLInstallDriverEx | Документы Microsoft
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql-non-specified
ms.prod_service: drivers
ms.service: ''
ms.component: odbc
ms.reviewer: ''
ms.suite: sql
ms.technology:
- drivers
ms.tgt_pltfrm: ''
ms.topic: article
apiname:
- SQLInstallDriverEx
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLInstallDriverEx
helpviewer_keywords:
- SQLInstallDriverEx function [ODBC]
ms.assetid: 1dd74544-f4e9-46e1-9b5f-c11d84fdab4c
caps.latest.revision: 16
author: MightyPen
ms.author: genemi
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 4179bf04131f256c5a37cb01c079035a569a07af
ms.sourcegitcommit: cc71f1027884462c359effb898390c8d97eaa414
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="sqlinstalldriverex-function"></a>Функция SQLInstallDriverEx
**Соответствия**  
 Появился в версии: ODBC 3.0  
  
 **Сводка**  
 **SQLInstallDriverEx** добавляет сведения о драйвере Odbcinst.ini запись сведений о системе и увеличивает драйвера *UsageCount* на 1. Тем не менее, если версия драйвера уже существует, но *UsageCount* значение для драйвера, не существует, новый *UsageCount* имеет значение 2.  
  
 Эта функция фактически не копирует все файлы. Он отвечает вызывающая программа передает макросу правильно скопировать файлы драйверов в конечный каталог.  
  
 Функциональные возможности **SQLInstallDriverEx** можно получить с помощью [ODBCCONF. EXE](../../../odbc/odbcconf-exe.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
BOOL SQLInstallDriverEx(  
     LPCSTR    lpszDriver,  
     LPCSTR    lpszPathIn,  
     LPSTR     lpszPathOut,  
     WORD      cbPathOutMax,  
     WORD *    pcbPathOut,  
     WORD      fRequest,  
     LPDWORD   lpdwUsageCount);  
```  
  
## <a name="arguments"></a>Аргументы  
 *lpszDriver*  
 [Вход] Описание драйвера (обычно имя СУБД связанные) пользователям вместо имени физического драйвера. *LpszDriver* аргумент должен содержать двойной завершающий список пар ключевое слово значение, описывающее драйвер. Дополнительные сведения о пары «ключевое слово значение» в разделе [драйвер спецификации подразделов](../../../odbc/reference/install/driver-specification-subkeys.md). Дополнительные сведения о строке двойной завершающий см. в разделе [ConfigDSN функция](../../../odbc/reference/syntax/configdsn-function.md).  
  
 *lpszPathIn*  
 [Вход] Полный путь к целевой каталог установки, или указатель null. Если *lpszPathIn* является пустым указателем, драйверы будут установлены в системном каталоге.  
  
 *lpszPathOut*  
 [Выход] Путь к целевой каталог для установки драйвера. Если драйвер ранее не была установлена, *lpszPathOut* должно быть таким же, как *lpszPathIn*. Если ранее был установлен драйвер, *lpszPathOut* путь к предыдущей установки.  
  
 *cbPathOutMax*  
 [Вход] Длина *lpszPathOut*.  
  
 *pcbPathOut*  
 [Выход] Общее число байтов (за исключением знака завершения null) для возврата в *lpszPathOut*. Если количество байтов, доступных для возврата больше или равно *cbPathOutMax*, выходной путь в *lpszPathOut* усекается до *cbPathOutMax* минус знак завершения NULL. *PcbPathOut* аргумент может быть пустой указатель.  
  
 *fRequest*  
 [Вход] Тип запроса. *FRequest* аргумент должен иметь один из следующих значений:  
  
 ODBC_INSTALL_INQUIRY: Запрос установки драйвера.  
  
 ODBC_INSTALL_COMPLETE: Завершите запрос на установку.  
  
 *lpdwUsageCount*  
 [Выход] Счетчик использования драйвера после вызова этой функции.  
  
 Приложение не может установить счетчик использования. ODBC поддерживает это число.  
  
## <a name="returns"></a>Возвращает  
 Функция возвращает значение TRUE, если он прошел успешно, FALSE в случае неудачи.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLInstallDriverEx** возвращает значение FALSE, связанный с ним  *\*pfErrorCode* значение можно получить путем вызова **SQLInstallerError**. В следующей таблице перечислены  *\*pfErrorCode* значения, которые могут быть возвращены **SQLInstallerError** и описание каждого из них в контексте этой функции.  
  
|*\*pfErrorCode*|Ошибка|Description|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_GENERAL_ERR|Установщик Общие ошибки|Произошла ошибка для которого нет ошибок определенного установщика.|  
|ODBC_ERROR_INVALID_BUFF_LEN|Недопустимый буфер длины|*LpszPathOut* аргумент не может быть достаточно большим, чтобы содержать выходной путь. Буфер содержит путь к усечению.<br /><br /> *CbPathOutMax* аргумент было равно 0, и *fRequest* был ODBC_INSTALL_COMPLETE.|  
|ODBC_ERROR_INVALID_REQUEST_TYPE|Недопустимый тип запроса|*FRequest* аргумент не является одним из следующих:<br /><br /> ODBC_INSTALL_INQUIRY ODBC_INSTALL_COMPLETE|  
|ODBC_ERROR_INVALID_KEYWORD_VALUE|Пары "недопустимое ключевое слово значение"|*LpszDriver* аргумент содержит синтаксическую ошибку.|  
|ODBC_ERROR_INVALID_PATH|Путь установки недопустимый|*LpszPathIn* аргумент содержит неправильный путь.|  
|ODBC_ERROR_LOAD_LIBRARY_FAILED|Не удалось загрузить библиотеку установки драйвера или преобразователь|Не удается загрузить библиотеку установки драйвера.|  
|ODBC_ERROR_INVALID_PARAM_SEQUENCE|Недопустимый параметр последовательности|*LpszDriver* аргумент не содержит список пар «ключевое слово значение».|  
|ODBC_ERROR_USAGE_UPDATE_FAILED|Не удалось увеличить или уменьшить загруженность в компонент|Программа установки не удалось увеличить счетчик использования драйвера.|  
  
## <a name="comments"></a>Комментарии  
 *LpszDriver* аргумент является список атрибутов в форме пар «ключевое слово значение». Каждая пара заканчивается нулевым байтом, и завершается нулевым байтом весь список. (То есть две пустые байты отмечающий конец списка.) Этот список имеет следующий формат:  
  
 *драйвер desc*  **\\** 0Driver**=***имя файла драйвера DLL*  **\\** 0 [установки**=***имя файла DLL установки***\\**0]  
  
 [*драйвер attr ключевое_слово1***=***значение1***\\**0] [*драйвер attr ключевое_слово2*   **=**  *value2***\\**0]...  **\\** 0  
  
 где \0 является нулевым байтом и *драйвер attr keywordn* является любое ключевое слово атрибута драйвера. Ключевые слова должны располагаться в указанном порядке. Например предположим, что драйвер для файлов форматированный текст имеет отдельный драйвер и установки библиотеки DLL и можно использовать файлы с расширениями txt и CSV. *LpszDriver* аргумент для этого драйвера может выглядеть следующим образом:  
  
```  
Text\0Driver=TEXT.DLL\0Setup=TXTSETUP.DLL\0FileUsage=1\0  
FileExtns=*.txt,*.csv\0\0  
```  
  
 Предположим, что драйвер для SQL Server не имеет отдельный DLL-файлов установки и не имеет всех ключевых слов атрибута драйвера. *LpszDriver* аргумент для этого драйвера может выглядеть следующим образом:  
  
```  
SQL Server\0Driver=SQLSRVR.DLL\0\0  
```  
  
 После **SQLInstallDriverEx** извлекает сведения о драйвере из *lpszDriver* аргумент, он добавляет Описание драйвера в раздел [ODBC Drivers] Odbcinst.ini записи в системе сведения. Затем создается раздел с описанием драйвер и добавляет полные пути к DLL-Библиотека драйвера и DLL-файлов установки. Наконец возвращает путь к целевой каталог установки, но не копирует файлы драйверов в него. Фактически, вызывающей программе необходимо скопировать файлы драйверов в конечный каталог.  
  
 **SQLInstallDriverEx** увеличивает счетчик использования компонента, установленного драйвера на 1. Если уже существует версия драйвера, но драйвер счетчик использования компонента не существует, новое значение счетчика использования компонента имеет значение 2.  
  
 Программа установки отвечает за физически копирования файла драйвера и обслуживания счетчик использования файла. Если файл драйвера ранее не была установлена, программа установки необходимо скопировать файл в *lpszPathIn* путь и создать счетчик использования файла. Если файл был ранее установлен, программа установки просто увеличивает счетчик использования файла и возвращает путь перед установкой в *lpszPathOut* аргумент.  
  
> [!NOTE]  
>  Дополнительные сведения о счетчики использования компонента и счетчики использования файла см. в разделе [об использовании инвентаризации](../../../odbc/reference/install/usage-counting.md).  
  
 Если приложение уже установлена устаревшая версия файла драйвера, драйвер следует удалить и переустановить, таким образом, счетчик использования компонент driver допустимым. **SQLConfigDriver** (с *fRequest* из ODBC_REMOVE_DRIVER) сначала следует вызвать, а затем **SQLRemoveDriver** должен вызываться для уменьшения числа использования компонента. **SQLInstallDriverEx** затем должен вызываться для переустановки драйвера, увеличивая счетчик использования компонента. Программа установки необходимо заменить старый файл с новым файлом. Счетчик использования файла останется тем же, а все другие приложения, используется файл старой версии теперь будет использовать более новую версию.  
  
> [!NOTE]  
>  Если ранее был установлен драйвер и **SQLInstallDriverEx** вызывается для установки драйвера в другом каталоге, функция возвращает значение TRUE, но *lpszPathOut* будет включать каталог Когда драйвер уже был установлен. Не будут включены в каталоге, введенные в *lpszDriver* аргумент.  
  
 Длина пути в *lpszPathOut* в **SQLInstallDriverEx** позволяет процессом двухфазной установки, поэтому приложение может определить, что *cbPathOutMax* необходимо определить вызов **SQLInstallDriverEx** с *fRequest* ODBC_INSTALL_INQUIRY режима. Возвращает общее количество байтов, доступных в *pcbPathOut* буфера. **SQLInstallDriverEx** затем может быть вызван с *fRequest* из ODBC_INSTALL_COMPLETE и *cbPathOutMax* аргументу присвоено значение в *pcbPathOut*буфера, а также знак завершения null.  
  
 Если вы решили не использовать двухфазной модель для **SQLInstallDriverEx**, необходимо задать *cbPathOutMax*, который определяет размер хранилища для пути целевой каталог, чтобы значение _MAX_PATH, как определен в Stdlib.h, чтобы не допустить усечения.  
  
 Когда *fRequest* — ODBC_INSTALL_COMPLETE, **SQLInstallDriverEx** не допускает *lpszPathOut* равным NULL (или *cbPathOutMax* быть (0). Если *fRequest* является ODBC_INSTALL_COMPLETE, FALSE возвращается, если количество байтов, доступных для возврата больше или равно *cbPathOutMax*, в результате происходит усечение.  
  
 После **SQLInstallDriverEx** был вызван и (при необходимости), программа установки скопировала файл драйвера, необходимо вызвать метод установки драйвера DLL **SQLConfigDriver** настроить конфигурацию для драйвер.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Установка диспетчера драйверов|[SQLInstallDriverManager](../../../odbc/reference/syntax/sqlinstalldrivermanager-function.md)|
