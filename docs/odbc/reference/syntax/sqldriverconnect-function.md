---
title: "Функция SQLDriverConnect | Документы Microsoft"
ms.custom: 
ms.date: 01/19/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology:
- drivers
ms.tgt_pltfrm: 
ms.topic: article
apiname:
- SQLDriverConnect
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLDriverConnect
helpviewer_keywords:
- SQLDriverConnect function [ODBC]
ms.assetid: e299be1d-5c74-4ede-b6a3-430eb189134f
caps.latest.revision: 50
author: MightyPen
ms.author: genemi
manager: jhubbard
ms.workload: On Demand
ms.translationtype: MT
ms.sourcegitcommit: f7e6274d77a9cdd4de6cbcaef559ca99f77b3608
ms.openlocfilehash: 8b9576bf21c922c1e8d223710210a1703f1cbec3
ms.contentlocale: ru-ru
ms.lasthandoff: 09/09/2017

---
# <a name="sqldriverconnect-function"></a>Функция SQLDriverConnect
**Соответствия**  
 Появился в версии: Полное соответствие стандартам 1.0 ODBC: ODBC  
  
 **Сводка**  
 **SQLDriverConnect** является альтернативой **SQLConnect**. Он поддерживает источников данных, которым требуются дополнительные сведения о соединении, чем трех аргументов в **SQLConnect**, диалоговым окнам, чтобы запрашивать у пользователя все сведения о соединении и источники данных, которые не определены в системе сведения.  
  
 **SQLDriverConnect** предоставляет следующие атрибуты соединения:  
  
-   Установите соединение с помощью строки подключения, который содержит имя источника данных, один или несколько идентификаторов пользователей, один или несколько паролей и другие сведения, необходимые в источнике данных.  
  
-   Установить соединение с помощью частичную строку соединения или Дополнительные сведения отсутствуют; в этом случае диспетчер драйверов и драйвер может каждый запрашивать у пользователя сведения о соединении.  
  
-   Установите соединение с источником данных, который не определен в сведениях о системе. Если приложение предоставляет частичную строку соединения, драйвер может запросить у пользователя сведения о соединении.  
  
-   Установите соединение с источником данных с помощью строки подключения, построенным на основе информации в файле DSN с.  
  
 После установления соединения **SQLDriverConnect** возвращает полную строку подключения. Приложение может использовать эту строку для последующих запросов на соединение. Дополнительные сведения см. в разделе [соединение с помощью SQLDriverConnect](../../../odbc/reference/develop-app/connecting-with-sqldriverconnect.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
SQLRETURN SQLDriverConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLHWND         WindowHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr,  
     SQLUSMALLINT    DriverCompletion);  
```  
  
## <a name="arguments"></a>Аргументы  
 *ConnectionHandle*  
 [Вход] Дескриптор соединения.  
  
 *WindowHandle*  
 [Вход] Дескриптор окна. Можно передать в дескриптор родительского окна, если это применимо, или указатель null, если параметр неприменим дескриптор окна или **SQLDriverConnect** диалоговые не отображаются.  
  
 *InConnectionString*  
 [Вход] Требуется полная строка подключения (см. в «Комментарии» синтаксис) частичную строку соединения, или пустая строка.  
  
 *StringLength1*  
 [Вход] Длина **InConnectionString*, в символах, если строка Юникода или байтов, если строка ANSI или DBCS.  
  
 *OutConnectionString*  
 [Выход] Указатель на буфер для полную строку подключения. После успешного подключения к целевому источнику данных этот буфер содержит полную строку подключения. Приложения, необходимо выделить по крайней мере 1 024 символов для этого буфера.  
  
 Если *OutConnectionString* имеет значение NULL, *StringLength2Ptr* по-прежнему возвращает общее число символов (за исключением символа конечное значение null, символьные данные) для возврата в буфер Указывает *OutConnectionString*.  
  
 *BufferLength*  
 [Вход] Длина **OutConnectionString* буфера в символах.  
  
 *StringLength2Ptr*  
 [Выход] Указатель на буфер, в который возвращается общее число символов (за исключением знака завершения null) для возврата в \* *OutConnectionString*. Если количество символов вернуть больше или равно *BufferLength*, выполнить строку подключения в \* *OutConnectionString* усекается до * BufferLength* за вычетом длины символ конечное значение null.  
  
 *DriverCompletion*  
 [Вход] Флаг, указывающий, должен ли диспетчер драйверов или драйвер должен запрашивать дополнительные сведения о соединении:  
  
 SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE, SQL_DRIVER_COMPLETE_REQUIRED или SQL_DRIVER_NOPROMPT.  
  
 (Дополнительные сведения см. в разделе «Комментарии».)  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_ERROR, SQL_INVALID_HANDLE или SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLDriverConnect** возвращает значение SQL_ERROR или SQL_SUCCESS_WITH_INFO, соответствующее значение SQLSTATE можно получить, вызвав **SQLGetDiagRec** с *fHandleType*установленным в значение sql_handle_stmt и *hHandle* из *ConnectionHandle*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые **SQLDriverConnect** и описание каждого из них в контексте этой функции; нотации «(DM)» предшествует описания SQLSTATE, возвращаемых диспетчером драйверов. Код возврата, связанные с каждым из значений SQLSTATE — это SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Description|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, относящиеся к драйверу. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01004|Строка справа усечение данных|Буфер \* *OutConnectionString* не был достаточно велик, чтобы возвращать строке все соединения, поэтому строка соединения была усечена. Длина строки неусеченный соединение возвращается в **StringLength2Ptr*. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S00|Недопустимый атрибут строки соединения|В строке подключения указан недопустимый атрибут ключевое слово (*InConnectionString*), но драйверу не удалось подключиться к источнику данных, несмотря на это. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S02|Значение параметра изменено|Драйвер не поддерживает указанное значение, на который указывает *ValuePtr* аргумент в **SQLSetConnectAttr** и заменить примерно такое же значение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S08|Ошибка при сохранении файлового DSN|Строка в * \*InConnectionString* содержится **FILEDSN** ключевое слово, но DSN с файл не был сохранен. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S09|Недопустимое ключевое слово|(DM) строки в * \*InConnectionString* содержится **SAVEFILE** ключевое слово, но не **ДРАЙВЕР** или **FILEDSN** Ключевое слово. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|08001|Клиенту не удается установить соединение|Драйвер не удалось установить соединение с источником данных.|  
|08002|Имя подключения используется|(DM) указанного *ConnectionHandle* уже была использована для установления соединения с источником данных и подключение было все еще открыт.|  
|08004|Сервер отклонил соединение|Источник данных отклонены установление соединения по причинам, определяемого реализацией.|  
|08S01|Сбой связи|Сбой в канале связи между драйвером и источника данных, к которому драйвер при попытке подключиться перед **SQLDriverConnect** обработки функции было завершено.|  
|28000|Недопустимая спецификация авторизации|Идентификатор пользователя или строку авторизации (или оба), указанное в строке подключения (*InConnectionString*), нарушены ограничения, определенные в источнике данных.|  
|HY000|Общая ошибка|Произошла ошибка, для которой было нет определенных SQLSTATE и для которого был определен SQLSTATE не зависит от реализации. Сообщение об ошибке, возвращенные **SQLGetDiagRec** в * \*szMessageText* буфера описывает ошибку и его причины.|  
|HY000|Общая ошибка: недопустимый файл источника данных|(DM) строки в **InConnectionString* содержится ключевое слово FILEDSN, но имя DSN с файл не найден.|  
|HY000|Общая ошибка: не удается создать буфер для файла|(DM) строки в **InConnectionString* содержится ключевое слово FILEDSN, но не удается прочитать файл DSN с.|  
|HY001|Ошибка выделения памяти|Диспетчер драйверов не удалось выделить память, необходимую для поддержки выполнения или завершения **SQLDriverConnect** функции.<br /><br /> Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Операция отменена|Асинхронная обработка была включена для *ConnectionHandle*. Функция был вызван, и до выполнения, [функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md) был вызван для *ConnectionHandle*, а затем **SQLDriverConnect** функция была вызвана снова на *ConnectionHandle*.<br /><br /> Или **SQLDriverConnect** была вызвана функция и до выполнения, **SQLCancelHandle** был вызван для *ConnectionHandle* из другого потока в многопоточные приложения.|  
|HY010|Ошибка последовательности функций|(DM) другой функции асинхронного выполнения (не **SQLDriverConnect**) был вызван для *ConnectionHandle* и еще выполнялась при **SQLDriverConnect** функция была вызвана.|  
|HY013|Ошибка управления памятью|**SQLDriverConnect** вызов функции не может быть обработан, поскольку базовые объекты памяти будет недоступен, возможно из-за нехватки памяти.|  
|HY090|Недопустимая длина строки или буфера|(DM) значение, указанное в аргументе *StringLength1* меньше 0 и не может быть равно SQL_NTS.<br /><br /> (DM) значение, указанное в аргументе *BufferLength* был меньше 0.|  
|HY092|Недопустимый атрибут идентификатор или параметра|(DM) *DriverCompletion* аргумент был SQL_DRIVER_PROMPT и *WindowHandle* аргумент был пустым указателем.|  
|HY110|Недопустимое завершение драйвера|(DM) значение, указанное для аргумента *DriverCompletion* не равнялось SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE, SQL_DRIVER_NOPROMPT или SQL_DRIVER_COMPLETE_REQUIRED.<br /><br /> (DM) пул подключений был включен, и значение, указанное для аргумента *DriverCompletion* было не равно SQL_DRIVER_NOPROMPT.|  
|HYC00|Дополнительная возможность не реализована|Драйвер не поддерживает версию ODBC поведения, запрошенный приложением.|  
|HYT00|Время ожидания истекло|Для подключения к источнику данных завершено истечения времени ожидания входа в систему. Время ожидания задается с помощью **SQLSetConnectAttr**, параметре.|  
|HYT01|Время ожидания соединения истекло|Время ожидания соединения истекло раньше, чем ответил на запрос источника данных. Время ожидания задается с помощью **SQLSetConnectAttr**, sql_attr_connection_timeout не учитывается.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, соответствующий заданным именем источника данных не поддерживает функцию.|  
|IM002|Не удалось найти источник данных и не указан драйвер по умолчанию|Имя, указанное в строке подключения источника данных (интеллектуальный анализ данных) (*InConnectionString*) не удалось найти сведения о системе и возникла не по умолчанию драйвер спецификации.<br /><br /> (DM) ODBC данных по умолчанию драйвер сведения об источнике и не удалось найти сведения о системе.|  
|IM003|Не удалось загрузить указанный драйвер|(DM) драйвер, перечисленные в спецификации источника данных сведений о системе или указанных в **ДРАЙВЕР** ключевое слово не найден или не может быть загружена по другой причине.|  
|IM004|Драйвера **SQLAllocHandle** на SQL_HANDLE_ENV сбой|(DM) во время **SQLDriverConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *fHandleType* SQL_HANDLE_ENV и драйвер возвращается Произошла ошибка.|  
|IM005|Драйвера **SQLAllocHandle** на SQL_HANDLE_DBC сбой.|(DM) во время **SQLDriverConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *fHandleType* SQL_HANDLE_DBC и драйвер возвращается Произошла ошибка.|  
|IM006|Драйвера **SQLSetConnectAttr** сбой|(DM) во время **SQLDriverConnect**, диспетчер драйверов называемая драйвером **SQLSetConnectAttr** функции и драйвер вернул ошибку.|  
|IM007|Нет источника данных или драйвера задан; Открытие диалогового окна невозможно|Нет имя источника данных или драйвер был указан в строке подключения и *DriverCompletion* был SQL_DRIVER_NOPROMPT.|  
|IM008|Сбой диалогового окна|Драйвер пытается отобразить его диалоговое окно входа и сбой.<br /><br /> *WindowHandle* является пустым указателем, а *DriverCompletion* не SQL_DRIVER_NO_PROMPT.|  
|IM009|Не удается загрузить трансляции (DLL)|Драйверу не удалось загрузить трансляции (DLL), указанный для источника данных или для подключения.|  
|IM010|Слишком длинное имя источника данных|(DM), значение атрибута для ключевого слова DSN был более SQL_MAX_DSN_LENGTH символов.|  
|IM011|Слишком длинное имя драйвера|(DM), значение атрибута для **ДРАЙВЕР** ключевое слово были длиннее 255 символов.|  
|IM012|Синтаксическая ошибка ДРАЙВЕРА ключевое слово|Значение ключевого слова (DM), свяжите для **ДРАЙВЕР** ключевое слово содержит синтаксическую ошибку.<br /><br /> (DM) строки в * \*InConnectionString* содержится **FILEDSN** не содержит ключевое слово, но файл DSN с **ДРАЙВЕР** ключевое слово или ** DSN** ключевое слово.|  
|IM014|Указанное имя DSN содержит несоответствие архитектуры драйверов и приложения|32-разрядное приложение (DM) использует имя источника данных, подключение к 64-разрядный драйвер; и наоборот.|  
|IM015|Не удалось выполнить SQLDriverConnect драйвера на SQL_HANDLE_DBC_INFO_HANDLE|Если драйвер возвращает значение SQL_ERROR, диспетчер драйверов вернет значение SQL_ERROR в приложение и соединение будет разорвано.<br /><br /> Дополнительные сведения о SQL_HANDLE_DBC_INFO_TOKEN см. в разделе [разработке пула соединений, поддерживающие драйвер ODBC](../../../odbc/reference/develop-driver/developing-connection-pool-awareness-in-an-odbc-driver.md).|  
|IM017|В режиме асинхронное уведомление отключена опроса|При использовании модели уведомление опроса отключен.|  
|IM018|**SQLCompleteAsync** не был вызван для завершения предыдущей асинхронной операции на этот дескриптор.|Если предыдущего вызова функции с дескриптором возвращает SQL_STILL_EXECUTING и уведомлений в режиме **SQLCompleteAsync** должен вызываться для этого после обработки и выполнения операции с дескриптором.|  
|S1118|Драйвер не поддерживает асинхронное уведомление|Если драйвер не поддерживает асинхронное уведомление, нельзя вернуть SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="comments"></a>Комментарии  
 Строка подключения имеет следующий синтаксис:  
  
 *Строка подключения* :: = *пустой строки*[;] &#124; *атрибута*[;] &#124; *атрибута*; *строки подключения*  
  
 *пустой строки* :: =*атрибута* :: = *ключевое слово атрибут*=*значение атрибута* &#124; ДРАЙВЕР = [{}]*значение атрибута*[}]  
  
 *Ключевое слово атрибут* :: = DSN &#124; UID &#124; PWD &#124; *-определенные атрибут-ключевое слово driver*  
  
 *значение атрибута* :: = *символьной строки*  
  
 *определенные атрибут-ключевое слово Driver* :: = *идентификатор*  
  
 где *символьной строки* имеет ноль или более символов; *идентификатор* имеет один или несколько символов. *ключевое слово атрибут* не учитывает регистр; *значение атрибута* может учитываться регистр; и значение **DSN** ключевое слово не состоит из одних пробелов.  
  
 Из-за соединения строки и инициализации файл грамматики, ключевые слова и атрибут значения, содержащие символы **[] {} (),? \*=! @** не заключено в скобки следует избегать. Значение **DSN** ключевое слово не может состоять только из пробелов и не должно содержать начальные пробелы. Из-за грамматики сведения о системе, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов.  
  
 Приложения не должны добавлять фигурные скобки вокруг значения атрибута после **ДРАЙВЕР** ключевое слово, если атрибут содержит точку с запятой (;), в этом случае требуются фигурные скобки. Если значение атрибута, полученного драйвером, включает фигурные скобки, драйвер не должен удалять их, но они должны быть частью возвращаемой строки подключения.  
  
 Строковое значение DSN или подключения заключать в скобки ({}), содержащий символы **[] {} (),? \*=! @** передается без изменений к драйверу. Тем не менее при использовании этих символов в ключевом слове, диспетчер драйверов возвращает ошибку при работе с DSN-файлом, но передает строку подключения к драйверу правильных строк подключения. Избегайте использования внедренных фигурных скобок в значении ключевого слова.  
  
 Строка подключения может содержать любое количество ключевых слов, определяемым драйвером. Поскольку **ДРАЙВЕР** ключевое слово не использует сведения из сведений о системе, драйвер должен определить такое количество ключевых слов, что драйвер позволяет подключаться к источнику данных, используя только данные в строке подключения. (Дополнительные сведения см. в «Драйвер правила,» далее в этом разделе.) Драйвер определяет, какие ключевые слова необходимы для подключения к источнику данных.  
  
 В следующей таблице описаны значения атрибута **DSN**, **FILEDSN**, **ДРАЙВЕР**, **UID**, **PWD**, и **SAVEFILE** ключевые слова.  
  
|Ключевое слово|Описание значения атрибута|  
|-------------|---------------------------------|  
|**ИМЯ ИСТОЧНИКА ДАННЫХ**|Имя источника данных, возвращенный **SQLDataSources** или диалоговом окне Источники данных из **SQLDriverConnect**.|  
|**FILEDSN**|Имя файла DSN с будут построены строку подключения для источника данных. Эти источники данных, называются файловых источников данных.|  
|**ДРАЙВЕР**|Описание драйвера, возвращаемое функцией **SQLDrivers** функции. Например Rdb или SQL Server.|  
|**UID**|Идентификатор пользователя.|  
|**PWD**|Пароль, соответствующий идентификатор пользователя, или пустая строка, если пароль не для идентификатора пользователя (PWD =;).|  
|**SAVEFILE**|Имя файла DSN с файла, в котором следует сохранить значение атрибута ключевых слов, используемых в соединении присутствует, успешно.|  
  
 Сведения о выборе приложения источник данных или драйвер см [Выбор источника данных или драйвер](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md).  
  
 Если все ключевые слова повторяются в строке подключения, драйвер использует значение, связанное с первого вхождения ключевого слова. Если **DSN** и **ДРАЙВЕР** ключевые слова включаются в ту же строку подключения, диспетчер драйверов и драйвер использовать любой ключевое слово встречается первый.  
  
 **FILEDSN** и **DSN** ключевые слова являются взаимоисключающими: любой ключевое слово встречается первый используется, и что и второй игнорируется. **FILEDSN** и **ДРАЙВЕР** ключевые слова, с другой стороны, не являются взаимоисключающими. Если любое ключевое слово появляется в строке соединения с **FILEDSN**, то значение атрибута ключевое слово в строке подключения используется вместо значения атрибута в файле DSN с одно ключевое слово.  
  
 Если **FILEDSN** используется ключевое слово, ключевые слова, указанные в файле DSN с используются для создания строки подключения. (Дополнительные сведения см. в разделе «Файл источников данных,» далее в этом разделе.) **UID** ключевое слово является необязательным; DSN с файл может быть создан только **ДРАЙВЕР** ключевое слово. **PWD** ключевое слово не хранятся в файле DSN с. Каталог по умолчанию для сохранения и загрузки файлов DSN с будет представлять собой сочетание путем, указанным в **CommonFileDir** HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ Windows\CurrentVersion и «ODBC\DataSources». (Если CommonFileDir «C:\Program Files\Common Files», каталог по умолчанию будет «C:\Program Files\Common Files\ODBC\Data источников».)  
  
> [!NOTE]  
>  DSN с файла можно управлять напрямую путем вызова [SQLReadFileDSN](../../../odbc/reference/syntax/sqlreadfiledsn-function.md) и [SQLWriteFileDSN](../../../odbc/reference/syntax/sqlwritefiledsn-function.md) функции в программе установки библиотеки DLL.  
  
 Если **SAVEFILE** используется ключевое слово, значения атрибутов ключевых слов, используемых в соединении присутствует, успешно будет сохранен как файл DSN с именем атрибута значение **SAVEFILE** Ключевое слово. **SAVEFILE** ключевое слово должно использоваться совместно с **ДРАЙВЕР** ключевое слово, **FILEDSN** ключевое слово (или оба) или функция возвращает значение SQL_SUCCESS_WITH_INFO с SQLSTATE 01S09 (недопустимое ключевое слово). **SAVEFILE** ключевое слово должно стоять перед **ДРАЙВЕР** ключевое слово в строке подключения или результаты будут неопределенными.  
  
## <a name="driver-manager-guidelines"></a>Диспетчер драйверов рекомендации  
 Диспетчер драйверов создает строку подключения для передачи драйверу в *InConnectionString* аргумент драйвера **SQLDriverConnect** функции. Диспетчер драйверов не изменяет *InConnectionString* аргумент, переданный в него приложением.  
  
 Действие диспетчера драйверов основан на значении *DriverCompletion* аргумент:  
  
-   SQL_DRIVER_PROMPT: Если строка подключения не содержит либо **ДРАЙВЕР**, **DSN**, или **FILEDSN** ключевое слово, диспетчер драйверов отображает диалоговое окно источников данных. Он создает строку подключения из имя источника данных, возвращенных диалоговым окном и любые другие ключевые слова, переданные приложением. Если имя источника данных, возвращенных в диалоговом окне пуст, диспетчер драйверов указывает пары ключ значение DSN = значение по умолчанию. (Это диалоговое окно предназначено не будет отображаться источника данных с именем «Default».)  
  
-   SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED: Если определяется приложением строка подключения содержит **DSN** ключевое слово, диспетчер драйверов копирует строку подключения, заданного приложением. В противном случае — он принимает те же действия, как и когда *DriverCompletion* — SQL_DRIVER_PROMPT.  
  
-   SQL_DRIVER_NOPROMPT: Диспетчер драйверов копирует строку подключения, заданного приложением.  
  
 Если строка подключения, указанная для приложения содержит **ДРАЙВЕР** ключевое слово, диспетчер драйверов копирует строку подключения, заданного приложением.  
  
 Используя строку подключения, которую он создан, диспетчер драйверов определяет, какой драйвер следует использовать, подключается к этому драйверу и передает строку подключения, которую он создан для драйвера. Дополнительные сведения о взаимодействии диспетчера драйверов и драйверов см. в разделе «Комментарии» в [SQLConnect, функция](../../../odbc/reference/syntax/sqlconnect-function.md). Если строка подключения не содержит **ДРАЙВЕР** ключевое слово, диспетчер драйверов определяет, какой драйвер следует использовать следующим образом:  
  
1.  Если строка подключения содержит **DSN** ключевое слово, диспетчер драйверов извлекает драйвера, связанного с источником данных из сведений о системе.  
  
2.  Если строка подключения не содержит **DSN** ключевое слово или источник данных не найден, диспетчер драйверов извлекает драйвера, связанного с источником данных по умолчанию из сведений о системе. (Дополнительные сведения см. в разделе [по умолчанию подраздел](../../../odbc/reference/install/default-subkey.md).) Диспетчер драйверов изменяет значение **DSN** ключевое слово в строке подключения значение «DEFAULT».  
  
3.  Если **DSN** ключевого слова в строке подключения задано значение «DEFAULT», диспетчер драйверов извлекает драйвера, связанного с источником данных по умолчанию из сведений о системе.  
  
4.  Если источник данных не найден и не найден источник данных по умолчанию, диспетчер драйверов возвращает ошибку SQL_ERROR с SQLSTATE IM002 (источник данных не найден и не указан драйвер, по умолчанию).  
  
## <a name="file-data-sources"></a>Файловые источники данных  
 Если указана строка подключения для приложения при вызове **SQLDriverConnect** содержит **FILEDSN** ключевое слово и это ключевое слово не заменяется либо **DSN**или **ДРАЙВЕР** ключевое слово, а затем диспетчер драйверов создает строку подключения, используя сведения в файле DSN с и *InConnectionString* аргумент. Диспетчер драйверов происходит следующим образом:  
  
1.  Проверяет, является ли допустимым имя DSN с файла. Если нет, возвращается значение SQL_ERROR с SQLSTATE IM014 (недопустимое имя файла источника данных). Если имя файла является пустой строкой ("») и SQL_DRIVER_NOPROMPT не указан, то **открытия файла** диалоговое окно. Если имя файла содержит недопустимый путь, но не имя файла или недопустимое имя файла и SQL_DRIVER_NOPROMPT не указан, то **открытия файла** откроется диалоговое окно текущий каталог, значение, указанное в имени файла. Если имя файла является пустой строкой ("») или имя файла содержит недопустимый путь, но не имя файла или недопустимое имя файла и задано значение SQL_DRIVER_NOPROMPT, то возвращается значение SQL_ERROR с SQLSTATE IM014 (недопустимое имя файла источника данных).  
  
2.  Считывает все ключевые слова в раздел [ODBC] файла DSN с. Если **ДРАЙВЕР** ключевое слово отсутствует, возвращается значение SQL_ERROR с SQLSTATE IM012 (драйвер ключевое слово синтаксические ошибки), за исключением того, где DSN с файл непригоден для совместного использования и поэтому он содержит только **DSN** ключевое слово.  
  
     Если непригоден для совместного использования файла источника данных, диспетчер драйверов считывает значение **DSN** ключевое слово и подключается при необходимости для пользователя или системного источника данных, на который указывает такие источники данных. Шаги с 3 по 5, не выполняются.  
  
3.  Создает строку подключения для драйвера. Строка подключения драйвера является объединением и ключевые слова, указанные в файле DSN с теми, которые указаны в исходной строке подключения приложения. Ниже приведены правила для создания строки подключения драйвера перекрытия ключевые слова:  
  
    -   Если **ДРАЙВЕР** существует ключевое слово в строке подключения приложения и драйверы, заданные **ДРАЙВЕР** ключевые слова не совпадают в файле DSN с и строке соединения приложения, то сведения о драйвере в файле DSN с игнорируется и используется сведений о драйвере в строке подключения приложения. Если заданные драйверы **ДРАЙВЕР** ключевое слово одинаковы в файле DSN с и строке соединения, то там, где пересекаются все ключевые слова, указанные в строке подключения приложения имеют приоритет по сравнению с теми указанный в файле DSN с.  
  
    -   В новую строку подключения **FILEDSN** ключевое слово исключается.  
  
4.  Путем поиска в записи реестра HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBCINST будет загружен драйвер. INI\\< имя драйвера\>\Driver где \<имя драйвера > задается **ДРАЙВЕР** ключевое слово.  
  
5.  Передает драйвер новую строку подключения.  
  
 Примеры DSN-файлы см. в разделе [подключение источников данных с помощью файла](../../../odbc/reference/develop-app/connecting-using-file-data-sources.md).  
  
## <a name="savefile-keyword"></a>Ключевое слово SAVEFILE  
 Если строка подключения, указанная для приложения содержит **SAVEFILE** ключевое слово, а затем диспетчер драйверов Сохранение строки подключения в файле DSN с. Диспетчер драйверов происходит следующим образом:  
  
1.  Проверяет, включены ли имя DSN с файла в качестве значения атрибута **SAVEFILE** ключевое слово является допустимым. Если нет, возвращается значение SQL_ERROR с SQLSTATE IM014 (недопустимое имя файла источника данных). Допустимость имени файла определяется на стандартные системные правила именования. Если имя файла является пустой строкой ("») и *DriverCompletion* аргумент не SQL_DRIVER_NOPROMPT, то имя файла является допустимым. Если имя файла уже существует, программа Если *DriverCompletion* равно SQL_DRIVER_NOPROMPT, то файл будет перезаписан. Если *DriverCompletion* SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED, диалоговое окно предлагает пользователю указать, следует ли перезаписывать файл. Если не указано, то **сохранить файл** откроется диалоговое окно.  
  
2.  Если драйвер возвращает SQL_SUCCESS и имя файла не является пустой строкой, то диспетчер драйверов записывает сведения о соединении, возвращаемых в *OutConnectionString* аргумента в указанный файл в формате, указанном в в разделе «Строки соединения» этого раздела.  
  
3.  Если драйвер возвращает SQL_SUCCESS, а имя файла — пустая строка ("»), диспетчер драйверов вызывает **сохранить файл** общее диалоговое окно с *hwnd* указан и записывает сведения о соединении возвращается в *OutConnectionString* к файлу, заданному в файл сохранить стандартным диалоговым окном с форматом, указанным в разделе «Строки соединения» этого раздела.  
  
4.  Если драйвер возвращает SQL_SUCCESS, она возвращает *OutConnectionString* аргументу, содержащему строку подключения к приложению.  
  
5.  Если драйвер возвращает SQL_SUCCESS_WITH_INFO или SQL_ERROR, диспетчер драйверов возвращает SQLSTATE приложению.  
  
## <a name="driver-guidelines"></a>Рекомендации по драйверов  
 Драйвер проверяет, содержит ли строка подключения, переданного ему диспетчером драйверов **DSN** или **ДРАЙВЕР** ключевое слово. Если строка подключения содержит **ДРАЙВЕР** ключевое слово, драйвер не удается получить сведения об источнике данных из сведений о системе. Если строка подключения содержит **DSN** ключевое слово или не содержит либо **DSN** или **ДРАЙВЕР** ключевое слово, драйвер может получать сведения об источнике данных в сведениях о системе следующим образом:  
  
1.  Если строка подключения содержит **DSN** ключевое слово, драйвер возвращает сведения для указанного источника данных.  
  
2.  Если строка подключения не содержит **DSN** ключевое слово, не найден указанный источник данных, или **DSN** ключевого слова задано значение «DEFAULT», драйвер возвращает сведения об источнике данных по умолчанию .  
  
 Драйвер использует сведения, которые он получает из сведений о системе, чтобы расширить сведения, передаваемые в строке подключения. Если информация в сведениях о системе дублирует сведения в строку подключения, драйвер использует данные в строке подключения.  
  
 На основе значения *DriverCompletion*, драйвер запрашивает сведения о соединении, например идентификатор пользователя и пароль и подключается к источнику данных:  
  
-   SQL_DRIVER_PROMPT: Драйвер отображает диалоговое окно, используя значения из строки и системных сведений о соединении (если таковые имеются) как начальные значения. Когда пользователь выходит из диалоговым окном, драйвер подключается к источнику данных. Он также создает строку подключения с помощью значения **DSN** или **ДРАЙВЕР** ключевое слово в \* *InConnectionString* и сведения, полученные из диалоговое окно. Он помещает эту строку подключения в **OutConnectionString* буфера.  
  
-   SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED: Если строка подключения содержит достаточно информации, и оно задано правильно, драйвер подключается к источнику данных и копирует \* *InConnectionString*для \* *OutConnectionString*. Если все данные отсутствует или неверен, драйвер принимает те же действия, как и когда *DriverCompletion* — SQL_DRIVER_PROMPT, за исключением того, что если *DriverCompletion* — SQL_DRIVER_COMPLETE_ ОБЯЗАТЕЛЬНО, драйвер отключение элементов управления все данные, не требуется для подключения к источнику данных.  
  
-   SQL_DRIVER_NOPROMPT: Если строка подключения содержит достаточно информации, драйвер подключается к источнику данных и копирует \* *InConnectionString* для \* *OutConnectionString*. В противном случае драйвер возвращает значение SQL_ERROR для **SQLDriverConnect**.  
  
 Для успешного подключения к источнику данных, драйвер также задает \* *StringLength2Ptr* длине выходной строки подключения, доступные для возврата в **OutConnectionString*.  
  
 Если пользователь отменяет диалоговое окно, представленный диспетчера драйверов или драйвер **SQLDriverConnect** не вернет значение SQL_NO_DATA.  
  
 Сведения о взаимодействии диспетчера драйверов и драйвера во время подключения к статье [SQLConnect, функция](../../../odbc/reference/syntax/sqlconnect-function.md).  
  
 Если драйвер поддерживает **SQLDriverConnect**, должен содержать раздел ключевое слово driver информация о системе для драйвера **ConnectFunctions** значение ключевого слова with второй символ «Y».  
  
## <a name="connecting-when-connection-pooling-is-enabled"></a>Подключение, когда пул подключений включен  
 Организация пулов соединений позволяет приложению использовать подключение, который уже был создан. Когда **SQLDriverConnect** вызывается диспетчер драйверов пытается сделать соединение при помощи соединения, который является частью пула подключений в среде, которая была предназначена для пулов соединений. Дополнительные сведения о пулов соединений. в разделе [SQLConnect, функция](../../../odbc/reference/syntax/sqlconnect-function.md).  
  
 Приложение может установить SQL_ATTR_RESET_CONNECTION перед вызовом метода SQLDisconnect для соединения, активированной пулов. Дополнительные сведения см. в разделе [SQLSetConnectAttr, функция](../../../odbc/reference/syntax/sqlsetconnectattr-function.md).  
  
 Применяются следующие ограничения, когда приложение вызывает **SQLDriverConnect** для подключения к соединение из пула:  
  
-   Нет пула обработки подключений не выполняется при **SAVEFILE** указано ключевое слово в строке подключения.  
  
-   Если включен пул соединений, **SQLDriverConnect** может вызываться только с *DriverCompletion* аргумент SQL_DRIVER_NOPROMPT; Если **SQLDriverConnect** вызывается для любого другого *DriverCompletion*, SQLSTATE HY110 (недопустимое завершение драйвера) будет возвращено.  
  
## <a name="connection-attributes"></a>Атрибуты соединения  
 Атрибут соединения параметре, заданные с помощью **SQLSetConnectAttr**, определяет количество секунд ожидания для запроса имени входа для выполнения после успешного соединения с помощью драйвера перед возвратом к приложению. Если пользователю предлагается выполнить строку подключения, период ожидания для каждого запроса входа начинается, когда драйвер выполняет подключение.  
  
 Драйвер открывает соединение в режиме доступа SQL_MODE_READ_WRITE по умолчанию. Чтобы установить режим доступа SQL_MODE_READ_ONLY, приложение должно вызвать **SQLSetConnectAttr** с атрибутом SQL_ATTR_ACCESS_MODE до вызова метода **SQLDriverConnect**.  
  
 Если библиотека преобразования по умолчанию указан в системные сведения для источника данных, драйвер загружает их. Можно загрузить библиотеки различных перевода путем вызова **SQLSetConnectAttr** с помощью настройки SQL_ATTR_TRANSLATE_LIB атрибутом. Параметр миграции можно указать путем вызова **SQLSetConnectAttr** с параметром SQL_ATTR_TRANSLATE_OPTION.  
  
 Дополнительные сведения см. в разделе [соединение с помощью SQLDriverConnect](../../../odbc/reference/develop-app/connecting-with-sqldriverconnect.md).  
  
```  
// SQLDriverConnect_ref.cpp  
// compile with: odbc32.lib user32.lib  
#include <windows.h>  
#include <sqlext.h>  
  
int main() {  
   SQLHENV henv;  
   SQLHDBC hdbc;  
   SQLHSTMT hstmt;  
   SQLRETURN retcode;  
  
   SQLCHAR OutConnStr[255];  
   SQLSMALLINT OutConnStrLen;  
  
   HWND desktopHandle = GetDesktopWindow();   // desktop's window handle  
  
   // Allocate environment handle  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);  
  
   // Set the ODBC version environment attribute  
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);   
  
      // Allocate connection handle  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);   
  
         // Set login timeout to 5 seconds  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            SQLSetConnectAttr(hdbc, SQL_LOGIN_TIMEOUT, (SQLPOINTER)5, 0);  
  
            retcode = SQLDriverConnect( // SQL_NULL_HDBC  
               hdbc,   
               desktopHandle,   
               (SQLCHAR*)"driver=SQL Server",   
               _countof("driver=SQL Server"),  
               OutConnStr,  
               255,   
               &OutConnStrLen,  
               SQL_DRIVER_PROMPT );  
  
            // Allocate statement handle  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {                 
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);   
  
               // Process data  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               }  
  
               SQLDisconnect(hdbc);  
            }  
  
            SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
         }  
      }  
      SQLFreeHandle(SQL_HANDLE_ENV, henv);  
   }  
}  
```  
  
 См. также [образец программы на ODBC](../../../odbc/reference/sample-odbc-program.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение дескриптора|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Обнаружение и перечисление значений, необходимых для подключения к источнику данных|[Функция SQLBrowseConnect](../../../odbc/reference/syntax/sqlbrowseconnect-function.md)|  
|Подключение к источнику данных|[Функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Возврат описания драйверов и атрибуты|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение дескриптора|[Функция SQLFreeHandle](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
|Присвоение атрибуту соединения|[Функция SQLSetConnectAttr](../../../odbc/reference/syntax/sqlsetconnectattr-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API-интерфейса ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)

