---
title: "Резервное копирование и восстановление"
author: barbkess
ms.author: barbkess
manager: jhubbard
ms.prod: analytics-platform-system
ms.prod_service: mpp-data-warehouse
ms.service: 
ms.component: 
ms.suite: sql
ms.custom: 
ms.technology: mpp-data-warehouse
description: "Описывает, как данные резервного копирования и восстановления для SQL Server Parallel данных хранилища (PDW) работает."
ms.date: 10/20/2016
ms.topic: article
ms.assetid: d4669957-270a-4e50-baf3-14324ca63049
caps.latest.revision: 
ms.openlocfilehash: 06863b600ed62d795db82aa5aa3ae5c88578833a
ms.sourcegitcommit: 7519508d97f095afe3c1cd85cf09a13c9eed345f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2018
---
# <a name="backup-and-restore"></a>Резервное копирование и восстановление
Описывает, как данные резервного копирования и восстановления для SQL Server Parallel данных хранилища (PDW) работает. Операции резервного копирования и восстановления используются для аварийного восстановления. Резервное копирование и восстановление могут также использоваться для копирования базы данных с одного устройства на другое устройство.  
    
## <a name="BackupRestoreBasics"></a>Основные сведения о резервном копировании и восстановлении  
PDW *резервной копии базы данных* , является копией базы данных устройства, хранящиеся в формате, чтобы он может использоваться для восстановления исходной базы данных на устройстве.  
  
PDW резервной копии базы данных создается с [резервной копии базы данных](../t-sql/statements/backup-database-parallel-data-warehouse.md) инструкции t-sql и формата для использования с [RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md) инструкции; не может использоваться для других целей. Резервную копию можно восстановить только на устройстве с тем же номером или большего количества вычислительных узлов.  
  
<!-- MISSING LINKS

The [master database](master-database.md) is a SMP SQL Server database. It is backed up with the BACKUP DATABASE statement. To restore master, use the [Restore the Master Database](configuration-manager-restore-master-database.md) page of the Configuration Manager tool.  

-->
  
PDW использует технологию резервного копирования SQL Server, резервное копирование и восстановление баз данных с устройства. Параметры резервного копирования SQL Server предварительно настроен на использование сжатия резервной копии. Невозможно задать параметры резервного копирования, такие как сжатие, контрольная сумма, размер блока и число буферов.  
  
Резервные копии баз данных, хранятся на один или несколько резервных серверов, которые существуют в сети клиента.  PDW записывает резервные копии в параллельном режиме непосредственно от вычислительных узлов один резервный сервер и восстанавливает резервную копию базы данных пользователя в параллельном режиме непосредственно на сервере резервного копирования для вычислительных узлов.  
  
Резервные копии хранятся на сервере резервного копирования в виде набора файлов в файловой системе Windows. PDW резервной копии базы данных можно восстановить только к PDW. Тем не менее вы можете архивировать резервные копии баз данных на сервере резервного копирования в другое место с помощью стандартных процессов резервного копирования файлов Windows. Дополнительные сведения о резервных серверов см. в разделе [получения и настройки резервного копирования сервера](acquire-and-configure-backup-server.md).  
  
## <a name="BackupTypes"></a>Типы резервного копирования базы данных  
Существует два типа данных, которые необходимо выполнять резервное копирование: пользовательских и системных баз данных (например, базу данных master). PDW не создать резервную копию журнала транзакций.  
  
Полной резервной копии представляет собой резервную копию всей базы данных PDW. Это тип резервного копирования по умолчанию. Полную резервную копию пользовательской базы данных включает в себя пользователей базы данных и ролей базы данных. Резервная копия базы данных master включает имена входа.  
  
Разностная резервная копия содержит все изменения, внесенные с момента последнего полного резервного копирования. Разностная резервная копия обычно занимает меньше времени, чем полное резервное копирование и может выполняться более часто. При нескольких разностных резервных копий основаны на одной полной резервной копии, каждого разностная резервная копия включает все изменения, внесенные в предыдущей разностной копии.  
  
Например можно создать еженедельное полное резервное копирование и разностное резервное копирование каждый день. Восстановление пользовательской базы данных, полное резервное копирование, а также последней разностной резервной копии (если такой существует) необходимо восстановить.  
  
Разностное резервное копирование поддерживается только для пользовательских баз данных. Резервная копия главного всегда является полной резервной копии.  
  
Для создания резервной копии всей устройства, необходимо выполнить резервное копирование всех пользовательских баз данных и резервной копии базы данных master.  
  
## <a name="BackupProc"></a>Резервное копирование базы данных  
В примере ниже показан поток данных во время резервного копирования базы данных.  
  
![Процесс резервного копирования PDW](media/backup-process.png "PDW процесс резервного копирования")  
  
Процесс резервного копирования происходит следующим образом.  
  
1.  Пользователь отправляет инструкцию BACKUP DATABASE tsql к узлу.  
  
    -   Резервная копия является полной или разностной резервной копии.  
  
2.  Для пользовательских баз данных узел элемента управления (MPP Engine) создает план распределенного запроса создать резервную копию параллельного базы данных.  
  
3.  Каждый узел участвует в резервных копий его файла резервной копии на резервный сервер, с помощью функции резервного копирования SQL Server.  
  
    -   Каждый узел, влияющих на один файл резервной копии копий резервный сервер.  
  
    -   Резервная копия базы данных пользователя (полной или разностной) включает резервной копии части базы данных, хранящихся на каждом вычислительном узле, а резервная копия базы данных пользователей и ролей базы данных.  
  
4.  Устройство выполняет резервное копирование в параллельного использования сети InfiniBand.  
  
    -   PDW параллельно выполняет Каждая полная и разностная резервная копия. Однако несколько резервных копий базы данных не выполняется параллельно. Каждый запрос резервного копирования необходимо дождаться ранее отправленные резервных копий для завершения.  
  
    -   Резервная копия базы данных master только выполняет резервное копирование данных из узла управления. Этот тип резервного копирования выполняется последовательно.  
  
5.  Резервная копия базы данных PDW — это группа файлов, хранящихся в каталог, в котором находится отключение устройства. Имя каталога задается как имя сетевой путь к каталогу. Каталог не может быть локальный путь, и не может быть на устройстве.  
  
6.  После завершения резервного копирования, при необходимости файловой системы Windows можно использовать для копирования в каталог резервного копирования в другое место.  
  
    -   Резервной копии может быть восстановлена только на устройству PDW, имеющий больше или равно количество вычислительных узлов.  
  
    -   Не удается изменить имя резервной копии перед выполнением операции восстановления. Имя каталога резервного копирования должно соответствовать имени исходного имени резервная копия. Исходное имя резервного копирования находится в файле backup.xml в каталоге резервных копий. Восстановление базы данных с другим именем, в команде восстановления можно указать новое имя. Например: `RESTORE DATABASE MyDB1 FROM DISK = ꞌ\\10.192.10.10\backups\MyDB2ꞌ`.  
  
## <a name="RestoreModes"></a>Режимы восстановления базы данных  
Полное восстановление базы данных повторно создает базу данных PDW, используя данные в резервной копии базы данных. Восстановление базы данных выполняется путем сначала восстановление полной резервной копии и при необходимости восстановления одного разностной резервной копии. Восстановление базы данных включает в себя пользователей и ролей базы данных.  
  
Восстановление только заголовок возвращает данные заголовка для базы данных. Он не восстанавливает данные с устройством.  
  
Операция восстановления всего устройства — для восстановления устройства. Это включает восстановление всех пользовательских баз данных и базы данных master.  
  
## <a name="RestoreProc"></a>Процесс восстановления  
В примере ниже показан поток данных во время восстановления базы данных.  
  
![Процесс восстановления](media/restore-process.png "процесс восстановления")  
  
## <a name="restoring-to-an-appliance-with-the-same-number-of-compute-nodes"></a>Восстановление на устройстве с одинаковым числом вычислительных узлов **  
  
При восстановлении данных, устройство обнаруживает количество вычислительных узлов на устройстве источника и назначения устройством. Если оба устройства имеют одинаковое число вычислительных узлов, процесс восстановления происходит следующим образом.  
  
1.  Резервная копия базы данных, подлежащей восстановлению можно найти в общую папку Windows на сервере не устройство резервного копирования. Для наилучшей производительности этот сервер обычно подключен к сети InfiniBand устройства.  
  
2.  Пользователь отправляет [RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md) инструкции t-SQL к узлу.  
  
    -   Восстановление проводится полное восстановление или восстановление заголовка. Полное восстановление восстановление полной резервной копии и затем при необходимости восстановление разностной резервной копии.  
  
3.  Узел элемента управления (MPP Engine) создает план распределенный запрос для выполнения восстановления параллельных базы данных.  
  
    -   SQL ServerPDW параллельно выполняет восстановление пользовательской базы данных. Однако несколько резервных копий базы данных и восстановления не выполняются одновременно. Подсистема MPP помещает каждой инструкции restore в очередь; оно должно дождаться ранее отправленные резервного копирования и восстановления выполнения запросов.  
  
    -   Восстановление базы данных master только восстанавливает данные на узел элемента управления; восстановление выполняется последовательно.  
  
    -   Восстановление данных заголовка операция выполняется очень быстро и не восстанавливаются данные, к узлам вычислений или элемента управления. Вместо этого узел элемента управления возвращает результаты в виде выходных данных запроса.  
  
4.  Файлы резервной копии обычно копируется в правильное вычислительных узлов в параллельном режиме, по сети InfiniBand устройства.  
  
5.  Каждый вычислительный узел восстанавливает его часть пользовательской базы данных. Если любой из восстановления завершается успешно, все базы данных удаляются и восстановление завершено с ошибкой.  
  
## <a name="restoring-to-an-appliance-with-a-larger-number-of-compute-nodes"></a>Восстановление на устройстве с большим числом вычислительных узлов  
  
Восстановление резервной копии на устройстве с большим числом вычислительных узлов роста размера выделенной базы данных, пропорционально количеству вычислительных узлов.  
  
Например восстановления базы данных 60 ГБ с двумя узлами устройства (30 ГБ на каждом узле) к устройству 6-узла, SQL Server PDW создает базу данных 180 ГБ (6 узлы с 30 ГБ на каждом узле) на устройстве, 6-узла. SQL Server PDW изначально восстанавливает базу данных до 2 узлов в соответствии с исходной конфигурацией и перераспределяет данные для всех узлов 6.  
  
После распространения каждый вычислительный узел содержит меньше фактических данных и большего объема свободного пространства, чем каждом вычислительном узле, на устройстве меньше исходного. Используйте дополнительное место для добавления данных в базу данных. Если размер восстановленной базы данных больше, чем необходимо, можно использовать [инструкции ALTER DATABASE](../t-sql/statements/alter-database-parallel-data-warehouse.md) уменьшить размеры файлов базы данных.  
  
## <a name="related-tasks"></a>Связанные задачи  
  
|Резервное копирование и задачи восстановления|Описание|  
|---------------------------|---------------|  
|Подготовьте сервер как сервер резервного копирования.|[Получить и настроить резервный сервер ](acquire-and-configure-backup-server.md)|  
|Создайте резервную копию базы данных.|[РЕЗЕРВНОЕ КОПИРОВАНИЕ БАЗЫ ДАННЫХ](../t-sql/statements/backup-database-parallel-data-warehouse.md)|  
|Восстановление базы данных.|[ВОССТАНОВЛЕНИЕ БАЗЫ ДАННЫХ](../t-sql/statements/restore-database-parallel-data-warehouse.md)|    
<!-- MISSING LINKS
|Create a disaster recovery plan.|[Create a Disaster Recovery Plan](create-disaster-recovery-plan.md)|
|Restore the master database.|To restore the master database, use the [Restore the master database](configuration-manager-restore-master-database.md) page in the Configuration Manager tool.| 
|Copy a database from one appliance to another appliance.|[Copy a PDW database to another appliance](copy-pdw-database-to-another-appliance.md).|  
|Monitor backups and restores.|[Monitor backups and restores](monitor-backup-and-restore.md)|  
-->
