---
title: "Справочник по агрегатным функциям (построитель отчетов и службы SSRS) | Microsoft Docs"
ms.custom: ""
ms.date: "03/23/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "reporting-services-sharepoint"
  - "reporting-services-native"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: db6542ee-02d0-4073-90e6-cba8f9510fbb
caps.latest.revision: 8
author: "maggiesMSFT"
ms.author: "maggies"
manager: "erikre"
---
# Справочник по агрегатным функциям (построитель отчетов и службы SSRS)
  Чтобы включить в отчет статистические значения, в выражениях можно использовать агрегатные функции. Агрегатная функция по умолчанию для числовых полей — функция SUM. Можно изменить выражение и использовать другую встроенную агрегатную функцию или указать другую область. Область определяет набор данных, используемый при вычислениях.  
  
 Поскольку в обработчике отчетов объединены данные и макет отчета, то выражения для всех элементов отчета вычисляются. При просмотре всех страниц отчета в элементах отчета, подготовленных к просмотру, отображаются результаты для всех выражений.  
  
 В следующей таблице перечислены категории встроенных функций, которые можно включать в выражение.  
  
-   [Встроенные агрегатные функции](#CalculatingAggregates)  
  
-   [Ограничения встроенных полей, коллекций и агрегатных функций](#Restrictions)  
  
-   [Ограничения вложенных агрегатов](#NestedRestrictions)  
  
-   [Вычисление текущих значений](#CalculatingRunningValues)  
  
-   [Получение числа строк](#RetrievingRowCounts)  
  
-   [Уточняющий запрос значений из другого набора данных](#LookupFunctions)  
  
-   [Получение основанных на сортировке значений](#RetrievingPostsortValues)  
  
-   [Получение серверных агрегатов](#RetrievingServerAggregates)  
  
-   [Получение уровня рекурсии](#RetrievingRecursiveLevel)  
  
-   [Тестирование области](#TestingforScope)  
  
 Чтобы определить допустимые области для функции, см. раздел справки по конкретной функции. Дополнительные сведения и примеры см. в разделе [Область выражения для суммирования, агрегатных функций и встроенных коллекций (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression scope for totals, aggregates, and built-in collections.md).  
  
> [!NOTE]  
>  [!INCLUDE[ssRBRDDup](../../includes/ssrbrddup-md.md)]  
  
##  <a name="CalculatingAggregates"></a> Встроенные агрегатные функции  
 Для вычисления сводных значений для набора ненулевых числовых данных в области по умолчанию или именованной области используются следующие встроенные функции.  
  
|**Функция**|**Description**|  
|------------------|---------------------|  
|[Avg](../../reporting-services/report-design/avg-function-report-builder-and-ssrs.md)|Возвращает среднее значение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[Count](../../reporting-services/report-design/count-function-report-builder-and-ssrs.md)|Возвращает количество значений, отличных от NULL, определяемое выражением, вычисляемым в контексте данной области.|  
|[CountDistinct](../../reporting-services/report-design/countdistinct-function-report-builder-and-ssrs.md)|Возвращает количество уникальных значений, отличных от NULL, определяемое выражением, вычисляемым в контексте данной области.|  
|[Max](../../reporting-services/report-design/max-function-report-builder-and-ssrs.md)|Возвращает максимальное значение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области. Можно использовать для задания максимального значения оси диаграммы при управлении масштабом.|  
|[Min](../../reporting-services/report-design/min-function-report-builder-and-ssrs.md)|Возвращает минимальное значение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области. Можно использовать для задания минимального значения оси диаграммы при управлении масштабом.|  
|[StDev](../../reporting-services/report-design/stdev-function-report-builder-and-ssrs.md)|Возвращает стандартное отклонение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[StDevP](../../reporting-services/report-design/stdevp-function-report-builder-and-ssrs.md)|Возвращает стандартное отклонение совокупности всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области.|  
|[Sum](../../reporting-services/report-design/sum-function-report-builder-and-ssrs.md)|Возвращает сумму всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[Union](../../reporting-services/report-design/union-function-report-builder-and-ssrs.md)|Возвращает объединение всех значений пространственных данных типа **SqlGeometry** или **SqlGeography**, не равных NULL и указанных с помощью выражения, которое вычисляется в заданной области.|  
|[Var](../../reporting-services/report-design/var-function-report-builder-and-ssrs.md)|Возвращает дисперсию всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[VarP](../../reporting-services/report-design/varp-function-report-builder-and-ssrs.md)|Возвращает дисперсию совокупности всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="Restrictions"></a> Ограничения встроенных полей, коллекций и агрегатных функций  
 В следующей таблице описываются ограничения местоположений отчетов, в которых можно добавлять выражения, содержащие ссылки на глобальные встроенные коллекции.  
  
|Местоположение в отчете|Поля|Параметры|ReportItems|PageNumber<br /><br /> TotalPages|DataSource<br /><br /> DataSet|Переменные|RenderFormat|  
|------------------------|------------|----------------|-----------------|-------------------------------|----------------------------|---------------|------------------|  
|Заголовок страницы<br /><br /> Нижний колонтитул страницы|Да|Да|Максимум одно<br /><br /> Примечание 1|Да|Да|Да|Да|  
|Текст|Да<br /><br /> Примечание 2|Да|Только элементы в текущей или включающей области<br /><br /> Примечание 3|Нет|Да|Да|Да|  
|Параметр отчета|Нет|Только ранее упомянутые в списке параметры<br /><br /> Примечание 4|Нет|Нет|Нет|Нет|Нет|  
|Поле|Да|Да|Нет|Нет|Нет|Нет|Нет|  
|Параметр запроса|Нет|Да|Нет|Нет|Нет|Нет|Нет|  
|Выражение группы|Да|Да|Нет|Нет|Да|Нет|Нет|  
|Выражение сортировки|Да|Да|Нет|Нет|Да|Да<br /><br /> Примечание 5|Нет|  
|Критерий фильтра|Да|Да|Нет|Нет|Да|Да<br /><br /> Примечание 6|Нет|  
|код|Нет|Да<br /><br /> Примечание 7|Нет|Нет|Нет|Нет|Нет|  
|Report.Language|Нет|Да|Нет|Нет|Нет|Нет|Нет|  
|Переменные|Да|Да|Нет|Нет|Да|Текущая или включающая область|Нет|  
|Статистические вычисления|Да|Да|Только в верхнем или нижнем колонтитуле страницы|Только в агрегатных функциях элементов отчета|Да|Нет|Нет|  
|Функции поиска|Да|Да|Да|Нет|Да|Нет|Нет|  
  
-   **Примечание 1.** Элемент ReportItems должен существовать на странице отчета, подготовленной к просмотру, или их значение равно NULL. Если видимость элемента отчета зависит от выражения, принимающего значение False, то этот элемент отчета не существует на странице.  
  
-   **Примечание 2** . Если ссылка на поле используется в области группы и ссылка на поле не включена в выражение группы, то значение для поля считается неопределенным, за исключением случаев, когда в области имеется только одно значение. Чтобы указать значение используйте методы First и Last и область группы.  
  
-   **Примечание 3** . Выражения, включающие ссылку на элемент ReportItems, могут использоваться для указания значений для других элементов ReportItems в той же или включающей области группы.  
  
-   **Примечание 4** . Значения свойств для предыдущих параметров могут быть равны NULL.  
  
-   **Примечание 5** . Только при сортировке элементов. Нельзя использовать в выражениях сортировки области данных.  
  
-   **Примечание 6** . Только для фильтров элементов. Нельзя использовать в выражениях сортировки области данных или критериев фильтра наборов данных.  
  
-   **Примечание 7.** Коллекция параметров не инициализируется до обработки блока кода, поэтому методы не могут быть использованы для управления параметрами при инициализации.  
  
-   **Примечание 8.** Все агрегатные функции, за исключением Count и CountDistinct, должны иметь один тип данных, или все значения должны быть равны NULL.  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="NestedRestrictions"></a> Ограничения вложенных агрегатов  
 В следующей таблице описываются ограничения, которые используются агрегатными функциями для указания других агрегатных функций как вложенных агрегатов.  
  
|Контекст|RunningValue|RowNumber|Первая<br /><br /> Последняя|Previous|Sum и другие функции предварительной сортировки|Агрегаты ReportItem|Функции поиска|Агрегатная функция|  
|-------------|------------------|---------------|--------------------|--------------|-------------------------------------|---------------------------|----------------------|------------------------|  
|Текущее значение|Нет|Нет|Нет|Нет|Да|Нет|Да|Нет|  
|Первая<br /><br /> Последняя|Нет|Нет|Нет|Нет|Да|Нет|Нет|Нет|  
|Previous|Да|Да|Да|Нет|Да|Нет|Да|Нет|  
|Sum и другие функции предварительной сортировки|Нет|Нет|Нет|Нет|Да|Нет|Да|Нет|  
|Агрегаты ReportItem|Нет|Нет|Нет|Нет|Нет|Нет|Нет|Нет|  
|Функции поиска|Да|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Нет|Нет|  
|Агрегатная функция|Нет|Нет|Нет|Нет|Нет|Нет|Нет|Нет|  
  
-   **Примечание 1.** Использование агрегатных функций разрешено только внутри выражения *Source* функции Lookup, если функция Lookup не содержится в агрегате. Использование агрегатных функций не разрешено внутри выражений *Destination* или *Result* функции поиска.  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="CalculatingRunningValues"></a> Вычисление текущих значений  
 Следующие встроенные функции вычисляют текущие значения для набора данных. Функция**RowNumber** подобна функции **RunningValue** тем, что возвращает текущее значение счетчика, которое увеличивается для каждой строки внутри содержащей области. В этих функциях параметр области должен задавать вмещающую область, которая управляет обнулением счетчика.  
  
|**Функция**|**Description**|  
|------------------|---------------------|  
|[RowNumber](../../reporting-services/report-design/rownumber-function-report-builder-and-ssrs.md)|Возвращает текущее количество строк в указанной области. Функция **RowNumber** начинает счет с 1, а не с 0.|  
|[RunningValue](../../reporting-services/report-design/runningvalue-function-report-builder-and-ssrs.md)|Возвращает текущий агрегат всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="RetrievingRowCounts"></a> Получение числа строк  
 Следующая встроенная функция вычисляет количество строк в данной области. Используйте эту функцию для подсчета всех строк, включая строки, содержащие значение NULL.  
  
|**Функция**|**Description**|  
|------------------|---------------------|  
|[CountRows](../../reporting-services/report-design/countrows-function-report-builder-and-ssrs.md)|Возвращает число строк в указанной области, включая строки со значениями NULL.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="LookupFunctions"></a> Уточняющий запрос значений из другого набора данных  
 Следующие функции поиска извлекают значения из указанного набора данных.  
  
|**Функция**|**Description**|  
|------------------|---------------------|  
|[Функция Lookup](../../reporting-services/report-design/lookup-function-report-builder-and-ssrs.md)|Возвращает значение определенного выражения из набора данных.|  
|[Функция LookupSet](../../reporting-services/report-design/lookupset-function-report-builder-and-ssrs.md)|Возвращает набор значений указанного выражения из набора данных.|  
|[Функция Multilookup](../../reporting-services/report-design/multilookup-function-report-builder-and-ssrs.md)|Возвращает первые подходящие значения для набора имен из набора данных, содержащего пары «имя-значение».|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="RetrievingPostsortValues"></a> Получение основанных на сортировке значений  
 Следующие встроенные функции возвращают первое, последнее или предыдущее значения внутри заданной области. Эти функции зависят от порядка сортировки значений данных. С помощью этих функций можно, например, найти последнее и первое значения на странице, чтобы создать заголовок в стиле словаря. Используйте функцию **Previous** , чтобы сравнить значение в одной строке со значением в предыдущей строке конкретной области, например чтобы найти значение годового процента в таблице.  
  
|**Функция**|**Description**|  
|------------------|---------------------|  
|[Первая](../../reporting-services/report-design/first-function-report-builder-and-ssrs.md)|Возвращает первое значение указанного выражения для заданной области.|  
|[Последняя](../../reporting-services/report-design/last-function-report-builder-and-ssrs.md)|Возвращает последнее значение указанного выражения для заданной области.|  
|[Previous](../../reporting-services/report-design/previous-function-report-builder-and-ssrs.md)|Возвращает значение или значение статистического выражения для предыдущего экземпляра элемента внутри заданной области.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="RetrievingServerAggregates"></a> Получение серверных агрегатов  
 Следующая встроенная функция получает пользовательские агрегаты из поставщика данных. Например, при использовании источника данных типа служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] можно получить агрегаты, вычисляемые на сервере источника данных и используемые в заголовке группы.  
  
|**Функция**|**Description**|  
|------------------|---------------------|  
|[Статистическое](../../reporting-services/report-design/aggregate-function-report-builder-and-ssrs.md)|Возвращает пользовательские статистические данные заданного выражения в соответствии с определением поставщика данных.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="TestingforScope"></a> Тестирование области  
 Следующая встроенная функция тестирует текущий контекст элемента отчета, чтобы увидеть, является ли он элементом определенной области.  
  
|Функция|Description|  
|--------------|-----------------|  
|[InScope](../../reporting-services/report-design/inscope-function-report-builder-and-ssrs.md)|Указывает, входит ли текущий экземпляр элемента в пределы указанной области действия.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
##  <a name="RetrievingRecursiveLevel"></a> Получение уровня рекурсии  
 Следующая встроенная функция получает текущий уровень при обработке рекурсивной иерархии. Чтобы управлять уровнем отступа визуальной иерархии для рекурсивной группы, используйте результат этой функции вместе со свойством **Padding** в текстовом поле. Дополнительные сведения см. в разделе [Создание групп рекурсивной иерархии (построитель отчетов и службы SSRS)](../../reporting-services/report-design/creating-recursive-hierarchy-groups-report-builder-and-ssrs.md).  
  
|Функция|Description|  
|--------------|-----------------|  
|[Level](../../reporting-services/report-design/level-function-report-builder-and-ssrs.md)|Возвращает текущий уровень глубины в рекурсивной иерархии.|  
  
 ![Значок стрелки, используемый со ссылкой «В начало»](../../analysis-services/instances/media/uparrow16x16.png "Значок стрелки, используемый со ссылкой «В начало»")В начало  
  
## См. также  
 [Использование выражений в отчетах (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression-uses-in-reports-report-builder-and-ssrs.md)   
 [Примеры выражений (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression-examples-report-builder-and-ssrs.md)   
 [Область выражения для суммирования, агрегатных функций и встроенных коллекций (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression scope for totals, aggregates, and built-in collections.md)  
  
  