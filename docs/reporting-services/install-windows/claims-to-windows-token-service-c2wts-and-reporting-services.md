---
title: "Служба claims to Windows Token Service (c2WTS) и службы Reporting Services | Документы Microsoft"
ms.custom: 
ms.date: 06/12/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- reporting-services-sharepoint
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- c2wts.exe.config
- SharePoint mode
- C2WTS
- WSS_WPG
ms.assetid: 4d380509-deed-4b4b-a9c1-a9134cc40641
caps.latest.revision: 17
author: guyinacube
ms.author: asaxton
manager: erikre
ms.translationtype: HT
ms.sourcegitcommit: 0eb007a5207ceb0b023952d5d9ef6d95986092ac
ms.openlocfilehash: 2ab5f4b5d2774d9dc944ad17bb55063388b70a6d
ms.contentlocale: ru-ru
ms.lasthandoff: 08/09/2017

---
# <a name="claims-to-windows-token-service-c2wts-and-reporting-services"></a>Служба Claims to Windows Token Service (c2WTS) и службы Reporting Services

[!INCLUDE[ssrs-appliesto-sql2016-xpreview](../../includes/ssrs-appliesto-sql2016-xpreview.md)] [!INCLUDE[ssrs-appliesto-sharepoint-2013-2016i](../../includes/ssrs-appliesto-sharepoint-2013-2016.md)]

  Служба SharePoint Claims to Windows Token Service (c2WTS) требуется для режима SharePoint [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] в случае, если необходимо использовать проверку подлинности Windows для источников данных, которые находятся за пределами фермы SharePoint. Она также требуется, когда пользователь получает доступ к источникам данных с помощью проверки подлинности Windows, так как для связи между интерфейсным веб-сервером и общей службой [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] всегда используется аутентификация на основе утверждений.  
  
 Служба c2WTS необходима, даже если источники данных находятся на одном компьютере с общей службой. Однако в этом случае ограниченное делегирование не требуется.  
  
 Токены, созданные службой c2WTS, работают только при наличии ограниченного делегирования (ограничение набором определенных служб) и заданном параметре "Использовать любой протокол проверки подлинности". Как уже отмечалось, если источники данных находятся на одном компьютере с общей службой, ограниченное делегирование не требуется.  
  
 Если в среде используется делегирование, ограниченное Kerberos, то внешние источники данных и служба SharePoint Server должны находиться в одном домене Windows. Любая служба, использующая службу токенов Claims to Windows Service (c2WTS), должна применять делегирование, **ограниченное** Kerberos, чтобы разрешить c2WTS использовать передачу протокола Kerberos для перевода утверждений в учетные данные Windows. Эти требования являются достоверными для всех общих служб SharePoint. Дополнительные сведения см. в разделе [Планирование проверки подлинности Kerberos в SharePoint 2013](http://technet.microsoft.com/library/ee806870.aspx).  
  
 Эта процедура описана в данном разделе.

## <a name="prerequisites"></a>Предварительные требования

> [!NOTE]
>  Примечание. Некоторые шаги настройки могут отличаться или могут не работать в определенных топологиях фермы. Например, установка одиночного сервера не поддерживает службы c2WTS Windows Identity Foundation, поэтому в этой конфигурации фермы требования сценариев делегирования токенов Windows невозможны.

> [!IMPORTANT]
> При использовании Power View для работы с книгами Power Pivot необходимо выполнить дополнительные настройки, перечисленные в разделе [Обзор Office Online Server](https://technet.microsoft.com/library/jj219437\(v=office.16\).aspx). Дополнительные сведения см. в следующих технических документах. 
>
> - [Развертывание SQL Server 2016 PowerPivot и Power View в SharePoint 2016](../../analysis-services/instances/install-windows/deploying-sql-server-2016-powerpivot-and-power-view-in-sharepoint-2016.md)
> 
> - [Deploying SQL Server 2016 PowerPivot and Power View in a Multi-Tier SharePoint 2016 Farm (Развертывание SQL Server 2016 PowerPivot и Power View в многоуровневой ферме SharePoint 2016)](../../analysis-services/instances/install-windows/deploy-powerpivot-and-power-view-multi-tier-sharepoint-2016-farm.md)
  
### <a name="basic-steps-needed-to-configure-c2wts"></a>Основные шаги для настройки службы c2WTS  
  
1.  Настройка учетной записи службы c2WTS. Добавьте учетную запись службы к группе локальных администраторов на каждом сервере приложений с c2WTS. Кроме того, убедитесь, что учетная запись имеет следующие права локальной политики безопасности:  
  
    -   работа в качества части операционной системы;  
  
    -   олицетворение клиента после проверки подлинности;  
  
    -   Вход в систему в качестве службы.  
  
2.  Настройка делегирования для учетной записи службы c2WTS. Для учетной записи необходимо настроить ограниченное делегирование со сменой протоколов. Кроме того, ей требуются разрешения на делегирование для служб, с которыми она будет обмениваться данными (например, ядро SQL Server, службы SQL Server Analysis Services). Для настройки делегирования можно использовать оснастку "Active Directory — пользователи и компьютеры".  

    > [!IMPORTANT]
    > Любые параметры, настраиваемые для учетной записи службы C2WTS на вкладке делегирования, должны соответствовать учетной записи службы Reporting Services. Например, если разрешить учетной записи службы C2WTS делегировать полномочия службе SQL Service, потребуется выполнить то же самое с учетной записью службы Reporting Services.
  
    1.  Щелкните правой кнопкой мыши каждую учетную запись службы и откройте диалоговое окно свойств. В диалоговом окне перейдите на вкладку **Делегирование** .  
  
        > [!NOTE]  
        >  Примечание. Вкладка делегирования отображается, только если объекту назначено имя участника-службы (SPN). Службе c2WTS не требуется имя участника-службы для учетной записи службы c2WTS, однако без имени участника службы вкладка **Делегирование** отображаться не будет. Другой способ настройки ограниченного делегирования заключается в использовании специальной программы, например **ADSIEdit**.  
  
    2.  Основными параметрами, приведенными на вкладке делегирования, являются следующие:  
  
        -   Установка параметра «Доверять этому пользователю делегирование только определенных служб»  
  
        -   Установка параметра «Использовать любой протокол проверки подлинности»  

    3. Выберите **Добавить** , чтобы добавить службу, которая является адресатом делегирования.
    
    4. Выберите **пользователи или компьютеры...** * и введите учетную запись, на котором размещена служба. Например, если SQL Server выполняется под учетной записью с именем *sqlservice*, введите `sqlservice`.
    
    5. Выберите список служб. Отобразятся имена участников-служб, которые доступны в этой учетной записи. Если вы не видите в списке службу для соответствующей учетной записи, возможно, она отсутствует или размещена в другой учетной записи. Для настройки имен SPN можно использовать служебную программу SetSPN.
    
    6. Нажмите кнопку ОК, чтобы закрыть все диалоговые окна.
  
3.  Настройка параметра AllowedCallers службы c2WTS.  
  
     Для службы c2WTS требуется, чтобы идентификаторы вызывающих были явно перечислены в файле конфигурации **c2WTShost.exe.config**. Служба c2WTS принимает запросы от всех пользователей системы, прошедших аутентификацию, только если она настроена на это. В этом случае вызывающим является группа Windows WSS_WPG. Файл c2WTShost.exe.confi хранится в следующем расположении:  
     
     > [!NOTE]
     > Изменение учетной записи службы в центре администрирования SharePoint (для службы C2WTS) добавит эту учетную запись в группу WSS_WPG.
  
     **\Program Files\Windows Identity Foundation\v3.5\c2WTShost.exe.config**  
  
     В следующем примере показан файл конфигурации:  
  
    ```  
    <configuration>  
      <windowsTokenService>  
        <!--  
            By default no callers are allowed to use the Windows Identity Foundation Claims To NT Token Service.  
            Add the identities you wish to allow below.  
          -->  
        <allowedCallers>  
          <clear/>  
          <add value="WSS_WPG" />  
        </allowedCallers>  
      </windowsTokenService>  
    </configuration>  
    ```    
4.  Запуск службы SharePoint C2WTS. Запустите службу C2WTS из центра администрирования SharePoint на странице **Управление службами на сервере** . Служба должна быть запущена на сервере, который будет выполнять действие. Например, при наличии сервера, который является интерфейсным веб-сервером, и другого сервера, который служит сервером приложений, где работает общая служба служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] , службу c2WTS необходимо запустить только на сервере приложений. Служба c2WTS не требуется на интерфейсном веб-сервере.

## <a name="next-steps"></a>Следующие шаги

[Общие сведения о службе Claims to Windows Token (c2WTS)](http://msdn.microsoft.com/library/ee517278.aspx)   
[Планирование проверки подлинности Kerberos в SharePoint 2013](http://technet.microsoft.com/library/ee806870.aspx)  

Дополнительные вопросы? [Попробуйте задать вопрос на форуме служб Reporting Services](http://go.microsoft.com/fwlink/?LinkId=620231)
