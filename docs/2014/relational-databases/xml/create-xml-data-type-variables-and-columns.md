---
title: Создание переменных и столбцов типа данных XML | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- xml data type [SQL Server], variables
- xml data type [SQL Server], columns
ms.assetid: 8994ab6e-5519-4ba2-97a1-fac8af6f72db
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.openlocfilehash: 27f4458299fd82a1afe74122edba3cbf886d9425
ms.sourcegitcommit: 3da2edf82763852cff6772a1a282ace3034b4936
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2018
ms.locfileid: "48114104"
---
# <a name="create-xml-data-type-variables-and-columns"></a>Создание переменных и столбцов типа данных XML
  Тип данных `xml` — это встроенный в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] тип данных, несколько напоминающий другие встроенные типы данных, такие как `int` и `varchar`. Как и другие встроенные типы, можно использовать `xml` типа данных как тип столбца при создании таблицы как тип переменной, типа параметра, тип возвращаемого функцией значения, а также в [CAST и CONVERT](/sql/t-sql/functions/cast-and-convert-transact-sql).  
  
## <a name="creating-columns-and-variables"></a>Создание столбцов и переменных  
 Чтобы создать в таблице столбец типа `xml` , воспользуйтесь инструкцией `CREATE TABLE` , приведенной в следующем примере:  
  
```  
CREATE TABLE T1(Col1 int primary key, Col2 xml)   
```  
  
 Функция `DECLARE statement` , приведенная в следующем примере, позволяет создать переменную типа `xml` .  
  
```  
DECLARE @x xml   
```  
  
 Создайте типизированную переменную `xml` , указав коллекцию XML-схем, как показано в следующем примере.  
  
```  
DECLARE @x xml (Sales.StoreSurveySchemaCollection)  
```  
  
 Чтобы передать параметр типа `xml` хранимой процедуре, воспользуйтесь инструкцией `CREATE PROCEDURE` , как показано в следующем примере.  
  
```  
CREATE PROCEDURE SampleProc(@XmlDoc xml) AS ...   
```  
  
 Чтобы выполнять запросы к экземплярам XML, хранимым в столбцах, параметрах и переменных, можно использовать XQuery. Чтобы обновлять экземпляры XML, также можно использовать язык XML DML. Поскольку стандарт XQuery на момент разработки не определял язык XQuery DML, в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] были введены расширения [языка XML DML](/sql/t-sql/xml/xml-data-modification-language-xml-dml) к XQuery. Эти расширения позволяют выполнять операции вставки, обновления и удаления.  
  
## <a name="assigning-defaults"></a>Назначение значений по умолчанию  
 В таблице столбцу типа `xml` можно назначить экземпляр XML по умолчанию. Экземпляр XML по умолчанию можно указать двумя способами: при помощи константы XML или явного приведения к типу `xml`.  
  
 Чтобы указать в качестве экземпляра XML по умолчанию константу XML, воспользуйтесь синтаксической конструкцией из следующего примера. Обратите внимание, что строка неявно ПРИВЕДЕНА к `xml` типа.  
  
```  
CREATE TABLE T (XmlColumn xml default N'<element1/><element2/>')  
```  
  
 Чтобы указать экземпляр XML по умолчанию посредством явного преобразования `CAST` в тип `xml`, воспользуйтесь синтаксической конструкцией из следующего примера.  
  
```  
CREATE TABLE T (XmlColumn xml   
                  default CAST(N'<element1/><element2/>' AS xml))  
```  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает ограничения NULL и NOT NULL для столбцов типа `xml`. Пример:  
  
```  
CREATE TABLE T (XmlColumn xml NOT NULL)  
```  
  
## <a name="specifying-constraints"></a>Указание ограничений  
 При создании столбцов типа `xml` можно устанавливать ограничения уровня столбца или уровня таблицы. Используйте ограничения в следующих ситуациях.  
  
-   Бизнес-правила не могут быть выражены в XML-схемах. Допустим, что адреса доставки заказов магазином цветов должны находиться не далее 90 километров от магазина. Это требование можно выразить в форме ограничения XML-столбца. Эти ограничения могут содержать методы для обработки данных типа `xml`.  
  
-   В ограничении фигурируют другие столбцы таблицы, имеющие тип XML или другой тип. В качестве примера можно привести требование, согласно которому идентификатор заказчика (`/Customer/@CustId`), хранимый в экземпляре XML, должен соответствовать значению из реляционного столбца CustomerID.  
  
 Ограничения можно указать для типизированных и нетипизированных столбцов `xml`. Однако использование [методов типа данных xml](/sql/t-sql/xml/xml-data-type-methods) при указании ограничений невозможно. Кроме того, обратите внимание, что тип данных `xml` не поддерживает следующие ограничения столбцов и таблиц:  
  
-   PRIMARY KEY и FOREIGN KEY  
  
-   UNIQUE  
  
-   COLLATE  
  
     XML использует свою собственную кодировку. Параметры сортировки применимы только к строковым типам. Тип данных `xml` к таковым не относится. Однако у него есть строковое представление, и его можно приводить к строковым типам данных и обратно.  
  
-   RULE  
  
 Альтернативой использованию ограничений — создать оболочку, то есть определяемую пользователем функцию для создания оболочки `xml` метода типа данных и указать определяемую пользователем функцию в проверочном ограничении, как показано в следующем примере.  
  
 В этом примере ограничение на столбец `Col2` указывает, что каждый хранимый в этом столбце экземпляр XML должен иметь элемент `<ProductDescription>` , содержащий атрибут `ProductID` . Это ограничение принудительно применяется с помощью пользовательской функции:  
  
```  
CREATE FUNCTION my_udf(@var xml) returns bit  
AS BEGIN   
RETURN @var.exist('/ProductDescription/@ProductID')  
END  
GO  
```  
  
 Обратите внимание, что метод `exist()` типа данных `xml` возвращает значение `1` , если элемент `<ProductDescription>` в экземпляре содержит атрибут `ProductID` . В противном случае возвращается значение `0`.  
  
 Теперь возможно создание таблицы с ограничениями на уровне столбцов, как показано ниже:  
  
```  
CREATE TABLE T (  
    Col1 int primary key,   
    Col2 xml check(dbo.my_udf(Col2)=1))  
GO  
```  
  
 Эта операция вставки выполняется успешно:  
  
```  
INSERT INTO T values(1,'<ProductDescription ProductID="1" />')  
```  
  
 Из-за ограничения следующая операция вставки не будет выполнена:  
  
```  
INSERT INTO T values(1,'<Product />')  
```  
  
## <a name="same-or-different-table"></a>Та же таблица или другая  
 `xml` Столбце с типом данных могут создаваться в таблице, содержащей другие реляционные столбцы, или в таблице, связанной посредством внешнего ключа с главной таблицей.  
  
 Создание `xml` столбец типа данных в той же таблице, если выполняется одно из следующих условий:  
  
-   Приложение извлекает данные из XML-столбца и не нуждается в том, чтобы для него был создан XML-индекс.  
  
-   Для столбца типа `xml` требуется создание XML-индекса, причем первичный ключ главной таблицы идентичен ее ключу кластеризации. Дополнительные сведения см в разделе [XML-индексы (SQL Server)](xml-indexes-sql-server.md).  
  
 Создание `xml` столбец типа данных в отдельной таблице, если выполняются следующие условия:  
  
-   Вы хотите создать XML-индекса `xml` столбец типа данных, но первичный ключ главной таблицы отличается от ее ключа кластеризации, главная таблица не имеет первичного ключа или главная таблица является кучей (нет ключа кластеризации). Это может иметь место, если главная таблица уже существует.  
  
-   Не требуется замедлять просмотр таблицы из-за наличия в ней XML-столбца. Он занимает место независимо от того, хранится ли он в строке или вне строки.  
  
  
