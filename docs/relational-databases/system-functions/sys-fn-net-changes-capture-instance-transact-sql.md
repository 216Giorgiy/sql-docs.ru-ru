---
title: "sys.fn_net_changes_&lt;capture_instance&gt; (Transact-SQL) | Документы Microsoft"
ms.custom: 
ms.date: 03/14/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine
ms.service: 
ms.component: system-functions
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
applies_to: SQL Server (starting with 2008)
f1_keywords:
- sys.fn_net_changes_TSQL
- fn_net_changes_TSQL
- fn_net_changes
- sys.fn_net_changes
dev_langs: TSQL
helpviewer_keywords:
- fn_net_changes_<capture_instance>
- sys.fn_net_changes_<capture_instance>
ms.assetid: 342fa030-9fd9-4b74-ae4d-49f6038a5073
caps.latest.revision: "16"
author: BYHAM
ms.author: rickbyh
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 9b2ffff0a485b6014a41a1a2bf783155df35974a
ms.sourcegitcommit: 66bef6981f613b454db465e190b489031c4fb8d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2017
---
# <a name="sysfnnetchangesltcaptureinstancegt-transact-sql"></a>sys.fn_net_changes_&lt;capture_instance&gt; (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  Программы-оболочки для **net изменения** функций запроса. Скрипты, необходимые для создания этих функций, создаются хранимой процедурой sys.sp_cdc_generate_wrapper_function.  
  
||  
|-|  
|**Область применения**: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (с[!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [текущей версии](http://go.microsoft.com/fwlink/p/?LinkId=299658)).|  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
fn_net_changes_<capture_instance> ('start_time', 'end_time', '<row_filter_option>' )  
  
<capture_instance> ::= The name of the capture instance.  
<row_filter_option> ::=  
{ all  
  | all with mask  
  | all with merge  
}  
```  
  
## <a name="arguments"></a>Аргументы  
 *start_time*  
 **Datetime** значение, представляющее нижнюю конечную точку диапазона записей таблицы изменений, включаемых в результирующий набор.  
  
 Только те таблицы, для которых соответствующее время фиксации строго больше изменений строк в cdc. < capture_instance > _CT *start_time* включаются в результирующий набор.  
  
 Если для этого аргумента задано значение NULL, нижняя конечная точка диапазона запроса будет соответствовать нижней конечной точке допустимого диапазона для экземпляра системы отслеживания.  
  
 *end_time*  
 **Datetime** значение, представляющее верхнюю конечную точку диапазона записей таблицы изменений, включаемых в результирующий набор.  
  
 Этот параметр может принимать одно из двух возможных значений, в зависимости от значения, выбранного для @closed_high_end_point при вызове sys.sp_cdc_generate_wrapper_function для формирования скрипта создания функции-оболочки:  
  
-   @closed_high_end_point = 1  
  
     Только для строк в cdc. < capture_instance > _CT изменить таблицу, имеющую значение в \_ \_$start_lsn и соответствующее фиксации которых меньше или равно времени **start_time** включаются в результирующий набор.  
  
-   @closed_high_end_point = 0  
  
     Только для строк в cdc. < capture_instance > _CT изменить таблицу, имеющую значение в \_ \_$start_lsn и соответствующее время фиксации которых меньше, чем **start_time** включаются в результирующий набор.  
  
 Если для этого аргумента задано значение NULL, верхняя конечная точка диапазона запроса будет соответствовать верхней конечной точке допустимого диапазона для экземпляра системы отслеживания.  
  
 *< row_filter_option >* :: = {все | все с маской | все со слиянием}  
 Параметр, управляющий содержимым столбцов метаданных, а также строк, возвращаемых в результирующем наборе. Может быть одним из следующих:  
  
 all  
 Возвращает окончательное содержимое измененной строки в столбцах содержимого и операцию, необходимую, чтобы применить строку в столбце метаданных __CDC_OPERATION.  
  
 all with mask  
 Возвращает окончательное содержимое всех измененных строк в столбцах содержимого и операцию, необходимую, чтобы применить каждую строку в столбце метаданных __CDC_OPERATION. Если при формировании скрипта для создания функции-оболочки был указан флаг обновления, этот параметр необходим для заполнения маски обновления.  
  
 all with merge  
 Возвращает окончательное содержимое всех измененных строк в столбцах содержимого.  
  
 Столбец __CDC_OPERATION будет иметь одно из двух следующих значений.  
  
-   D, если строка должна быть удалена.  
  
-   M, если строка должна быть вставлена или обновлена.  
  
 Логика, которая определяет операцию, которую необходимо применить к конечному изменению, повышает сложность запроса. Данный параметр позволяет повысить производительность в тех случаях, когда различие между операциями вставки и обновления не требуется. Этот подход особенно полезен в тех целевых средах, где операция слияния доступна непосредственно, например, в среде [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
## <a name="table-returned"></a>Возвращаемая таблица  
  
|Имя столбца|Тип столбца|Description|  
|-----------------|-----------------|-----------------|  
|\<столбцы из @column_list>|**зависит от**|Столбцы, которые определены в **column_list** функции sp_cdc_generate_wrapper_function при ее вызове для формирования скрипта создания оболочки. Если *column_list* имеет значение NULL, будут отображаться все отслеживаемые исходные столбцы в результирующем наборе.|  
|__CDC_OPERATION|**nvarchar(2)**|Код операции, указывающий операцию, необходимую для применения строки к целевой среде. Операция будет отличаться в зависимости от значения аргумента *row_filter_option* , предоставленные в следующий вызов:<br /><br /> *row_filter_option* = 'all', 'all with mask'<br /><br /> «D» — операция удаления<br /><br /> «I» — операция вставки<br /><br /> 'UN' — операция обновления<br /><br /> *row_filter_option* = «all with merge'<br /><br /> «D» — операция удаления<br /><br /> 'M' — операция вставки либо обновления|  
|\<столбцы из @update_flag_list>|**bit**|Битовый флаг, имя которого образуется добавлением _uflag к имени столбца. Флаг получает от ненулевое значение только если *row_filter_option* **= «all with mask»** и \__CDC_OPERATION **= 'UN'**. Если соответствующий столбец изменялся в окне запроса, флагу присваивается значение 1. В противном случае флагу присваивается значение 0.|  
  
## <a name="remarks"></a>Замечания  
 Функция fn_net_changes_<capture_instance> выступает в качестве оболочки для функции запроса cdc.fn_cdc_get_net_changes_<capture_instance>. Для формирования скрипта, создающего оболочку, используется хранимая процедура sys.sp_cdc_generate_wrapper.  
  
 Функции-оболочки не создаются автоматически. Чтобы создать функции-оболочки, нужно выполнить две операции:  
  
1.  запустить хранимую процедуру, чтобы сформировать создающий оболочку скрипт;  
  
2.  выполнить скрипт, чтобы создать функцию-оболочку.  
  
 Функции-оболочки дают пользователям возможность систематически запрашивать изменения, произошедшие в течение интервала, окруженных **datetime** значения вместо значений LSN. Функции-оболочки выполняют все необходимые преобразования между переданными **datetime** значениями и значениями номеров LSN, необходимое внутренним образом в качестве аргументов для функций запроса. Если функции-оболочки используются последовательно для обработки потока информации об изменениях, данные не потеряются и не будут повторяться, если выполняется следующее условие: значение @end_time интервала, соответствующего одному вызову, передается как значение @start_time для последующего вызова.  
  
 Используя параметр @closed_high_end_point при создании скрипта, можно формировать оболочки для поддержки закрытой или открытой верхней границы в заданном окне запроса. Таким образом, можно решить, включаются ли в интервал записи, для которых время фиксации совпадает с верхней границей интервала извлекаемых данных. По умолчанию верхняя граница включается в интервал.  
  
 Результирующий набор, возвращаемый процедурой **net изменения** оболочки функция возвращает только те отслеживаемые столбцы, которые были в @column_list при формировании оболочки. Если аргумент @column_list имеет значение NULL, возвращаются все отслеживаемые исходные столбцы. За исходными столбцами следует столбец операции __CDC_OPERATION, который содержит 1 или 2 символа, определяющих операцию.  
  
 Битовые флаги, затем добавляются в результирующий набор для каждого столбца, указанного в параметре @update_flag_list. Для **net изменения** оболочки, бит флаги всегда иметь значение NULL, если @row_filter_option именно в вызов функции-оболочки используется 'all' или «all with merge». Если @row_filter_option имеет значение «all with маску» и __CDC_OPERATION равно d ' или 'I', значение флага также будет иметь значение NULL. Если \__CDC_OPERATION является 'UN', флаг задается значение 1 или 0, в зависимости от того, следует ли **net** изменен столбец в результате операции обновления.  
  
 Шаблон конфигурации «Instantiate CDC Wrapper TVFs for Schema» для системы отслеживания измененных данных показывает, как использовать хранимую процедуру sp_cdc_generate_wrapper_function, чтобы получить скрипты CREATE для всех функций-оболочек для функций запросов, определенных в схеме. Затем шаблон создает эти скрипты. Дополнительные сведения о шаблонах см. в разделе [обозреватель шаблонов](http://msdn.microsoft.com/library/b9ee55c5-bb44-4f76-90ac-792d8d83b4c8).  
  
## <a name="see-also"></a>См. также:  
 [sys.sp_cdc_generate_wrapper_function &#40; Transact-SQL &#41;](../../relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql.md)   
 [CDC.fn_cdc_get_net_changes_ &#60; capture_instance &#62; &#40; Transact-SQL &#41;](../../relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql.md)  
  
  
