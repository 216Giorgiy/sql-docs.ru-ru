---
title: "Развертывание базы данных SQL Server на виртуальной машине Microsoft Azure | Документация Майкрософт"
ms.date: 07/29/2016
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords:
- sql13.swb.deploymentwizard.deploymentsettings.f1
- sql13.swb.deploymentwizard.sourcesettings.f1
- sql13.swb.deploymentwizard.summary.f1
- sql13.swb.agdashboard.agp9virtualnw.issues.f1
- sql13.swb.deploymentwizard.f1
- sql13.swb.deploymentwizard.progress.f1
- sql13.swb.usevmdialog.f1
- sql13.swb.newvmdialog.f1
- sql13.swb.sqlvmdialog.f1
- sql13.swb.deploymentwizard.results.f1
- sql13.swb.deploymentwizard.azuresignin.f1
helpviewer_keywords:
- Deploy a database
- Deploy to Azure VM
- Migrate to Azure
- Windows Azure virtual machine
- Migrate to Azure VM
- Migrate to the cloud
- SQL Server Management Studio
- SSMS
- Deploy database wizard
- Deploy a SQL Server database to Azure
- Azure VM
ms.assetid: 5e82e66a-262e-4d4f-aa89-39cb62696d06
caps.latest.revision: 30
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.translationtype: HT
ms.sourcegitcommit: f3481fcc2bb74eaf93182e6cc58f5a06666e10f4
ms.openlocfilehash: 2aca87c0050dd501c73bb4da8953a93bf40c0c8e
ms.contentlocale: ru-ru
ms.lasthandoff: 07/31/2017

---
# <a name="deploy-a-sql-server-database-to-a-microsoft-azure-virtual-machine"></a>Развертывание базы данных SQL Server в виртуальной машине Microsoft Azure
  Используйте мастер **развертывания базы данных на виртуальной машине Windows Azure** для развертывания базы данных из экземпляра [!INCLUDE[ssDE](../../includes/ssde-md.md)] на [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в виртуальной машине (ВМ) Microsoft Azure. Мастер использует операцию полного резервного копирования базы данных, поэтому он всегда копирует всю схему базы данных и данные из пользовательской базы данных SQL Server. Мастер также выполняет всю настройку ВМ Azure, поэтому дополнительные действия для задания параметров ВМ не требуются.  
  
 Мастер нельзя использовать для создания разностных резервных копий. Он не перезаписывает существующую базу данных с таким же именем. Чтобы заменить существующую базу данных на ВМ, сначала необходимо удалить существующую базу данных или изменить имя базы данных. В случае возникновения конфликта имен между базой данных, в отношении которой выполняется операция развертывания на лету, и существующей базой данных на виртуальной машине мастер предложит имя базы данных с добавлением определенных символов для развертываемой на лету базы данных, чтобы можно было завершить операцию.  
  
-   [Перед началом](#before_you_begin)  
  
-   [Ограничения](#limitations)  
  
-   [Основные моменты при развертывании базы данных с поддержкой FILESTREAM](#filestream)  
  
-   [Вопросы территориального распределения активов](#geography)  
  
-   [Параметры конфигурации мастера](#configuration_settings)  
  
-   [Необходимые разрешения](#permissions)  
  
-   [Запуск мастера](#launch_wizard)  
  
-   [Страницы мастера](#wizard_pages)  
  
> [!NOTE]  
>  Подробное пошаговое руководство по использованию мастера см. в статье [Migrate a SQL Server database to SQL Server in an Azure VM](https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-migrate-onpremises-database/)(Перенос базы данных SQL Server в SQL Server в виртуальной машине Azure).  
  
##  <a name="before_you_begin"></a> Перед началом  
 Чтобы завершить этот мастер, необходима возможность предоставить следующие сведения и назначить следующие параметры конфигурации:  
  
-   Данные учетной записи Microsoft, связанной с подпиской Windows Azure.  
  
-   Ваш профиль публикации Windows Azure.  
  
    > [!CAUTION]  
    >  SQL Server в настоящий момент поддерживает версию 2.0 профиля публикации. Для загрузки поддерживаемой версии профиля публикации см. раздел [Загрузка профиля публикации 2.0](http://go.microsoft.com/fwlink/?LinkId=396421).  
  
-   Сертификат управления, загруженный в подписку Microsoft Azure.  Создайте сертификат управления с помощью командлета Powershell [New-SelfSignedCertificate](https://technet.microsoft.com/library/hh848633(v=wps.630)).  Затем загрузите сертификат в свою подписку Microsoft Azure.  Дополнительные сведения о загрузке сертификата управления см. в разделе [Upload an Azure Management API Management Certificate](https://azure.microsoft.com/en-us/documentation/articles/azure-api-management-certs/)(Загрузка сертификата управления для API управления Azure).  Пример синтаксиса для создания сертификата управления из раздела [Certificates overview for Azure Cloud Services](https://azure.microsoft.com/en-us/documentation/articles/cloud-services-certs-create/)(Обзор сертификатов для облачных служб Azure): 

    ```powershell  
    $cert = New-SelfSignedCertificate -DnsName yourdomain.cloudapp.net -CertStoreLocation "cert:\LocalMachine\My"
    $password = ConvertTo-SecureString -String "your-password" -Force -AsPlainText
    Export-PfxCertificate -Cert $cert -FilePath ".\my-cert-file.pfx" -Password $password
    ```    

    > [!NOTE]  
    > Для создания сертификата управления также можно использовать средство MakeCert, однако сейчас оно является нерекомендуемым.  Дополнительные сведения см. в разделе [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968).
   
  -   Сертификат управления, сохраненный в хранилище личных сертификатов на компьютере, где запущен мастер.  
  
-   Необходимо временное место хранения, доступное для компьютера, на котором размещается база данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Временное место хранения также должно быть доступным для компьютера, на котором запущен мастер.  
  
-   При развертывании базы данных на существующей виртуальной машине в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должно быть настроено прослушивание порта TCP/IP.  
  
-   Виртуальная машина Microsoft Azure или образ из коллекции, который планируется использовать для создания виртуальных машин, должны иметь настроенный и запущенный [адаптер для облака SQL Server](http://msdn.microsoft.com/library/82ed0d0f-952d-4d49-aa36-3855a3ca9877) .  
  
-   Необходимо настроить открытую конечную точку под [адаптер для облака SQL Server](http://msdn.microsoft.com/library/82ed0d0f-952d-4d49-aa36-3855a3ca9877) в шлюзе Microsoft Azure с частным портом 11435.  
  
 Кроме того, если планируется развернуть базу данных в существующей виртуальной машине Windows Azure, необходимо также предоставить:  
  
-   Имя DNS облачной службы, в которой размещается виртуальная машина.  
  
-   Учетные данные администратора для виртуальной машины.  
  
-   Учетные данные с правами доступа для выполнения оператора резервного копирования базы данных, которую планируется развернуть из исходного экземпляра служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
 Дополнительные сведения о запуске SQL Server в виртуальных машинах Microsoft Azure см. в разделах [Подготовка виртуальной машины SQL Server на портале Azure](https://msdn.microsoft.com/library/dn133141.aspx) и [Миграция базы данных SQL Server в экземпляр SQL Server на виртуальной машине Azure](http://msdn.microsoft.com/library/dn133142.aspx).  
  
 На компьютерах, работающих под управлением операционных систем Windows Server, для запуска мастера необходимо использовать следующие параметры конфигурации.  
  
-   Отключите конфигурацию усиленной безопасности: выберите "Диспетчер серверов" > "Локальный сервер" и задайте для параметра "Конфигурация усиленной безопасности Internet Explorer" значение **ВЫКЛ**.  
  
-   Включите JavaScript: Internet Explorer > Свойства обозревателя > Безопасность > Уровень пользователя > Скрипты > Активные скрипты: **Включить**.  
  
###  <a name="limitations"></a> Ограничения  
Эта функция развертывания предназначена для использования только с учетной записью хранения Azure, созданной с помощью (классической) модели развертывания управления службами. Дополнительные сведения о моделях развертывания Azure см. в статье [Azure Resource Manager и классическое развертывание](https://azure.microsoft.com/en-us/documentation/articles/resource-manager-deployment-model/).

 Размер базы данных для этой операции не может превышать 1 ТБ.  
  
 Эта функция развертывания доступна в среде SQL Server Management Studio для [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] и [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)].  
  
 Эта функция развертывания предназначена для использования только в отношении пользовательских баз данных. Развертывание системных баз данных не поддерживается.  
  
 Функция развертывания не поддерживает размещаемые службы, связанные с группой сходства. Например, учетные записи хранения, связанные с группой сходства, нельзя выбрать для использования на странице мастера **Параметры развертывания** .  
  
 Версии базы данных SQL Server, которые могут быть развернуты на виртуальной машине Windows Azure с помощью этого мастера:  
  
-   SQL Server 2008  
  
-   SQL Server 2008 R2  
  
-   SQL Server 2012  
  
-   [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)]  

- [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
 Версии баз данных SQL Server, работающих на виртуальной машине Windows Azure, могут быть развернуты в следующем:  
  
-   SQL Server 2012  
  
-   [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)]  

- [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]
  
 В случае возникновения конфликта имен между базой данных, в отношении которой выполняется операция развертывания на лету, и существующей базой данных на виртуальной машине мастер предложит имя базы данных с добавлением определенных символов для развертываемой на лету базы данных, чтобы можно было завершить операцию.  
  
###  <a name="filestream"></a> Основные моменты при развертывании базы данных с поддержкой FILESTREAM на виртуальную машину SQL Azure  
 Обратите внимание на следующие правила и ограничения при развертывании баз данных с большими двоичными объектами, хранящихся в объектах FILESTREAM.  
  
-   Функция развертывания не может развернуть базу данных с поддержкой FILESTREAM на новой виртуальной машине. Если функция FILESTREAM отключена в виртуальной машине до запуска мастера, то операция восстановления базы данных завершится ошибкой, а операция мастера не будет завершена успешно. Для успешного развертывания базы данных, в которой используется FILESTREAM, перед запуском мастера включите FILESTREAM в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на виртуальной машине основного приложения. Дополнительные сведения см. в разделе [FILESTREAM (SQL Server)](http://msdn.microsoft.com/library/gg471497.aspx).  
  
-   Если база данных использует функции OLTP в памяти, то можно развернуть базу данных в виртуальной машине Azure без каких-либо изменений в базе данных. Дополнительные сведения см. в разделе [In-Memory OLTP (оптимизация в памяти)](http://msdn.microsoft.com/library/dn133186\(SQL.120\).aspx).  
  
###  <a name="geography"></a> Вопросы территориального распределения активов  
 Обратите внимание, что следующие активы должны находиться в одной и той же географической области.  
  
-   Облачная служба  
  
-   Расположение виртуальной машины  
  
-   Служба хранения диска данных  
  
 Если приведенные выше активы не находятся в одном месте, мастер не сможет завершиться успешно.  
  
###  <a name="configuration_settings"></a> Параметры конфигурации мастера  
 Используйте следующие параметры конфигурации для изменения настроек для развертывания базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на виртуальной машине Azure.  
  
-   **Путь по умолчанию к файлу конфигурации** : "%LOCALAPPDATA%\SQL Server\Deploy to SQL in WA VM\DeploymentSettings.xml".  
  
-   **Структура файла конфигурации**  
  
    -   \<DeploymentSettings>  
  
        -   <OtherSettings  
  
            -   TraceLevel="Debug" \<! — Уровень журналирования -->  
  
            -   BackupPath="\\\\[имя сервера]\\[том]\\" \<! — последний путь, использованный для резервного копирования. Используется в мастере в качестве значения по умолчанию. -->  
  
            -   CleanupDisabled = False /> \<! — мастер не удаляет промежуточные файлы и объекты Windows Azure (ВМ, CS, SA). -->  
  
        -   <PublishProfile \<! — последние использованные сведения профиля публикации. -->  
  
            -   Certificate="12A34B567890123ABCD4EF567A8" \<! — сертификат для использования в мастере. -->  
  
            -   Subscription="1a2b34c5-67d8-90ef-ab12-xxxxxxxxxxxxx" \<! — подписка для использования в мастере. -->  
  
            -   Name= "Моя подписка" \<! — имя подписки. -->  
  
            -   Publisher="" />  
  
    -   \</DeploymentSettings>  
  
 **Значения файла конфигурации**  
  
###  <a name="permissions"></a> Разрешения  
 Развертываемая база данных должна находиться в нормальном состоянии, база данных должна быть доступна для учетной записи пользователя, запустившего мастер, и учетная запись должна иметь разрешения для выполнения операции резервного копирования.  
  
##  <a name="launch_wizard"></a> Использование мастера развертывания базы данных на виртуальной машине Microsoft Azure  
 **Для запуска мастера выполните следующие действия.**  
  
1.  Использование среды SQL Server Management Studio для подключения к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с базой данных, развертывание которой требуется выполнить.  
  
2.  В **обозревателе объектов**разверните имя экземпляра, затем узел **Databases** .  
  
3.  Щелкните правой кнопкой мыши базу данных, которую необходимо развернуть, выберите **Задачи**, затем **Развернуть базу данных в ВМ Microsoft Azure…**  
  
##  <a name="wizard_pages"></a> Страницы мастера  
 Следующие разделы содержат дополнительные сведения о параметрах развертывания и данные конфигурации для этой операции.  
  
-   [Введение](#Introduction)  
  
-   [Параметры источника](#Source_settings)  
  
-   [Вход в Windows Azure](#Azure_sign-in)  
  
-   [Параметры развертывания](#Deployment_settings)  
  
-   [Сводка](#Summary)  
  
-   [Результаты](#Results)  
  
##  <a name="Introduction"></a> Введение 
 На этой странице описан мастер **развертывания базы данных в виртуальной машине Microsoft Azure** .  
  
-   **Больше не показывать эту страницу.**  
  Установите этот флажок, чтобы больше не показывать вводную страницу.  
  
-   **Дальше**  
Переход к странице **Параметры источника** .  
  
-   **Отмена**  
  Отмена операции и закрытие мастера.  
  
-   **Справка**  
Запуск раздела справки MSDN для мастера.  
  
##  <a name="Source_settings"></a> Параметры источника  
 Эта страница используется для соединения с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , где размещена база данных, развертываемая в виртуальной машине Microsoft Azure. Можно также указать временное расположение для файлов, которые будут сохраняться с локального компьютера перед передачей в Microsoft Azure. Это может быть общая сетевая папка.  
 
- **SQL Server**    
Нажмите кнопку **Соединить** , затем укажите сведения о соединении для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , где размещена база данных.  
  
-   **Выбор базы данных**  
Используйте этот раскрывающийся список, чтобы указать базу данных для развертывания.  
  
-   **Другие параметры**  
В этом поле укажите общую папку, которая будет доступна службе виртуальной машины Microsoft Azure.  
  
##  <a name="Azure_sign-in"></a> Вход в Microsoft Azure  
 Войдите в Microsoft Azure, используя учетную запись Майкрософт или учетную запись вашей организации. Учетная запись Майкрософт или организации имеет формат адреса электронной почты, например patc@contoso.com. Дополнительные сведения об учетных данных Azure см. в разделах [Часто задаваемые вопросы об учетной записи Майкрософт для организаций](http://technet.microsoft.com/jj592903) и [Устранение проблем](https://technet.microsoft.com/dn197220).  
  
##  <a name="Deployment_settings"></a> Параметры развертывания
 На этой странице указываются целевой сервер и подробные сведения о новой базе данных.  
  
 **Виртуальная машина Microsoft Azure**  
  
-   **Имя облачной службы**  
Укажите имя службы, которая размещена на виртуальной машине. Чтобы создать новую облачную службу укажите для нее имя.  
  
-   **Имя виртуальной машины** — укажите имя виртуальной машины, на которой будет размещена база данных SQL Server. Для создания новой виртуальной машины Microsoft Azure укажите для нее имя.  
  
-   **Учетная запись хранения**  
Выберите учетную запись хранения в раскрывающемся списке. Для создания новой учетной записи хранения укажите для нее имя. Обратите внимание, что учетные записи хранения, связанные с группой сходства, не будут доступны в раскрывающемся списке.  

-   **Настройки**  
Нажмите кнопку "Параметры", чтобы создать новую виртуальную машину для размещения базы данных SQL Server. Если используется существующая виртуальная машина, предоставленные сведения будут использоваться для проверки подлинности учетных данных.  
  
**Целевая база данных**
  
-   **Имя экземпляра SQL**  
Сведения о соединении с сервером.  
  
-   **Имя базы данных**  
Укажите или подтвердите имя новой базы данных. Если имя базы данных уже существует на целевом экземпляре SQL Server, измените имя базы данных.  
  
##  <a name="Summary"></a> Сводка
 На этой странице можно просмотреть указанные параметры операции. Чтобы выполнить развертывание с заданными параметрами, нажмите кнопку **Готово**. Чтобы отменить операцию развертывания и выйти из мастера, нажмите кнопку **Отмена**.  При нажатии кнопки **Готово** открывается страница **Выполнение развертывания** .  Вы также можете просмотреть ход выполнения в файле журнала, расположенном в `"%LOCALAPPDATA%\SQL Server\Deploy to SQL in WA VM"`.
  
 Возможно, потребуется выполнить вручную шаги для развертывания сведений о базах данных в базе данных SQL Server на виртуальной машине Windows Azure. Эти действия будут подробно описаны.  
  
##  <a name="Results"></a> Результаты 
 На этой странице отображаются сведения об успешности операции развертывания по результатам каждого действия. Для каждого действия, в котором обнаружена ошибка, предусмотрен индикатор в столбце **Результат** . Щелкните эту ссылку, чтобы просмотреть отчет об ошибках, относящихся к данному действию.  
  
 Чтобы завершить работу мастера, нажмите кнопку **Готово** .  
  
## <a name="see-also"></a>См. также:  
 [адаптер для облака SQL Server](http://msdn.microsoft.com/library/82ed0d0f-952d-4d49-aa36-3855a3ca9877)   
 [Управление жизненным циклом базы данных](../../relational-databases/database-lifecycle-management.md)   
 [Экспорт приложения уровня данных](../../relational-databases/data-tier-applications/export-a-data-tier-application.md)   
 [Импорт файла BACPAC для создания новой пользовательской базы данных](../../relational-databases/data-tier-applications/import-a-bacpac-file-to-create-a-new-user-database.md)   
 [Резервное копирование и восстановление баз данных SQL Azure](https://msdn.microsoft.com/library/azure/jj650016.aspx)   
 [Развертывание SQL Server на виртуальных машинах Windows Azure](http://msdn.microsoft.com/library/dn133141.aspx)   
 [Подготовка к переходу на SQL Server на виртуальных машинах Windows Azure](http://msdn.microsoft.com/library/dn133142.aspx)  
  
  

