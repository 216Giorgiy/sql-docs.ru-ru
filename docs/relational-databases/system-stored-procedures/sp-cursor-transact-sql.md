---
title: sp_cursor (Transact-SQL) | Документы Microsoft
ms.custom: ''
ms.date: 03/03/2017
ms.prod: sql
ms.prod_service: database-engine
ms.service: ''
ms.component: system-stored-procedures
ms.reviewer: ''
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: ''
ms.topic: language-reference
f1_keywords:
- sp_cursor_TSQL
- sp_cursor
dev_langs:
- TSQL
helpviewer_keywords:
- sp_cursor
ms.assetid: 41ade0ca-5f11-469d-bd4d-c8302ccd93b3
caps.latest.revision: 10
author: edmacauley
ms.author: edmaca
manager: craigg
ms.openlocfilehash: a6e55691bc045a8de84084498a501983bcc5a11a
ms.sourcegitcommit: 2ddc0bfb3ce2f2b160e3638f1c2c237a898263f4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="spcursor-transact-sql"></a>sp_cursor (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  Запрашивает позиционированные обновления. Эта процедура выполняет операции с одной или несколькими строками в пределах буфера выборки курсора. sp_cursor вызывается указанием ID = 1 в пакете потока табличных данных.  
  
||  
|-|  
|**Применяется к**: SQL Server ([!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] через [текущей версии](http://go.microsoft.com/fwlink/p/?LinkId=299658)).|  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
sp_cursor  cursor, optype, rownum, table  
    [ , value[...n]]]  
```  
  
## <a name="arguments"></a>Аргументы  
 *курсор*  
 Дескриптор курсора. *курсор* является обязательным параметром, который вызывает для **int** входного значения. *курсор* — *обработки* значение, сформированное SQL Server и возвращаемый процедурой sp_cursoropen.  
  
 *optype*  
 Обязательный параметр, назначающий операцию, которую будет выполнять курсор. *optype* требуется один из следующих **int** входных значений.  
  
|Значение|Название|Описание|  
|-----------|----------|-----------------|  
|0X0001|UPDATE|Используется для обновления одной или более строк в буфере выборки.  К строкам, указанным в *rownum* повторный доступ и обновлены.|  
|0x0002|DELETE|Используется для удаления одной или более строк в буфере выборки. К строкам, указанным в *rownum* повторный доступ и удалить.|  
|0X0004|INSERT|Вставляет данные без построения SQL **вставить** инструкции.|  
|0X0008|REFRESH|Используется для повторного заполнения буфера из базовых таблиц. Может использоваться для обновления строки, если обновление или удаление не удалось провести из-за управления оптимистическим параллелизмом, или после выполнения UPDATE.|  
|0X10|LOCK|В результате SQL Server U-блокировку на странице, содержащей указанную строку. Эта блокировка совместима с S-блокировками и несовместима с X-блокировками или другими U-блокировками. Может использоваться для краткосрочной блокировки.|  
|0X20|SETPOSITION|Используется, только когда программа собирается выдать последующих SQL Server расположен инструкции DELETE или UPDATE.|  
|0X40|ABSOLUTE|Может использоваться только совместно с UPDATE или DELETE.  ABSOLUTE используется только с курсорами KEYSET (не используется курсорами DYNAMIC, а курсоры STATIC не допускают обновления).<br /><br /> Примечание: Если указано «ABSOLUTE» над строкой в наборе ключей, которая не была получена, операция может завершиться ошибкой проверки параллелизм и возвращаемый результат не гарантируется.|  
  
 *rownum*  
 Указывает, с какими строками в буфере выборки будет работать курсор, обновляя или удаляя их.  
  
> [!NOTE]  
>  Не оказывает влияния на точку начала любой операции выборки RELATIVE, NEXT или PREVIOUS, а также на операции обновления и удаления, выполняемые с помощью процедуры sp_cursor.  
  
 *rownum* является обязательным параметром, который вызывает для **int** входного значения.  
  
 1  
 Обозначает первую строку в буфере выборки.  
  
 2  
 Обозначает вторую строку в буфере выборки.  
  
 3, 4, 5  
 Обозначает третью строку и так далее.  
  
 n  
 Обозначает n-ю строку в буфере выборки.  
  
 0  
 Обозначает все строки в буфере выборки.  
  
> [!NOTE]  
>  Допустимо только для использования с обновления, удаления, обновления или БЛОКИРОВКИ *optype* значения.  
  
 *table*  
 Имя таблицы, которая идентифицирует таблицу, *optype* применяется, когда определение курсора включает соединение или неоднозначные имена столбцов, возвращаемых *значение* параметра. Если таблица не назначена, то по умолчанию берется первая таблица в предложении FROM. *Таблица* является необязательным параметром требует входного значения строки. Строка может иметь любой символьный тип данных или Юникоде. *Таблица* может быть имя таблицы на несколько частей.  
  
 *value*  
 Используется для вставки или обновления значений. *Значение* строковый параметр используется только с UPDATE и INSERT *optype* значения. Строка может иметь любой символьный тип данных или Юникоде.  
  
> [!NOTE]  
>  Имена параметров для *значение* могут назначаться пользователем.  
  
## <a name="return-code-values"></a>Значения кода возврата  
 При использовании RPC позиционированной операции DELETE или UPDATE с номером буфера 0 возвращает сообщение DONE со *rowcount* 0 (неуспешное завершение) или 1 (успешное завершение) для каждой строки в буфере выборки.  
  
## <a name="remarks"></a>Замечания  
  
## <a name="optype-parameter"></a>Параметр optype  
 Кроме сочетаний SETPOSITION с UPDATE, DELETE, обновления или БЛОКИРОВКИ; Абсолютный или ОТНОСИТЕЛЬНЫЙ с UPDATE или DELETE, *optype* значения являются взаимоисключающими.  
  
 Предложение SET значения UPDATE создается на основе *значение* параметра.  
  
 Одно из преимуществ использования значения INSERT *optype* значение — что не требуется выполнять преобразование несимвольных данных в символьный формат для вставки. Значения указываются так же, как в UPDATE. Если какие-либо обязательные столбцы не включены, то возникает ошибка INSERT.  
  
-   Значение SETPOSITION не влияет на начальную точку любой операции выборки RELATIVE, NEXT или PREVIOUS, так же как и любые обновления или удаления, выполненные с помощью интерфейса sp_cursor. Любое число, не указывающее строку в буфере выборки, приведет к установке позиции в значения 1, при этом сообщение об ошибке не выдается. После выполнения инструкции SETPOSITION позиция действует до следующей операции sp_cursorfetch, T-SQL **ВЫБОРКИ** операции или операции sp_cursor SETPOSITION для того же курсора. Последующая операция sp_cursorfetch переместит позицию курсора на первую строку в новом буфере выборки, тогда как другие вызовы курсора не повлияют на его позицию. SETPOSITION можно связывать оператором OR с REFRESH, UPDATE, DELETE или LOCK, чтобы установить значение позиции на последнюю измененную строку.  
  
 Если строки в буфере выборки не указана в *rownum* параметра, позиция устанавливается в 1, ошибка не возвращается. После задания позиции она действует до выполнения следующей операции sp_cursorfetch, команды T-SQL FETCH или операции sp_cursor SETPOSITION для того же курсора.  
  
 SETPOSITION можно связывать оператором OR с REFRESH, UPDATE, DELETE или LOCK, чтобы установить позицию курсора на последнюю измененную строку.  
  
## <a name="rownum-parameter"></a>Параметр rownum  
 Если указано, *rownum* параметра можно интерпретировать как число строк в наборе ключей, а не номер строки в буфере выборки. Пользователь отвечает за управление параллелизмом. Это означает, что для курсоров SCROLL_LOCKS придется независимо поддерживать блокировку заданной строки (это можно сделать через транзакции). Для курсоров OPTIMISTIC надо предварительно извлечь строку, чтобы выполнить эту операцию.  
  
## <a name="table-parameter"></a>Параметр table  
 Если *optype* значение равно UPDATE или INSERT и полное обновление или инструкции insert отправляется как *значение* , значение, указанное для *таблицы* игнорируется.  
  
> [!NOTE]  
>  Для представлений могут изменяться только участвующие в них таблицы. *Значение* имена столбцов параметра должны отражать имена столбцов в представлении, но именем таблицы может быть, содержащиеся в базовой таблице (в этом случае sp_cursor будет заменен именем представления).  
  
## <a name="value-parameter"></a>Параметр value  
 Существует два способа правила использования *значение* как уже говорилось в разделе «аргументы»:  
  
1.  Можно использовать имя, которое является "@" добавляется в начало имени столбца в списке select для всех именованных *значение* параметров. Одним из преимуществ такого варианта является то, что не обязательно преобразовывать данные.  
  
2.  Параметр для передачи полной инструкции UPDATE или INSERT или использовать несколько параметров для передачи частей инструкции UPDATE или INSERT, в которой SQL Server будет построена в полную инструкцию. Примеры можно найти далее в подразделе «Примеры» этого раздела.  
  
## <a name="examples"></a>Примеры  
  
### <a name="alternative-value-parameter-uses"></a>Альтернативы использованию параметра value  
 Для UPDATE:  
  
 Когда используется один параметр, инструкцию UPDATE можно передать с использованием следующего синтаксиса:  
  
 `[ [ UPDATE <table name> ] SET ] {<column name> = expression} [,…n]`  
  
> [!NOTE]  
>  Если обновление \<имя таблицы > любое значение, заданный для *таблицы* параметр будет игнорироваться.  
  
 При использовании нескольких параметров первый параметр должен быть строкой в следующем формате:  
  
 `[ SET ] <column name> = expression  [,...n]`  
  
 Последующие параметры должны быть в формате:  
  
 `<column name> = expression  [,...n]`  
  
 В этом случае \<имя таблицы > в обновлении сконструированный инструкция стоит указанным или применяемым по умолчанию для *таблицы* параметра.  
  
 Для INSERT:  
  
 Если используется один параметр, то инструкцию INSERT можно передать с использованием следующего синтаксиса:  
  
 `[ [ INSERT [INTO] <table name> ] VALUES ] ( <expression> [,...n] )`  
  
> [!NOTE]  
>  Если вставить  *\<имя таблицы >* любое значение, заданный для *таблицы* параметр будет игнорироваться.  
  
 При использовании нескольких параметров первый параметр должен быть строкой в следующем формате:  
  
 `[ VALUES ( ] <expression>  [,...n]`  
  
 Последующие параметры должны быть в формате:  
  
 `expression [,...n]`  
  
 За исключением случаев, когда указан параметр VALUES, в этом случае после последнего выражения должен стоять символ ). В этом случае  *\<имя таблицы >* в сконструированный udpate будет ИМЕНЕМ инструкция стоит указанным или применяемым по умолчанию для *таблицы* параметра.  
  
> [!NOTE]  
>  Возможно передать один параметр как именованный, то есть «`@VALUES`». В этом случае другие параметры использовать нельзя.  
  
## <a name="see-also"></a>См. также  
 [sp_cursoropen &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-cursoropen-transact-sql.md)   
 [Хранимая процедура sp_cursorfetch &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-cursorfetch-transact-sql.md)   
 [Системные хранимые процедуры (Transact-SQL)](../../relational-databases/system-stored-procedures/system-stored-procedures-transact-sql.md)  
  
  
