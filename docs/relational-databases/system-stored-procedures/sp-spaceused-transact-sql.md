---
title: "sp_spaceused (Transact-SQL) | Документы Microsoft"
ms.custom: 
ms.date: 08/14/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.service: 
ms.component: system-stored-procedures
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
f1_keywords:
- sp_spaceused_TSQL
- sp_spaceused
dev_langs: TSQL
helpviewer_keywords: sp_spaceused
ms.assetid: c6253b48-29f5-4371-bfcd-3ef404060621
caps.latest.revision: "62"
author: edmacauley
ms.author: edmaca
manager: craigg
ms.workload: Active
ms.openlocfilehash: 670fc2eaf7d6e5c4e499ff57c3a5564bec903ac1
ms.sourcegitcommit: 9e6a029456f4a8daddb396bc45d7874a43a47b45
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2018
---
# <a name="spspaceused-transact-sql"></a>sp_spaceused (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-all-md](../../includes/tsql-appliesto-ss2012-all-md.md)]

  Выводит количество строк, зарезервированное место на диске и место на диске, которое используется таблицей, индексированным представлением или очередью компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] в текущей базе данных, либо выводит место на диске, зарезервированное и используемое всей базой данных.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
sp_spaceused [[ @objname = ] 'objname' ]   
[, [ @updateusage = ] 'updateusage' ]  
[, [ @mode = ] 'mode' ]  
[, [ @oneresultset = ] oneresultset ]  
[, [ @include_total_xtp_storage = ] include_total_xtp_storage ]
```  
  
## <a name="arguments"></a>Аргументы  

Для [!INCLUDE[sssdw-md](../../includes/sssdw-md.md)] и [!INCLUDE[sspdw-md](../../includes/sspdw-md.md)], `sp_spacedused` необходимо указать именованные параметры (например `sp_spacedused (@objname= N'Table1');` вместо того чтобы полагаться на порядковый номер параметра. 

 [ **@objname=**] **'***objname***'** 
   
 Полное или неполное имя таблицы, индексированного представления или очереди, для которых были запрошены сведения по использованию места на диске. Кавычки необходимы только в том случае, если указано уточненное имя объекта. Если указано полностью уточненное имя, включающее имя базы данных, именем базы данных должно быть имя текущей базы данных.  
Если *objname* не указан, результаты возвращаются для всей базы данных.  
*ObjName* — **nvarchar(776)**, значение по умолчанию NULL.  
> [!NOTE]  
> [!INCLUDE[sssdw-md](../../includes/sssdw-md.md)]и [!INCLUDE[sspdw-md](../../includes/sspdw-md.md)] поддерживают только объекты базы данных и таблицы.
  
 [ **@updateusage=**] **'***updateusage***'**  
 Указывает, что для обновления сведений об использовании места на диске следует запустить инструкцию DBCC UPDATEUSAGE. Когда *objname* — не указан, инструкция запускается в отношении всей базы данных; в противном случае инструкция выполняется *objname*. Значения могут быть **true** или **false**. *UPDATEUSAGE* — **varchar(5)**, значение по умолчанию **false**.  
  
 [ **@mode=**] **'***mode***'**  
 Указывает область результатов. Для расширенной таблицы или базы данных *режим* позволяет включить или исключить удаленный часть объекта. Дополнительные сведения см. в разделе [Stretch Database](../../sql-server/stretch-database/stretch-database.md).  
  
 *Режим* аргумент может принимать следующие значения:  
  
|Значение|Описание|  
|-----------|-----------------|  
|ALL|Возвращает статистику хранения объекта или базы данных, включая часть локальных и удаленных часть.|  
|LOCAL_ONLY|Возвращает статистику только локальной части объекта или базы данных хранилища. Если объект или база данных не включена, возвращает ту же статистику, когда @mode = ALL.|  
|REMOTE_ONLY|Возвращает статистику только удаленной части объекта или базы данных хранилища. Этот параметр вызывает ошибку при выполнении одного из следующих условий:<br /><br /> В таблице не включена для Stretch.<br /><br /> Таблица включена для Stretch, но никогда не включалась переноса данных. В этом случае удаленная таблица еще нет схемы.<br /><br /> Пользователь удален вручную удаленной таблицы.<br /><br /> Подготовка remote data archive вернул состояние успешно, но на самом деле не удалось.|  
  
 *режим* — **varchar(11)**, значение по умолчанию **N'ALL'**.  
  
 [ **@oneresultset=**] *oneresultset*  
 Указывает, следует ли возвращать один результирующий набор. *Oneresultset* аргумент может принимать следующие значения:  
  
|Значение|Описание|  
|-----------|-----------------|  
|0|Когда  *@objname*  имеет значение null или не указан, возвращаются два результирующих набора. Два результирующих набора поведение установлено по умолчанию.|  
|1|Когда  *@objname*  = null или является не указан, возвращается один результирующий набор.|  
  
 *oneresultset* — **бит**, значение по умолчанию **0**.  

[ **@include_total_xtp_storage**] **'***include_total_xtp_storage***'**  
**Применяется к:** [!INCLUDE[sssql15-md](../../includes/sssql15-md.md)], [!INCLUDE[sssds-md](../../includes/sssds-md.md)].  
  
 Когда @oneresultset= 1, параметр @include_total_xtp_storage определяет, включает ли один результирующий набор столбцов для хранения MEMORY_OPTIMIZED_DATA. По умолчанию равно 0, то есть, по умолчанию (Если этот параметр опущен) XTP столбцы не включаются в результирующий набор.  

## <a name="return-code-values"></a>Значения кода возврата  
 0 (успешное завершение) или 1 (неуспешное завершение)  
  
## <a name="result-sets"></a>Результирующие наборы  
 Если *objname* опущен и значение *oneresultset* равно 0, возвращаются следующие результирующие наборы предоставляют текущий размер базы данных.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов.|  
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных.|  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**reserved**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**unused**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|  
  
 Если *objname* опущен и значение *oneresultset* -1, следующие один результирующий набор возвращается для предоставления текущий размер базы данных.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов.|  
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных.|  
|**reserved**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**unused**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|  
  
 Если *objname* задан, для указанного объекта возвращается следующий результирующий набор.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**name**|**nvarchar(128)**|Имя объекта, для которого были запрошены сведения об используемом пространстве.<br /><br /> Имя схемы объекта не возвращается. Если требуется указать имя схемы, используйте [sys.dm_db_partition_stats](../../relational-databases/system-dynamic-management-views/sys-dm-db-partition-stats-transact-sql.md) или [sys.dm_db_index_physical_stats](../../relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql.md) динамические административные представления для получения эквивалентных сведений о размере.|  
|**rows**|**char(20)**|Количество существующих строк в таблице. Если объект указан как очередь компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)], этот столбец указывает число сообщений в очереди.|  
|**reserved**|**varchar(18)**|Общий объем пространства, зарезервированный для *objname*.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными *objname*.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами *objname*.|  
|**unused**|**varchar(18)**|Общий объем пространства, зарезервированного для *objname* , но еще не используется.|  
 
Это режим по умолчанию, если параметры не указаны. Следующие результирующие наборы возвращаются со сведения о размере базы данных на диске. 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов. Если файловая группа MEMORY_OPTIMIZED_DATA в базе данных, в нем общий размер всех файлов контрольных точек на диске в файловой группе.|  
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных. Если файловая группа MEMORY_OPTIMIZED_DATA в базе данных, в нем общий размер на диске файлов контрольных точек с состоянием PRECREATED в файловой группе.|  

Пространство, используемое таблицами в базе данных: (этот результирующий набор не отражает таблицами, оптимизированными для памяти, поскольку выполняется без учета-таблица использования диска) 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**reserved**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**unused**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|

Следующий результирующий набор возвращается **, только если** базе данных есть файловая группа MEMORY_OPTIMIZED_DATA с по крайней мере один контейнер: 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**xtp_precreated**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием PRECREATED, в КБ. Подсчитывает сторону незанятое пространство в базе данных в целом. [Например, если имеется 600 000 КБ готовые файлы контрольных точек, этот столбец содержит "600000 КБ"]|  
|**xtp_used**|**varchar(18)**|Общий размер файлов контрольных точек с состояниями в процессе разработки, АКТИВНЫЕ и MERGE TARGET, в КБ. Это место на диске, активно используются для данных в таблицах, оптимизированных для памяти.|  
|**xtp_pending_truncation**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием WAITING_FOR_LOG_TRUNCATION, в КБ. Это дисковое пространство для файлов контрольных точек, ожидающих очистки, когда происходит усечение журнала.|

Если *objname* — этот параметр опущен, значение oneresultset равно 1, и *include_total_xtp_storage* -1, следующие один результирующий набор возвращается для предоставления текущий размер базы данных. Если `include_total_xtp_storage` равно 0 (по умолчанию), последние три столбца, опущены. 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов. Если файловая группа MEMORY_OPTIMIZED_DATA в базе данных, в нем общий размер всех файлов контрольных точек на диске в файловой группе.|
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных. Если файловая группа MEMORY_OPTIMIZED_DATA в базе данных, в нем общий размер на диске файлов контрольных точек с состоянием PRECREATED в файловой группе.|  
|**reserved**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**unused**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|
|**xtp_precreated**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием PRECREATED, в КБ. Это учитывается размер свободного места в базе данных в целом. Возвращает значение NULL, если базы данных не имеет по крайней мере одному контейнеру файловую группу memory_optimized_data. *Этот столбец содержит только включено, если @include_total_xtp_storage= 1*.| 
|**xtp_used**|**varchar(18)**|Общий размер файлов контрольных точек с состояниями в процессе разработки, АКТИВНЫЕ и MERGE TARGET, в КБ. Это место на диске, активно используются для данных в таблицах, оптимизированных для памяти. Возвращает значение NULL, если базы данных не имеет по крайней мере одному контейнеру файловую группу memory_optimized_data. *Этот столбец содержит только включено, если @include_total_xtp_storage= 1*.| 
|**xtp_pending_truncation**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием WAITING_FOR_LOG_TRUNCATION, в КБ. Это дисковое пространство для файлов контрольных точек, ожидающих очистки, когда происходит усечение журнала. Возвращает значение NULL, если базы данных не имеет по крайней мере одному контейнеру файловую группу memory_optimized_data. Этот столбец содержит только включено, если `@include_total_xtp_storage=1`.|

## <a name="remarks"></a>Remarks  
 **database_size** всегда требуется большее, чем сумма **зарезервированные** + **нераспределенное пространство** , так как он включает размер файлов журнала, но **зарезервировано** и **unallocated_space** учитывают только страницы данных.  
  
 Страницы, используемые XML-индексов и полнотекстовых индексов, включаются в **index_size** обоих результирующих наборах. Когда *objname* указано, страницы XML-индексов и полнотекстовых индексов для объекта также учитываются в общую сумму **зарезервированные** и **index_size** результаты.  
  
 Если использование пространства вычисляется для базы данных или объект, который содержит пространственный индекс столбцов размер пространства, такие как **database_size**, **зарезервированные**, и **index_size**, включают размер пространственного индекса.  
  
 Когда *updateusage* указано, [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] просмотров страниц в базе данных и вносит все необходимые изменения в **sys.allocation_units** и **sys.partitions** представления относительно дискового пространства, используемого всеми таблицами каталога. Иногда возникают ситуации, например после удаления индекса, когда сведения о занимаемом таблицей месте могут устареть. *UPDATEUSAGE* может занять некоторое время для выполнения на больших таблиц или баз данных. Используйте *updateusage* только при подозрении возвращаются неверные значения и если процесс не будет неблагоприятное воздействие на других пользователей или процессов в базе данных. При необходимости инструкцию DBCC UPDATEUSAGE можно запускать отдельно.  
  
> [!NOTE]  
>  При удалении или перестройке больших индексов либо удалении или усечении больших таблиц компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] откладывает фактическое освобождение страниц и связанных блокировок до момента фиксации транзакции. Отложенные операции удаления не освобождают выделенное место немедленно. Таким образом, значения, возвращаемые методом **sp_spaceused** немедленно после удаления или усечения большого объекта, могут не отражать доступное пространство на диске.  
  
## <a name="permissions"></a>Разрешения  
 Разрешение на выполнение процедуры **sp_spaceused** предоставлено роли **public** . Параметр **@updateusage** могут указывать только члены предопределенной роли базы данных **@updateusage** .  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-displaying-disk-space-information-about-a-table"></a>A. Вывод сведений о занимаемом месте на диске для таблицы  
 В следующем примере предоставляются сведения о месте на диске для таблицы `Vendor` и ее индексах.  
  
```sql  
USE AdventureWorks2012;  
GO  
EXEC sp_spaceused N'Purchasing.Vendor';  
GO  
```  
  
### <a name="b-displaying-updated-space-information-about-a-database"></a>Б. Вывод обновленных сведений о занимаемом месте на диске для базы данных  
 В следующем примере приводятся итоговые сведения об использовании места на диске текущей базой данных с применением необязательного параметра `@updateusage`, чтобы получить достоверные текущие значения.  
  
```sql  
USE AdventureWorks008R2;  
GO  
EXEC sp_spaceused @updateusage = N'TRUE';  
GO  
```  
  
### <a name="c-displaying-space-usage-information-about-the-remote-table-associated-with-a-stretch-enabled-table"></a>В. Отображение информации о удаленная таблица связана с таблицей с включенным Stretch  
 Приведенный ниже приведены пространства, занятого удаленной таблицы, связанной с таблицей с включенным Stretch с помощью  **@mode**  аргумент, чтобы указать удаленному целевому объекту. Дополнительные сведения см. в разделе [Stretch Database](../../sql-server/stretch-database/stretch-database.md).  
  
```sql  
USE StretchedAdventureWorks2016  
GO  
EXEC sp_spaceused N'Purchasing.Vendor', @mode = 'REMOTE_ONLY'  
```  
  
### <a name="d-displaying-space-usage-information-for-a-database-in-a-single-result-set"></a>Г. Отображение информации для базы данных в один результирующий набор  
 Следующий пример обобщает использование пространства для текущей базы данных в единый результирующий набор.  
  
```sql  
USE AdventureWorks2016  
GO  
EXEC sp_spaceused @oneresultset = 1  
```  

### <a name="e-displaying-space-usage-information-for-a-database-with-at-least-one-memoryoptimized-file-group-in-a-single-result-set"></a>Д. Отображение информации для базы данных с по крайней мере один оптимизированные для памяти файловой группы в один результирующий набор 
 Приведенный ниже приведена сводка использования места в текущей базе данных с по крайней мере один оптимизированные для памяти файловой группы, в один результирующий набор.
 
```sql
USE WideWorldImporters
GO
EXEC sp_spaceused @updateusage = 'FALSE', @mode = 'ALL', @oneresultset = '1', @include_total_xtp_storage = '1';
GO
``` 

### <a name="f-displaying-space-usage-information-for-a-memoryoptimized-table-object-in-a-database"></a>Е. Отображение сведения об использовании пространства объект оптимизированные для памяти таблицы в базе данных.
 Следующий пример обобщает использование пространства для объекта оптимизированные для памяти таблицы в текущей базе данных с по крайней мере один оптимизированные для памяти файловой группы.
 
```sql
USE WideWorldImporters
GO
EXEC sp_spaceused
@objname = N'VehicleTemparatures',
@updateusage = 'FALSE',
@mode = 'ALL',
@oneresultset = '0',
@include_total_xtp_storage = '1';
GO
```  

## <a name="see-also"></a>См. также  
 [CREATE INDEX (Transact-SQL)](../../t-sql/statements/create-index-transact-sql.md)   
 [CREATE TABLE (Transact-SQL)](../../t-sql/statements/create-table-transact-sql.md)   
 [DBCC UPDATEUSAGE &#40; Transact-SQL &#41;](../../t-sql/database-console-commands/dbcc-updateusage-transact-sql.md)   
 [SQL Server Service Broker](../../database-engine/configure-windows/sql-server-service-broker.md)   
 [sys.allocation_units &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-allocation-units-transact-sql.md)   
 [sys.indexes (Transact-SQL)](../../relational-databases/system-catalog-views/sys-indexes-transact-sql.md)   
 [sys.index_columns (Transact-SQL)](../../relational-databases/system-catalog-views/sys-index-columns-transact-sql.md)   
 [sys.Objects &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-objects-transact-sql.md)   
 [sys.partitions &#40; Transact-SQL &#41;](../../relational-databases/system-catalog-views/sys-partitions-transact-sql.md)   
 [Системные хранимые процедуры (Transact-SQL)](../../relational-databases/system-stored-procedures/system-stored-procedures-transact-sql.md)  
  
  
