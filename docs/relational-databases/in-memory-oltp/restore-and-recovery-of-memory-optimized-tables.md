---
title: "Восстановление оптимизированных для памяти таблиц | Документация Майкрософт"
ms.custom: 
ms.date: 03/14/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine
ms.service: 
ms.component: in-memory-oltp
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine-imoltp
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 294975b7-e7d1-491b-b66a-fdb1100d2acc
caps.latest.revision: "10"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: add6844ed550417478cc44090fd40a4a5b4cf62b
ms.sourcegitcommit: 44cd5c651488b5296fb679f6d43f50d068339a27
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2017
---
# <a name="restore-and-recovery-of-memory-optimized-tables"></a>Восстановление оптимизированных для памяти таблиц
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

  Базовый механизм восстановления баз данных с таблицами, оптимизированными для памяти, аналогичен методу для баз данных, содержащих только таблицы на диске. Но в отличие от метода для таблиц на диске оптимизированные для памяти таблицы должны быть загружены в память до того, как база данных будет доступна для доступа пользователей. При этом добавляется новый этап восстановления базы данных.  
  
 Во время операций восстановления подсистема OLTP в памяти считывает файлы данных и разностные файлы для загрузки в физическую память. Время загрузки определяется следующими факторами:  
  
-   объем данных для загрузки;  
  
-   пропускная способность операций последовательного ввода-вывода;  
  
-   степень параллелизма, определенная числом контейнеров файла и процессорных ядер.  
  
-   Количество записей журнала в активной части журнала, которые нужно перезаписать.  
  
 При перезапуске [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для каждой базы данных выполняется этап восстановления, который состоит из следующих трех фаз.  
  
1.  Фаза анализа. Во время этой фазы передача осуществляется в активные журналы транзакций для обнаружения фиксированных и незафиксированных транзакций. Модуль In-Memory OLTP определяет контрольную точку для загрузки и выполняет предварительную загрузку соответствующих записей журналов системных таблиц. При этом также выполняется обработка определенных записей журналов распределения файлов.  
  
2.  Стадия повтора. Эта фаза выполняется одновременно с таблицами на диске и с таблицами, оптимизированными для памяти.  
  
     Для дисковых таблиц база данных перемещается в текущий момент времени и в ней настраиваются блокировки для незафиксированных транзакций.  
  
     Для таблиц, оптимизированных для памяти, данные из пар данных и разностных файлов загружаются в память, а данные обновляются с учетом активных журналов транзакций на основе последней надежной контрольной точки.  
  
     После описанных выше операция с таблицами на диске и таблицами, оптимизированными для памяти, база данных становится готова для доступа.  
  
3.  Стадия отката. В этой фазе выполняется откат незафиксированных транзакций.  
  
 Загрузка в память таблиц, оптимизированных для памяти, может повлиять на производительность целевого времени восстановления (RTO). Чтобы сократить время загрузки оптимизированных для памяти данных из файлов данных и разностных файлов, модуль In-Memory OLTP загружает данные и разностные параллельно следующим образом.  
  
-   Создание фильтра сопоставления данных. Хранилище разностных файлов ссылается на удаленные строки. Один поток на контейнер считывает разностные файлы и создает фильтр сопоставления данных. (Оптимизированная для памяти файловая группа данных может содержать один или несколько контейнеров.)  
  
-   Потоковая передача файлов данных.  После создания фильтра сопоставления разностных файлов файлы данных считываются с использованием числа потоков, идентичных логическим ЦП. Каждый поток при чтении файла данных считывает строки данных, проверяет связанное сопоставление и только вставляет строку в таблицу, если эта строка не была помечена как удаленная. Эта часть процесса восстановления в некоторых случаях может быть ограничена ресурсами ЦП, как описано ниже.  
  
 ![Оптимизированные для памяти таблицы.] (../../relational-databases/in-memory-oltp/media/memory-optimized-tables.gif "Оптимизированные для памяти таблицы.")  
  
 Оптимизированные таблицы для памяти обычно можно загрузить в память на скорости операций ввода-вывода, но существуют ситуации, когда скорость загрузки строк данных в память будет ниже. Особые случаи:  
  
-   Небольшое число контейнеров для хэш-индекса может привести к конфликту наложения, что снизит скорость операций вставки строк данных. Обычно это приводит к большой нагрузке на ЦП, особенно в последней части операции восстановления. Если настроить хэш-индекс правильно, он не должен влиять на время восстановления.  
  
-   Большие таблицы, оптимизированные для памяти, с одним или несколькими некластеризованными индексами, в отличие от хэш-индексов, в которых число контейнеров определяется во время создания, число некластеризованных индексов может увеличиваться не динамически, результатом чего является высокая загрузка ЦП.  
  
## <a name="see-also"></a>См. также:  
 [Резервное копирование и восстановление оптимизированных для памяти таблиц](http://msdn.microsoft.com/library/3f083347-0fbb-4b19-a6fb-1818d545e281)  
  
  
