---
title: Занятие 8. Восстановление в качестве новой базы данных из резервной копии журнала | Документация Майкрософт
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: ebba12c7-3d13-4c9d-8540-ad410a08356d
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.openlocfilehash: 7403564eabb8f7e5ff6c26bdce57caefaefa2cc2
ms.sourcegitcommit: 61381ef939415fe019285def9450d7583df1fed0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47830162"
---
# <a name="lesson-8-restore-as-new-database-from-log-backup"></a>Занятие 8. Восстановление в качестве новой базы данных из резервной копии журнала
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
На этом занятии вы восстановите базу данных AdventureWorks2014 в качестве новой базы данных из резервной копии журнала транзакций на основе моментального снимка файла.  
  
В этом сценарии восстановление производится в экземпляр SQL Server в другой виртуальной машине в целях бизнес-анализа и создания отчетов. Восстановление в другом экземпляре, размещенном в другой виртуальной машине, позволяет перенести нагрузку на выделенную виртуальную машину, специально предназначенную для этой цели, и снизить требования к ресурсам, предъявляемые к системе обработки транзакций.  
  
Восстановление из резервной копии журнала транзакций, созданной посредством резервного копирования моментальных снимков файлов, выполняется очень быстро — существенно быстрее, чем при использовании традиционных потоковых резервных копий. В случае с традиционными потоковыми резервными копиями вам потребовалось бы использовать полную резервную копию базы данных, а также, возможно, разностную резервную копию и все или часть резервных копий журнала транзакций (либо новую полную резервную копию базы данных). При использовании же резервных копий журнала на основе моментальных снимков файлов требуется только самая последняя резервная копия журнала (либо любая другая резервная копия журнала, либо две смежные резервные копии журнала для восстановления на определенный момент времени). Если точнее, требуется только один резервный набор моментальных снимков файлов, так как каждая операция резервного копирования журнала с помощью моментальных снимков файлов создает моментальный снимок каждого файла базы данных (то есть файла данных и файла журнала).  
  
Чтобы выполнить восстановление в новую базу данных из резервной копии журнала транзакций, созданной посредством резервного копирования моментальных снимков файлов, выполните указанные ниже действия.  
  
1.  Подключитесь к среде Microsoft SQL Server Management Studio.  
  
2.  Откройте новое окно запроса и подключитесь к экземпляру SQL Server 2016 ядра СУБД в виртуальной машине Azure.  
  
    > [!NOTE]  
    > Если это не та виртуальная машина Azure, которая использовалась на предыдущих занятиях, необходимо выполнить инструкции в разделе [Занятие 2. Создание учетных данных SQL Server с помощью подписанного URL-адреса](../relational-databases/lesson-2-create-a-sql-server-credential-using-a-shared-access-signature.md). Если нужно выполнить восстановление в другой контейнер, выполните инструкции в разделах [Занятие 1. Создание хранимой политики доступа и подписанного URL-адреса для контейнера Azure](../relational-databases/lesson-1-create-stored-access-policy-and-shared-access-signature.md) и [Занятие 2. Создание учетных данных SQL Server с помощью подписанного URL-адреса](../relational-databases/lesson-2-create-a-sql-server-credential-using-a-shared-access-signature.md) для нового контейнера.  
  
3.  Скопируйте и вставьте приведенный ниже скрипт Transact-SQL в окне запроса. Выберите файл резервной копии журнала, который нужно использовать. Измените URL-адрес в соответствии с именем учетной записи хранения и контейнером, которые были указаны на занятии 1, укажите имя файла резервной копии журнала, а затем выполните этот скрипт.  
  
    ```  
  
    -- restore as a new database from a transaction log backup file  
    RESTORE DATABASE AdventureWorks2014_EOM   
        FROM URL = 'https://<mystorageaccountname>.blob.core.windows.net/<mystorageaccountcontainername>/<logbackupfile.bak'    
        WITH MOVE 'AdventureWorks2014_data' to 'https://<mystorageaccountname>.blob.core.windows.net/<mystorageaccountcontainername>/AdventureWorks2014_EOM_Data.mdf'  
       , MOVE 'AdventureWorks2014_log' to 'https://<mystorageaccountname>.blob.core.windows.net/<mystorageaccountcontainername>/AdventureWorks2014_EOM_Log.ldf'  
       , RECOVERY  
    --, REPLACE  
  
    ```  
  
4.  Просмотрите выходные данные, чтобы проверить успешность восстановления.  
  
5.  В обозревателе объектов подключитесь к хранилищу Azure.  
  
6.  Разверните узел "Контейнеры", разверните контейнер, созданный на занятии 1 (при необходимости обновите его), и убедитесь в том, что в нем появились новые файлы данных и журналов, а также BLOB-объекты из предыдущих занятий.  
  
    ![Контейнер Azure, демонстрирующий файлы данных и журналов для новой базы данных](../relational-databases/media/e9705083-86bc-4309-a0bf-92c15f174c0a.JPG "Контейнер Azure, демонстрирующий файлы данных и журналов для новой базы данных")  
  
[Занятие 9. Управление резервными наборами данных и резервными копиями моментальных снимков файлов](../relational-databases/lesson-9-manage-backup-sets-and-file-snapshot-backups.md)  
  
  
  
