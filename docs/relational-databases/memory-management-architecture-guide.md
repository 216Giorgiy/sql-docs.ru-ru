---
title: "Руководство по архитектуре управления памятью | Документация Майкрософт"
ms.custom: 
ms.date: 10/21/2016
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- guide, memory management architecture
- memory management architecture guide
ms.assetid: 7b0d0988-a3d8-4c25-a276-c1bdba80d6d5
caps.latest.revision: 6
author: BYHAM
ms.author: rickbyh
manager: jhubbard
ms.translationtype: Human Translation
ms.sourcegitcommit: f3481fcc2bb74eaf93182e6cc58f5a06666e10f4
ms.openlocfilehash: d00e5c97e6c27f3fe40b2066b5e194b8011f6b1e
ms.contentlocale: ru-ru
ms.lasthandoff: 04/11/2017

---
# <a name="memory-management-architecture-guide"></a>руководство по архитектуре управления памятью
[!INCLUDE[tsql-appliesto-ss2008-all_md](../includes/tsql-appliesto-ss2008-all-md.md)]

## <a name="memory-architecture"></a>Архитектура оперативной памяти

[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] по мере необходимости динамически получает и освобождает оперативную память. Обычно администратору не требуется указывать, сколько памяти необходимо выделить для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], хотя эта возможность по-прежнему существует и в некоторых случаях необходима.

Одна из главных задач проектирования любой программной системы для баз данных — минимизация операций дискового ввода-вывода, так как чтение и запись на диск являются наиболее ресурсоемкими операциями. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] создает в памяти буферный пул для сохранения страниц, считываемых из базы данных. Большой объем кода [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] предназначен для минимизации числа физических операций чтения-записи между диском и буферным пулом. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] выполняет балансировку для решения двух задач:

* предотвращения роста буферного пула до размера, при котором вся система будет испытывать нехватку оперативной памяти;
* минимизации числа физических операций ввода-вывода в базе данных путем увеличения размера буферного пула.


> [!NOTE]
> В сильно загруженной системе некоторые масштабные запросы, для выполнения которых требуется большой объем оперативной памяти, не могут получить минимально необходимого им объема и в результате завершаются ошибкой, когда истекает время ожидания ресурса памяти. Для решения этой проблемы следует увеличить значение параметра [query wait](../database-engine/configure-windows/configure-the-query-wait-server-configuration-option.md). При параллельных запросах можно попробовать уменьшить значение параметра [max degree of parallelism](../database-engine/configure-windows/configure-the-max-degree-of-parallelism-server-configuration-option.md).
 
> [!NOTE]
> В сильно загруженной системе с ограниченными ресурсами памяти запросы, содержащие соединение слиянием, сортировку и построение битовой карты в плане запроса, могут удалить битовую карту, если запрос не получил минимально необходимого для ее сохранения объема оперативной памяти. Это может повлиять на производительность запроса, и, если процесс сортировки не помещается в памяти, приводит к повышению интенсивности использования рабочих таблиц в базе данных tempdb, вызывая тем самым ее рост. Для решения этой проблемы необходимо увеличить объем физической памяти или настроить запросы так, чтобы они использовали другие, более быстрые планы запроса.
 
### <a name="providing-the-maximum-amount-of-memory-to-includessnoversionincludesssnoversion-mdmd"></a>Выделение [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]максимального объема памяти

Используя AWE и право на закрепление страниц в памяти, вы можете выделять следующие объемы памяти в ядре СУБД [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . (Следующая таблица содержит столбец для 32-разрядных версий, которые больше не доступны).

| |32-разрядная версия <sup>1</sup> |64-разрядная версия
|-------|-------|-------| 
|Обычная память |Все выпуски [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . до достижения предела обработки виртуального адресного пространства — <br>— 2 ГБ<br>— 3 ГБ с параметром загрузки /3gb <sup>2</sup> <br>— 4 ГБ на WOW64 <sup>3</sup> |Все выпуски [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . до достижения предела обработки виртуального адресного пространства — <br>— 7 ТБ с архитектурой IA64 (IA64 не поддерживается в версии [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] и более поздней)<br>— Максимум, поддерживаемый операционной системой при использовании архитектуры x64 <sup>4</sup>
|Механизм AWE (позволяет [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] выходить за пределы обработки виртуального адресного пространства на 32-разрядной платформе). |Выпуски[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Standard, Enterprise и Developer — буферный пул, достаточный для доступа к 64 ГБ памяти.|Неприменимо<sup>5</sup> |
|Разрешение операционной системы на удерживание страницы в памяти (разрешает блокировать физическую память, предотвращает разбиение блокированной памяти на страницы). <sup>6</sup> |Выпуски [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Standard, Enterprise и Developer — для процесса [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] необходимо использовать механизм AWE. Память, распределенная с использованием механизма AWE, не может быть выгружена. <br> Предоставление данного разрешения без включения AWE не оказывает влияния на сервер. |Выпуски[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Enterprise и Developer — рекомендуется, чтобы избежать выгрузки страниц операционной системой. В зависимости от рабочей нагрузки может улучшить производительность. Объем доступной памяти аналогичен объему в случае обычной памяти. |

<sup>1</sup> 32-разрядные версии недоступны, начиная с [!INCLUDE[ssSQL14](../includes/sssql14-md.md)].  
<sup>2</sup> /3gb — это параметр загрузки операционной системы. Дополнительные сведения см. в библиотеке MSDN.  
<sup>3</sup> WOW64 (Windows on Windows 64) — режим, в котором 32-разрядная версия [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] запускается в 64-разрядной операционной системе.  
<sup>4</sup> [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Standard Edition supports up to 128 GB. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Enterprise Edition поддерживает максимальное значение, поддерживаемое операционной системой.  
<sup>5</sup> Обратите внимание, что параметр awe enabled функции sp_configure в 64-разрядной системе [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]присутствует, но не учитывается.    
<sup>6</sup> При выдаче разрешения на закрепление страниц в памяти (либо в 32-разрядной системе для поддержки AWE-памяти, либо в 64-разрядной системе) рекомендуем выделить максимальный объем серверной памяти.

> [!NOTE]
> Более старые версии [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] можно запустить в 32-разрядной операционной системе. При доступе более чем к 4 ГБ памяти в 32-разрядной операционной системе требуется использовать расширения AWE для управления памятью. Это необязательно, если [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] выполняется в 64-разрядных операционных системах. Дополнительные сведения о расширениях AWE см. в документации по [2008:](https://msdn.microsoft.com/library/ms189334) Адресное пространство процесса [и](https://msdn.microsoft.com/library/ms191481) Управление памятью для больших баз данных [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .   


## <a name="dynamic-memory-management"></a>Динамическое управление памятью

Управление памятью в ядре СУБД Microsoft [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] по умолчанию выражается в получении необходимого объема памяти для исключения нехватки памяти в системе. Ядро СУБД осуществляет это при помощи API-интерфейсов уведомления о событиях памяти в Microsoft Windows.

Виртуальное адресное пространство [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] может быть разделено на две области: пространство, занятое буферным пулом, и остальное пространство. Если включен механизм AWE, буферный пул может располагаться в сопоставленной памяти AWE, предоставляя дополнительное пространство для страниц базы данных. 

Буферный пул служит основным источником размещения памяти [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Внешние компоненты, которые расположены внутри процесса [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , такие как объекты COM и средства, не знающие о функциях управления памятью [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , используют память вне виртуального адресного пространства, занятого буферным пулом.

При запуске [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] вычисляется размер виртуального адресного пространства для буферного пула на основании числа параметров, таких как объем физической памяти в системе, число потоков сервера и различные параметры запуска. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] резервирует вычисляемый объем виртуального адресного пространства процесса для буферного пула, но занимает (фиксирует) только необходимый объем физической памяти для текущей нагрузки.

После этого экземпляр продолжает занимать память по мере необходимости для поддержания рабочей нагрузки. По мере того как больше пользователей подключается и выполняет запросы, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] занимает дополнительную физическую память. Экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] продолжает занимать физическую память до тех пор, пока заполнение памяти сервера не достигнет максимальных пределов, или до тех пор, пока Windows не сообщит о том, что свободной памяти не осталось. Он освобождает память, если она занята больше, чем указано в параметре min server memory, а Windows сообщает о том, что свободной памяти не хватает.

По мере того как на компьютере, где запущен экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], запускаются другие приложения, они используют память, и объем свободной физической памяти падает ниже цели [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] корректирует использование памяти. При остановке какого-либо приложения ресурсы освобождаются, и экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] увеличивает объем выделяемой памяти. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] ежесекундно может освобождать и занимать несколько мегабайт памяти, что позволяет быстро регулировать ее выделение.


## <a name="effects-of-min-and-max-server-memory"></a>Параметры настройки min server memory и max server memory

Параметры конфигурации, определяющие минимальное и максимальное значение памяти сервера, устанавливают верхний и нижний пределы объема памяти, занятого буферными пулами ядра СУБД Microsoft [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Буферный пул не сразу выделяет объем памяти, определенный минимальным значением. Он начинает расти от объема, необходимого для инициализации. По мере увеличения рабочей нагрузки ядро СУБД продолжает потреблять память, необходимую для обработки нагрузки. Буферный пул не освободит занятую память, пока не достигнет размера, определенного минимальным значением. Как только это значение будет достигнуто, буферный пул применит стандартный алгоритм выделения и освобождения памяти по мере необходимости. Единственное отличие заключается в том, что буферный пул никогда не освобождает объем памяти ниже предела, определяемого параметром "Минимальная память сервера", — и никогда не занимает объем больше предела, определяемого параметром "Максимальная память сервера".

> [!NOTE]
> Сам[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] как процесс занимает больше памяти, чем указано в параметре max server memory. И внутренние, и внешние компоненты могут занимать память за пределами буферного пула, что также входит в ее общий расход, однако буферный пул обычно составляет наибольшую часть общего объема памяти, потребляемого [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].


Объем памяти, занимаемой ядром СУБД, напрямую зависит от рабочей нагрузки на экземпляре. Экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , обрабатывающий не слишком много запросов, может и не достигнуть предела, указываемого параметром min server memory.

Для максимального и минимального пределов можно указать одно и то же значение. В таком случае, как только выделенная память достигнет этого значения, ядро СУБД прекратит динамическое выделение и освобождение памяти для буферного пула.

Если экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] работает на компьютере, на котором часто запускаются и останавливаются другие приложения, выделение и освобождение памяти экземпляром [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] может замедлить запуск других приложений. Кроме того, если [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] является одним из нескольких серверных приложений, выполняющихся на компьютере, системным администраторам может понадобиться возможность контроля памяти, выделяемой для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. В таких случаях параметры min server memory и max server memory помогут управлять объемами памяти, потребляемой [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Дополнительные сведения см. в статье [Параметры конфигурации сервера Server Memory](../database-engine/configure-windows/server-memory-server-configuration-options.md).

Значение параметров "Минимальная память сервера" и "Максимальная память сервера" указываются в мегабайтах.

## <a name="memory-used-by-includessnoversionincludesssnoversion-mdmd-objects-specifications"></a>Требования к объему памяти для хранения объектов [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]

Следующий список содержит обобщенные сведения об объеме памяти, потребляемой разными объектами [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Эти значения являются оценочными и могут отличаться в зависимости от среды и способов создания объектов.

* Блокировка: 64 байта + 32 байта на владельца   
* Подключение пользователя: приблизительно (3* *размер_сетевого_пакета + 94 КБ)    

Размер сетевого пакета — это размер пакетов схемы табличных данных, которые используются для обмена данными между приложениями и ядром СУБД [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . По умолчанию размер пакета равен 4 КБ, а его настройка осуществляется с помощью параметра конфигурации network packet size.

Если включено использование режима MARS, подключение пользователя занимает примерно (3+3×число_логических_соединений)×размер_сетевого_пакета+94 КБ.

## <a name="buffer-management"></a>Управление буферами

Главное назначение базы данных [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] — хранение и поиск данных, поэтому интенсивное использование операций дискового ввода-вывода — это основное свойство компонента Database Engine. А так как дисковые операции ввода-вывода могут потреблять много ресурсов и требовать относительно длительного времени для выполнения, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] обращает огромное внимание на рациональное использование операций ввода-вывода. Управление буфером — это ключевой компонент в достижении этой рациональности. Компонент управления буферами состоит из двух механизмов: диспетчер буферов для доступа к страницам баз данных и их обновления и буферный кэш (также называемый буферный пул) для сокращения числа операций ввода-вывода файла базы данных. 

### <a name="how-buffer-management-works"></a>Принцип работы управления буфером

Буфер — это 8-килобайтовая (КБ) страница в памяти такого же размера, что и страница данных или индекса. Буферный кэш делится на 8-килобайтовые страницы. Диспетчер буферов содержит функции чтения страниц данных или индекса из файлов базы данных на диске в буферный кэш и записывает измененные страницы обратно на диск. Страница остается в буферном кэше, пока диспетчеру буферов требуется область буфера для чтения дополнительных данных. Данные записываются обратно на диск, только если они были изменены. Данные в буферном кэше могут измениться несколько раз, прежде чем будут сохранены обратно на диске. Дополнительные сведения см. в статьях [Считывание страниц](../relational-databases/reading-pages.md) и [Запись страниц](../relational-databases/writing-pages.md).

При запуске [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] вычисляется размер виртуального адресного пространства для буферного кэша на основе таких параметров, как объем физической памяти в системе, указанное максимальное число потоков сервера и разных параметров запуска. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] резервирует вычисляемый объем виртуального адресного пространства процесса (называемого целевой памятью) для буферного кэша, но занимает (фиксирует) только необходимый объем физической памяти для текущей нагрузки. Можно запросить столбцы **bpool_commit_target** и **bpool_committed** в представлении каталога [sys.dm_os_sys_info](../relational-databases/system-dynamic-management-views/sys-dm-os-sys-info-transact-sql.md) , чтобы получить число зарезервированных страниц в качестве указателя памяти и число зафиксированных страниц в буферном кэше соответственно.

Интервал между запуском [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] и получением буфером кэша указателя памяти называется линейным нарастанием. В течение этого времени читаемые запросы заполняют буфер по мере заполнения. Например, запрос чтения одной страницы заполняет одну страницу буфера. Это означает, что линейное нарастание зависит от числа и типа запросов клиента. Линейное нарастание ускорено, благодаря преобразованию запросов чтения одной страницы в запросы, одновременно работающие с восемью страницами. Это позволяет линейному нарастанию завершить операцию намного быстрее, особенно на машинах с большим объемом памяти.

Поскольку диспетчер буферов использует большой объем памяти в процессе [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , он взаимодействует с диспетчером памяти, чтобы дать возможность другим компонентам использовать его буфер. Диспетчер буферов взаимодействует прежде всего со следующими компонентами.

* Диспетчер ресурсов управляет полным использованием памяти и использованием адресного пространства на 32-разрядных платформах.  
* Диспетчер базы данных и операционная система [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] (SQLOS) для низкоуровневых операций файлового ввода-вывода.  
* Диспетчер журнала для упреждающего ведения журнала.  

### <a name="supported-features"></a>Поддерживаемые функции

Диспетчер буферов поддерживает следующие возможности:

* Он учитывает неоднородный доступ к памяти (NUMA). Страницы буферного кэша распределены между узлами оборудования NUMA, которые позволяют потоку обращаться к странице буфера, расположенной на локальном узле NUMA, а не во внешней памяти. 
* Диспетчер буферов поддерживает технологию памяти с «горячей» заменой, которая позволяет пользователям добавлять физическую память, не перезапуская сервер. 
* Диспетчер буферов поддерживает большие страницы на 64-разрядных платформах. Размер страницы зависит от версии Windows. 
* Диспетчер буферов обеспечивает дополнительную диагностику, выполняемую с помощью динамических административных представлений. Можно использовать эти представления, чтобы контролировать различные ресурсы операционной системы, характерные для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Например, можно использовать представление sys.dm_os_buffer_descriptors, чтобы отслеживать страницы в буферном кэше.   

### <a name="disk-io"></a>Операции дискового ввода-вывода
Диспетчер буферов выполняет только чтение и запись в базу данных. Другие операции над файлами и базами данных, такие как открытие, закрытие, расширение и сжатие, выполняются диспетчером базы данных и компонентами диспетчера файлов. 

Дисковые операции ввода-вывода, выполняемые диспетчером буферов, имеют следующие характеристики.

* Все операции ввода-вывода выполняются асинхронно, что позволяет вызывающему потоку продолжать обработку во время выполнения операции ввода-вывода в фоновом режиме.
* Все операции ввода-вывода происходят в вызывающих потоках, если не используется параметр affinity I/O. Параметр «affinity I/O mask» привязывает операцию дискового ввода-вывода [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] к определенному подмножеству ЦП. В средах [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] высокоскоростной обработки транзакций (OLTP) данное расширение может улучшать производительность потоков [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , выдающих вводы-выводы.
* Операции ввода-вывода нескольких страниц выполняются с операциями ввода-вывода с разбросом, что позволяет передавать данные из прерывающихся областей памяти. Это означает, что [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] может быстро заполнить или записать на диск буферный кэш, предотвращая множество физических запросов операций ввода-вывода. 

#### <a name="long-io-requests"></a>Длительные запросы операций ввода-вывода  
Диспетчер буферов сообщает о любых запросах операций ввода-вывода, которые не были выполнены в течение 15 секунд. Это помогает системному администратору различать ошибки [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] и ошибки подсистемы ввода-вывода. Появляется сообщение об ошибке 833, и в журнал ошибок [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] записывается следующее:

`` 
SQL Server has encountered %d occurrence(s) of I/O requests taking longer than %d seconds to complete on file [%ls] in database [%ls] (%d). The OS file handle is 0x%p. The offset of the latest long I/O is: %#016I64x.
`` 

Длительная операция ввода-вывода может быть чтением или записью; в настоящий момент это не указывается в сообщении. Сообщение о длительной операции ввода-вывода является предупреждением, а не ошибкой. Они не указывают на неполадки [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Сообщения помогают системному администратору быстрее находить причину длительного времени отклика [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] и распознавать ошибки, происходящие вне средств [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Также они не требуют никакого действия, но системный администратор должен выяснить, почему выполнение запроса ввода-вывода заняло столько времени и оправдано ли это.

#### <a name="causes-of-long-io-requests"></a>Причины длительных запросов операций ввода-вывода  
Сообщение о длительной операции ввода-вывода может указывать на то, что ввод-вывод постоянно блокируется и никогда не будет завершен (потерянные операции ввода-вывода) или что он еще не завершен. Из сообщения невозможно узнать, какой сценарий имеет место, хотя потерянные операции ввода-вывода будут часто приводить ко времени ожидания кратковременной блокировки.

Длительные операции ввода-вывода часто имеют рабочую нагрузку [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , которая является слишком интенсивной для дисковой подсистемы. Неуправляемая дисковая подсистема может быть получена в следующих случаях.

* В журнале ошибок появляются несколько сообщений о длительных операциях ввода-вывода во время большой рабочей нагрузки [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .
* Счетчики системного монитора показывают большую задержку, длинные очереди или отсутствие времени простоя диска.  

Длительные операции ввода-вывода также могут быть вызваны компонентом в пути ввода-вывода (например драйвером, контроллером или встроенным ПО), постоянно откладывающим обслуживание старого запроса ввода-вывода в пользу обслуживания более новых запросов, которые ближе к текущей позиции головки диска. Основная методика обработки запросов, которые наиболее близки к текущей позиции головки для чтения-записи, называется «элеваторный поиск». Это довольно сложно отследить с помощью системного монитора Windows (PERFMON.EXE), так как большинство операций ввода-вывода выполняется быстро. Длительные операции ввода-вывода могут усугубляться рабочими нагрузками, которые выполняют большой объем операций последовательного ввода-вывода, например: создание резервных копий и восстановление, просмотр таблиц, сортировку, создание индексов, массовую загрузку и очистку файлов.

Изолированные длительные операции ввода-вывода, которые не связаны с любой из указанных выше причин, могут быть вызваны ошибками драйвера или оборудования. Журнал системных событий может содержать связанные события, которые помогают выявить ошибку.

#### <a name="error-detection"></a>Определение ошибки  
Страницы базы данных могут использовать один из двух дополнительных механизмов, чтобы обеспечить целостность страницы от момента записи на диск до чтения: защита от разрыва страницы и защита контрольной суммой. Эти механизмы позволяют отдельному методу проверить правильность не только хранения данных, но и компонентов оборудования, например контроллеров, драйверов, кабелей и даже операционной системы. Защита присоединяется к странице как раз перед ее записью на диск и выполняет проверку после чтения страницы с диска.

#### <a name="torn-page-protection"></a>Защита от разрыва страницы  
Защита от разрыва страницы, включенная в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2000, является прежде всего способом обнаружения поврежденных страниц из-за сбоев питания. Например, неожиданный сбой питания может оставить только часть страницы, записанной на диск. Когда используется защита от разрыва страницы, в конце каждого 512-байтового сектора на странице помещается 2-битовая подпись (исходные два бита копируются в колонтитул). В подписи после каждой записи чередуются двоичные числа от 01 до 10, поэтому всегда можно определить, когда только часть секторов была записана на диск. Если при последующем считывании выясняется, что состояние бита неправильное, это означает, что страница записана некорректно, и обнаружено ее повреждение. Защита от разрыва страницы использует минимальные ресурсы, однако она не обнаруживает все ошибки, вызванные аппаратными сбоями диска.

#### <a name="checksum-protection"></a>Защита контрольной суммой  
Защита контрольной суммой, включенная в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2005, обеспечивает более надежную проверку целостности данных. Контрольная сумма рассчитывается для данных каждой записанной страницы и сохраняется в колонтитуле. Всякий раз, когда страница с сохраненной контрольной суммой читается с диска, компонент Database Engine повторно вычисляет контрольную сумму для данных страницы и вызывает ошибку 824, если новая контрольная сумма отличается от сохраненной. Защита контрольной суммой может перехватить больше ошибок, чем защита от разрыва страницы, потому что она учитывает каждый байт страницы, однако она более ресурсоемкая. Когда защита контрольной суммой активирована, ошибки, вызванные сбоями питания и поврежденным оборудованием или встроенным ПО, могут быть обнаружены во время чтения страницы с диска диспетчером буферов.

Вид используемой защиты страницы является атрибутом базы данных, содержащей страницу. Защита контрольной суммой задана по умолчанию для баз данных, созданных в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2005 и более поздних версиях. Механизм защиты страницы указывается во время создания базы данных и может быть изменен с помощью инструкции ALTER DATABASE. Установку защиты текущей страницы можно определить, создав запрос значения столбца page_verify_option в представлении каталога [sys.databases](../relational-databases/system-catalog-views/sys-databases-transact-sql.md) или свойства IsTornPageDetectionEnabled функции [DATABASEPROPERTYEX](../t-sql/functions/databasepropertyex-transact-sql.md) . Если установка защиты страницы изменена, новая установка сразу не влияет на всю базу данных. Вместо этого страницы принимают текущий уровень защиты базы данных во время следующей записи. Это означает, что база данных может состоять из страниц с различными видами защиты. 

## <a name="understanding-non-uniform-memory-access"></a>Основные сведения о неоднородном доступе к памяти

Microsoft [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] совместим с архитектурой NUMA и хорошо работает на оборудовании NUMA без дополнительной настройки. С ростом тактовой частоты и количества процессоров становится труднее сократить время задержки памяти, необходимой для использования дополнительной производительности системы. Для устранения этого недостатка поставщики оборудования применяют большие кэши третьего уровня, но это является всего лишь полумерой. Архитектура NUMA обеспечивает масштабируемое решение для этой проблемы. [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] позволяет использовать преимущество компьютеров на основе NUMA без необходимости изменять что-либо в приложении. Дополнительные сведения см. в статье [Как настроить сервер SQL Server на использование программной архитектуры NUMA](../database-engine/configure-windows/soft-numa-sql-server.md).

## <a name="see-also"></a>См. также
[Считывание страниц](../relational-databases/reading-pages.md)   
 [Запись страниц](../relational-databases/writing-pages.md)


