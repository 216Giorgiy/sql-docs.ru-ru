---
title: Интеллектуальная обработка запросов в базах данных Microsoft SQL | Документы Майкрософт
description: Функции интеллектуальной обработки запросов для повышения производительности запросов в SQL Server и базе данных SQL Azure.
ms.custom: ''
ms.date: 07/25/2018
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.suite: sql
ms.technology: ''
ms.tgt_pltfrm: ''
ms.topic: conceptual
helpviewer_keywords: ''
ms.assetid: ''
author: joesackmsft
ms.author: josack
manager: craigg
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017
ms.openlocfilehash: 20c453617ccef36166ca3b9fae62ee0430959e51
ms.sourcegitcommit: 4cd008a77f456b35204989bbdd31db352716bbe6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2018
ms.locfileid: "39562958"
---
# <a name="intelligent-query-processing-in-sql-databases"></a>Интеллектуальная обработка запросов в базах данных SQL
[!INCLUDE[appliesto-ss-asdb-xxxx-xxx-md](../../includes/appliesto-xx-asdb-xxxx-xxx-md.md)]

Семейство функций **интеллектуальной обработки запросов** включает средства, которые значительно повышают производительность существующих рабочих нагрузок и требуют минимальных усилий при реализации.

![Функции интеллектуальной обработки запросов](./media/1_IQPFeatureFamily.png)

## <a name="adaptive-query-processing"></a>Адаптивная обработка запросов
Семейство функций адаптивной обработки запросов включает усовершенствования, которые позволяют применять стратегии оптимизации к среде выполнения рабочих нагрузок ваших приложений. Эти улучшения включают адаптивные соединения в пакетном режиме, обратную связь с временно предоставляемым буфером памяти и выполнение с чередованием для функций с табличным значением с несколькими инструкциями.

### <a name="batch-mode-adaptive-joins"></a>Адаптивные соединения в пакетном режиме
Эта функция позволяет динамически переключить ваш план на лучшую стратегию соединения во время выполнения с использованием одного кэшированного плана.

### <a name="row-and-batch-mode-memory-grant-feedback"></a>Обратная связь по временно предоставляемому буферу памяти в строковом или пакетном режиме
Эта функция пересчитывает фактический объем памяти, необходимый для выполнения запроса, и обновляет размер временно предоставляемого буфера памяти для кэшированного плана. Это позволяет сократить избыточное использование временно предоставляемых буферов памяти и решить проблему с недостатком временно предоставляемых буферов памяти, который вызывает избыточную запись на диск.

### <a name="interleaved-execution-for-multi-statement-table-valued-functions-mstvfs"></a>Выполнение с чередованием для функций с табличным значением с несколькими инструкциями (MSTVF)
При выполнении с чередованием используется фактическое количество строк из функции для принятия обоснованного решения о плане запроса. 

Дополнительные сведения см. в статье [Адаптивная обработка запросов в базах данных SQL](../../relational-databases/performance/adaptive-query-processing.md).

## <a name="table-variable-deferred-compilation"></a>Отложенная компиляция табличных переменных
Отложенная компиляция табличных переменных улучшает качество плана и повышает общую производительность для запросов со ссылкой на табличные переменные. Во время оптимизации и первичной компиляции эта функция будет распространять оценки кратности, основанные на фактическом количестве строк табличной переменной.  Эти точные сведения о количестве строк будут использоваться для оптимизации нижестоящих операций планирования.

При отложенной компиляции табличных переменных компиляция инструкции со ссылкой на табличную переменную откладывается до момента первого фактического выполнения инструкции. Такое поведение при отложенной компиляции идентично поведению временных таблиц. В результате вместо исходного однострочного предположения используется фактическое значение кратности. Чтобы включить общедоступную предварительную версию отложенной компиляции табличных переменных в Базе данных SQL Azure, активируйте режим совместимости базы данных 150 для базы данных, к которой вы подключаетесь при выполнении запроса.

См. дополнительные сведения об [отложенной компиляции табличных переменных](../../t-sql/data-types/table-transact-sql.md#table-variable-deferred-compilation ).

## <a name="approximate-query-processing"></a>Приблизительная обработка запросов
Приблизительная обработка запросов — это новое семейство функций, предназначенных для агрегирования в больших наборах данных, для которых скорость реагирования намного важнее абсолютной точности.  Примером может быть вычисление COUNT(DISTINCT()) в 10 миллиардах строк для отображения на панели мониторинга.  В этом случае абсолютная точность не требуется, но важна скорость реагирования. Новая агрегатная функция APPROX_COUNT_DISTINCT возвращает приблизительное количество уникальных значений, не равных NULL, в группе.

Дополнительные сведения см. в описании [APPROX_COUNT_DISTINCT (Transact-SQL)](../../t-sql/functions/approx-count-distinct-transact-sql.md).

## <a name="see-also"></a>См. также раздел
[Центр производительности для базы данных SQL Azure и ядра СУБД SQL Server](../../relational-databases/performance/performance-center-for-sql-server-database-engine-and-azure-sql-database.md)     
[Руководство по архитектуре обработки запросов](../../relational-databases/query-processing-architecture-guide.md)    
[Справочник по логическим и физическим операторам Showplan](../../relational-databases/showplan-logical-and-physical-operators-reference.md)    
[Соединения](../../relational-databases/performance/joins.md)    
[Демонстрация адаптивной обработки запросов](https://github.com/joesackmsft/Conferences/blob/master/Data_AMP_Detroit_2017/Demos/AQP_Demo_ReadMe.md)        
