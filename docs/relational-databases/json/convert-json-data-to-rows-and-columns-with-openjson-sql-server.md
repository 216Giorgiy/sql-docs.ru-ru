---
title: "Преобразование данных JSON в строки и столбцы с помощью функции OPENJSON (SQL Server) | Microsoft Docs"
ms.custom: 
  - "SQL2016_New_Updated"
ms.date: "01/31/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dbe-json"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "OPENJSON"
  - "JSON, импорт"
  - "Импорт JSON"
ms.assetid: 0c139901-01e2-49ef-9d62-57e08e32c68e
caps.latest.revision: 31
author: "douglaslMS"
ms.author: "douglasl"
manager: "jhubbard"
caps.handback.revision: 27
---
# Преобразование данных JSON в строки и столбцы с помощью функции OPENJSON (SQL Server)
[!INCLUDE[tsql-appliesto-ss2016-asdb-xxxx-xxx_md](../../includes/tsql-appliesto-ss2016-asdb-xxxx-xxx-md.md)]

  Функция набора строк **OPENJSON** позволяет преобразовать текст JSON в набор строк и столбцов. Функцию **OPENJSON** можно использовать для выполнения запросов SQL к коллекциям JSON или для импорта текста JSON в таблицы SQL Server.  
  
> [!NOTE] Функция **OPENJSON** доступна только при **уровне совместимости 130**. Если уровень совместимости базы данных меньше 130, SQL Server не сможет найти и выполнить функцию **OPENJSON**. Другие функции JSON доступны на всех уровнях совместимости. Проверить уровень совместимости можно в представлении sys.databases или в свойствах базы данных.
> 
>   Изменить уровень совместимости базы данных можно с помощью следующей команды:   
>   ALTER DATABASE DatabaseName SET COMPATIBILITY_LEVEL = 130  
  
 Функция **OPENJSON** примет один объект JSON или коллекцию объектов JSON и преобразует их в одну или несколько строк. По умолчанию функция **OPENJSON** возвращает все пары ключ:значение, которые могут находиться на первом уровне объекта JSON, или все элементы в массивах JSON вместе с индексами.  
  
 Указать схему строк, которые нужно получить с помощью функции **OPENJSON**, можно с помощью предложения WITH. Эта явная схема определяет структуру выходных данных.  
  
## Использование функции OPENJSON без схемы результатов

Ниже приведен краткий пример, который использует **OPENJSON**  со схемой по умолчанию и возвращает одну строку для каждого свойства объекта JSON.  
 
Если функция **OPENJSON** используется без указанной схемы необходимых результатов (т. е. без предложения WITH после OPENJSON), она возвращает таблицу с тремя столбцами: имя свойства для входного объекта (или индекс элемента для входного массива), значение свойства или элемента массива и тип (например, строка, число, логическое значение, массив или объект). Свойства объекта JSON (или элементов массива) возвращаются в отдельных строках.  

-   Дополнительные сведения и примеры см. в статье [Использование функции OPENJSON со схемой по умолчанию (SQL Server)](../../relational-databases/json/use-openjson-with-the-default-schema-sql-server.md).
-   Сведения о синтаксисе и использовании см. в статье [OPENJSON (Transact-SQL)](../../t-sql/functions/openjson-transact-sql.md). 

```tsql  
SET @json = '{"name":"John","surname":"Doe","age":45,"skills":["SQL","C#","MVC"]}';  
  
SELECT *  
FROM OPENJSON(@json);  
```  
  
**Результаты**  
  
|Key|value|type|  
|---------|-----------|----------|  
|имя|Джон|1|  
|surname|Doe|1|  
|age|45|2|  
|навыки|["SQL","C#","MVC"]|4|
    
## Использование функции OPENJSON с явной схемой

Ниже представлен краткий пример использования функции **OPENJSON** с явно заданной схемой.  
  
Если указана схема необходимых результатов (с помощью предложения WITH функции **OPENJSON**), функция возвращает таблицу со столбцами, заданными в предложении WITH. В предложении WITH можно указать набор выходных столбцов, их типы и пути исходных свойств JSON для каждого выходного значения. **OPENJSON** переберет массив объектов JSON, считает значение по указанному пути для каждого столбца и конвертирует его в заданный тип.  

-   Дополнительные сведения и примеры см. в статье [Использование функции OPENJSON с явной схемой (SQL Server)](../../relational-databases/json/use-openjson-with-an-explicit-schema-sql-server.md).
-   Сведения о синтаксисе и использовании см. в статье [OPENJSON (Transact-SQL)](../../t-sql/functions/openjson-transact-sql.md).
  
```tsql  
SET @json =   
 N'[  
      {  
        "Order": {  
          "Number":"SO43659",  
          "Date":"2011-05-31T00:00:00"  
        },  
        "AccountNumber":"AW29825",  
        "Item": {  
          "Price":2024.9940,  
          "Quantity":1  
        }  
      },  
      {  
        "Order": {  
          "Number":"SO43661",  
          "Date":"2011-06-01T00:00:00"  
        },  
        "AccountNumber":"AW73565",  
        "Item": {  
          "Price":2024.9940,  
          "Quantity":3  
        }  
     }  
]'  
  
SELECT * FROM  
OPENJSON ( @json )  
WITH (   
             Number   varchar(200) '$.Order.Number' ,  
             Date     datetime     '$.Order.Date',  
             Customer varchar(200) '$.AccountNumber',  
             Quantity int          '$.Item.Quantity'  
)  
```  
  
**Результаты**  
  
|Количество|Дата|Customer|Количество|  
|------------|----------|--------------|--------------|  
|SO43659|2011-05-31T00:00:00|AW29825|1|  
|SO43661|2011-06-01T00:00:00|AW73565|3|  
  
 Эта функция возвращает и форматирует элементы массива JSON.  
  
-   Для каждого элемента в массиве JSON функция **OPENJSON** создает новую строку в выходной таблице. Два элемента в массиве JSON конвертируются в две строки в таблице результатов.  
  
-   Для каждого столбца, указанного с помощью синтаксиса `colName type json_path`, функция **OPENJSON** конвертирует значение, найденное в элементах массива по указанному пути, в указанный тип и заполняет ячейки в таблице результатов. В этом примере значения для столбца дат взяты из каждого объекта в пути `$.Order.Date` и конвертированы в значения даты и времени.  
  
После того как коллекция данных JSON будет преобразована в набор строк, можно выполнить любой запрос SQL к полученным данным или вставить их в любую таблицу.  
  
## Дополнительные сведения о функции OPENJSON и встроенной поддержке JSON в SQL Server  
 [Публикации блога Йована Поповича (Jovan Popovic), руководителя программы Microsoft](http://blogs.msdn.com/b/sqlserverstorageengine/archive/tags/json/)  
  
## См. также:  
 [OPENJSON (Transact-SQL)](../../t-sql/functions/openjson-transact-sql.md)  
  
  