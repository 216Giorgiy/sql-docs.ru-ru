---
title: "Управление размером файла журнала транзакций | Microsoft Docs"
ms.custom: ""
ms.date: "07/14/2016"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dbe-transaction-log"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "журналы транзакций [SQL Server], управление размерами"
ms.assetid: 3a70e606-303f-47a8-96d4-2456a18d4297
caps.latest.revision: 23
author: "JennieHubbard"
ms.author: "jhubbard"
manager: "jhubbard"
caps.handback.revision: 22
---
# Управление размером файла журнала транзакций
В данном разделе содержатся сведения о мониторинге размера журнала транзакций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , сжатии журнала транзакций, добавлении или увеличении файла журнала транзакций, оптимизации скорости роста журнала транзакций **tempdb** , а также об управлении размером файла журнала транзакций.  

  ##  <a name="MonitorSpaceUse"></a> Мониторинг используемого пространства журнала  
Контролировать используемое пространство журнала можно с помощью команды DBCC SQLPERF (LOGSPACE). Она возвращает сведения об объеме пространства, используемого журналом в данный момент, и указывает, необходимо ли провести усечение журнала транзакций. Дополнительные сведения см. в разделе [DBCC SQLPERF (Transact-SQL)](../../t-sql/database-console-commands/dbcc-sqlperf-transact-sql.md). Для получения сведений о текущем размере файла журнала, его максимальном размере и параметре автоматического увеличения файла вы можете также использовать столбцы **size**, **max_size** и **growth** для данного файла журнала в представлении **sys.database_files**. Дополнительные сведения см. в разделе [sys.database_files (Transact-SQL)](../../relational-databases/system-catalog-views/sys-database-files-transact-sql.md).  
  
**Важно.** Избегайте переполнения диска, содержащего журналы.  

  
##  <a name="ShrinkSize"></a> Уменьшение размера файла журнала  
 Для уменьшения реального размера физического файла журнала необходимо выполнить его сжатие. Это полезно, если файл журнала транзакций содержит неиспользованное пространство, которое вам не потребуется. Сжатие файла журнала может производиться только в том случае, если база данных находится в режиме "в сети" и свободен хотя бы один виртуальный файл журнала. В ряде случаев сжатие невозможно до тех пор, пока не выполнена следующая операция усечения журнала.  
  
> [!NOTE]  Такие факторы, как долго выполняемые транзакции, удерживающие файлы журналов в активном состоянии в течение продолжительного периода времени, могут ограничить или вовсе не допустить возможность сжатия журнала. Дополнительные сведения о факторах, из-за которых усечение журнала может откладываться, см. в разделе [Журнал транзакций (SQL Server)](../../relational-databases/logs/the-transaction-log-sql-server.md).  
  
 В процессе сжатия файла журнала удаляется один или несколько виртуальных файлов журнала, которые не содержат частей логического журнала (*неактивные виртуальные файлы журнала*). При сжатии файла журнала транзакций в конце файла журнала удаляется достаточное количество неактивных виртуальных файлов журнала, чтобы журнал уменьшился до приблизительного целевого размера.  
  
 **Сжатие файла журнала (без сжатия файлов базы данных)**  
  
-   [DBCC SHRINKFILE (Transact-SQL)](../../t-sql/database-console-commands/dbcc-shrinkfile-transact-sql.md)  
  
-   [Сжатие файла](../../relational-databases/databases/shrink-a-file.md)  
  
 **Мониторинг событий сжатия файла журнала**  
  
-   [Log File Auto Shrink Event Class](../../relational-databases/event-classes/log-file-auto-shrink-event-class.md).  
  
 **Мониторинг пространства журнала**  
  
-   [DBCC SQLPERF (Transact-SQL)](../../t-sql/database-console-commands/dbcc-sqlperf-transact-sql.md)  
  
-   [sys.database_files (Transact-SQL)](../../relational-databases/system-catalog-views/sys-database-files-transact-sql.md) (См. столбцы **size**, **max_size** и **growth** файла или файлов журнала.)  
  
> [!NOTE]  Можно задать автоматическое выполнение сжатия файлов базы данных и журнала. Однако автоматическое сжатие не рекомендуется, поэтому свойство **autoshrink** базы данных по умолчанию имеет значение FALSE. Если свойство **autoshrink** имеет значение TRUE, то автоматическое сжатие уменьшит размер файла только в том случае, если неиспользуемое пространство занимает более 25 % от общего объема. Файл будет сжат либо до размера, в котором 25 % пространства не используется, либо до исходного размера, каким бы большим он ни был. Сведения об установке свойства **autoshrink** см. в разделе [Просмотр или изменение свойств базы данных](../../relational-databases/databases/view-or-change-the-properties-of-a-database.md) при использовании свойства **Автоматическое сжатие** на странице **Параметры** или в разделе [Параметры ALTER DATABASE SET (Transact-SQL)](../Topic/ALTER%20DATABASE%20SET%20Options%20\(Transact-SQL\).md) при использовании параметра AUTO_SHRINK.  
  

##  <a name="AddOrEnlarge"></a> Добавление или увеличение размера файла журнала  
 Кроме того, можно выделить дополнительное место на диске путем увеличения существующего файла журнала (если для этого достаточно места на диске) либо путем добавления файла журнала в базу данных, как правило, на другом диске.  
  
-   Файл журнала добавляется в базу данных с помощью предложения ADD LOG FILE инструкции ALTER DATABASE. Это позволяет увеличить размер файла.  
  
-   Файл журнала можно увеличить с помощью предложения MODIFY FILE инструкции ALTER DATABASE. При этом следует указать синтаксис SIZE и MAXSIZE. Дополнительные сведения см. в разделе [ALTER DATABASE (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql.md).  
    
  
##  <a name="tempdbOptimize"></a> Оптимизация размера журнала транзакций tempdb  
 При перезапуске экземпляра сервера размер журнала транзакций базы данных **tempdb** изменяется и становится равным исходному размеру, который был до применения параметра автоматического увеличения файла. Это может понизить производительность журнала транзакций базы данных **tempdb** . Этого можно избежать с помощью увеличения размера журнала транзакций базы данных **tempdb** после запуска или перезапуска экземпляра сервера. Дополнительные сведения см. в статье [tempdb Database](../../relational-databases/databases/tempdb-database.md).  
  
  
##  <a name="ControlGrowth"></a> Управление увеличением размера файла журнала транзакций  
 Для управления размером файла журнала транзакций вы можете использовать инструкцию [ALTER DATABASE (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql.md). Следует отметить следующее.  
  
-   Чтобы изменить текущий размер файла в КБ, МБ, ГБ и ТБ, используйте параметр «SIZE».  
  -   Чтобы изменить шаг приращения размера, используйте параметр FILEGROWTH. Значение 0 указывает, что автоматическое приращение выключено и дополнительное пространство для файла не разрешено. Небольшое значение параметра автоувеличения прироста размера файла журнала может снизить производительность системы. Во избежание слишком частых увеличений размера файла журнала следует задать достаточно большое значение шагу роста файла журнала. Как правило, достаточно установить значение увеличения шага роста равным 10 %.  

Сведения об изменении свойства прироста для файлов журнала см. в разделе [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/ms174269.aspx).  
  
-   Чтобы установить максимальный размер файла журнала в КБ, МБ, ГБ и ТБ или задать неограниченный размер, используйте параметр MAXSIZE.  
  
  
## См. также:  
 [BACKUP (Transact-SQL)](../../t-sql/statements/backup-transact-sql.md)   
 [Устранение неполадок при переполнении журнала транзакций (ошибка SQL Server 9002)](../../relational-databases/logs/troubleshoot-a-full-transaction-log-sql-server-error-9002.md)  
  
  