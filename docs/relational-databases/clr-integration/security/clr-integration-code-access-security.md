---
title: "Среда CLR Integration Code Access Security | Документы Microsoft"
ms.custom: 
ms.date: 03/17/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine
ms.service: 
ms.component: clr
ms.reviewer: 
ms.suite: sql
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: reference
helpviewer_keywords:
- UNSAFE assemblies
- permissions [CLR integration]
- common language runtime [SQL Server], security
- SAFE assemblies
- code access security [CLR integration]
- EXTERNAL_ACCESS assemblies
ms.assetid: 2111cfe0-d5e0-43b1-93c3-e994ac0e9729
caps.latest.revision: 
author: rothja
ms.author: jroth
manager: craigg
ms.workload: On Demand
ms.openlocfilehash: b93a1955adb6f38eebd8de86599e1861a80ff75b
ms.sourcegitcommit: acab4bcab1385d645fafe2925130f102e114f122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2018
---
# <a name="clr-integration-code-access-security"></a>Управление доступом для кода на основе интеграции со средой CLR
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
Среда CLR поддерживает модель безопасности, называемую управлением доступом для кода. В этой модели разрешения предоставляются сборкам на основе идентификатора кода. Дополнительные сведения см. в разделе «Управление доступом для кода» справочной документации пакета средств разработки программного обеспечения .NET Framework.  
  
 Политика безопасности, которая регламентирует разрешения, предоставляемые сборкам, определяется в трех разных местах.  
  
-   Политики компьютера: — это политика действует для всего управляемого кода, выполнение на компьютере, на котором [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] установлен.  
  
-   Политика пользователя: политики, применяемые для управляемого кода в процессе. Для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] применяемая политика пользователя зависит от учетной записи Windows, от имени которой работает служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
-   Политика размещения: политики, Настройка узлом среды CLR (в этом случае [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]), действует для управляемого кода, выполняемый на узле.  
  
 Механизм управления доступом к коду, поддерживаемый средой CLR, основан на предположении, что в среде времени выполнения может размещаться код, доверенный полностью или частично. Ресурсы, которые защищены с помощью управления доступом для кода среды CLR, обычно окружены управляемый API-интерфейсы, необходимо разрешение на соответствующий перед предоставлением доступа к ресурсу. Требование разрешения удовлетворяется только в том случае, если все вызывающие элементы (на уровне сборки) в стеке вызовов обладают соответствующими ресурсными разрешениями.  
  
 Набор разрешений CAS, которые предоставляются управляемому коду при его выполнении в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], является пересечением наборов разрешений, предоставляемых на трех указанных уровнях политики. Даже если [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет ряд разрешений сборке, загруженной в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], в конечном итоге набор разрешений, которые предоставлены пользовательскому коду, может быть подвергнут дальнейшему сокращению с учетом политик, заданных на уровне пользователя и компьютера.  
  
## <a name="sql-server-host-policy-level-permission-sets"></a>Наборы разрешений на уровне политики узла SQL Server  
 Набор разрешений CAS, который предоставляется определяемым пользователем сборкам на уровне политики узла [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], определяется набором разрешений, заданным при создании сборки. Существуют три набора разрешений: **БЕЗОПАСНОМ**, **EXTERNAL_ACCESS** и **UNSAFE** (с использованием **PERMISSION_SET** параметр [ СОЗДАТЬ СБОРКУ &#40; Transact-SQL &#41; ](../../../t-sql/statements/create-assembly-transact-sql.md)).  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляют среде CLR уровень политики безопасности на уровне сервера размещенной; Эта политика представляет собой дополнительный уровень политики ниже, уже действующих уровней политики для двух. Данная политика задается для каждого домена приложений, создаваемого службами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Эта политика не предназначена для домена приложения по умолчанию, который применяется при создании в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляра среды CLR.  
  
 Политика на уровне узла служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] является сочетанием фиксированной политики служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для системных сборок и пользовательской политики для пользовательских сборок.  
  
 Фиксированная политика для сборок CLR и системных сборок [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет этим сборкам полное доверие.  
  
 В основе пользовательской части политики сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] лежит указание владельцем сборки одного из трех сегментов разрешений для каждой сборки. Дополнительные сведения о правах доступа, перечисленных ниже, см. в документации пакета SDK для платформы .NET Framework.  
  
### <a name="safe"></a>SAFE  
 Разрешаются только внутренние вычисления и локальный доступ к данным. **БЕЗОПАСНЫЙ** является наиболее ограниченным набором разрешений. Код, выполняемый сборкой с **БЕЗОПАСНОМ** разрешения не может получить доступ к внешним системным ресурсам — файлам, сети, переменные среды или реестру.  
  
 **БЕЗОПАСНЫЙ** сборки имеют следующие разрешения и значения:  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|**SecurityPermission**|**Выполнение:** разрешение на выполнение управляемого кода.|  
|**SqlClientPermission**|**Контекстное соединение = true**, **контекстного соединения = yes**: только контекстное соединение можно использовать и строку подключения можно указать только значение «контекстного соединения = true» или «контекстного соединения = yes».<br /><br /> **AllowBlankPassword = false:** пустые пароли не допускаются.|  
  
### <a name="externalaccess"></a>EXTERNAL_ACCESS  
 Сборки EXTERNAL_ACCESS имеют те же разрешения, что **БЕЗОПАСНОМ** сборки с дополнительными возможностями для доступа к внешним системным ресурсам, например файлы, сети, переменные среды и реестр.  
  
 **EXTERNAL_ACCESS** сборки обладают следующими разрешениями и значениями:  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|**DistributedTransactionPermission**|**Неограниченный доступ:** распределенные транзакции допускаются.|  
|**DNSPermission**|**Неограниченный доступ:** разрешений для запроса данных от DNS-серверов.|  
|**EnvironmentPermission**|**Неограниченный доступ:** полный доступ к системным и пользовательским переменным среды.|  
|**EventLogPermission**|**Администрирование:** разрешаются следующие действия: Создание источника событий, чтение существующих журналов, удаление источников событий или журналов, формирование ответов на записи, очистка журнала событий, прослушивание событий и доступ к коллекции всех журналов событий.|  
|**FileIOPermission**|**Неограниченный доступ:** полный доступ к файлам и папкам допускается.|  
|**KeyContainerPermission**|**Неограниченный доступ:** полный доступ к контейнерам ключей.|  
|**NetworkInformationPermission**|**Доступ:** Pinging разрешен.|  
|**RegistryPermission**|Предоставляет право чтения разделов для **HKEY_CLASSES_ROOT**, **HKEY_LOCAL_MACHINE**, **HKEY_CURRENT_USER**, **HKEY_CURRENT_CONFIG**и  **HKEY_USERS.**|  
|**SecurityPermission**|**Утверждение:** способность подтверждать, что все вызывающие объекты этого кода имеют необходимое разрешение для операции.<br /><br /> **ControlPrincipal:** возможность управления объектом-участником.<br /><br /> **Выполнение:** разрешение на выполнение управляемого кода.<br /><br /> **SerializationFormatter:** возможность предоставлять услуги сериализации.|  
|**SmtpPermission**|**Доступ:** разрешены исходящие соединения с портом сервера SMTP 25.|  
|**SocketPermission**|**Подключение:** разрешены исходящие соединения (всех портов и протоколов) по транспортному адресу.|  
|**SqlClientPermission**|**Неограниченный доступ:** полный доступ к источнику данных.|  
|**StorePermission**|**Неограниченный доступ:** полный доступ для сертификата X.509 может быть хранилищ.|  
|**WebPermission**|**Подключение:** разрешены исходящие соединения для веб-ресурсов.|  
  
### <a name="unsafe"></a>UNSAFE  
 Набор UNSAFE предоставляет сборкам неограниченный доступ к внутренним и внешним ресурсам [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Код, исполняемый внутри **UNSAFE** сборки также может вызывать неуправляемый код.  
  
 **НЕБЕЗОПАСНЫЙ** сборки, получающие **FullTrust**.  
  
> [!IMPORTANT]  
>  **БЕЗОПАСНЫЙ** является рекомендованной установкой разрешений для сборок, которые выполняют задачи вычисления и данных управления без доступа к ресурсам за пределами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. **EXTERNAL_ACCESS** рекомендуется для сборок, которые обращаются к ресурсам за пределами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. **EXTERNAL_ACCESS** сборки по умолчанию, выполняются как [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] учетной записи службы. Существует возможность **EXTERNAL_ACCESS** код может явно олицетворять контекст безопасности вызывающего проверку подлинности Windows. Поскольку по умолчанию для выполнения в качестве [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] учетная запись службы, разрешение на выполнение **EXTERNAL_ACCESS** должно предоставляться только именам входа, которым доверено выполняться как учетная запись службы. С точки зрения безопасности **EXTERNAL_ACCESS** и **UNSAFE** сборки идентичны. Тем не менее **EXTERNAL_ACCESS** сборки обеспечивают различные надежные и устойчивые средства защиты, не входящие в **UNSAFE** сборки. Указание **UNSAFE** позволяет коду в сборке выполнять запрещенные операции в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] пространстве процесса и таким образом можно нарушать устойчивость и масштабируемость [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Дополнительные сведения о создании сборок CLR в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], в разделе [Управление сборками интеграции со средой CLR](../../../relational-databases/clr-integration/assemblies/managing-clr-integration-assemblies.md).  
  
## <a name="accessing-external-resources"></a>Доступ к внешним ресурсам  
 Если зарегистрирован определяемых пользователем типов (UDT), хранимая процедура или другого типа сборки конструкция **БЕЗОПАСНОМ** набор разрешений, а затем управляемого кода, выполняемого в конструкции не удается получить доступ к внешним ресурсам. Тем не менее если параметр **EXTERNAL_ACCESS** или **UNSAFE** указываются наборы разрешений, а управляемый код пытается получить доступ к внешним ресурсам [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] применяются следующие правила:  
  
|Если оператор|То|  
|--------|----------|  
|Контекст выполнения соответствует имени входа [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|Попытки получить доступ к внешним ресурсам отклоняются, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, и контекстом выполнения является первоначальный вызывающий объект.|Доступ к внешнему ресурсу предоставляется в контексте безопасности учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|  
|Вызывающий объект не является первоначальным вызывающим объектом.|Доступ запрещается, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, контекст выполнения является исходным вызывающим объектом, а к вызывающему объекту применяется олицетворение.|При доступе используется контекст безопасности вызывающего объекта, а не учетная запись службы.|  
  
## <a name="permission-set-summary"></a>Сводные данные о наборе разрешений  
 На следующей диаграмме показаны ограничения и разрешения, предоставленные **БЕЗОПАСНОМ**, **EXTERNAL_ACCESS**, и **UNSAFE** наборов разрешений.  
  
|||||  
|-|-|-|-|  
||**SAFE**|**EXTERNAL_ACCESS**|**UNSAFE**|  
|**Разрешения управления доступом для кода**|Только выполнение|Выполнение и доступ к внешним ресурсам|Неограниченное (включая P/Invoke)|  
|**Ограничения модели программирования**|Да|Да|Без ограничений|  
|**Требование к проверяемости**|Да|Да|нет|  
|**Доступ к локальным данным**|Да|Да|Да|  
|**Возможность вызова машинного кода**|нет|Нет|Да|  
  
## <a name="see-also"></a>См. также:  
 [Безопасность интеграции со средой CLR](../../../relational-databases/clr-integration/security/clr-integration-security.md)   
 [Атрибуты защиты узла и программирование средств интеграции со средой CLR](../../../relational-databases/clr-integration-security-host-protection-attributes/host-protection-attributes-and-clr-integration-programming.md)   
 [Ограничения модели программирования интеграции со средой CLR](../../../relational-databases/clr-integration/database-objects/clr-integration-programming-model-restrictions.md)   
 [Среда размещения CLR](../../../relational-databases/clr-integration/clr-integration-architecture-clr-hosted-environment.md)  
  
  
