---
title: "График архитектуры SQL | Документы Microsoft"
ms.custom: 
ms.date: 04/19/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine, sql-database
ms.service: 
ms.component: graphs
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
helpviewer_keywords:
- SQL graph
- SQL graph, architecture
ms.assetid: 
caps.latest.revision: "1"
author: shkale-msft
ms.author: shkale;barbkess
manager: jhubbard
ms.workload: On Demand
ms.openlocfilehash: 30748d9c5cf8a53b7e04c9897ba2fe70fa32972e
ms.sourcegitcommit: dcac30038f2223990cc21775c84cbd4e7bacdc73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="sql-graph-architecture"></a>График архитектуры SQL  
[!INCLUDE[tsql-appliesto-ss2017-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2017-asdb-xxxx-xxx-md.md)]

Узнайте, как спроектирован SQL Graph. Знание основ сделает облегчает понимание другие статьи SQL Graph.
 
## <a name="sql-graph-database"></a>База данных SQL графа
Пользователи могут создавать один график каждой базы данных. График — это коллекция таблиц узла и границей. Узел или край таблицы можно создать в любой схемы в базе данных, но все они принадлежат к одной логической диаграммы. Таблица узел представляет коллекцию узлов того же типа. Например таблицы Person узел содержит все узлы лица, относящихся к диаграмме. Аналогичным образом краевую таблицу — это совокупность краев того же типа. Например друзей краевой таблице содержит всем краям, которые подключаются к другому лицу человека. Поскольку узлы и ребра, хранятся в таблицах, большинство операций, поддерживаемых в обычных таблицах поддерживаются на узел или края таблицы. 
 
 
![Архитектура SQL-graph](../../relational-databases/graphs/media/sql-graph-architecture.png "архитектуры базы данных Sql графа")   

Рисунок 1: Архитектура базы данных SQL графа
 
## <a name="node-table"></a>Таблица узла
Таблица узла представляет сущность в схему графа. Каждый раз, узел создается таблица, вместе со столбцами определяемых пользователем, неявный `$node_id` создается столбец, который однозначно идентифицирует заданного узла в базе данных. Значения в `$node_id` автоматически создаются и представляют собой сочетание `object_id` из этой таблицы узла и значение типа bigint внутренне созданные. Тем не менее, когда `$node_id` выбран столбец, отображается вычисленное значение в виде строки JSON. Кроме того `$node_id` представляет собой Псевдостолбец, который сопоставляется с шестнадцатеричной строки в его внутреннее имя. При выборе `$node_id` из таблицы, имя столбца будет отображаться как `$node_id_<hex_string>`. Использование имен псевдо столбцов в запросах — рекомендуемый способ запроса к внутреннему `$node_id` следует избегать столбца, а также использование внутренних имен с шестнадцатеричная строка.

Рекомендуется, пользователи создают уникальное ограничение или индекс для столбца `$node_id` столбец во время создания узла таблицу, но если он не создан, значение по умолчанию, автоматически создается уникальный некластеризованный индекс. Тем не менее любой индекс на столбце псевдо graph создается на базовые столбцы внутренней. То есть индексом, созданным для `$node_id` столбца, будут отображаться на внутренний `graph_id_<hex_string>` столбца.   


## <a name="edge-table"></a>Краевой таблицы
Краевая таблица представляет связь в графе. Границы всегда направляются и соединения двух узлов. Краевой таблицы позволяет пользователям модели многие ко многим связей в графе. Краевую таблицу может или не может иметь определенные пользователем атрибуты его. Всякий раз при создании краевую таблицу с атрибутами определяемых пользователем в краевой таблице создаются три неявно столбцы:

|Имя столбца    |Описание  |
|---   |---  |
|`$edge_id`   |Уникально идентифицирует заданной границы в базе данных. Это созданный столбец и значение представляет собой сочетание object_id краевую таблицу и значение созданного внутреннего типа bigint. Тем не менее, когда `$edge_id` выбран столбец, отображается вычисленное значение в виде строки JSON. `$edge_id`представляет собой псевдо столбец, который сопоставляется с шестнадцатеричной строки в его внутреннее имя. При выборе `$edge_id` из таблицы, имя столбца будет отображаться как `$edge_id_\<hex_string>`. Использование имен псевдо столбцов в запросах — рекомендуемый способ запроса к внутреннему `$edge_id` следует избегать столбца, а также использование внутренних имен с шестнадцатеричная строка. |
|`$from_id`   |Магазины `$node_id` узла, из которого исходят границе.  |
|`$to_id`   |Магазины `$node_id` узла, с которой завершает край. |

Узлы подключаются заданном краю регулируется вставленные данные в `$from_id` и `$to_id` столбцов. В первом выпуске не можно определить ограничения на краевую таблицу, чтобы запретить подключения любого два типа узлов. То есть граница можно подключиться любыми двумя узлами, на графе, независимо от их типов.

Аналогично `$node_id` столбца, рекомендуется пользователей создать уникальный индекс или ограничение на `$edge_id` столбец во время создания краевую таблицу, но если он не создан, значение по умолчанию на автоматически создается уникальный некластеризованный индекс Этот столбец. Тем не менее любой индекс на столбце псевдо graph создается на базовые столбцы внутренней. То есть индексом, созданным для `$edge_id` столбца, будут отображаться на внутренний `graph_id_<hex_string>` столбца. Также рекомендуется, для сценариев OLTP, которые пользователи создать индекс для (`$from_id`, `$to_id`) столбцов быстрее уточняющих запросов в направлении края.  

На рисунке 2 показано, как узел и границей таблицы хранятся в базе данных. 

![лицо, друзей, таблицы](../../relational-databases/graphs/media/person-friends-tables.png "узел Person и друзья ребро таблиц")   

Рис. 2: Представление таблицы узла и границей



## <a name="metadata"></a>Метаданные
Эти метаданные представления можно используйте для просмотра атрибуты узла или края таблицы.
 
### <a name="systables"></a>sys.tables
Следующие новые возможности, бит типа, будут добавлены столбцы для SYS. ТАБЛИЦЫ. Если `is_node` имеет значение 1, которое указывает, что таблица является таблицей узла и, если `is_edge` имеет значение 1, которое указывает, что таблица является краевую таблицу.
 
|Имя столбца |Тип данных |Описание |
|--- |---|--- |
|is_node |bit |1 = таблица узла |
|is_edge |bit |1 = это краевой таблицы |
 
### <a name="syscolumns"></a>sys.columns
`sys.columns` Представление содержит дополнительные столбцы `graph_type` и `graph_type_desc`, указывающие тип столбца в таблицах на узле и границей.
 
|Имя столбца |Тип данных |Описание |
|--- |---|--- |
|graph_type |int |Внутренний столбец с набором значений. 1 – 8 для графа столбцы значения NULL для других пользователей.  |
|graph_type_desc |nvarchar(60)  |внутренний столбец с набором значений |
 
В следующей таблице перечислены допустимые значения для `graph_type` столбца

|Значение столбца  |Описание  |
|---   |---   |
|1  |GRAPH_ID  |
|2  |GRAPH_ID_COMPUTED  |
|3  |GRAPH_FROM_ID  |
|4  |GRAPH_FROM_OBJ_ID  |
|5  |GRAPH_FROM_ID_COMPUTED  |
|6  |GRAPH_TO_ID  |
|7  |GRAPH_TO_OBJ_ID  |
|8  |GRAPH_TO_ID_COMPUTED  |


`sys.columns`также хранит сведения о неявных столбцов, созданных в узел или края таблицы. Следующие сведения могут быть получены из sys.columns, тем не менее, пользователи не смогут устанавливать эти столбцы из узла или края таблицы. 

Неявные столбцы в таблице узлов  
|Имя столбца    |Тип данных  |is_hidden  |Комментарий  |
|---  |---|---|---  |
|graph_id_\<hex_string> |bigint |1  |столбец внутреннего graph_id  |
|$node_id_\<hex_string> |NVARCHAR   |0  |Идентификатор столбца внешних узлов  |

Неявные столбцы в краевой таблицы  
|Имя столбца    |Тип данных  |is_hidden  |Комментарий  |
|---  |---|---|---  |
|graph_id_\<hex_string> |bigint |1  |столбец внутреннего graph_id  |
|$edge_id_\<hex_string> |NVARCHAR   |0  |Идентификатор столбца внешнего края  |
|from_obj_id_\<hex_string>  |INT    |1  |внутренний узел из объекта с идентификатором  |
|from_id_\<hex_string>  |bigint |1  |Внутренняя из graph_id узла  |
|$from_id_\<hex_string> |NVARCHAR   |0  |внешние из идентификатор узла  |
|to_obj_id_\<hex_string>    |INT    |1  |Внутренний идентификатор объекта узла  |
|to_id_\<hex_string>    |bigint |1  |Внутренний узел graph_id  |
|$to_id_\<hex_string>   |NVARCHAR   |0  |внешние идентификатор узла  |
 
### <a name="system-functions"></a>Системные функции
Будут добавлены следующие встроенные функции. Это поможет пользователям извлекать данные из созданных столбцов. Обратите внимание, что эти методы не будет проверять входные данные пользователя. Если пользователь указывает недопустимый `sys.node_id` извлекают подходящую часть и возврат его в метод. Например, будет использоваться OBJECT_ID_FROM_NODE_ID `$node_id` качестве входных данных и возвращает идентификатор object_id таблицы, принадлежит данный узел. 
 
|Встроено   |Описание  |
|---  |---  |
|OBJECT_ID_FROM_NODE_ID |Извлечение из node_id object_id  |
|GRAPH_ID_FROM_NODE_ID  |Извлечение из node_id graph_id  |
|NODE_ID_FROM_PARTS |Конструкция node_id object_id и graph_id  |
|OBJECT_ID_FROM_EDGE_ID |Извлечение из edge_id object_id  |
|GRAPH_ID_FROM_EDGE_ID  |Извлечение удостоверения из edge_id  |
|EDGE_ID_FROM_PARTS |Конструкция edge_id из object_id и удостоверение  |



## <a name="transact-sql-reference"></a>Справочник по Transact-SQL 
Дополнительные сведения [!INCLUDE[tsql-md](../../includes/tsql-md.md)] расширения, появившиеся в SQL Server и базы данных SQL Azure, которые обеспечивают возможность создания и выполнения запросов к объектам графа. Расширения языка запросов справки запрос и просмотрите граф с использованием синтаксиса art ASCII.
 
### <a name="data-definition-language-ddl-statements"></a>Данные инструкции языка определения (DDL)
|Задача   |Связанный раздел  |Примечания
|---  |---  |---  |
|CREATE TABLE |[CREATE TABLE (Transact-SQL)](../../t-sql/statements/create-table-sql-graph.md)|`CREATE TABLE `Теперь расширяется для поддержки создания узла AS или AS КРАЯ таблицы. Обратите внимание, что краевую таблицу может или не может иметь любой пользователь, определенные атрибуты.  |
|ALTER TABLE    |[ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md)|Узел и границей таблицы можно изменить так же, как реляционной таблице, используя `ALTER TABLE`. Пользователи могут добавлять или изменять столбцы определяемых пользователем, индексы или ограничения. Изменение столбцов внутренних graph, однако, как `$node_id` или `$edge_id`, приведет к ошибке.  |
|CREATE INDEX   |[CREATE INDEX (Transact-SQL)](../../t-sql/statements/create-index-transact-sql.md)  |Пользователи могут создавать индексы на псевдостолбцов и заданные пользователем столбцы в таблицах на узле и границей. Поддерживаются все типы индексов, включая кластеризованный и некластеризованный индексы columnstore.  |
|DROP TABLE |[DROP TABLE &#40; Transact-SQL &#41;](../../t-sql/statements/drop-table-transact-sql.md)  |Узел и границей таблиц можно удалить используя реляционную таблицу так же, как `DROP TABLE`. Однако в этом выпуске нет никаких ограничений, чтобы нет краев пункты удаленного узла и каскадного удаления границ, после удаления узла или узла таблицы не поддерживается. Рекомендуется, если удаляется таблица узла, пользователи drop краям, подключенных к узлам в этой таблице узлов вручную, чтобы обеспечить целостность графа.  |


### <a name="data-manipulation-language-dml-statements"></a>Инструкции языка Обработки данных
|Задача   |Связанный раздел  |Примечания
|---  |---  |---  |
|INSERT |[INSERT (Transact-SQL)](../../t-sql/statements/insert-sql-graph.md)|Вставка в таблицу узел ничем не отличается от вставки в реляционной таблице. Значения для `$node_id` столбца создается автоматически. При попытке вставки значения в `$node_id` или `$edge_id` столбца приведет к ошибке. Пользователи должны предоставить значения для `$from_id` и `$to_id` столбцов при вставке в краевой таблицы. `$from_id`и `$to_id` , `$node_id` значения, заданного ребро соединяет узлов.  |
|DELETE | [DELETE (Transact-SQL)](../../t-sql/statements/delete-transact-sql.md)|Можно удалить данные из таблиц узла или край таким же образом, как она будет удалена из реляционных таблиц. Однако в этом выпуске нет никаких ограничений, чтобы нет краев пункты удаленного узла и каскадного удаления границ, после удаления узла не поддерживается. Рекомендуется, что при каждом удалении узла всем краям, подключающегося к этому узлу также удаляются, для обеспечения целостности графа.  |
|UPDATE |[UPDATE (Transact-SQL)](../../t-sql/queries/update-transact-sql.md)  |Можно обновить значения в столбцах определяемых пользователем, с помощью инструкции UPDATE. Обновление столбцов внутренних графа, `$node_id`, `$edge_id`, `$from_id` и `$to_id` не допускается.  |
|MERGE |[MERGE (Transact-SQL)](../../t-sql/statements/merge-transact-sql.md)  |`MERGE`Инструкция не поддерживается на узле или края таблицы.  |


### <a name="query-statements"></a>Операторы запроса
|Задача   |Связанный раздел  |Примечания
|---  |---  |---  |
|SELECT |[SELECT (Transact-SQL)](../../t-sql/queries/select-transact-sql.md)|Узлы и ребра, хранятся в виде таблицы внутренне, таким образом большинство операций, поддерживаемых в таблице в SQL Server или база данных SQL Azure поддерживаются на узел и границей таблицы  |
|MATCH  | [УЧИТЫВАТЬ &#40; Transact-SQL &#41;](../../t-sql/queries/match-sql-graph.md)|Встроенные соответствия введен для поддержки сопоставления шаблонов и прохождения через граф.  |



## <a name="limitations-and-known-issues"></a>Ограничения и известные проблемы  
Существуют некоторые ограничения на узел и границей таблицы в этом выпуске:
* Локальные или глобальные временные таблицы не может быть узел или края таблицы.
* Табличные типы и табличные переменные не может объявляться как узел или края таблицы. 
* Узел и границей таблицы не может быть созданы как темпоральной таблицы с системным управлением версиями.   
* Узел и границей таблицы не могут быть оптимизированные для памяти таблицы.  
* Пользователи не могут обновлять $from_id и $to_id столбцы края, с помощью инструкции UPDATE. Чтобы обновить узлы, которые ребро соединяет, пользователи получат новые особенности, указывающим на новые узлы вставки и удаления предыдущей.
* Кросс-базы данных не поддерживаются запросы к объектам графа. 


## <a name="next-steps"></a>Следующие шаги
Чтобы приступить к работе с нового синтаксиса, в разделе [диаграммы базы данных SQL — пример](./sql-graph-sample.md)
 

