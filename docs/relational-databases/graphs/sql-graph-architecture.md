---
title: Архитектура графа базы данных SQL | Документация Майкрософт
ms.custom: ''
ms.date: 04/19/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.component: graphs
ms.reviewer: ''
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: ''
ms.topic: language-reference
helpviewer_keywords:
- SQL graph
- SQL graph, architecture
ms.assetid: ''
caps.latest.revision: 1
author: shkale-msft
ms.author: shkale
manager: craigg
monikerRange: = azuresqldb-current || >= sql-server-2017 || = sqlallproducts-allversions
ms.openlocfilehash: 7cfba1fc79e44bb28a433c3b31fe5f4236037d6e
ms.sourcegitcommit: e77197ec6935e15e2260a7a44587e8054745d5c2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2018
ms.locfileid: "38051512"
---
# <a name="sql-graph-architecture"></a>Архитектура графа базы данных SQL  
[!INCLUDE[tsql-appliesto-ss2017-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2017-asdb-xxxx-xxx-md.md)]

Узнайте, как устроено SQL Graph. Знать основы облегчит понимание другие статьи по SQL Graph.
 
## <a name="sql-graph-database"></a>База данных SQL Graph
Пользователи могут создавать один график на базу данных. Граф состоит из таблиц узлов и ребер. Узла или граничной таблицы могут быть созданы в любой схемы в базе данных, но все они принадлежат к одной логической диаграммы. Таблицы узлов — коллекция узлов того же типа. Например таблица узлов Person содержит все лица узлах, принадлежащих к диаграмме. Аналогичным образом краевую таблицу — это совокупность краев того же типа. Например таблица Friends edge содержит всех краев, которые подключаются к другому лицу человека. Так как узлы и ребра хранятся в таблицах, большая часть операций, поддерживаемых в обычных таблицах поддерживаются узла или граничной таблицы. 
 
 
![SQL-graph-architecture](../../relational-databases/graphs/media/sql-graph-architecture.png "архитектуру базы данных Sql graph")   

Рис. 1: Архитектура базы данных SQL Graph
 
## <a name="node-table"></a>Таблица узлов
Узел таблицы представляет сущность в схему графа. Каждый раз, когда узел создается таблица, а также заданные пользователем столбцы, неявным `$node_id` создается столбец, который однозначно идентифицирует определенный узел в базе данных. Значения в `$node_id` создаются автоматически, а представляют собой сочетание `object_id` из этой таблицы узла и значение созданного внутреннего bigint. Тем не менее, если `$node_id` выбран столбец, отображается вычисляемое значение в виде строки JSON. Кроме того `$node_id` представляет собой Псевдостолбец, который сопоставляется с шестнадцатеричная строка в его внутреннее имя. При выборе `$node_id` из таблицы, имя столбца будет отображаться как `$node_id_<hex_string>`. Использование имен псевдо столбцов в запросах является рекомендуемым способом запроса к внутренней `$node_id` следует избегать столбца и использование внутренних имен с помощью шестнадцатеричная строка.

Рекомендуется, пользователи создать ограничение уникальности или индекс на `$node_id` столбец во время создания таблицы узла, но если он не создан, значение по умолчанию автоматически создается уникальный, некластеризованный индекс. Тем не менее любой индекс по столбцу псевдо graph создается на базовые столбцы внутренней. То есть индексом, созданным для `$node_id` столбца, будут отображаться на внутренний `graph_id_<hex_string>` столбца.   


## <a name="edge-table"></a>Краевой таблицы
Краевую таблицу представляет связь в граф. Границы всегда направляются и соединения двух узлов. Граничную таблицу пользователи моделировать многие ко многим отношения в графе. Краевую таблицу может иметь или не иметь любые определяемые пользователем атрибуты в нем. Каждый раз при создании краевую таблицу, а также определяемые пользователем атрибуты, создаются три неявных столбцы в краевой таблице:

|Имя столбца    |Описание  |
|---   |---  |
|`$edge_id`   |Однозначно определяет границу заданного в базе данных. Это созданный столбец и значение представляет собой сочетание object_id краевую таблицу, и значение созданного внутреннего типа bigint. Тем не менее, если `$edge_id` выбран столбец, отображается вычисляемое значение в виде строки JSON. `$edge_id` — Это псевдо столбец, который сопоставляется с шестнадцатеричная строка в его внутреннее имя. При выборе `$edge_id` из таблицы, имя столбца будет отображаться как `$edge_id_\<hex_string>`. Использование имен псевдо столбцов в запросах является рекомендуемым способом запроса к внутренней `$edge_id` следует избегать столбца и использование внутренних имен с помощью шестнадцатеричная строка. |
|`$from_id`   |Магазины `$node_id` узла, из которого исходят эти границы.  |
|`$to_id`   |Магазины `$node_id` узла, по которому завершает границе. |

Узлы, которые могут подключаться заданного edge регулируется с помощью данных, вставленных в `$from_id` и `$to_id` столбцов. В первом выпуске он не поддерживается для определения ограничений в краевой таблице, чтобы запретить подключения любого два типа узлов. То есть ребро можно подключиться двумя узлами в графе, независимо от их типов.

Аналогичную `$node_id` столбца, мы рекомендуем пользователям создать уникальный индекс или ограничение на `$edge_id` столбец во время создания краевую таблицу, но если он не создан, значение по умолчанию на автоматически создается уникальный некластеризованный индекс Этот столбец. Тем не менее любой индекс по столбцу псевдо graph создается на базовые столбцы внутренней. То есть индексом, созданным для `$edge_id` столбца, будут отображаться на внутренний `graph_id_<hex_string>` столбца. Кроме того, рекомендуется, для сценариев OLTP, создаваемые пользователями индекса на (`$from_id`, `$to_id`) столбцы, для ускорения уточняющих запросов в направлении границы.  

Рис. 2 показано, как для таблиц узлов и ребер хранятся в базе данных. 

![пользователь друзей tables](../../relational-databases/graphs/media/person-friends-tables.png "узел Person и друзей периметра таблиц")   

Рис. 2: Представление таблицы узлов и ребер



## <a name="metadata"></a>Метаданные
Используйте приведенные ниже представления метаданных, чтобы увидеть атрибуты узла или граничной таблицы.
 
### <a name="systables"></a>sys.tables
Тип, bit следующий новый, будут добавлены столбцы для SYS. ТАБЛИЦЫ. Если `is_node` имеет значение 1, которое указывает, что таблица является таблицей узла и, если `is_edge` имеет значение 1, которое указывает, что таблица является граничной таблицы.
 
|Имя столбца |Тип данных |Описание |
|--- |---|--- |
|is_node |bit |1 = это таблицу узлов |
|is_edge |bit |1 = это краевую таблицу |
 
### <a name="syscolumns"></a>sys.columns
`sys.columns` Представление содержит дополнительные столбцы `graph_type` и `graph_type_desc`, указывающих тип столбца в таблиц узлов и ребер.
 
|Имя столбца |Тип данных |Описание |
|--- |---|--- |
|graph_type |ssNoversion |Внутренний столбец с набором значений. 1 – 8 для graph столбцы значения NULL для других пользователей.  |
|graph_type_desc |nvarchar(60)  |внутренний столбец с набором значений |
 
В следующей таблице перечислены допустимые значения для `graph_type` столбца

|Значение столбца  |Описание  |
|---   |---   |
|1  |GRAPH_ID  |
|2  |GRAPH_ID_COMPUTED  |
|3  |GRAPH_FROM_ID  |
|4  |GRAPH_FROM_OBJ_ID  |
|5  |GRAPH_FROM_ID_COMPUTED  |
|6  |GRAPH_TO_ID  |
|7  |GRAPH_TO_OBJ_ID  |
|8  |GRAPH_TO_ID_COMPUTED  |


`sys.columns` также хранит сведения о неявных столбцов, созданных в узла или граничной таблицы. Следующие сведения могут быть получены из sys.columns, тем не менее, пользователи не могут выбрать эти столбцы из узлов или граничную таблицу. 

Неявные столбцы в таблицу узлов  
|Имя столбца    |Тип данных  |is_hidden  |Комментарий  |
|---  |---|---|---  |
|graph_id_\<hex_string > |bigint |1  |столбец внутреннего graph_id  |
|$node_id_\<hex_string > |NVARCHAR   |0  |Идентификатор столбца внешних узлов  |

Неявные столбцы в граничную таблицу  
|Имя столбца    |Тип данных  |is_hidden  |Комментарий  |
|---  |---|---|---  |
|graph_id_\<hex_string > |bigint |1  |столбец внутреннего graph_id  |
|$edge_id_\<hex_string > |NVARCHAR   |0  |Идентификатор столбца внешних edge  |
|from_obj_id_\<hex_string>  |INT    |1  |внутренний узел из объекта с идентификатором  |
|from_id_\<hex_string>  |bigint |1  |Внутренняя из graph_id узла  |
|$from_id_\<hex_string > |NVARCHAR   |0  |внешние из идентификатор узла  |
|to_obj_id_\<hex_string>    |INT    |1  |Внутренняя к узлу с идентификатором объекта  |
|to_id_\<hex_string>    |bigint |1  |Внутренняя для узла graph_id  |
|$to_id_\<hex_string >   |NVARCHAR   |0  |внешним по отношению к идентификатору узла  |
 
### <a name="system-functions"></a>Системные функции
Добавляются следующие встроенные функции. Эти функции помогают пользователям извлекать сведения из создаваемых столбцов. Обратите внимание на то, что эти методы не будет проверять входные данные пользователя. Если пользователь указывает недопустимое `sys.node_id` метод извлечет подходящую часть и вернуть его. Например, займет OBJECT_ID_FROM_NODE_ID `$node_id` качестве входных данных и вернет object_id таблицы, принадлежит данный узел. 
 
|Встроено   |Описание  |
|---  |---  |
|OBJECT_ID_FROM_NODE_ID |Извлечение из node_id object_id  |
|GRAPH_ID_FROM_NODE_ID  |Извлечение из node_id graph_id  |
|NODE_ID_FROM_PARTS |Конструкция node_id object_id и graph_id  |
|OBJECT_ID_FROM_EDGE_ID |Извлечение из edge_id object_id  |
|GRAPH_ID_FROM_EDGE_ID  |Извлечение удостоверения из edge_id  |
|EDGE_ID_FROM_PARTS |Конструкция edge_id object_id и удостоверения  |



## <a name="transact-sql-reference"></a>Справочник по Transact-SQL 
Узнайте, [!INCLUDE[tsql-md](../../includes/tsql-md.md)] расширения, появившиеся в SQL Server и базы данных SQL Azure, обеспечивают создания и выполнения запросов к объектам графа. Расширения языка запросов помогают запроса и просмотрим граф, используя синтаксис ASCII-арта.
 
### <a name="data-definition-language-ddl-statements"></a>Данные инструкции языка определения (DDL)
|Задача   |Связанный раздел  |Примечания
|---  |---  |---  |
|CREATE TABLE |[CREATE TABLE (Transact-SQL)](../../t-sql/statements/create-table-sql-graph.md)|`CREATE TABLE ` Теперь расширена для поддержки создания таблицы AS УЗЛОВ или ГРАНИЧНУЮ AS. Обратите внимание на то, что может краевую таблицу, или может не иметь любые пользовательские атрибуты.  |
|ALTER TABLE    |[ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md)|Таблиц узлов и ребер может быть изменен так же с помощью реляционной таблице `ALTER TABLE`. Пользователи могут добавлять или изменять определяемые пользователем столбцов, индексов или ограничений. Однако изменение столбцы внутреннего графика, например `$node_id` или `$edge_id`, приведет к ошибке.  |
|CREATE INDEX   |[CREATE INDEX &#40;Transact-SQL&#41;](../../t-sql/statements/create-index-transact-sql.md)  |Пользователи могут создавать индексы на псевдо столбцы и столбцы определяемых пользователем таблиц узлов и ребер. Поддерживаются все типы индексов, включая кластеризованный и некластеризованный индексы columnstore.  |
|DROP TABLE |[DROP TABLE &#40;Transact-SQL&#41;](../../t-sql/statements/drop-table-transact-sql.md)  |Узлов и ребер таблиц можно удалить так же с помощью реляционной таблице `DROP TABLE`. Тем не менее в этом выпуске нет никаких ограничений, чтобы не краев пункты удаленного узла, а каскадного удаления границ, после удаления узел или узел таблицы не поддерживается. Рекомендуется, если удаляется таблица узлов, пользователи помещают краям, подключается к тем узлам в этой таблице узла вручную, чтобы поддерживать целостность данных в диаграмме.  |


### <a name="data-manipulation-language-dml-statements"></a>Инструкции языка обработки (DML) данных
|Задача   |Связанный раздел  |Примечания
|---  |---  |---  |
|INSERT |[INSERT (Transact-SQL)](../../t-sql/statements/insert-sql-graph.md)|Вставка в таблицу узлов ничем не отличается от вставки в реляционной таблице. Значения для `$node_id` столбец создается автоматически. При попытке вставки значения в `$node_id` или `$edge_id` столбца приведет к ошибке. Пользователи должны указать значения для `$from_id` и `$to_id` столбцов при вставке в граничную таблицу. `$from_id` и `$to_id` являются `$node_id` значения, заданного граница соединяет узлов.  |
|DELETE | [DELETE (Transact-SQL)](../../t-sql/statements/delete-transact-sql.md)|Можно удалить данные из таблиц узлов или граничную таким же образом, как она будет удалена из реляционных таблиц. Тем не менее в этом выпуске нет никаких ограничений, чтобы не краев пункты удаленного узла, а каскадного удаления границ, после удаления узла не поддерживается. Рекомендуется, что при каждом удалении узла границ, подключения к этому узлу также удаляются, чтобы поддерживать целостность данных в диаграмме.  |
|UPDATE |[UPDATE (Transact-SQL)](../../t-sql/queries/update-transact-sql.md)  |Использование инструкции UPDATE можно обновить значения в столбцах определяемых пользователем. Обновление столбцов внутреннего графика, `$node_id`, `$edge_id`, `$from_id` и `$to_id` не допускается.  |
|MERGE |[MERGE (Transact-SQL)](../../t-sql/statements/merge-transact-sql.md)  |`MERGE` Инструкция не поддерживается для узлов или граничной таблицы.  |


### <a name="query-statements"></a>Инструкции запросов
|Задача   |Связанный раздел  |Примечания
|---  |---  |---  |
|SELECT |[SELECT (Transact-SQL)](../../t-sql/queries/select-transact-sql.md)|Узлы и ребра хранятся в виде таблицы внутренне, поэтому большинство операций, которые поддерживаются для таблиц в SQL Server или базы данных SQL Azure поддерживаются для таблиц узлов и ребер  |
|MATCH  | [СОВПАДЕНИЕ &#40;Transact-SQL&#41;](../../t-sql/queries/match-sql-graph.md)|Встроенные СОВПАДЕНИЕ введено для поддержки сопоставления по шаблону и прохождения через graph.  |



## <a name="limitations-and-known-issues"></a>Ограничения и известные проблемы  
Существуют некоторые ограничения для таблиц узлов и ребер в этом выпуске:
* Локальные или глобальные временные таблицы не может быть узла или граничной таблицы.
* Табличные типы и табличные переменные не могут объявляться как узлов или граничную таблицу. 
* Таблиц узлов и ребер не могут создаваться как временные таблицы с системным управлением версиями.   
* Таблицы узлов и ребер, не могут быть оптимизированные для памяти таблицы.  
* Пользователи не могли обновлять $from_id и $to_id столбцов на ребро с помощью инструкции UPDATE. Чтобы обновить узлы, которые ребро соединяет, пользователям придется вставить новые особенности, указывающий на новые узлы и удалить его.
* Кросс-базы данных не поддерживаются запросы графа объектов. 


## <a name="next-steps"></a>Следующие шаги
Чтобы начать работу с новым синтаксисом, см. в разделе [Graph базы данных SQL — пример](./sql-graph-sample.md)
 

