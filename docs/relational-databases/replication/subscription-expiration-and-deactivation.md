---
title: "Окончание срока действия и отключение подписки | Microsoft Docs"
ms.custom: ""
ms.date: "03/07/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "распространители [репликация SQL Server], срок хранения для распространения"
  - "подписки [репликация SQL Server], истечение срока действия"
  - "публикации [репликация SQL Server], срок хранения для публикации"
  - "срок действия [репликация SQL Server]"
  - "срок хранения [репликация SQL Server]"
  - "срок хранения публикации"
  - "срок хранения распространения"
  - "подписки [репликация SQL Server], отключение"
  - "отключение подписок"
ms.assetid: 4d03f5ab-e721-4f56-aebc-60f6a56c1e07
caps.latest.revision: 45
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 45
---
# Окончание срока действия и отключение подписки
  Подписки могут быть деактивированы или могут закончиться сроки их действия, если они не будут синхронизированы в течение определенного *срока хранения*. Выполняемое действие зависит от типа репликации и от превышенного срока хранения.  
  
 Задание сроков хранения, в разделе [Установка срока действия подписок](../../relational-databases/replication/publish/set-the-expiration-period-for-subscriptions.md), [срока хранения распространения для публикации транзакций и #40; SQL Server Management Studio & #41;](../../relational-databases/replication/set distribution retention period for transactional publications.md), и [настройки публикации и распространения](../../relational-databases/replication/configure-publishing-and-distribution.md).  
  
## Репликация транзакций  
 Репликация транзакций использует максимальный срок хранения распространения ( **@max_distretention** параметр [sp_adddistributiondb & #40; Transact-SQL & #41;](../../relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql.md)) и срок хранения публикации ( **@retention** параметр [sp_addpublication & #40; Transact-SQL & #41;](../../relational-databases/system-stored-procedures/sp-addpublication-transact-sql.md)):  
  
-   Если подписка не синхронизирована в пределах максимального срока хранения распространения (по умолчанию 72 часа) и нет изменений в базе данных распространителя, которые не были доставлены подписчику, подписка будет помечена отключенной по **Очистка распространения** задания, выполняющегося на распространителе. Эта подписка должна быть инициализирована повторно.  
  
-   Если подписка не синхронизирована в пределах срока хранения публикации (по умолчанию 336 часов), подписки истечет и удаляться при **Подписка с истекшим сроком очистку** Задание, которое выполняется на издателе. Эта подписка должна быть вновь создана и синхронизирована.  
  
     Если истекает срок действия принудительной подписки, она полностью удаляется, а подписки по запросу не удаляются. Подписки по запросу должны удаляться на подписчике. Дополнительные сведения см. в статье [Delete a Pull Subscription](../../relational-databases/replication/delete-a-pull-subscription.md).  
  
## Репликация слиянием  
 Репликация слиянием использует срок хранения публикации ( **@retention** и **@retention_period_unit** Параметры [sp_addmergepublication & #40; Transact-SQL & #41;](../../relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql.md)). Когда срок действия подписки истекает, ее необходимо повторно инициализировать, потому что метаданные для этой подписки удаляются. Не инициализированные повторно подписки удаляются заданием **Очистка истекшей подписки** , выполняемым на издателе. По умолчанию это задание запускается ежедневно; оно удаляет все принудительные подписки, которые не синхронизированы для удвоения срока хранения публикации. Например:  
  
-   Допустим, срок хранения публикации равен 14 дням, тогда действие подписки может истечь, если она не будет синхронизирована в течение 14 дней.  
  
     Если на издателе выполняется [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздняя версия, и агент подписки входит в состав [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздней версии, тогда действие подписки истечет, только если будут внесены изменения в данные секции этой подписки. Например, предположим, что подписчик получает пользовательские данные только для клиентов в Германии. Если срок хранения задан равным 14 дням, срок действия подписки истечет на 14-й день, только если за последние 14 дней не вносились изменения в данные немецких клиентов.  
  
-   В интервале от 14 до 27 дней после последней синхронизации подписка может быть инициализирована повторно.  
  
-   Через 28 дней после последней синхронизации подписка удаляется заданием **Очистка истекшей подписки** . Если истекает срок действия принудительной подписки, она полностью удаляется, а подписки по запросу не удаляются. Подписки по запросу должны удаляться на подписчике. Дополнительные сведения см. в статье [Delete a Pull Subscription](../../relational-databases/replication/delete-a-pull-subscription.md).  
  
### Вопросы установки срока хранения публикации слиянием  
 При установке срока хранения для публикаций слиянием учитывайте следующие факторы:  
  
-   Срок хранения для публикаций слиянием содержит 24-часовой льготный период для размещения подписчиков в разных часовых поясах. Например, если установить срок хранения продолжительностью в один день, то действительный срок хранения будет равен 48 часам.  
  
-   Очистка метаданных репликации слиянием зависит от срока хранения публикации:  
  
    -   Репликации не удастся очистить метаданные в базах данных публикации и подписки, пока не закончится срок хранения. Будьте осмотрительны при указании больших значений срока хранения, так как они могут негативно сказываться на производительности репликации. Рекомендуется использовать небольшие значения, если можно надежно предсказать, что все подписчики будут синхронизироваться регулярно в течение указанного периода времени.  
  
    -   Имеется возможность указать, что неограниченный срок действия подписок (значение 0 для **@retention**), но настоятельно рекомендуется не использовать это значение, поскольку невозможно будет очистить метаданные.  
  
-   Срок хранения, устанавливаемый для любого переиздающего подписчика, не должен превышать срок хранения, заданный для исходного издателя. Для всех издателей и их альтернативных участников синхронизации также следует использовать одинаковые значения срока хранения публикаций. Использование разных значений может привести к несогласованности данных. Если необходимо изменить значение срока хранения публикации, выполните повторную инициализацию подписчика, чтобы избежать несогласованности данных.  
  
-   Если после очистки срок хранения публикации увеличен и выполняется попытка объединения подписки с издателем (на котором уже удалены метаданные), срок действия подписки не истечет, поскольку было увеличено значение срока хранения. Однако издатель не имеет достаточно метаданных для загрузки изменений на подписчик, что ведет к несогласованности данных.  
  
## См. также:  
 [Повторная инициализация подписок](../../relational-databases/replication/reinitialize-subscriptions.md)   
 [Администрирование агента репликации](../../relational-databases/replication/agents/replication-agent-administration.md)   
 [Подписка на публикации](../../relational-databases/replication/subscribe-to-publications.md)  
  
  