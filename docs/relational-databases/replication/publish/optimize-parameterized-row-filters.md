---
title: "Оптимизация параметризованных фильтров строк | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "предварительно вычисляемые секции [репликация SQL Server]"
  - "фильтры [репликация SQL Server], параметризованные"
  - "предварительно вычисляемые секции репликации слиянием [репликация SQL Server], среда SQL Server Management Studio"
  - "параметризованные фильтры [репликация SQL Server], оптимизация"
ms.assetid: 49349605-ebd0-4757-95be-c0447f30ba13
caps.latest.revision: 44
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 44
---
# Оптимизация параметризованных фильтров строк
  В этом разделе описывается оптимизация параметризованных фильтров строк в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../../includes/tsql-md.md)].  
  
 **В этом разделе**  
  
-   **Перед началом работы выполните следующие действия.**  
  
     [Рекомендации](#Recommendations)  
  
-   **Для оптимизации параметризованных фильтров строк используется:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Recommendations"></a> Рекомендации  
  
-   При использовании параметризованных фильтров можно управлять обработкой фильтрами репликацией слиянием, если указать параметр **use partition groups** или **keep partition changes** при создании публикации. Эти параметры повышают производительность синхронизации для публикаций с отфильтрованными статьями, сохраняя дополнительные метаданные в базе данных публикации. Можно управлять совместным использованием данных подписчиками, настроив параметр **partition options** при создании статьи. Дополнительные сведения об этих требованиях см. в разделе [Parameterized Row Filters](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
     При работе с подписчиками [!INCLUDE[ssEW](../../../includes/ssew-md.md)]SQL Server Compact параметр keep_partition_changes необходимо установить в значение true, чтобы обеспечить правильное распределение удалений. При установке значения false подписчик может получить больше строк, чем ожидается.  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
 Для оптимизации параметризованных фильтров строк можно воспользоваться следующими настройками:  
  
 **Параметры секционирования**  
 Установите этот параметр на **Свойства** Страница **Свойства статьи — \< статья>** диалоговом или в **Добавить фильтр** диалоговое окно. Оба диалоговых доступны в мастере создания публикаций и **Свойства публикации — \< публикация>** диалоговое окно.  **Свойства статьи — \< статья>** диалоговое окно позволяет указать для этого параметра Дополнительные значения, которые недоступны в **Добавить фильтр** диалоговое окно.  
  
 **Предварительное вычисление секций**  
 Этот параметр имеет значение **True** по умолчанию, если статьи в публикации соответствуют ряду требований. Дополнительные сведения об этих требованиях см. в разделе [оптимизации параметризованных фильтров производительности с помощью предварительно вычисляемых секций](../../../relational-databases/replication/merge/optimize-parameterized-filter-performance-with-precomputed-partitions.md). Измените этот параметр на **Параметры подписки** Страница **Свойства публикации — \< публикация>** диалоговое окно.  
  
 **Оптимизировать синхронизацию**  
 Этот параметр следует задать **значение True,** только если **Предварительное вычисление секций** задано значение **False**. Установите этот параметр на **Параметры подписки** Страница **Свойства публикации — \< публикация>** диалоговое окно.  
  
 Дополнительные сведения об использовании мастера создания публикаций и доступе к **Свойства публикации — \< публикация>** диалоговом см [Создать публикацию](../../../relational-databases/replication/publish/create-a-publication.md) и [Просмотр и изменение свойств публикации](../../../relational-databases/replication/publish/view-and-modify-publication-properties.md).  
  
#### Задание настройки «Параметры секционирования» в диалоговом окне «Добавить фильтр» или «Редактировать фильтр»  
  
1.  На **Фильтрация строк таблицы** страница мастера создания публикаций или **Фильтрация строк** Страница **Свойства публикации — \< публикации>** диалоговом нажмите кнопку **Добавить**, и нажмите кнопку **Добавить фильтр**.  
  
2.  Создайте параметризованный фильтр. Дополнительные сведения см. в статье [Define and Modify a Parameterized Row Filter for a Merge Article](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).  
  
3.  Выберите параметр, который соответствует способу совместного использования данных подписчиками:  
  
    -   **Строка из этой таблицы будет отправлена нескольким подпискам**  
  
    -   **Строка из этой таблицы будет отправлена только одной подписке**  
  
     Если выбрана настройка **Строка из этой таблицы будет отправлена только одной подписке**, производительность репликации слиянием будет оптимизирована путем уменьшения объема хранимых и обрабатываемых метаданных. Однако следует убедиться, что данные секционированы таким образом, что одна строка не может быть реплицирована более чем одному подписчику. Дополнительные сведения см. в подразделе «Настройка параметров секционирования» раздела [Parameterized Row Filters](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
5.  При работе в **Свойства публикации — \< публикация>** диалоговом нажмите кнопку **ОК** Сохранить и закрыть диалоговое окно.  
  
#### Настройка параметров секционирования в свойства статьи — \< статья> диалоговое окно  
  
1.  На **статьи** страница мастера создания публикаций или **Свойства публикации — \< публикация>** диалоговое окно, выберите таблицу и нажмите кнопку **Свойства статьи**.  
  
2.  Щелкните **Указать свойства выделенной статьи таблицы** или **Указать свойства всех статей таблиц**.  
  
3.  В **целевой объект** раздел **Свойства** Вкладка **Свойства статьи — \< статья>** диалогового окна укажите одно из следующих значений для **Параметры раздела**:  
  
    -   **Перекрывающиеся**  
  
    -   **Перекрывающиеся, с запретом на изменение данных вне секции**  
  
    -   **Неперекрывающаяся, одиночная подписка**  
  
    -   **Неперекрывающиеся, общие для нескольких подписок**  
  
     Дополнительные сведения об этих параметрах и о том, как они связаны с параметрами, доступными в диалоговых окнах **Добавление фильтра** и **Изменение фильтра** , см. в подразделе «Установка параметров секционирования» раздела [Parameterized Row Filters](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
5.  При работе в **Свойства публикации — \< публикация>** диалоговом нажмите кнопку **ОК** Сохранить и закрыть диалоговое окно.  
  
#### Задание настройки «Предварительное вычисление секций»  
  
1.  На **Параметры подписки** Страница **Свойства публикации — \< публикация>** диалоговое окно, выберите значение для **Предварительное вычисление секций** параметр. Это свойство доступно только для чтения если:  
  
    -   Публикация не отвечает требованиям, предъявляемым к предварительно вычисляемым секциям.  
  
    -   Для данной публикации еще не был создан моментальный снимок. В этом случае для данного параметра отображается значение **Устанавливается автоматически при создании моментального снимка**.  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### Задание настройки «Оптимизировать синхронизацию»  
  
1.  На **Параметры подписки** Страница **Свойства публикации — \< публикация>** диалоговое окно, выберите значение **True** для **Оптимизировать синхронизацию** параметр.  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
 Для определения параметров фильтрации для **@keep_partition_changes** и **@use_partition_groups**, в разделе [sp_addmergepublication](../../../relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql.md).  
  
#### Указание оптимизации фильтра слияния при создании публикации  
  
1.  На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergepublication](../../../relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql.md). Укажите параметр **@publication** и значение **true** для одного из следующих параметров.  
  
    -   **@use_partition_groups**:-оптимизация для наивысшей производительности, предоставляемых статьи соответствуют требованиям предварительно вычисляемых секций. Дополнительные сведения см. в разделе [оптимизации параметризованных фильтров производительности с помощью предварительно вычисляемых секций](../../../relational-databases/replication/merge/optimize-parameterized-filter-performance-with-precomputed-partitions.md).  
  
    -   **@keep_partition_changes** -использовать эту оптимизацию, если предварительно вычисляемые секции не могут быть использованы.  
  
2.  Добавьте задание моментального снимка для публикации. Дополнительные сведения см. [Создать публикацию](../../../relational-databases/replication/publish/create-a-publication.md).  
  
3.  На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergearticle](../../../relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql.md), указав следующие параметры:  
  
    -   **@publication** -Имя публикации из шага 1.  
  
    -   **@article** -имя для статьи  
  
    -   **@source_object** — публикуемый объект базы данных.  
  
    -   **@subset_filterclause** -необязательное предложение параметризованного фильтра используется для горизонтальной фильтрации статьи.  
  
    -   **@partition_options** -Параметры секционирования для отфильтрованной статьи.  
  
4.  Повторите шаг 3 для каждой статьи в публикации.  
  
5.  (Необязательно) На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergefilter](../../../relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql.md) Определение фильтра соединения между двумя статьями. Дополнительные сведения см. в статье [Define and Modify a Join Filter Between Merge Articles](../../../relational-databases/replication/publish/define-and-modify-a-join-filter-between-merge-articles.md).  
  
#### Просмотр и изменение поведения фильтра слияния для существующей публикации  
  
1.  (Необязательно) На издателе в базе данных публикации выполните хранимую процедуру [sp_helpmergepublication](../../../relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql.md), указав **@publication**. Обратите внимание на значение **keep_partition_changes** и **use_partition_groups** в результирующем наборе.  
  
2.  (Необязательно) На издателе в базе данных публикации выполните хранимую процедуру [sp_changemergepublication](../../../relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql.md). Укажите значение **use_partition_groups** для **@property** и либо **true** или **false** для **@value**.  
  
3.  (Необязательно) На издателе в базе данных публикации выполните хранимую процедуру [sp_changemergepublication](../../../relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql.md). Укажите значение **keep_partition_changes** для **@property** и либо **true** или **false** для **@value**.  
  
    > [!NOTE]  
    >  При включении **keep_partition_changes**, необходимо сначала отключить **use_partition_groups** и укажите значение **1** для **@force_reinit_subscription**.  
  
4.  (Необязательно) На издателе в базе данных публикации выполните хранимую процедуру [sp_changemergearticle](../../../relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql.md). Укажите значение **partition_options** для **@property** и соответствующее значение для **@value**. В разделе [sp_addmergearticle](../../../relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql.md) для определения этих параметров фильтрации.  
  
5.  При необходимости запустите агент моментальных снимков для повторного создания моментального снимка (необязательно). Сведения о том, какие изменения требуют новый моментальный снимок для создаваемого содержатся [Изменение публикации и свойства статей](../../../relational-databases/replication/publish/change-publication-and-article-properties.md).  
  
## См. также:  
 [Создайте автоматически набор фильтров соединения между статьями публикации слиянием & #40; SQL Server Management Studio & #41;](../../../relational-databases/replication/publish/automatically generate join filters between merge articles.md)   
 [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)   
 [Параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-row-filters.md)  
  
  