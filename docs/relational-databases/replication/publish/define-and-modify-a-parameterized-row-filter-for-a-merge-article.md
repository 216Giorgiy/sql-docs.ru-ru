---
title: "Определение и изменение параметризованного фильтра строк для статьи публикации слиянием | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "параметризованные фильтры [репликация SQL Server], определение"
  - "параметризованные фильтры [репликация SQL Server], изменение"
  - "репликация слиянием [репликация SQL Server], динамические фильтры"
  - "параметризованные фильтры репликации слиянием [репликация SQL Server]"
  - "фильтры [репликация SQL Server], параметризованные"
  - "изменение фильтров, параметризованная строка"
  - "динамические фильтры [репликация SQL Server]"
ms.assetid: de0482a2-3cc8-4030-8a4a-14364549ac9f
caps.latest.revision: 44
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 44
---
# Определение и изменение параметризованного фильтра строк для статьи публикации слиянием
  В этом разделе описывается определение и изменение параметризованного фильтра строк в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../../includes/tsql-md.md)].  
  
 При создании статей таблицы можно применять параметризованные фильтры строк. Эти фильтры используют [ГДЕ](../../../t-sql/queries/where-transact-sql.md) предложение для отбора соответствующих данных для публикации. Вместо того чтобы задавать буквенное значение в предложении (как и для статического фильтра строк), вы указываете одну или обе следующие системные функции: [SUSER_SNAME](../../../t-sql/functions/suser-sname-transact-sql.md) и [HOST_NAME](../../../t-sql/functions/host-name-transact-sql.md). Дополнительные сведения см. в статье [Parameterized Row Filters](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
 **В этом разделе**  
  
-   **Перед началом работы выполните следующие действия.**  
  
     [Ограничения](#Restrictions)  
  
-   **Для определения и изменения параметризованного фильтра строк используется:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   Если добавление, изменение или удаление параметризованного фильтра строк выполняется после инициализации подписок на публикацию, следует создать новый моментальный снимок и повторно инициализировать все подписки после внесения изменений. Дополнительные сведения о требованиях к изменениям свойств см. в разделе [Изменение публикации и свойства статей](../../../relational-databases/replication/publish/change-publication-and-article-properties.md).  
  
###  <a name="Recommendations"></a> Рекомендации  
  
-   Для обеспечения высокой производительности не рекомендуется применять функции к именам столбцов в выражениях параметризованных фильтров строк, таких как `LEFT([MyColumn]) = SUSER_SNAME()`. Если в предложении фильтра используется HOST_NAME и переопределяется значение HOST_NAME, может быть, необходимо выполнить преобразование типов данных при помощи инструкции CONVERT. Дополнительные сведения о рекомендациях для этого случая см. в подразделе «Переопределение значения HOST_NAME()» раздела [параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
 Определение, изменение и удаление параметризованных фильтров строк на **Фильтрация строк таблицы** страницы мастера создания публикаций или **Фильтрация строк** страницы **Свойства публикации — \< публикация>** диалоговое окно. Дополнительные сведения об использовании мастера и о доступе к диалоговому окну см. в разделе [Создать публикацию](../../../relational-databases/replication/publish/create-a-publication.md) и [Просмотр и изменение свойств публикации](../../../relational-databases/replication/publish/view-and-modify-publication-properties.md).  
  
#### Определение параметризованного фильтра строк  
  
1.  На **Фильтрация строк таблицы** страницы мастера публикации или **Фильтрация строк** Страница **Свойства публикации — \< публикация>**, нажмите кнопку **Добавить**, и нажмите кнопку **Добавить фильтр**.  
  
2.  В **Добавить фильтр** диалоговое окно, выберите таблицу для фильтрации из раскрывающегося списка.  
  
3.  Создайте инструкцию фильтра в **инструкция фильтра** текстовое поле. Можно ввести текст в тестовом поле или перетащить столбцы из списка **Столбцы** .  
  
    -   Текстовая область **Инструкция фильтра** содержит текст по умолчанию, в виде:  
  
        ```  
        SELECT <published_columns> FROM [tableowner].[tablename] WHERE  
        ```  
  
    -   Текст по умолчанию изменять нельзя. Введите предложение фильтра после ключевого слова WHERE, используя стандартный синтаксис SQL. Параметризованный фильтр включает вызов системной функции **HOST_NAME()** или **SUSER_SNAME()**, или определяемой пользователем функции, которая ссылается на одну или обе эти функции. Ниже приведен пример полного выражения для параметризованного фильтра строк:  
  
        ```  
        SELECT <published_columns> FROM [HumanResources].[Employee] WHERE LoginID = SUSER_SNAME()  
        ```  
  
         В предложении WHERE необходимо использовать имена, состоящие из двух частей; имена, состоящие из трех или четырех частей, не поддерживаются.  
  
4.  Выберите параметр, который соответствует способу совместного использования данных подписчиками:  
  
    -   **Строка из этой таблицы будет отправлена нескольким подпискам**  
  
    -   **Строка из этой таблицы будет отправлена только одной подписке**  
  
     Если выбрана настройка **Строка из этой таблицы будет отправлена только одной подписке**, производительность репликации слиянием будет оптимизирована путем уменьшения объема хранимых и обрабатываемых метаданных. Однако следует убедиться, что данные секционированы таким образом, что одна строка не может быть реплицирована более чем одному подписчику. Дополнительные сведения см. в подразделе «Настройка параметров секционирования» раздела [Parameterized Row Filters](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
5.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
6.  При работе в **Свойства публикации — \< публикация>** диалоговом нажмите кнопку **ОК** Сохранить и закрыть диалоговое окно.  
  
#### Изменение параметризованного фильтра строк  
  
1.  На **Фильтрация строк таблицы** страницы мастера публикации или **Фильтрация строк** страницы **Свойства публикации — \< публикация>**, выберите фильтр в **Отфильтрованные таблицы** панели, а затем щелкните **Изменить**.  
  
2.  В окне **Изменение фильтра** измените фильтр.  
  
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### Удаление параметризованного фильтра строк  
  
1.  На **Фильтрация строк таблицы** страницы мастера публикации или **Фильтрация строк** страницы **Свойства публикации — \< публикация>**, выберите фильтр в **Отфильтрованные таблицы** панели, а затем щелкните **Удалить**.  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
 Параметризованные фильтры строк можно создавать и изменять программно с помощью хранимых процедур репликации.  
  
#### Определение параметризованного фильтра строк для статьи в публикации слиянием  
  
1.  На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergearticle & #40; Transact-SQL & #41;](../../../relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql.md). Укажите **@publication**, имя статьи, для **@article**, таблицы, публикуемой для **@source_object**, предложение WHERE, определяющее параметризованный фильтр для **@subset_filterclause** (не включая `WHERE`), и одно из следующих значений для **@partition_options**, который описывает тип секционирования, который будет вызван на параметризованный фильтр строк:  
  
    -   **0** — Фильтрация для статьи либо является статической, либо не возвращает уникального подмножества данных для каждой секции («перекрывающиеся» секции).  
  
    -   **1** — результирующие секции перекрываются, и обновления, выполненные на подписчике не могут изменить секцию, к которой принадлежит строка.  
  
    -   **2** — Фильтрация для статьи дает неперекрывающиеся секции, но несколько подписчиков могут получать одну секцию.  
  
    -   **3** — Фильтрация для статьи дает неперекрывающиеся секции, уникальные для каждой подписки.  
  
#### Изменение параметризованного фильтра строк для статьи в публикации слиянием  
  
1.  На издателе в базе данных публикации выполните хранимую процедуру [sp_changemergearticle](../../../relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql.md). Укажите **@publication**, **@article**, значение **subset_filterclause** для **@property**, выражение, определяющее параметризованный фильтр для **@value** (не включая `WHERE`), а значение **1** для обоих **@force_invalidate_snapshot** и **@force_reinit_subscription**.  
  
2.  Если это изменение приведет к разному поведению секционирования, затем выполните [sp_changemergearticle](../../../relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql.md) еще раз. Укажите **@publication**, **@article**, значение **partition_options** для **@property**, и наиболее оптимальный параметр секционирования для **@value**, который может принимать одно из следующих:  
  
    -   **0** — Фильтрация для статьи либо является статической, либо не возвращает уникального подмножества данных для каждой секции («перекрывающиеся» секции).  
  
    -   **1** — результирующие секции перекрываются, и обновления, выполненные на подписчике не могут изменить секцию, к которой принадлежит строка.  
  
    -   **2** — Фильтрация для статьи дает неперекрывающиеся секции, но несколько подписчиков могут получать одну секцию.  
  
    -   **3** — Фильтрация для статьи дает неперекрывающиеся секции, уникальные для каждой подписки.  
  
###  <a name="TsqlExample"></a> Пример (Transact-SQL)  
 В этом примере определяется группа статей в публикации слиянием, где производится фильтрация статей с помощью набора фильтров соединения для `Employee` Таблица, которая сама фильтруется с использованием параметризованного фильтра строк на **LoginID** столбца. Во время синхронизации, значение, возвращаемое [HOST_NAME](../../../t-sql/functions/host-name-transact-sql.md) переопределения функции. Дополнительные сведения см. в разделе значение HOST_NAME() не переопределяется [параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../../relational-databases/replication/codesnippet/tsql/define-and-modify-a-para_1.sql)]  
  
## См. также:  
 [Определение и изменение фильтра соединения между статьями публикации слиянием](../../../relational-databases/replication/publish/define-and-modify-a-join-filter-between-merge-articles.md)   
 [Изменение свойств публикации и статьи](../../../relational-databases/replication/publish/change-publication-and-article-properties.md)   
 [Фильтры соединения](../../../relational-databases/replication/merge/join-filters.md)   
 [Параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-row-filters.md)  
  
  