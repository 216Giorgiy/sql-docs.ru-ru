---
title: "Определение и изменение фильтра соединения между статьями публикации слиянием | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "фильтры [репликация SQL Server], соединение"
  - "фильтры соединения репликации слиянием [репликация SQL Server]"
  - "изменение фильтров, соединение"
  - "фильтры соединения"
ms.assetid: f7f23415-43ff-40f5-b3e0-0be1d148ee5b
caps.latest.revision: 46
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 46
---
# Определение и изменение фильтра соединения между статьями публикации слиянием
  В этом разделе описывается определение и изменение фильтра соединения между статьями публикации слиянием в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../../includes/tsql-md.md)]. Репликация слиянием поддерживает фильтры соединения, которые обычно используются совместно с параметризованными фильтрами для распространения секционирования таблиц на все связанные статьи таблиц.  
  
 **В этом разделе**  
  
-   **Перед началом работы выполните следующие действия.**  
  
     [Ограничения](#Restrictions)  
  
     [Рекомендации](#Recommendations)  
  
-   **Для определения и изменения фильтра соединения между статьями публикации слиянием используется:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   Чтобы создать фильтр соединения, публикация должна содержать не менее двух связанных таблиц. Фильтр соединения расширяет фильтр строк, и поэтому следует задать фильтр строк для одной таблицы перед тем, как можно будет расширять фильтр соединением с другой таблицей. После того как будет определен один фильтр соединения, его можно расширить еще одним фильтром соединения, если публикация содержит другие связанные таблицы.  
  
-   Если добавление, изменение или удаление фильтра соединения выполняется после инициализации подписок на публикацию, следует создать новый моментальный снимок и повторно инициализировать все подписки после внесения изменений. Дополнительные сведения о требованиях к изменениям свойств см. в разделе [Изменение публикации и свойства статей](../../../relational-databases/replication/publish/change-publication-and-article-properties.md).  
  
###  <a name="Recommendations"></a> Рекомендации  
  
-   Фильтры соединения можно создать вручную для набора таблиц, или же репликация может создать эти фильтры автоматически, основываясь на связях между внешними ключами и первичными ключами, заданных в таблицах. Дополнительные сведения о автоматического создания набора фильтров соединения см. в разделе [автоматически создают набор из соединения фильтры между слияния статьи & #40; SQL Server Management Studio & #41;](../../../relational-databases/replication/publish/automatically generate join filters between merge articles.md).  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
 Определение, изменение и удаление фильтров соединения на **Фильтрация строк таблицы** страницы мастера создания публикаций или **Фильтрация строк** страницы **Свойства публикации — \< публикация>** диалоговое окно. Дополнительные сведения об использовании мастера и о доступе к диалоговому окну см. в разделе [Создать публикацию](../../../relational-databases/replication/publish/create-a-publication.md) и [Просмотр и изменение свойств публикации](../../../relational-databases/replication/publish/view-and-modify-publication-properties.md).  
  
#### Определение фильтра соединения  
  
1.  На **Фильтрация строк таблицы** страницы мастера публикации или **Фильтрация строк** Страница **Свойства публикации — \< публикация>**, выберите существующий фильтр строк или фильтр соединения **Отфильтрованные таблицы** области.  
  
2.  Щелкните **Добавить**и выберите **Добавить соединение для расширения выбранного фильтра**.  
  
3.  Создайте инструкцию соединения: выберите либо **Использовать построитель для создания инструкции** , либо **Создать инструкцию соединения вручную**.  
  
    -   Если выбрать с помощью построителя используйте столбцы в сетке (**вместе**, **столбец отфильтрованной таблицы**, **оператор**, и **Столбец соединяемой таблицы**) для создания инструкции соединения.  
  
         Каждый столбец в сетке содержит раскрывающийся список со списком, позволяющий выбрать два столбца и оператор (**=**, **<>**, **<=**, **\<**, **>=**, **>**, и **как**). Результаты выводятся в текстовом поле **Предварительный просмотр** . Если в соединении участвуют несколько пар столбцов, выберите конъюнкцию (и или или) из **совместно** столбец, а затем введите еще два столбца и оператор.  
  
    -   Если нужно написать инструкцию вручную, введите ее в текстовом поле **Инструкция соединения** . Используйте списки **Столбцы фильтруемой таблицы** и **Столбцы соединяемой таблицы** , перетягивая из них поля в текстовое поле **Инструкция соединения** .  
  
    -   Полная инструкция соединения будет выглядеть таким образом:  
  
        ```  
        SELECT <published_columns> FROM [Sales].[SalesOrderHeader] INNER JOIN [Sales].[SalesOrderDetail] ON [SalesOrderHeader].[SalesOrderID] = [SalesOrderDetail].[SalesOrderID]  
        ```  
  
         В предложении JOIN необходимо использовать имена, состоящие их двух частей; имена, состоящие из трех и четырех частей не поддерживаются.  
  
4.  Задайте параметры соединения.  
  
    -   Если столбец, по которому производится объединение в отфильтрованной таблице (родительской таблице) является уникальным, выберите **Уникальный ключ**.  
  
        > [!CAUTION]  
        >  Выбор этого параметра указывает, что связь между дочерней и родительской таблицей в фильтре соединения — «одна к одной» или «одна к нескольким». Устанавливайте этот параметр, лишь если на объединяющий столбец в дочерней таблице наложено ограничение, гарантирующее уникальность. Если параметр задан неправильно, может возникнуть потеря конвергенции данных.  
  
    -   По умолчанию во время синхронизации процесс репликации слиянием обрабатывает изменения построчно. Чтобы связанные изменения в строки отфильтрованной таблицы и присоединенная таблица функционировала бы как целое, выберите **логической записи** ([!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] и более поздние версии). Этот параметр доступен, только если удовлетворяются требования статьи и публикации на использование логических записей. Дополнительные сведения см в разделе «Вопросы использования логических записей» [изменения группы связанных строк с логическими записями](../../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
5.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
6.  При работе в **Свойства публикации — \< публикация>** диалоговом нажмите кнопку **ОК** Сохранить и закрыть диалоговое окно.  
  
#### Изменение фильтра соединения  
  
1.  На **Фильтрация строк таблицы** страницы мастера публикации или **Фильтрация строк** страницы **Свойства публикации — \< публикация>**, выберите фильтр в **Отфильтрованные таблицы** панели, а затем щелкните **Изменить**.  
  
2.  В окне **Изменить соединение** измените фильтр.  
  
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### Удаление фильтра соединения  
  
1.  На **Фильтрация строк таблицы** страницы мастера публикации или **Фильтрация строк** страницы **Свойства публикации — \< публикация>**, выберите фильтр в **Отфильтрованные таблицы** панели, а затем щелкните **Удалить**. Если удаляемый фильтр соединения расширен за счет других фильтров, эти фильтры также будут удалены.  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
 Эти процедуры демонстрируют совместное использование параметризованного фильтра родительской статьи с фильтрами соединения связанных с ней дочерних статей. Фильтры соединения могут создаваться программным путем с помощью хранимых процедур репликации.  
  
#### Определение фильтра соединения для распространения фильтра статьи на связанные с ней статьи в публикации слиянием  
  
1.  Определите параметры фильтрации статьи, к которой производится присоединение (она также называется родительской статьей).  
  
    -   Дополнительные сведения о фильтрации статьи при помощи параметризованного фильтра строк см. в разделе [Define and Modify a Parameterized Row Filter for a Merge Article](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).  
  
    -   Дополнительные сведения о фильтрации статьи с помощью статического строкового фильтра см. в разделе [Define and Modify a Static Row Filter](../../../relational-databases/replication/publish/define-and-modify-a-static-row-filter.md).  
  
2.  На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergearticle & #40; Transact-SQL & #41;](../../../relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql.md) Чтобы определить один или несколько статей, которые также называются дочерних статей для публикации. Дополнительные сведения см. в статье [Define an Article](../../../relational-databases/replication/publish/define-an-article.md).  
  
3.  На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergefilter & #40; Transact-SQL & #41;](../../../relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql.md). Укажите **@publication**, уникальное имя для этого фильтра для **@filtername**, имя дочерней статьи, созданного на шаге 2 для **@article**, имя родительской статьи, к домену для **@join_articlename**, и одно из следующих значений для **@join_unique_key**:  
  
    -   **0** -указывает многие к одному "или" многие ко многим соединение между родительской и дочерней статьи.  
  
    -   **1** -указывает одному» или «один ко многим соединение между родительской и дочерней статьи.  
  
     Таким образом определяется используемый фильтр соединения двух статей.  
  
    > [!CAUTION]  
    >  Задать только **@join_unique_key** для **1** при наличии ограничения на соединяющийся столбец в базовой таблице для родительской статьи, гарантирующее уникальность. Если **@join_unique_key** равен **1** неправильно, конвергенции данных может возникнуть.  
  
###  <a name="TsqlExample"></a> Примеры (Transact-SQL)  
 В следующем примере производится определение статьи для публикации слиянием, где статья таблицы `SalesOrderDetail` фильтруется по таблице `SalesOrderHeader` , для фильтрации которой, в свою очередь, используется статический строковый фильтр. Дополнительные сведения см. в статье [Define and Modify a Static Row Filter](../../../relational-databases/replication/publish/define-and-modify-a-static-row-filter.md).  
  
 [!code-sql[HowTo#sp_AddMergeArticle](../../../relational-databases/replication/codesnippet/tsql/define-and-modify-a-join_1.sql)]  
  
 В этом примере определяется группа статей в публикации слиянием, где производится фильтрация статей с помощью набора фильтров соединения для `Employee` Таблица, которая сама фильтруется с использованием параметризованного фильтра строк по значению [HOST_NAME](../../../t-sql/functions/host-name-transact-sql.md) в **LoginID** столбца. Дополнительные сведения см. в статье [Define and Modify a Parameterized Row Filter for a Merge Article](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../../relational-databases/replication/codesnippet/tsql/define-and-modify-a-join_2.sql)]  
  
## См. также:  
 [Фильтры соединения](../../../relational-databases/replication/merge/join-filters.md)   
 [Параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-row-filters.md)   
 [Изменение свойств публикации и статьи](../../../relational-databases/replication/publish/change-publication-and-article-properties.md)   
 [Фильтрация опубликованных данных для репликации слиянием](../../../relational-databases/replication/merge/filter-published-data-for-merge-replication.md)   
 [Практическое руководство: определение и изменение фильтра соединения между статьями публикаций слиянием (среда SQL Server Management Studio)](../../../relational-databases/replication/publish/define-and-modify-a-join-filter-between-merge-articles.md)   
 [Основные понятия системных хранимых процедур репликации](../../../relational-databases/replication/concepts/replication-system-stored-procedures-concepts.md)   
 [Определение связи логических записей между статьями таблиц слияния](../../../relational-databases/replication/publish/define-a-logical-record-relationship-between-merge-table-articles.md)   
 [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)  
  
  