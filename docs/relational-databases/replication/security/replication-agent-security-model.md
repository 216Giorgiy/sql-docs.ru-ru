---
title: "Модель безопасности агента репликации | Microsoft Docs"
ms.custom: ""
ms.date: "10/07/2015"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "Агент моментальных снимков, безопасность"
  - "Агенты [репликация SQL Server], безопасность"
  - "Агент распространителя, безопасность"
  - "Имена для входа [репликация SQL Server], разрешения для агентов"
  - "Безопасность [репликация SQL Server], модель безопасности агента"
  - "Агент чтения журнала, безопасность"
  - "Агент чтения очереди, безопасность"
  - "Агент слияния, безопасность"
  - "Репликация [SQL Server], агенты и профили"
ms.assetid: 6d09fc8d-843a-4a7a-9812-f093d99d8192
caps.latest.revision: 72
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 72
---
# Модель безопасности агента репликации
  Модель безопасности агента репликации предоставляет возможность точного управления учетными записями, под которыми агенты репликации выполняются и устанавливают соединения: для каждого агента может быть задана своя учетная запись. Дополнительные сведения об определении учетных записей см. в разделе [Управление именами входа и паролями в репликации](../../../relational-databases/replication/security/manage-logins-and-passwords-in-replication.md).  
  
> [!IMPORTANT]  
>  Если репликацию настраивает член предопределенной роли сервера **sysadmin** , агенты репликации можно настроить для олицетворения учетной записи агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Это можно сделать, если не задавать имя входа и пароль для агента репликации, однако такой подход не рекомендуется. Вместо этого для обеспечения надежной защиты рекомендуется задать учетную запись для каждого агента с минимальными разрешениями, описанными в подразделе «Разрешения, необходимые для агентов» ниже в этом разделе.  
  
 Агенты репликации, как и все исполняемые объекты, запускаются в контексте учетной записи Windows. Агенты выполняют соединения встроенной безопасности Windows, используя эту учетную запись. Учетная запись, под которой выполняется агент, зависит от того, как он был запущен:  
  
-   Запуск агента из задания агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (по умолчанию): когда для запуска агента репликации используется задание агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , агент репликации выполняется в контексте учетной записи, указанной при настройке репликации. Дополнительные сведения об агенте [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и репликации см. в подразделе «Безопасность агентов под управлением агента SQL Server» ниже в этом разделе. Дополнительные сведения о разрешениях, которые необходимы для учетной записи, под которой [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] запускается агент см. в разделе [Настройка агента SQL Server](../../../ssms/agent/configure-sql-server-agent.md).  
  
-   Запуск агента из командной строки MS-DOS или непосредственно, или с помощью скрипта: агент выполняется в контексте учетной записи пользователя, запустившего его из командной строки.  
  
-   Запуск агента из приложения, использующего объекты RMO или элемент управления ActiveX: агент выполняется в контексте приложения, которое вызывает объект RMO или элемент управления ActiveX.  
  
    > [!NOTE]  
    >  Элементы управления ActiveX являются устаревшими.  
  
 Рекомендуется выполнять соединение в контексте встроенной безопасности Windows. В целях обратной совместимости также можно использовать безопасность [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Дополнительные сведения о рекомендуемых подходах см. в разделе [Replication Security Best Practices](../../../relational-databases/replication/security/replication-security-best-practices.md).  
  
## Разрешения, необходимые для агентов  
 Учетные записи, под которыми выполняются и устанавливают соединения агенты, требуют различных разрешений. Описание этих разрешений приводится в следующей таблице. Рекомендуется выполнять каждый агент под отдельной учетной записью Windows, которым следует предоставлять только необходимые разрешения. Сведения о списке доступа к публикации (PAL), относящимся к нескольким агентам содержатся [организация безопасности издателя](../../../relational-databases/replication/security/secure-the-publisher.md).  
  
> [!NOTE]  
>  В некоторых операционных системах Windows с помощью средства «Контроль учетных записей» можно запретить административный доступ к хранилищу моментального снимка. Поэтому необходимо явно предоставить разрешения на доступ к хранилищу моментального снимка учетным записям Windows, которые используются агентом моментальных снимков, агентом распространителя и агентом слияния. Это необходимо делать даже в том случае, если эти учетные записи Windows являются членами группы «Администраторы». Дополнительные сведения см. в разделе [Безопасность папки моментальных снимков](../../../relational-databases/replication/security/secure-the-snapshot-folder.md).  
  
|Агент|Разрешения|  
|-----------|-----------------|  
|агент моментальных снимков|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна удовлетворять следующим требованиям:<br /><br /> -Минимум, быть членом **db_owner** фиксированной роли базы данных в базе данных распространителя.<br /><br /> Она должна обладать разрешениями на чтение, запись и изменение в хранилище моментальных снимков.<br /><br /> <br /><br /> Обратите внимание, что учетная запись используется *подключения* с издателем необходимо как минимум быть членом **db_owner** фиксированной роли базы данных в базе данных публикации.|  
|Агент чтения журнала.|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть минимум членом **db_owner** фиксированной роли базы данных в базе данных распространителя.<br /><br /> Учетная запись, используемая для подключения к издателю должна как минимум быть членом **db_owner** фиксированной роли базы данных в базе данных публикации.<br /><br /> При выборе **sync_type** Параметры *Поддержка только репликации*, *инициализации при помощи резервной копии*, или *инициализировать из номера lsn*, необходимо запустить агент чтения журнала после выполнения **sp_addsubscription**, чтобы скрипты установки были записаны в базу данных распространителя. Агент чтения журнала должен работать под учетной записью, которая является членом предопределенной роли сервера **sysadmin** . Когда **sync_type** включен режим *автоматического*, требуются никакие действия агента чтения журнала специальные.|  
|Агент распространителя для принудительной подписки|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна удовлетворять следующим требованиям:<br /><br /> -Минимум быть членом **db_owner** фиксированной роли базы данных в базе данных распространителя.<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.<br /><br /> Иметь разрешения на чтение из каталога, в который был установлен поставщик OLE DB для подписчика, если подписка предназначена для подписчика, отличного от подписчика SQL Server.<br /><br /> -При репликации данных LOB, агент распространителя должна обладать разрешением на репликацию **C:\Program Files\Microsoft SQL Server\XX\COMfolder** где XX — instanceID.<br /><br /> <br /><br /> Обратите внимание, что учетная запись используется *подключения* подписчику должна как минимум быть членом **db_owner** фиксированной роли базы данных в базе данных подписки или иметь равнозначные права, если подписка предназначена для подписчика, отличных от подписчика SQL Server.<br /><br /> Также Обратите внимание, что при использовании `-subscriptionstreams >= 2` об агенте распространителя, необходимо также предоставить **View Server State** разрешение на подписчиках для выявления взаимоблокировок.|  
|Агент распространителя для подписки по запросу|При соединении с подписчиком используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть минимум членом **db_owner** фиксированной роли базы данных в базе данных подписки. Учетная запись, используемая для соединения с распространителем, должна удовлетворять следующим требованиям:<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.<br /><br /> -При репликации данных LOB, агент распространителя должна обладать разрешением на репликацию **C:\Program Files\Microsoft SQL Server\XX\COMfolder** где XX — instanceID.<br /><br /> <br /><br /> Обратите внимание, что при использовании `-subscriptionstreams >= 2` об агенте распространителя, необходимо также предоставить **View Server State** разрешение на подписчиках для выявления взаимоблокировок.|  
|Агент слияния для принудительной подписки|При подключениях к издателю и распространителю используется та учетная запись Windows, под которой выполняется агент. Эта учетная запись должна удовлетворять следующим требованиям:<br /><br /> -Минимум быть членом **db_owner** фиксированной роли базы данных в базе данных распространителя.<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Он должна иметь имя для входа, связанное с пользователем в базе данных публикации.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.<br /><br /> <br /><br /> Обратите внимание, что учетная запись, используемая для *подключения* подписчику должна как минимум быть членом **db_owner** фиксированной роли базы данных в базе данных подписки.|  
|Агент слияния для подписки по запросу|При соединении с подписчиком используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть минимум членом **db_owner** фиксированной роли базы данных в базе данных подписки. Учетная запись, используемая для соединения с издателем и распространителем, должна удовлетворять следующим требованиям:<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Она должна иметь имя для входа, связанное с пользователем в базе данных публикации.<br /><br /> Она должна иметь имя для входа, связанное с пользователем в базе данных распространителя. Пользователь может иметь учетную запись **Guest** .<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.|  
|Агент чтения очереди.|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть минимум членом **db_owner** фиксированной роли базы данных в базе данных распространителя.<br /><br /> Учетная запись, используемая для подключения к издателю должна как минимум быть членом **db_owner** фиксированной роли базы данных в базе данных публикации.<br /><br /> Учетная запись, используемая для соединения с подписчиком необходимо как минимум быть членом **db_owner** фиксированной роли базы данных в базе данных подписки.|  
  
## Безопасность агентов под управлением агента SQL Server  
 При настройке репликации с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], процедур [!INCLUDE[tsql](../../../includes/tsql-md.md)] или объектов RMO по умолчанию для каждого агента создается задание агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Затем агенты выполняются в контексте соответствующего шага задания, вне зависимости от того, выполняются ли они постоянно, по расписанию или по запросу. Эти задания можно просмотреть в папке **Задания** в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]. В следующей таблице перечислены имена заданий.  
  
|Агент|Имя задания|  
|-----------|--------------|  
|агент моментальных снимков|**\< издатель>-\< база данных публикации>-\< публикация>-\< целое число>**|  
|Агент моментальных снимков для секции публикации слиянием|**Dyn_ \< издатель>-\< база данных публикации>-\< публикация>-\< GUID>**|  
|Агент чтения журнала.|**\< издатель>-\< база данных публикации>-\< целое число>**|  
|Агент слияния для подписок по запросу|**\< издатель>-\< база данных публикации>-\< публикация>-\< подписчик>-\< база данных подписки>-\< целое число>**|  
|Агент слияния для принудительных подписок|**\< издатель>-\< база данных публикации>-\< публикация>-\< подписчик>-\< целое число>**|  
|Агент распространителя для принудительных подписок|**\< издатель>-\< база данных публикации>-\< публикация>-\< подписчик>-\< целое число>***|  
|Агент распространителя для подписок по запросу|**\< издатель>-\< база данных публикации>-\< публикация>-\< подписчик>-\< база данных подписки>-\< GUID>***\*|  
|Агент распространителя для принудительных подписок подписчиков серверов, отличных от подписчиков SQL Server|**\< издатель>-\< база данных публикации>-\< публикация>-\< подписчик>-\< целое число>**|  
|Агент чтения очереди.|**[\< распространитель>]. \< целое число>**|  
  
 \*Для принудительных подписок на публикации Oracle именем задания является **\< издатель>— \< издатель**> вместо **\< издатель>-\< база данных публикации>**.  
  
 \*\*Для подписок по запросу на публикации Oracle именем задания является **\< издатель>-\< база данных распространителя**> вместо **\< издатель>-\< база данных публикации>**.  
  
 При настройке репликации задаются учетные записи, под которыми должны выполняться агенты. Однако все шаги заданий выполняются в контексте безопасности *учетной записи-посредника*, поэтому репликация осуществляет для указанных учетных записей агентов следующие внутренние сопоставления:  
  
-   Сначала учетная запись сопоставляется с учетными данными с помощью инструкции [!INCLUDE[tsql](../../../includes/tsql-md.md)] [CREATE CREDENTIAL](../../../t-sql/statements/create-credential-transact-sql.md) . [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] используют учетные данные для хранения сведений об учетных записях пользователей Windows.  
  
-    [Sp_add_proxy](../../../relational-databases/system-stored-procedures/sp-add-proxy-transact-sql.md) вызывается хранимая процедура, и учетные данные используются для создания прокси-сервера...  
  
> [!NOTE]  
>  Эти сведения предоставляются для понимания, что происходит при запуске агентов в соответствующих контекстах безопасности. Необязательно взаимодействовать непосредственно с учетными данными или созданными учетными записями-посредниками.  
  
## См. также:  
 [Рекомендации по защите репликации](../../../relational-databases/replication/security/replication-security-best-practices.md)   
 [Безопасность и защита и #40; Репликация & #41;](../../../relational-databases/replication/security/security-and-protection-replication.md)   
 [Организация безопасности папки моментальных снимков](../../../relational-databases/replication/security/secure-the-snapshot-folder.md)  
  
  