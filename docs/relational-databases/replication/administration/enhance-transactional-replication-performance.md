---
title: "Повышение производительности репликации транзакций | Microsoft Docs"
ms.custom: ""
ms.date: "03/07/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "публикации [репликация SQL Server], структура и производительность"
  - "производительность [репликация SQL Server], репликация транзакций"
  - "проектирование баз данных [SQL Server], производительность репликации"
  - "производительность [репликация SQL Server], репликация моментальных снимков"
  - "репликация моментальных снимков [SQL Server], производительность"
  - "подписки [репликация SQL Server], вопросы производительности"
  - "агенты [репликация SQL Server], производительность"
  - "агент распространителя, производительность"
  - "репликация транзакций, производительность"
  - "агент чтения журнала, производительность"
ms.assetid: 67084a67-43ff-4065-987a-3b16d1841565
caps.latest.revision: 39
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 39
---
# Повышение производительности репликации транзакций
  После учета общей производительности советы описано в [повышение общей производительности репликации](../../../relational-databases/replication/administration/enhance-general-replication-performance.md), рассмотрите следующие дополнительные области, относящиеся к репликации транзакций.  
  
## Структура базы данных  
  
-   Минимизируйте размер транзакций в структуре приложения.  
  
     По умолчанию репликация транзакций распространяет изменения в соответствии с границами транзакций. Если транзакции имеют небольшой размер, то маловероятно, что агенту распространителя придется повторно пересылать транзакцию вследствие перебоев в сети. Если агенту потребуется переслать транзакцию, то количество отсылаемых данных будет меньшим.  
  
## Настройка распространителя  
  
-   Настройте распространитель на выделенном сервере.  
  
     Нагрузку, связанную с обработкой на издателе, можно снизить, настроив удаленный распространитель. Дополнительные сведения см. в разделе [Настройка распространения](../../../relational-databases/replication/configure-distribution.md).  
  
-   Установите надлежащий размер для базы данных распространителя.  
  
     Проверьте репликацию с типовой нагрузкой системы, чтобы определить пространство, необходимое для хранения команд. Убедитесь в том, что база данных имеет достаточный размер для хранения команд без частого автоматического увеличения размера. Дополнительные сведения об изменении размера базы данных см. в разделе [ALTER DATABASE & #40; Transact-SQL & #41;](../../../t-sql/statements/alter-database-transact-sql.md).  
  
## Разработка публикации  
  
-   Реплицируйте выполнение хранимых процедур при выполнении пакетных обновлений опубликованных таблиц.  
  
     При наличии пакетов обновлений, которые эпизодически воздействуют на большое количество строк на подписчике, следует рассмотреть возможность обновления опубликованной таблицы с использованием хранимой процедуры и опубликовать результаты выполнения этой хранимой процедуры. Вместо отправки обновления или удаления для каждой изменяемой строки агент распространителя выполняет эту процедуру на подписчике с теми же значениями параметров. Дополнительные сведения см. в статье [Publishing Stored Procedure Execution in Transactional Replication](../../../relational-databases/replication/transactional/publishing-stored-procedure-execution-in-transactional-replication.md).  
  
-   Распределение статей по нескольким публикациям.  
  
     Если не удается использовать **- SubscriptionStreams** параметра (описывается далее в этом разделе), рассмотрите возможность создания нескольких публикаций. Распределение статей между этими публикациями позволяет репликации параллельно применять изменения на подписчиках.  
  
## Вопросы использования подписок  
  
-   Если на одном и том же издателе имеется несколько публикаций, используйте независимые агенты вместо общих агентов (эта конфигурация устанавливается по умолчанию в мастере создания публикаций).  
  
-   Выполняйте агенты в непрерывном режиме вместо запуска по часто повторяющимся расписаниям.  
  
     Настройка агентов на непрерывное выполнение вместо создания часто выполняемых расписаний (например, ежеминутных) позволяет повысить производительность репликации за счет экономии времени на запусках и остановках агента. Если агент распространителя настроен на непрерывную работу, изменения пересылаются на другие серверы, соединенные в топологии, с малой задержкой. Дополнительные сведения см. в разделе:  
  
    -   [! ВКЛЮЧИТЬ [ssManStudioFull] (.. / Token/ssManStudioFull_md.md)]: [Specify Synchronization Schedules](../../../relational-databases/replication/specify-synchronization-schedules.md)  
  
## Параметры агента распространителя и агента чтения журнала  
  
-   Для устранения узких мест случайные, возникающие воспользуйтесь **– MaxCmdsInTran** параметром для агента чтения журнала.  
  
      **– MaxCmdsInTran** параметр указывает максимальное количество инструкций, группируемых в транзакцию, когда агент чтения журнала записывает команды в базу данных распространителя. Использование этого параметра позволяет агенту чтения журнала и агенту распространителя разделять большие транзакции (состоящие из множества команд) на издателе на несколько меньших транзакций при применении команд на подписчике. Задание этого параметра может снизить вероятность состязаний на распространителе и уменьшить задержку при передаче данных между издателем и подписчиком. Поскольку исходная транзакция применяется меньшими по размеру блоками, подписчик может получить доступ к строкам большой логической транзакции издателя до завершения исходной транзакции, разбивая строгую атомарность транзакции. По умолчанию установлено значение **0**, сохраняющее границы транзакции издателя. Этот параметр не применим для издателей Oracle.  
  
    > [!WARNING]  
    >  **MaxCmdsInTran** не предназначалась для постоянного использования. Он существует для разрешения ситуаций, в которых случайно было запущено большое количество операций DML в рамках одной транзакции (из-за чего возникают задержки при распределении команд до тех пор, пока вся транзакция не будет находиться в базе данных распространителя, поскольку удерживаются блокировки и т. д.). Если такая ситуация возникает регулярно, следует проанализировать приложения и найти пути уменьшения размера транзакции.  
  
-   Использование **– SubscriptionStreams** параметр для агента распространителя.  
  
      **– SubscriptionStreams** может значительно повысить суммарную пропускную способность репликации. Он позволяет нескольким соединениям с подписчиком параллельно применять пакеты изменений, при этом сохраняя многие свойства транзакций, характерные для использования одиночного потока. Если одному из соединений не удается осуществить выполнение или фиксацию, все подключения прекратят выполнение текущего пакета, и агент будет использовать одиночный поток для повторных попыток выполнения поврежденных пакетов. Перед завершением фазы выполнения повторной попытки могут существовать временные несоответствия транзакций на подписчике. После успешной фиксации всех поврежденных пакетов подписчик возвращается в состояние согласованности транзакций.  
  
     Значение для этого параметра агента можно задать с помощью **@subscriptionstreams** из [sp_addsubscription & #40; Transact-SQL & #41;](../../../relational-databases/system-stored-procedures/sp-addsubscription-transact-sql.md).  
  
-   Увеличьте значение **- ReadBatchSize** параметром для агента чтения журнала.  
  
     Агент чтения журнала и агент распространителя поддерживают разные размеры пакетов для операций чтения и фиксации транзакций. По умолчанию размер пакетов составляет 500 транзакций. Агент чтения журнала считывает заданное количество транзакций из журнала независимо от того, отмечены они для репликации или нет. Если большое количество транзакций записывается в базу данных публикации, но только небольшое подмножество этих помечены для репликации, следует использовать **- ReadBatchSize** параметр для увеличения размера пакета, считываемого агентом чтения журнала. Этот параметр не применим для издателей Oracle.  
  
-   Увеличьте значение **- CommitBatchSize** параметр для агента распространителя.  
  
     Фиксация набора транзакций требует постоянного объема служебных операций. При выполнении менее частых фиксаций большего количества транзакций постоянный объем служебных операций приходится на больший объем данных. Однако выгода от увеличения значения этого параметра невелика, поскольку затраты на применение изменений управляются другими факторами, например максимальной пропускной способностью системы ввода-вывода диска, на котором хранится журнал. Кроме того, необходимо найти баланс между преимуществами и недостатками: в случае любого сбоя, приводящего к перезапуску агента распространителя, необходимо выполнить откат и повторное применение большого количества транзакций. В сетях с низкой надежностью более низкое значение параметра может уменьшить количество сбоев и число транзакций, для которых необходимо выполнить откат и повторное применение в случае сбоя.  
  
-   Уменьшить значение **- PollingInterval** параметром для агента чтения журнала.  
  
      **- PollingInterval** параметр задает частоту опроса журнала транзакций опубликованной базы для транзакций для репликации. Значение по умолчанию — 5 секунд. При уменьшении этого значения журнал опрашивается чаще, что может привести к меньшей задержке доставки транзакций из базы данных публикации в базу данных распространителя. Однако необходимо найти баланс между уменьшением задержки и ростом нагрузки на сервер с увеличением частоты опросов.  
  
 Параметры агента могут задаваться в профилях агента или в командной строке. Дополнительные сведения см. в разделе:  
  
-   [Работа с профилями агента репликации](../../../relational-databases/replication/agents/work-with-replication-agent-profiles.md)  
  
-   [Просмотр и изменение параметров командной строки агента репликации & #40; SQL Server Management Studio & #41;](../../../relational-databases/replication/agents/view and modify replication agent command prompt parameters.md)  
  
-   [Основные понятия исполняемых файлов агента репликации](../../../relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
  