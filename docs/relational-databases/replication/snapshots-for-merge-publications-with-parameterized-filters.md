---
title: Моментальные снимки для публикаций слиянием с параметризованными фильтрами | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.service: ''
ms.component: replication
ms.reviewer: ''
ms.suite: sql
ms.technology:
- replication
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
- merge replication [SQL Server replication], initializing subscriptions
- initializing subscriptions [SQL Server replication], snapshots
ms.assetid: 99d7ae15-5457-4ad4-886b-19c17371f72c
caps.latest.revision: 37
author: MashaMSFT
ms.author: mathoma
manager: craigg
ms.workload: Inactive
ms.openlocfilehash: 3d90559cdf8459dd875bcebfa50cc9fc68065f6f
ms.sourcegitcommit: 7a6df3fd5bea9282ecdeffa94d13ea1da6def80a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="snapshots-for-merge-publications-with-parameterized-filters"></a>Моментальные снимки для публикаций слиянием с параметризованными фильтрами
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Когда в публикации слиянием применяются параметризованные фильтры строк, репликация инициализирует каждую подписку с помощью моментального снимка, состоящего из двух частей. В первую очередь создается моментальный снимок схемы, содержащий все объекты, требуемые репликацией, и схемы опубликованных объектов, но не данные. Затем каждая подписка инициализируется с помощью моментального снимка, включающего объекты и схему из моментального снимка схемы, а также данные, принадлежащие секции подписки. Если несколько подписок получают заданную секцию (другими словами, они получают ту же схему и данные), моментальный снимок для этой секции создается один раз; несколько подписок инициализируются из одного и того же моментального снимка. Дополнительные сведения о параметризованных фильтрах строк см. в разделе [Parameterized Row Filters](../../relational-databases/replication/merge/parameterized-filters-parameterized-row-filters.md).  
  
 Моментальные снимки для публикаций с параметризованными фильтрами можно создать одним из трех способов:  
  
-   Предварительное создание моментальных снимков для каждой секции. Использование данного варианта позволяет управлять временем создания моментальных снимков.  
  
     Можно также выбрать возможность обновления снимков по расписанию. Новые подписчики, подписывающиеся на секцию, для которой создан моментальный снимок, получат обновленный моментальный снимок.  
  
-   Разрешите подписчикам запрашивать создание моментального снимка и его применение при первоначальной синхронизации. Использование данного параметра позволяет новым подписчикам синхронизироваться без вмешательства администратора (для создания моментального снимка у издателя должен быть запущен агент[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ).  
  
    > [!NOTE]  
    >  Если при фильтрации одной или нескольких статей публикации получаются неперекрывающиеся секции, которые являются уникальными для каждой подписки, метаданные очищаются при каждом запуске агента слияния. Это означает, что срок действия секционированного снимка истекает быстрее. При выборе этого параметра необходимо рассмотреть возможность разрешения подписчикам инициировать создание и доставку моментальных снимков. Дополнительные сведения о параметрах фильтрации см. в разделе [Parameterized Row Filters](../../relational-databases/replication/merge/parameterized-filters-parameterized-row-filters.md).  
  
-   Создайте моментальный снимок вручную для каждого подписчика при помощи агента моментальных снимков. Затем подписчик должен предоставить место для размещения моментальных снимков агенту слияния, чтобы он мог получить и применить правильный моментальный снимок.  
  
    > [!NOTE]  
    >  Данный параметр поддерживается для обратной совместимости и не допускает существования общих FTP-ресурсов моментальных снимков.  
  
 Самый гибкий подход состоит в использовании комбинации варианта предварительного создания моментального снимка с вариантом запроса моментального снимка подписчиком: моментальные снимки предварительно создаются и обновляются на основе расписания (обычно во время отсутствия пиковых нагрузок), но подписчик может сформировать свой собственный моментальный снимок, если создается подписка, для которой требуется новая секция.  
  
 Рассмотрим компанию [!INCLUDE[ssSampleDBCoShort](../../includes/sssampledbcoshort-md.md)], которая имеет мобильных работников, доставляющих товары в отдельные магазины. Каждый продавец на основании своего учетного имени получает подписку, в которую извлекаются данные для обслуживаемых магазинов. Администратор выбирает предварительное создание моментальных снимков и их обновление каждое воскресенье. Иногда в систему добавляется новый пользователь, и ему требуются данные для секции, которая не имеет доступного моментального снимка. Администратор также решает разрешить инициирование моментальных снимков подписчиком, чтобы исключить ситуацию, когда подписчик не может подписаться на публикацию из-за того, что моментальный снимок еще не доступен. Когда новый подписчик подключается впервые, снимок создается для указанной секции и применяется у подписчика (для создания моментального снимка у издателя должен быть запущен агент[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ).  
  
 Чтобы создать моментальный снимок публикации с параметризованными фильтрами, см. раздел [Create a Snapshot for a Merge Publication with Parameterized Filters](../../relational-databases/replication/create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).  
  
## <a name="security-settings-for-the-snapshot-agent"></a>Настройки безопасности для агента моментальных снимков  
 Агент моментальных снимков создает моментальные снимки для каждой секции. Для предварительно созданных моментальных снимков и моментальных снимков, запрашиваемых подписчиком, агент запускается и подключается с учетными данными, указанными при создании задания агента моментальных снимков для публикации (задание создается мастером создания публикации или хранимой процедурой **sp_addpublication_snapshot**). Для изменения учетных данных используйте хранимую процедуру **sp_changedynamicsnapshot_job**. Дополнительные сведения см. в статье [sp_changedynamicsnapshot_job (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-changedynamicsnapshot-job-transact-sql.md).  
  
## <a name="see-also"></a>См. также:  
 [Инициализация подписки с помощью моментального снимка](../../relational-databases/replication/initialize-a-subscription-with-a-snapshot.md)   
 [Parameterized Row Filters](../../relational-databases/replication/merge/parameterized-filters-parameterized-row-filters.md)   
 [Защита папки моментальных снимков](../../relational-databases/replication/security/secure-the-snapshot-folder.md)  
  
  
