---
title: "Урок 1. Публикация данных с помощью репликации слиянием | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
applies_to: 
  - "SQL Server 2016"
helpviewer_keywords: 
  - "репликация [SQL Server], учебники"
ms.assetid: c3c6e0b6-54cd-4b7d-8efb-2cefe14fcd7f
caps.latest.revision: 20
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 20
---
# Урок 1. Публикация данных с помощью репликации слиянием
На этом занятии с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] создается публикация слиянием с целью публикации подмножества таблиц **Employee**, **SalesOrderHeader**и **SalesOrderDetail** в образце базы данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] . Эти таблицы фильтруются с помощью параметризованных фильтров строк, так что каждая подписка содержит уникальную секцию данных. Также в список доступа к публикации добавляется имя входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], используемое агентом слияния. Для работы с этим учебником требуется завершить работу с предыдущим учебником, [Подготовка сервера для репликации](../../relational-databases/replication/tutorial-preparing-the-server-for-replication.md).  
  
### Создание публикации и определение статей  
  
1.  Подключитесь к издателю в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера.  
  
2.  Разверните папку **Репликация**, щелкните правой кнопкой мыши элемент **Локальные публикации** и выберите пункт **Создать публикацию**.  
  
    Будет запущен мастер настройки публикации.  
  
3.  На странице «База данных публикации» выберите [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)]и нажмите кнопку **Далее**.  
  
4.  На странице «Тип публикации» выберите **Публикация слиянием**и нажмите кнопку **Далее**.  
  
5.  На странице «Типы подписчиков» убедитесь, что выбрана только [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] или более поздняя версия, и нажмите кнопку **Далее**.  
  
6.  На странице «Статьи» разверните узел **Таблицы** , выберите **SalesOrderHeader** и **SalesOrderDetail**, затем разверните узел **Employee**, выберите **EmployeeID** или **LoginID**и нажмите кнопку **Далее**.  
  
    > [!TIP]  
    > Дополнительные требуемые столбцы выделяются автоматически. Выберите один из автоматически выбранных столбцов и просмотрите примечание под списком **Объекты для публикации** , объясняющее причину обязательного наличия столбца.  
  
7.  На странице «Фильтрация строк таблицы» нажмите кнопку **Добавить** , а затем щелкните **Добавить фильтр**.  
  
8.  В диалоговом окне **Добавление фильтра** выберите **Сотрудник (HumanResources)** в поле **Выберите таблицу для фильтрации**, щелкните столбец **LoginID**, нажмите кнопку со стрелкой вправо, чтобы добавить столбец в предложение WHERE фильтра запроса, и измените предложение WHERE следующим образом:  
  
    ```  
    WHERE [LoginID] = HOST_NAME()  
    ```  
  
9. Щелкните элемент **Строка из этой таблицы будет отправлена только одной подписке**и нажмите кнопку **ОК**.  
  
10. На странице **Фильтрация строк таблицы** выберите **Сотрудник (кадры)**, нажмите **Добавить**, а затем **Добавить соединение для расширения выбранного фильтра**.  
  
11. В диалоговом окне **Добавление соединения** выберите **Sales.SalesOrderHeader** в **Соединяемая таблица**, щелкните **Создать инструкцию соединения вручную**и завершите инструкцию соединения следующим образом:  
  
    ```  
    ON Employee.EmployeeID = SalesOrderHeader.SalesPersonID  
    ```  
  
12. В поле **Укажите параметры соединения**выберите **Уникальный ключ**, а затем нажмите кнопку **ОК**.  
  
13. На странице «Фильтрация строк таблицы» щелкните **SalesOrderHeader**, нажмите кнопку **Добавить**, а затем щелкните **Добавить соединение для расширения выбранного фильтра**.  
  
14. В диалоговом окне **Добавление соединения** выберите **Sales.SalesOrderDetail** в поле **Соединяемая таблица**.  
  
15. Нажмите **Создать инструкцию соединения вручную**.  
  
16. В поле **Столбцы отфильтрованной таблицы**выберите **BusinessEntityID**, затем нажмите кнопку со стрелкой, чтобы скопировать имя столбца в инструкцию соединения.  
  
17. В поле **Инструкция соединения** завершите инструкцию соединения следующим образом:  
  
    ```  
    ON Employee.BusinessEntityID = SalesOrderHeader.SalesPersonID  
    ```  
  
18. В поле **Укажите параметры соединения**выберите **Уникальный ключ**, а затем нажмите кнопку **ОК**.  
  
19. На странице **Фильтрация строк таблицы** выберите **SalesOrderHeader (Sales)**, нажмите **Добавить**, а затем **Добавить соединение для расширения выбранного фильтра**.  
  
20. В диалоговом окне **Добавление соединения** выберите **Sales.SalesOrderDetail** в поле **Соединяемая таблица**, нажмите кнопку **ОК**, а затем кнопку **Далее**.  
  
21. Установите флажок **Создать моментальный снимок немедленно**, снимите флажок **Запланировать запуск агента моментальных снимков в следующее время**и нажмите кнопку **Далее**.  
  
22. На странице "Безопасность агента" щелкните **Настройки безопасности**, введите \<*Имя_компьютера>***\repl_snapshot** в поле **Учетная запись процесса**, укажите пароль для учетной записи и нажмите кнопку **ОК**. Нажмите кнопку **Готово**.  
  
23. На странице «Завершение работы мастера» введите **AdvWorksSalesOrdersMerge** в поле **Имя публикации** и нажмите кнопку **Готово**.  
  
24. По завершении создания публикации нажмите кнопку **Закрыть**.  
  
### Просмотр состояния создания моментального снимка  
  
1.  Подключитесь к издателю в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера и папку **Репликация** .  
  
2.  В папке "Локальные публикации" щелкните правой кнопкой мыши публикацию **AdvWorksSalesOrdersMerge** и выберите пункт **Просмотр состояния агента моментальных снимков**.  
  
3.  Отобразится текущее состояние задания агента моментальных снимков для публикации. Перед тем как перейти к следующему занятию, убедитесь, что задание моментального снимка выполнено успешно.  
  
### Добавление имени входа агента слияния в список доступа к публикации  
  
1.  Подключитесь к издателю в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера и папку **Репликация** .  
  
2.  В папке "Локальные публикации" щелкните правой кнопкой мыши публикацию **AdvWorksSalesOrdersMerge** и выберите пункт **Свойства**.  
  
    Откроется диалоговое окно **Свойства публикации** .  
  
3.  Выберите страницу **Список доступа к публикации** и нажмите кнопку **Добавить**.  
  
4.  В диалоговом окне "Добавление доступа к публикации" выберите *\<Имя_компьютера>***\repl_merge** и нажмите кнопку **ОК**. Нажмите кнопку **ОК**.  
  
## Следующие шаги  
Публикация слиянием успешно создана. Далее будет создана подписка на эту публикацию. См. [Занятие 2. Создание подписки на публикацию слиянием](../../relational-databases/replication/lesson-2-creating-a-subscription-to-the-merge-publication.md).  
  
## См. также:  
[Фильтрация опубликованных данных](../../relational-databases/replication/publish/filter-published-data.md)  
[Параметризованные фильтры строк](../../relational-databases/replication/merge/parameterized-row-filters.md)  
[Определение статьи](../../relational-databases/replication/publish/define-an-article.md)  
  
  
  
