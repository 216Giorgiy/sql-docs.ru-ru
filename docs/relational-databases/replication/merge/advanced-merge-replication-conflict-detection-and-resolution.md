---
title: "Расширенное обнаружение и разрешение конфликтов репликации слиянием | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "разрешение конфликтов при репликации слиянием [репликация SQL Server], о разрешении конфликтов"
  - "сопоставитель конфликтов по умолчанию"
  - "отслеживание конфликтов уровня столбцов"
  - "отслеживание конфликтов уровня строк"
  - "просмотр конфликтов репликации слиянием"
  - "разрешение конфликтов при репликации слиянием"
  - "отслеживание конфликтов уровня логических записей [репликация SQL Server]"
  - "разрешение конфликтов [репликация SQL Server], репликация слиянием"
ms.assetid: 063d3d9c-ccb5-4fab-9d0c-c675997428b4
caps.latest.revision: 46
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 46
---
# Расширенное обнаружение и разрешение конфликтов репликации слиянием
  Когда издатель и подписчик соединяются и происходит синхронизация, агент слияния проверяет наличие конфликтов. При обнаружении конфликтов сопоставитель слияния использует арбитр конфликтов (указанный при добавлении статьи в публикацию), чтобы определить, какие данные являются приемлемыми и распространяются на другие сайты.  
  
> [!NOTE]  
>  Хотя подписчик синхронизируется с издателем, конфликты обычно возникают между обновлениями, осуществляемыми на различных подписчиках, а не между обновлениями, осуществляемыми на подписчике и издателе.  
  
 Логика обнаружения и разрешения конфликтов зависит от следующих параметров, описание которых приводится в данном разделе:  
  
-   указано ли отслеживание на уровне столбцов, строк или логических записей;  
  
-   указан ли механизм разрешения конфликтов на основе приоритетов (по умолчанию) или указан сопоставитель статей. Сопоставитель статей может быть:  
  
    -   *обработчиком бизнес-логики* , разработанным в управляемом коде;  
  
    -   На основе COM *пользовательского арбитра конфликтов*.  
  
    -   Арбитр на основе COM, предоставляемые [!INCLUDE[msCoName](../../../includes/msconame-md.md)].  
  
     При использовании механизма разрешения конфликтов по умолчанию логика работы определяется используемым типом подписки: клиентской или серверной.  
  
## Обнаружение конфликтов  
 Квалифицируется ли изменение данных как конфликт или зависит от типа отслеживания конфликтов, установленного для статьи:  
  
-   Если выбрано отслеживание конфликтов на уровне столбцов, то изменение данных считается конфликтом, если оно сделано в одном и том же столбце в одной и той же строке в нескольких узлах репликации.  
  
-   Если выбрано отслеживание на уровне строк, то изменение данных считается конфликтом, если оно выполнено для каких-либо столбцов в одной и той же строке в нескольких узлах репликации (изменяемые столбцы в соответствующих строках могут быть разными).  
  
-   Если выбрано отслеживание на уровне логических записей, то изменение данных считается конфликтом, если оно выполнено в какой-либо строке в одной и той же логической записи в нескольких узлах репликации (изменяемые столбцы в соответствующих строках могут быть разными).  
  
 Дополнительные сведения см. в статье [Detecting and Resolving Conflicts in Logical Records](../../../relational-databases/replication/merge/detecting-and-resolving-conflicts-in-logical-records.md).  
  
 Чтобы указать уровень отслеживания конфликтов и разрешений, см. раздел [Specify the Conflict Tracking and Resolution Level for Merge Articles](../../../relational-databases/replication/publish/specify-the-conflict-tracking-and-resolution-level-for-merge-articles.md).  
  
## Устранение конфликтов  
 После обнаружения конфликта агент слияния запускает выбранный сопоставитель конфликтов и использует его для определения победителя в конфликте. Победившая строка применяется на издателе и подписчике, а данные из проигравшей строки записываются в таблицу конфликтов. Разрешение конфликтов осуществляется немедленно после выполнения сопоставления конфликтов, если не выбран интерактивный режим разрешения конфликтов.  
  
### Типы сопоставителя конфликтов  
 В репликации слиянием устранение конфликтов осуществляется на уровне статей. Для публикаций, состоящих из нескольких статей, можно использовать разные сопоставители конфликтов для разных статей или один и тот же сопоставитель конфликтов, обслуживающий одну статью, несколько статей или все статьи публикации.  
  
 Если планируется использование сопоставителя конфликтов на основе приоритетов (по умолчанию), то не нужно устанавливать свойство сопоставителя для статьи. Если вместо сопоставителя конфликтов по умолчанию нужно использовать сопоставитель статей, следует установить свойство сопоставителя для статьи, которая будет использовать его, выбирая доступный сопоставитель конфликтов на издателе. Любую конкретную информацию, которую необходимо передать сопоставителю конфликтов, также можно указать в информационном свойстве сопоставителя.  
  
 Для репликации слиянием предлагается четыре типа сопоставителя конфликтов:  
  
-   Сопоставитель конфликтов на основе приоритетов (по умолчанию)  
  
     Механизм разрешения конфликтов по умолчанию функционирует по-разному в зависимости от того, является подписка клиентской или серверной. Можно назначать приоритеты различным подписчикам, использующим серверные подписки; изменения, внесенные на узле с наибольшим приоритетом, побеждают во всех конфликтах. В случае клиентских подписок первое изменение, записанное на издателе, побеждает в конфликте.  
  
     После того, как подписка создана, ее тип нельзя изменить.  
  
-   Обработчик бизнес-логики  
  
     Платформа обработчика бизнес-логики всегда доступна для добавления сборки управляемого кода, который выполняется во время процесса синхронизации слиянием. Сборка включает бизнес-логику, которая может реагировать на конфликты и некоторые другие условия, возникающие во время синхронизации. Дополнительные сведения см. в разделе [выполнение бизнес логики во время слияния синхронизации](../../../relational-databases/replication/merge/execute-business-logic-during-merge-synchronization.md).  
  
-   Пользовательский сопоставитель на основе COM  
  
     Репликация слиянием обеспечивает API-интерфейс, предназначенный для написания сопоставителей в виде COM-объектов на различных языках программирования — [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[vcprvc](../../../includes/vcprvc-md.md)] , [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]и других. Дополнительные сведения см. в разделе [на базе COM арбитры пользовательских](../../../relational-databases/replication/merge/com-based-custom-resolvers.md).  
  
-   Предоставляемые сопоставителя на основе COM [!INCLUDE[msCoName](../../../includes/msconame-md.md)]  
  
     [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] включает количество арбитров конфликтов на базе COM. Дополнительные сведения см. в разделе [Microsoft арбитров конфликтов на базе COM](../../../relational-databases/replication/merge/microsoft-com-based-resolvers.md).  
  
 Сведения о выборе подходящего типа арбитра конфликтов см. в разделе [Выбор сопоставителя](../../../relational-databases/replication/merge/choose-a-resolver.md).  
  
> [!NOTE]  
>  Некоторые сопоставители статей написаны для разрешения конфликтов только для определенных операций. Например, сопоставитель может обрабатывать обновления, но не вставки или удаления. Сопоставитель конфликтов на основе приоритетов (по умолчанию) обрабатывает все конфликты, не обработанные сопоставителем статей.  
  
 Указание типа подписки на публикацию слиянием и приоритета устранения конфликтов см. в разделе  
  
-   [! ВКЛЮЧИТЬ [ssManStudioFull] (.. / Token/ssManStudioFull_md.md)]: [Specify a Merge Subscription Type and Conflict Resolution Priority &#40;SQL Server Management Studio&#41;](../../../relational-databases/replication/specify a merge subscription type and conflict resolution priority.md)  
  
-   Репликация [!INCLUDE[tsql](../../../includes/tsql-md.md)] программирования и программирования, объекты управления репликацией (RMO): [Создать подписку по запросу](../../../relational-databases/replication/create-a-pull-subscription.md) и [Создание принудительной подписки](../../../relational-databases/replication/create-a-push-subscription.md)  
  
### Интерактивный сопоставитель  
 Репликация предоставляет пользовательский интерфейс интерактивного сопоставителя, который может использоваться совместно либо с сопоставителем конфликтов на основе приоритетов (по умолчанию), либо с сопоставителем статей. При выполнении синхронизации по требованию с помощью диспетчера синхронизации [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows интерактивный сопоставитель отображает конфликтные данные во время выполнения, позволяя выбрать методы разрешения конфликтов. Дополнительные сведения о том, как включить интерактивное устранение конфликтов и запуск интерактивного сопоставителя, см. в разделе [Interactive Conflict Resolution](../../../relational-databases/replication/merge/interactive-conflict-resolution.md).  
  
## Просмотр конфликтов  
 Наиболее простым способом просмотра конфликтов является использование средства просмотра конфликтов репликации, доступного из среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] ([!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] также предоставляет хранимые процедуры, которые позволяют создавать запросы к таблицам конфликтов.). Средство просмотра конфликтов и интерактивный сопоставитель являются аналогичными инструментами, но интерактивный сопоставитель позволяет разрешать конфликты во время выполнения синхронизации, в то время как средство просмотра конфликтов предназначено для просмотра конфликтов после их разрешения. Если метаданные конфликта остаются доступными в системных таблицах (по умолчанию метаданные конфликтов сохраняются в течение 14 суток), то результаты устранения конфликтов можно изменить в средстве просмотра конфликтов, однако при необходимости частого прямого вмешательства стоит рассмотреть возможность использования интерактивного сопоставителя.  
  
> [!NOTE]  
>  Конфликты, затрагивающие логические записи, не отображаются в средстве просмотра конфликтов. Для просмотра сведений о таких конфликтах используются хранимые процедуры репликации. Дополнительные сведения см. в разделе [просмотреть сведения о конфликтах для публикаций слиянием & #40; Программирование репликации Transact-SQL & #41;](../../../relational-databases/replication/view conflict information for merge publications.md).  
  
 Средство просмотра конфликтов отображает информацию из трех системных таблиц:  
  
-   Репликации создается таблица конфликтов для каждой таблицы в статье слияния с именем в формате **MSmerge_conflict_ \< ИмяПубликации>_ \< ArticleName>**.  
  
     Таблицы конфликтов имеют структуру, аналогичную структуре таблиц, на которых они основаны. Строка в одной из этих таблиц состоит из проигравшей версии строки конфликта (победившая версия строки находится в существующей пользовательской таблице).  
  
-    **MSmerge_conflicts_info** Таблица содержит сведения о каждом конфликте, включая тип конфликта.  
  
-   Таблица **sysmergearticles** определяет пользовательские таблицы, для которых существуют таблицы конфликтов, и предоставляет информацию об этих таблицах конфликтов.  
  
 По умолчанию сведения о конфликтах сохраняются:  
  
-   На издателе и подписчике, если уровень совместимости публикации 90RTM или выше.  
  
-   На издателе, если уровень совместимости публикации ниже, чем 80RTM.  
  
-   На издателе, если подписчики используют [!INCLUDE[ssEW](../../../includes/ssew-md.md)]. Данные о конфликтах не могут храниться на подписчиках, использующих [!INCLUDE[ssEW](../../../includes/ssew-md.md)] .  
  
 **Просмотр конфликтов**  
  
-   [! ВКЛЮЧИТЬ [ssManStudioFull] (.. / Token/ssManStudioFull_md.md)]: [View and Resolve Data Conflicts for Merge Publications &#40;SQL Server Management Studio&#41;](../../../relational-databases/replication/view and resolve data conflicts for merge publications.md)  
  
-   Репликация [!INCLUDE[tsql](../../../includes/tsql-md.md)] программирования: [просмотреть сведения о конфликтах для публикаций слиянием & #40; Программирование репликации Transact-SQL и #41;](../../../relational-databases/replication/view conflict information for merge publications.md)  
  
## См. также:  
 [Синхронизация данных](../../../relational-databases/replication/synchronize-data.md)  
  
  