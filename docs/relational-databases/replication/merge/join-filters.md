---
title: "Фильтры соединения | Microsoft Docs"
ms.custom: ""
ms.date: "03/07/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "фильтры [репликация SQL Server], соединение"
  - "публикации [репликация SQL Server], фильтры соединения"
  - "фильтры соединения репликации слиянием [репликация SQL Server]"
  - "фильтры соединения"
ms.assetid: dd78fd8f-56e3-4582-9abd-6bc25c91e075
caps.latest.revision: 38
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 38
---
# Фильтры соединения
  Фильтр соединения позволяет фильтровать таблицу на основе фильтрации связанной таблицы в публикации. Родительская таблица, как правило, фильтруется параметризованным фильтром. Затем определяется один или несколько фильтров соединения практически таким же способом, что и соединение таблиц. Фильтры соединения расширяют параметризованные фильтры таким образом, чтобы данные в связанных таблицах реплицировались только в том случае, если они соответствуют предложению фильтра соединения.  
  
 Фильтры соединений, как правило, следуют связям «первичный-внешний ключ», определенным для таблиц, к которым они применяются, но не ограничиваются только этими связями. Фильтр соединения может быть основан на любой логике, которая сравнивает связанные данные в двух таблицах.  
  
 Обратите внимание на следующие таблицы в образце базы данных [!INCLUDE[ssSampleDBCoShort](../../../includes/sssampledbcoshort-md.md)] , связанные связью «первичный-внешний ключ»:  
  
-   **HumanResources.Employee**  
  
-   **Sales.SalesOrderHeader**  
  
-   **Sales.SalesOrderDetail**  
  
 Эти таблицы могли бы использоваться в приложении для поддержки перемещающихся между регионами продавцов, но они должны фильтроваться таким образом, чтобы каждый менеджер продаж из таблицы **HumanResources.Employee** получал лишь те данные, которые относятся к заказам его клиентов.  
  
 Прежде всего необходимо определить параметризованный фильтр в родительской таблице, в данном примере — таблице **HumanResources.Employee.** . Эта таблица содержит столбец **LoginID**, содержащий имя входа каждого сотрудника в виде *ДОМЕН\имя_входа*. Для фильтрации таблицы, при которой каждый работник будет видеть только данные, связанные с ним, укажите следующее предложение параметризованного фильтра:  
  
```  
LoginID = SUSER_SNAME()  
```  
  
 Благодаря этому фильтру подписка каждого сотрудника содержит только данные из **HumanResources.Employee** таблицы, относящиеся к этому сотруднику (в данном случае — в одной строке). Дополнительные сведения см. в статье [Parameterized Row Filters](../../../relational-databases/replication/merge/parameterized-row-filters.md).  
  
 Следующим этапом является расширение этого фильтра на все связанные таблицы, используя синтаксис, подобный тому, который использовался для указания соединения таблиц. Первое предложение фильтра соединения:  
  
```  
Employee.EmployeeID = SalesOrderHeader.SalesPersonID  
```  
  
 Это предложение обеспечивает включение в подписку только тех сведений о заказах, которые относятся к каждому менеджеру по продажам. Второе предложение фильтра соединения:  
  
```  
SalesOrderHeader.SalesOrderID = SalesOrderDetail.SalesOrderID  
```  
  
 Это предложение обеспечивает включение в подписку только подробных данных о заказах, которые относятся к каждому менеджеру по продажам. В данном примере показывается соединение отдельной таблицы в каждой точке; кроме того, в каждой точке можно соединить и несколько таблиц.  
  
 Фильтры соединения можно добавлять по одному в мастере создания публикаций и диалоговом окне **Свойства публикации** , или же их можно добавить программно. Кроме того, их можно автоматически формировать с помощью мастера создания публикаций: укажите фильтр строк для таблицы, и фильтры соединения будут применены ко всем связанным таблицам. Дополнительные сведения см. в разделе [Определение и изменение соединения фильтра между слияния статьи](../../../relational-databases/replication/publish/define-and-modify-a-join-filter-between-merge-articles.md), [автоматически создают набор из соединения фильтры между слияния статьи и #40; SQL Server Management Studio & #41;](../../../relational-databases/replication/publish/automatically generate join filters between merge articles.md), и [определить статью](../../../relational-databases/replication/publish/define-an-article.md).  
  
## Оптимизация производительности фильтра соединения  
 Чтобы оптимизировать производительность фильтра соединения, необходимо придерживаться следующих рекомендаций.  
  
-   Ограничьте число таблиц, входящих в иерархию фильтра соединения.  
  
     Фильтры соединений могут включать неограниченное количество таблиц, однако фильтры с большим количеством таблиц могут в значительной степени повлиять на производительность во время процесса слияния. При создании фильтров соединения из пяти и более таблиц рассмотрите другие решения: не фильтруйте маленькие таблицы, таблицы, которые не изменяются или служат в основном таблицами подстановки. Используйте фильтры соединения только между теми таблицами, которые должны быть секционированы среди подписок.  
  
-   Для параметра **join unique key** установите значение **True** (где необходимо).  
  
     Для процесса слияния предлагается специальная оптимизация производительности, если соединяемый столбец в родительской таблице уникален. Если условие соединения основано на уникальном столбце, задайте для фильтра соединения параметр **join unique key** . Сведения о настройке этого параметра см. в разделах руководства, перечисленных в предыдущем разделе.  
  
-   Убедитесь, что столбцы, указанные в фильтрах соединений, имеют индексы.  
  
     Если столбцы, указанные в фильтре, имеют индексы, репликация может более эффективно обработать фильтры.  
  
-   Не создавайте фильтры строк, которые имитируют фильтры соединения.  
  
     Можно создавать фильтры строк, имитирующие фильтры соединения, используя вложенный запрос в предложении WHERE, например:  
  
    ```  
    WHERE Customer.SalesPersonID IN (SELECT EmployeeID FROM Employee WHERE LoginID = SUSER_SNAME())   
    ```  
  
     Настоятельно рекомендуется такую логику выражать в фильтре соединения, а не во вложенном запросе. Если приложение требует, чтобы фильтр строк использовал вложенный запрос, убедитесь, что вложенный запрос обращается только к поисковым данным, которые не изменяются.  
  
## См. также:  
 [Фильтрация опубликованных данных для репликации слиянием](../../../relational-databases/replication/merge/filter-published-data-for-merge-replication.md)   
 [Параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-row-filters.md)  
  
  