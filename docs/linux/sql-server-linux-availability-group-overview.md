---
title: Всегда в группах доступности для SQL Server для Linux | Документы Microsoft
description: ''
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.date: 11/27/2017
ms.topic: article
ms.prod: sql
ms.prod_service: database-engine
ms.component: ''
ms.suite: sql
ms.custom: sql-linux
ms.technology: database-engine
ms.assetid: e37742d4-541c-4d43-9ec7-a5f9b2c0e5d1
ms.openlocfilehash: b5716ab08f48900f80e24de46bc1b556884c7263
ms.sourcegitcommit: 1740f3090b168c0e809611a7aa6fd514075616bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="always-on-availability-groups-on-linux"></a>Всегда в группах доступности в Linux

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-linuxonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-linuxonly.md)]

В этой статье описываются характеристики группы доступности AlwaysOn (и действий) под управлением Linux [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] установок. В ней также рассматриваются различия между Linux и отказоустойчивого кластера Windows Server (WSFC) — на основе групп доступности. В разделе [документацию на основе Windows](../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) основы и действий, как они работают также в Windows и Linux, за исключением WSFC.

С точки зрения высокого уровня доступности группы, находящиеся под [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] в Linux аналогичны они находятся в реализации на основе WSFC. Это означает, что все ограничения и возможности одинаковы, за некоторыми исключениями. Следующие основные различия.

-   Координатор распределенных транзакций (DTC) не поддерживается с Linux в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]. Если приложения требуют использования распределенных транзакций и требуется группе Доступности, развертывание [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] в Windows.
-   Развертывание на основе Linux используйте Pacemaker вместо WSFC.
-   В отличие от большинства конфигураций для групп доступности в Windows за исключением сценарии рабочей группы кластера Pacemaker никогда не требуется доменных служб Active Directory (AD DS).
-   Как сбой группы Доступности с одного узла на другой отличается от Windows и Linux.
-   Некоторые параметры, такие как `required_synchronized_secondaries_to_commit` могут быть изменены только посредством Pacemaker в Linux, тогда как для установки, на основе WSFC используется Transact-SQL.

## <a name="number-of-replicas-and-cluster-nodes"></a>Число реплик и узлов кластера

В группе Доступности [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)] может иметь два полных реплик: основной и один получатель, которая может использоваться только для обеспечения доступности. Он не может использоваться для других, например запросы для чтения. В группе Доступности [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)] может иметь до девяти реплик общее: один первичный и до восьми вторичных реплик, из которых до трех (включая основные) может быть синхронной. Если используется базовый кластер, если участвует Corosync может быть больше всего 16 узлов. Группа доступности может занимать не более 9 16 узлов с [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)], а две имеют [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)].

Конфигурации двумя репликами, должен иметь возможность автоматически переключаться на другую реплику требует использования реплик только для конфигурации, как описано в [только для настройки реплики и кворума](#configuration-only-replica-and-quorum). Доступные только для конфигурации были представлены в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] накопительный пакет обновления 1 (CU1), поэтому это должен быть минимальный номер версии развертывания для этой конфигурации.

Если используется Pacemaker, она должна быть настроена, он остается запущен и работает. Это означает, что кворума и STONITH должен быть реализован должным образом с точки зрения Pacemaker, помимо любых [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] требования, такие как доступные только для настройки реплики.

Поддерживаются только для чтения вторичные реплики с [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)].

## <a name="cluster-type-and-failover-mode"></a>Режим тип и отказоустойчивого кластера

Новые [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] приведено описание типа кластера для групп доступности. Для Linux, существуют допустимые значения: внешних или нет. Тип кластера внешнего означает использования Pacemaker под группой Доступности. С помощью внешнего типа кластера требуется, режим отработки отказа было присвоено внешние также (также новые возможности [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]). Автоматическая отработка отказа поддерживается, но в отличие от WSFC, режим отработки отказа задается внешних, не автоматически, когда используется Pacemaker. В отличие от WSFC Pacemaker часть AG создается после настройки группы Доступности.

Тип кластера нет означает, что не требуется для, а также AG воспользуемся, Pacemaker. Даже на серверах, которые имеют Pacemaker настроен Если группе Доступности с типом кластера нет, Pacemaker не см и управлять этой группы Доступности. Тип кластера нет поддерживает только отработка отказа вручную с первичного на вторичную реплику. Группе Доступности, созданных с помощью None главным образом предназначен для чтения масштабирования сценария, а также обновление. Хотя он может работать в сценариях, например аварийного восстановления или локальной доступности, где необходима без автоматического перехода на другой ресурс, не рекомендуется. История прослушивателя также является более сложным без Pacemaker.

Тип кластера хранится в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] динамическое административное представление (DMV) `sys.availability_groups`, в столбцах `cluster_type` и `cluster_type_desc`.

## <a name="requiredsynchronizedsecondariestocommit"></a>требуется\_синхронизированы\_баз данных-получателей\_для\_фиксации

Новые [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] является параметром, который используется и действий вызывается `required_synchronized_secondaries_to_commit`. Это заставляет число вторичных реплик, которые должны быть одновременно с первичной группой Доступности. Это позволяет таких вещей, как автоматический переход на другой ресурс (только при интегрирован с Pacemaker с типом внешних объектов кластера), а также управляет поведением вещей, как доступность первичной, если нужное число вторичных реплик в сети или автономно. Чтобы получить представление о том, как это работает, в разделе [высокий уровень доступности и защиты данных в конфигурации группы доступности](sql-server-linux-availability-group-ha.md). `required_synchronized_secondaries_to_commit` Значение по умолчанию и обслуживается Pacemaker /[!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. Это значение можно заменить вручную.

Сочетание `required_synchronized_secondaries_to_commit` и новый порядковый номер (который находится в `sys.availability_groups`) информирует Pacemaker и [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] , например, автоматическая отработка отказа может произойти. В этом случае вторичная реплика будет тем же порядковым номером как первичной, а это означает, что он находится в актуальном состоянии все последние сведения о конфигурации.

Существует три значения, которые могут быть установлены для `required_synchronized_secondaries_to_commit`: 0, 1 или 2. Они управляют поведением того, что происходит, когда реплика становится недоступной. Числа соответствуют число вторичных реплик, которые должна быть синхронизирована с первичной. Поведение составляет под Linux:

-   0 — без автоматической отработки отказа возможна, поскольку ни одна вторичная реплика является обязательным для синхронизации. База данных-источник доступна всегда.
-   1 — вторичная реплика должна быть в синхронизированном состоянии с первичной; возможна автоматическая отработка отказа. База данных-источник недоступен, пока вторичная реплика синхронной доступен.
-   2 — в обеих вторичных реплик в конфигурации группы Доступности узла три или более должна быть синхронизирована с первичной; возможна автоматическая отработка отказа.

`required_synchronized_secondaries_to_commit` управляет поведением не только переход на другой ресурс с синхронными репликами, но потери данных. Со значением 1 или 2 вторичная реплика требуется всегда должна быть синхронизирована, поэтому всегда будет избыточность данных. Это означает отсутствие потерь данных.

Чтобы изменить значение `required_synchronized_secondaries_to_commit`, используйте следующий синтаксис:

>[!NOTE]
>Изменение значения вызывает ресурсов перезапустить, то есть Краткосрочные простои. Единственный способ избежать этого является установка ресурса не войдут в кластер временно.

**Red Hat Enterprise Linux (RHEL) и Ubuntu**

```bash
sudo pcs resource update <AGResourceName> required_synchronized_secondaries_to_commit=<Value>
```

**SUSE Linux Enterprise Server (SLES)**

```bash
sudo crm resource param ms-<AGResourceName> set required_synchronized_secondaries_to_commit <value>
```

где *AGResourceName* имя ресурс, настроенный для группы Доступности, и *значение* равно 0, 1 или 2. Чтобы установить его по умолчанию Pacemaker управление параметр, выполнение одной и той же инструкции и не имеет значения.

Автоматическое переключение группы Доступности может происходить, когда выполняются следующие условия:

-   Перемещение данных синхронной присваивается первичной и вторичной реплики.
-   Сервер-получатель находится в состоянии синхронизации (не синхронизировано), это означает, что они в той же точке данных.
-   Тип кластера устанавливается к внешним. Автоматический переход на другой ресурс с типом кластера нет невозможна.
-   `sequence_number` Вторичная реплика становится первичной имеет наибольший порядковый номер — другими словами, вторичная реплика `sequence_number` соответствует одному из исходной первичной реплике.

Если эти условия выполняются, сбоя сервера, на котором размещена первичная реплика группы Доступности меняют владельца синхронная реплика. Поведение для синхронных реплик (из которой может быть три общее: основной и двух вторичных реплик) дополнительно может управляться `required_synchronized_secondaries_to_commit`. Работа со и действий в Windows и Linux, но по-разному полностью настроена. В Linux значение автоматически настраивается с кластера на сам ресурс группы Доступности.

## <a name="configuration-only-replica-and-quorum"></a>Только для настройки реплики и кворума

Кроме того, новые возможности [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] на момент CU1 является репликой только для конфигурации. Поскольку Pacemaker отличается от WSFC, особенно в том случае, когда дело доходит до кворума и требовать STONITH, конфигурацию двух узлов будет работать не когда речь заходит о группе Доступности. Для экземпляра отказоустойчивого Кластера кворума механизмы, предоставляемые Pacemaker может быть нормально после того, так как все отработки отказа FCI разрешение конфликтов происходит на уровне кластера. Для группы Доступности, разрешение конфликтов в Linux происходит в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], где хранятся все метаданные. Это происходит, где реплика только для конфигурации вступает в действие.

Без ничего третий узел и по крайней мере один синхронизированной реплики не требуются. Это не будет работать для [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)], так как оно может иметь только двух реплик, участвующих в группе Доступности. Реплика только для конфигурации хранится конфигурация группы Доступности в базе данных master, совпадает с другими элементами конфигурации группы Доступности. Реплика только для конфигурации не имеет пользовательских баз данных, участвующих в группе Доступности. Данные конфигурации передается синхронно с сервера-источника. Эти данные затем используется при отработке отказа, будь то автоматический или ручной.

Для группы Доступности для поддержки кворума и включить автоматический переход на другой ресурс с типом внешних объектов кластера либо необходимо:

-   Есть три синхронных реплик ([!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)] только); или
-   У двух реплик (первичная и Вторичная), а также конфигурации только реплики.

Переход на другой ресурс вручную может произойти как с помощью внешних или ни один кластер, типы для конфигурации группы Доступности. Хотя можно настроить только для настройки реплики с AG, с типом кластера нет, не рекомендуется, так как он усложняет развертывания. Для этих конфигураций вручную изменить `required_synchronized_secondaries_to_commit` должен иметь значение по крайней мере 1, таким образом, что по крайней мере один синхронизированной реплики.

Только для настройки реплики может размещаться в любом выпуске [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], в том числе [!INCLUDE[ssexpress-md](../includes/ssexpress-md.md)]. Это позволит свести к минимуму стоимости лицензирования и обеспечивает она работает с и действий в [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)]. Это означает, что третий требуется только сервер должен соответствовать минимальным требованиям для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], так как трафик транзакций пользователь не получает группой доступности.

Когда используется только для настройки реплики, она имеет следующие особенности:

-   По умолчанию `required_synchronized_secondaries_to_commit` имеет значение 0. Такое поведение можно вручную изменить значение 1 при необходимости.
-   При сбое основного и `required_synchronized_secondaries_to_commit` равно 0, вторичная реплика будет стать новой первичной и быть доступны для чтения и записи. Если значение равно 1, автоматическая отработка отказа будет выполняться, но не будет добавлять новые транзакции, пока другой реплики находится в оперативном режиме.
-   В случае сбоя вторичной реплики и `required_synchronized_secondaries_to_commit` равно 0, первичная реплика по-прежнему принимает транзакции, но если в этот момент сбоя на основном нет защиты для данных, ни отработка отказа возможна (вручную или автоматически), так как вторичная реплика недоступна.
-   При сбое реплик только для конфигурации группы Доступности будет работать нормально, но возможен без автоматического перехода на другой ресурс.
-   Если модель не синхронной вторичной реплики и реплики только для конфигурации источника не может принять транзакции, нигде не для основного к ошибке.

В CU1 нет известная ошибка ведения журнала в файле corosync.log, сформированный с помощью `mssql-server-ha`. Если вторичная реплика не может стать первичной из-за число необходимых реплик, доступных, текущее сообщение сообщением «должен получить 1 порядковые номера, но только получил 2. Не хватает реплики находятся в оперативном режиме безопасно повышение уровня локальная реплика.» Номера должны быть отменены, и появится название «должен получить 2 порядковые номера, но только получено 1. Не хватает реплики находятся в оперативном режиме безопасно повышение уровня локальная реплика.» 

## <a name="multiple-availability-groups"></a>Несколько групп доступности 

Можно создавать более одной группы Доступности каждого кластера Pacemaker или набором серверов. Единственное ограничение: системных ресурсов. Владельцем группы Доступности показано master. И различных действий может принадлежать разных узлах; они не все нужно запускать на одном узле.

## <a name="drive-and-folder-location-for-databases"></a>Диск и папку расположения для баз данных

На основе Windows и действий, диск и папку структуры для пользовательских баз данных, участвующих в группе Доступности должны быть идентичными. Например, если пользователь базы данных в `/var/opt/mssql/userdata` на сервере А этой же папке должна существовать на сервере B. Единственное исключение упоминалось в разделе [взаимодействие с помощью групп доступности на основе Windows и](#interoperability-with-windows-based-availability-groups-and-replicas).

## <a name="the-listener-under-linux"></a>Прослушиватель в Linux

Что прослушиватель имеет дополнительные функциональные возможности для группы Доступности. Он предоставляет единую точку входа для всех подключений (чтение запись для первичной реплики и/или только для чтения для вторичной реплики), чтобы приложений и пользователей не нужно знать, какой сервер размещение данных. В WSFC а также DNS это сочетание ресурс сетевого имени и IP-ресурс, который затем регистрируется в Доменных службах Active Directory (при необходимости). В сочетании с сам ресурс группы Доступности он предоставляет это абстрактное представление. Дополнительные сведения о прослушивателя см. в разделе [прослушиватели, возможность подключения клиентов и отработка отказа приложений](../database-engine/availability-groups/windows/listeners-client-connectivity-application-failover.md).

Прослушиватель под Linux настроен по-разному, но его функциональные возможности. Отсутствует понятие ресурса сетевого имени в Pacemaker, а также объект создается в Доменных службах Active Directory; имеется только ресурсом IP-адреса в Pacemaker, который может работать на любом из узлов. Запись, связанный с ресурсом IP для прослушивателя в DNS с «понятное имя» должна быть создана. IP-ресурс для прослушивателя только будут активны на сервере, где размещена первичная реплика, для этой группы доступности.

Если используется Pacemaker и создается ресурс IP-адреса, связанного с прослушивателем, будет существовать Краткосрочные простои как IP-адрес останавливается на одном сервере и начинается с другой будь то автоматический или ручной переход на другой ресурс. Это обеспечивает Абстрагирование посредством сочетание одно имя и IP-адрес, простоя не маску. Приложение должно иметь возможность обрабатывать отключение, что какая-либо функциональные возможности для его обнаружения и восстановления.

Однако сочетание имени DNS и IP-адрес по-прежнему не хватает для предоставления всех функциональных возможностей предоставляет прослушивателя в кластере WSFC, например для вторичных реплик, маршрутизация только для чтения. При настройке группы Доступности, «прослушиватель» по-прежнему необходимо настроить в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. Это можно заметить в мастере, а также синтаксис Transact-SQL. Это можно настроить в одно и то же как и в Windows двумя способами:

-   Для группы Доступности с типом внешних объектов кластера, IP-адрес, связанный с «прослушиватель», созданных в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] должен быть IP-адрес ресурса, созданные в Pacemaker.
-   Для группы Доступности, созданные с типом кластера нет используйте IP-адреса, связанного с первичной репликой.

Экземпляр, связанный с предоставленный IP-адрес, затем становится координатором для таких вещей, как только для чтения маршрутизации запросов приложений.

## <a name="interoperability-with-windows-based-availability-groups-and-replicas"></a>Взаимодействие с группами доступности на основе Windows и реплик 

Группе Доступности, имеющего тип кластера внешние или адрес, находящийся в WSFC не может иметь ее реплик кросс-платформы. Это верно, является ли группой Доступности [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)] или [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)]. То есть в традиционных конфигурации группы Доступности с базовый кластер, одна реплика не может быть в пределах кластера WSFC, а другое — на Linux с Pacemaker.

Группы Доступности с типом кластера нет может иметь ее реплик выходить за пределы операционной системы, поэтому может существовать обе реплики на основе Linux и Windows в одну группу Доступности. Пример приведен здесь где первичная реплика находится под управлением Windows, когда сервер-получатель установлен на одном дистрибутивов Linux.

![Гибридные None](./media/sql-server-linux-availability-group-overview/image1.png)

Распределенные группы Доступности также может выходить за пределы операционной системы. Связанные базового и действий по правила для их настройки, например настроены внешние, только для Linux, но группы Доступности, который присоединен к может настраиваться с использованием WSFC. Рассмотрим следующий пример:

![Гибридные Dist AG](./media/sql-server-linux-availability-group-overview/image2.png)

<!-- Distributed AGs are also supported for upgrades from [!INCLUDE[sssql15-md](../includes/sssql15-md.md)] to [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]. For more information on how to achieve this, see [the article “x”].

If using automatic seeding with a distributed availability group that crosses OSes, it can handle the differences in folder structure. How this works is described in [the documentation for automatic seeding].
-->
 
## <a name="next-steps"></a>Следующие шаги
[Настройка группы доступности для SQL Server в Linux](sql-server-linux-availability-group-configure-ha.md)

[Настройка группы доступности чтения шкалы для SQL Server в Linux](sql-server-linux-availability-group-configure-rs.md)

[Добавьте группу доступности ресурса кластера на RHEL](sql-server-linux-availability-group-cluster-rhel.md)

[Добавьте группу доступности ресурса кластера на SLES](sql-server-linux-availability-group-cluster-sles.md)

[Добавьте группу доступности ресурса кластера на Ubuntu](sql-server-linux-availability-group-cluster-ubuntu.md)

[Настройка группы доступности между различными платформами](sql-server-linux-availability-group-cross-platform.md)

