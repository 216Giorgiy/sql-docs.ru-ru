---
title: "Известные проблемы для обучения Machine Services | Документы Microsoft"
ms.custom:
- SQL2016_New_Updated
ms.date: 06/16/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- r-services
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 2b37a63a-5ff5-478e-bcc2-d13da3ac241c
caps.latest.revision: 53
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: b7b9d53a87490e83f888b47b1cff87191b9693a8
ms.contentlocale: ru-ru
ms.lasthandoff: 09/01/2017

---
# <a name="known-issues-for-machine-learning-services"></a>Известные проблемы в службах машин обучения

С помощью машинного обучения компонентов, которые предоставляются в виде параметра в SQL Server 2016 и 2017 г. SQL Server, в этом разделе описываются известные проблемы и ограничения.

Если не указано специально, применяется ко всем следующее:

+ SQL Server 2016

  - Службы R Services (в базе данных)
  - Microsoft R Server (изолированная версия)

+ SQL Server 2017

  - Машинное обучение служб R (в базе данных)
  - Машинное обучение служб для Python (в базе данных)
  - Сервер машинного обучения (автономный)

## <a name="setup-and-configuration-issues"></a>Вопросы настройки и установки

Здесь перечислены описание обработаны и общие вопросы, связанные с начальной установки и конфигурации: [обновление и часто задаваемые вопросы по установке](r/upgrade-and-installation-faq-sql-server-r-services.md).

См. также в этой статье для получения сведений об обновлениях, -параллельную установку и установку из новых компонентов R или Python.

### <a name="unable-to-install-python-components-in-in-offline-installs-of-sql-server-2017"></a>Не удается установить компоненты Python в автономных экземпляров SQL Server 2017 г.

Если установить 2017 г. SQL Server на компьютере без доступа к Интернету, программа установки может завершиться ошибкой для отображения страницы, которые запрашиваются расположение загруженных компонентов Python; Таким образом можно установить компонент служб машины обучения, но не компоненты Python.

Эта проблема будет исправлена в следующих выпусках. Чтобы избежать этого можно временно включить доступ к Интернету на время выполнения программы установки. Это ограничение не применяется к R.

**Применяется к:** SQL Server 2017 г. с Python

### <a name="install-latest-service-release-to-ensure-compatibility-with-microsoft-r-client"></a>Чтобы обеспечить совместимость с клиентом Microsoft R, установите последний выпуск службы.

Если вы установите последнюю версию клиента Microsoft R и использовать его для выполнения R на контекста вычислений SQL Server с помощью удаленного, может появиться ошибка примерно так:

*9.x.x версия клиента Microsoft R выполняются на компьютере, которая несовместима с 8.x.x версии Microsoft R Server. Скачайте и установите совместимую версию*.

SQL Server 2016 необходимые библиотеки R на клиентском компьютере на совпадать библиотек R на сервере. Ограничение было снято для более поздней версии, чем R Server 9.0.1 освобождает. Тем не менее если эта ошибка возникает, проверьте версию библиотек R используется ваш клиент и сервер nad при необходимости обновления клиента в соответствии с версией сервера.

Версии R, который устанавливается вместе с SQL Server R Services обновляется при установке обновления выпуска SQL Server. Таким образом чтобы всегда иметь последние версии компонентов R, следует установить все пакеты обновления.

Для совместимости с клиентом Microsoft R 9.0.0 необходимо установить обновления, которые описываются в этой [статье службы поддержки](https://support.microsoft.com/kb/3210262).

Чтобы избежать проблем с пакетами R, можно обновить версию библиотек R, которые установлены на сервере, путем изменения политики современных жизненного цикла, как описано в [в этом разделе](#bkmk_sqlbindr). После этого, версии R, установленных с SQL Server обновляется по тому же расписанию, что обновления публикуются для Microsoft R Server, убедитесь, что сервер и клиент может всегда последних выпусках Microsoft R.

**Применяется к:** служб SQL Server 2016 R, с сервером R версии от 9.0.0 или более ранней версии

### <a name="bkmk_sqlbindr"></a>Предупреждение о несовместимой версии, при подключении к старой версии SQL Server R Services из клиента с помощью[!INCLUDE[ssSQLv14_md](../includes/sssqlv14-md.md)]

Если вы установили Microsoft R Server на клиентском компьютере с помощью мастера установки для [!INCLUDE[ssSQLv14_md](../includes/sssqlv14-md.md)] или нового автономного установщика [Microsoft R Server](https://msdn.microsoft.com/microsoft-r/rserver-install-windows), а затем выполняете код R в контексте вычисления, который использует более раннюю версию служб SQL Server R, может возникнуть ошибка наподобие следующей:

*На компьютере используется версия 9.0.0 клиента Microsoft R, которая несовместима с Microsoft R Server версии 8.0.3. Скачайте и установите совместимую версию*.

В состав выпуска Microsoft R Server 9.0 входит средство **SqlBindR.exe**, обеспечивающее обновление экземпляров SQL Server до совместимой версии 9.0. Поддержка обновления экземпляров служб R до версии 9.0 будет реализована в будущем выпуске служб для SQL Server. Версии, которые являются кандидатами для будущих обновлений включают SQL Server 2016 RTM CU3 + и SP1 + и SQL Server 2017 г CTP-версии 1.1.

**Применяется к:** служб SQL Server 2016 R, с сервером R версии от 9.0.0 или более ранней версии

### <a name="setup-for-sql-server-2016-service-releases-might-fail-to-install-newer-versions-of-r-components"></a>При установке выпусков служб SQL Server 2016 могут не установиться более новые версии компонентов R.

При установке накопительного пакета обновления или пакета обновления для SQL Server 2016 на компьютере, не подключенном к Интернету, мастер установки может не вывести запрос, позволяющий обновить компоненты R с помощью скачанных файлов CAB. Обычно это происходит, если несколько компонентов устанавливаются вместе с ядром СУБД.

Чтобы избежать этого, можно установить выпуск обновления, с помощью командной строки и указав */MRCACHEDIRECTORY* аргумент, как показано в этом примере выполняется установка обновлений CU1:

`C:\<path to installation media>\SQLServer2016-KB3164674-x64.exe /Action=Patch /IACCEPTROPENLICENSETERMS /MRCACHEDIRECTORY=<path to CU1 CAB files>`

Последние установщиков см. [Установка компонентов обучения компьютер без доступа к Интернету](r/installing-ml-components-without-internet-access.md).

**Применяется к:** служб SQL Server 2016 R, с сервером R версии от 9.0.0 или более ранней версии

### <a name="launchpad-services-fails-to-start-if-version-is-different-than-r-version"></a>Службы панели запуска не запускаются, если их версия отличается от версии R.

При установке служб R отдельно от компонента database engine и имеют разные версии сборки, возможны ошибки в журнале системных событий: _службы панели запуска SQL Server не удалось запустить из-за следующей ошибки: служба не ответ на запрос в течение отведенного времени._

Эта ошибка может возникнуть, например, если вы установили ядро СУБД с использованием версии выпуска, применили исправление для обновления ядра СУБД, а затем добавили службы R с использованием версии выпуска.

Чтобы избежать этой проблемы, убедитесь в том, что все компоненты имеют одинаковый номер версии. Если вы обновляете один компонент, обязательно примените это же обновление ко всем остальным установленным компонентам.

Список номеров версий R, требуемых для каждого выпуска SQL Server 2016, см. в разделе [Установка компонентов R без доступа к Интернету](r/installing-ml-components-without-internet-access.md).

### <a name="remote-compute-contexts-blocked-by-firewall-in-sql-server-instances-running-on-azure-virtual-machines"></a>Контексты удаленных вычислений блокируются брандмауэром в экземплярах SQL Server, работающих на виртуальных машинах Azure

Если вы установили [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] на виртуальной машине Azure, возможно, вы не сможете использовать контексты вычислений, для которых требуется рабочее пространство виртуальной машины. Объясняется это тем, что по умолчанию брандмауэр виртуальной машины Azure использует правило, которое блокирует сетевой доступ для локальных учетных записей пользователя R.

Чтобы избежать этого, на виртуальной машине Azure откройте **брандмауэр Windows в режиме повышенной безопасности**, выберите **Исходящие правила**и отключить следующее правило: "Блокировать сетевой доступ для локальных учетных записей пользователей R в экземпляре SQL Server MSSQLSERVER".

### <a name="implied-authentication-in-sqlexpress"></a>Неявная проверка подлинности в SQLEXPRESS

При выполнении заданий R с удаленной рабочей станции обработки и анализа данных с применением встроенной проверки подлинности Windows сервер SQL Server будет использовать *неявную проверку подлинности* для создания локальных вызовов ODBC, которые могут потребоваться скрипту. Но эта функция не работала в сборке RTM экспресс-выпуска SQL Server.

Чтобы устранить эту проблему, рекомендуем произвести обновление до более позднего выпуска службы.

Если обновление невозможно, вы можете использовать имя входа SQL для выполнения удаленных заданий R, которым могут потребоваться внедренные вызовы ODBC.

**Применяется к:** экспресс-выпуск служб R SQL Server 2016

### <a name="performance-limits-when-r-libraries-are-called-from-standalone-r-tools"></a>Ограничивает производительности при вызове из R автономные средства библиотеки R

Существует возможность вызова средств R и библиотек, которые устанавливаются для SQL Server R Services из внешнего приложения R, например RGui. Это может быть удобно при установке новых пакетов, или выполнение нерегламентированных тестов на очень короткие примеры кода.

Однако иметь в виду, что за пределами SQL Server, производительность будет ограничена. Например даже если вы приобрели Enterprise Edition SQL Server, R будет выполняться в однопотоковом режиме при выполнении кода R с помощью внешних средств. Производительность будет выше, при выполнении кода R, инициирует подключение к SQL Server и используя [sp_execute_external_script](../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md), которой будет вызывать библиотеки R для вас.

+ Старайтесь не вызывать библиотеки R, используемые SQL Server, из внешних средств R.
+ Если нужно выполнить много кода R на компьютере SQL Server без использования SQL server, установить отдельный экземпляр R, например клиент Microsoft R и затем убедитесь, что ваши средства разработки R точки в новой библиотеке.

Дополнительные сведения см. в разделе [Создание изолированного сервера R Server](r/create-a-standalone-r-server.md).

### <a name="r-script-throttled-due-to-resource-governance-default-values"></a>R-сценарий регулированию из-за значения по умолчанию для ресурсов управления

В выпуске Enterprise Edition можно использовать пулы ресурсов для управления внешними процессами скриптов. В некоторых ранних сборках выпуска максимальный объем памяти, который может быть распределен процессам R: 20%. Поэтому, если сервер имел 32 ГБ ОЗУ, исполняемые файлы R (RTerm.exe и BxlServer.exe) могли использовать не более 6,4 ГБ для одного запроса.

Если вы сталкиваетесь с ограничениями ресурсов, проверьте текущее значение по умолчанию и, если 20 % недостаточно, воспользуйтесь инструкциями по изменению этого значения в документации по [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .

**Применяется к:** служб R SQL Server 2016, Enterprise Edition

## <a name="r-code-execution-and-package-or-function-issues"></a>Выполнение кода R и пакета или функция проблемы

Этот раздел содержит известные проблемы, относящиеся к выполнение R на сервере SQL Server, а также некоторые проблемы, связанные с библиотеки R и инструменты, опубликованные корпорацией Майкрософт, включая RevoScaleR.

Другие известные проблемы, которые могут повлиять на решения R, см. в разделе сайта Microsoft R Server: [известные проблемы с Microsoft R Server](https://msdn.microsoft.com/microsoft-r/rserver-known-issues)

### <a name="limitations-on-processor-affinity-for-r-jobs"></a>Ограничения на соответствие процессоров для заданий R

В сборке первоначального выпуска SQL Server 2016 можно установить соответствие процессоров только для процессоров в первом k группе. Например, если сервер представляет собой компьютер с двумя сокетами и двумя k-группами, для процессов R будут использоваться только процессоры из первой k-группы. Это же ограничение действует при настройке регулирования ресурсов для заданий скриптов R.

Проблема исправлена в SQL Server 2016 с пакетом обновления 1 (SP1).

**Применяется к:** версии RTM, службы R SQL Server 2016

### <a name="changes-to-column-types-cannot-be-performed-when-reading-data-in-a-sql-server-compute-context"></a>Изменение типов столбцов невозможно при считывании данных в контексте вычисления SQL Server.

Если в качестве контекста вычисления задан экземпляр SQL Server, вы не можете использовать аргумент _colClasses_ (или иные подобные аргументы) для изменения типа данных столбцов в коде R.

Например, следующая инструкция приведет к ошибке, если столбец CRSDepTimeStr уже не является целочисленным:

~~~~
data <- RxSqlServerData(sqlQuery = "SELECT CRSDepTimeStr, ArrDelay  FROM AirlineDemoSmall",
                                connectionString = connectionString,
                                colClasses = c(CRSDepTimeStr = "integer"))
~~~~

Эта проблема будет исправлена в будущем выпуске.

В качестве обходного решения можно переписать SQL-запрос так, чтобы в нем использовалась функция CAST или CONVERT, и предоставить данные среде R с правильным типом данных. Как правило, оптимальнее в плане производительности работать с данными с помощью SQL, а не изменять данные в коде R.

**Применяется к:** служб R SQL Server 2016

### <a name="avoid-clearing-workspaces-when-executing-r-code-in-a-includessnoversionincludesssnoversion-mdmd-compute-context"></a>Старайтесь не очищать рабочие области при выполнении кода R в контексте вычисления [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .

Если вы используете команду R для очистки рабочей области объектов при выполнении кода R в контексте вычисления [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] или если вы очищаете рабочую область в рамках скрипта R, вызываемого с помощью [sp_execute_external_script](../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md), может возникнуть следующая ошибка: *объект рабочей области revoScriptConnection не найден*.

`revoScriptConnection` — это объект в рабочей области R, который содержит информацию о сеансе R, вызываемом из [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Но если код R содержит команду для очистки рабочей области (например, `rm(list=ls()))`), вся информация о сеансе и других объектах в рабочей области R также очищается.

Чтобы избежать этой проблемы, старайтесь не очищать переменные и другие объекты без особой надобности при выполнении кода R в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Хотя очистка рабочих областей является обычным действием при работе в консоли R, она может иметь непредвиденные последствия.

+ Для удаления конкретных переменных используйте функцию *remove* языка R: `remove('name1', 'name2', ...)`.
+ Если нужно удалить несколько переменных, сохраните имена временных переменных в списке и периодически выполняйте сборку мусора.

### <a name="restrictions-on-data-that-can-be-provided-as-input-to-an-r-script"></a>Ограничения для данных, которые могут быть предоставлены как входные данные в сценарии R

Следующие типы результатов запросов невозможно использовать в сценарии R:

- данные из запроса [!INCLUDE[tsql](../includes/tsql-md.md)] , который ссылается на столбцы AlwaysEncrypted;
  
- данные из запроса [!INCLUDE[tsql](../includes/tsql-md.md)] , который ссылается на маскированные столбцы.
  
     Если вам необходимо использовать скрытые данные в сценарии R, при необходимости можно создать копию данных во временной таблице и использовать эти данные.

### <a name="arguments-varstokeep-and-varstodrop-not-supported-for-sql-server-data-sources"></a>Аргументы *varsToKeep* и *varsToDrop* не поддерживается для источников данных SQL Server

При использовании функции rxDataStep для записи результатов в таблицу с помощью *varsToKeep* и *varsToDrop* является удобным способом для определения столбцов, которые нужно включить или исключить как часть операции. В настоящее время эти аргументы не поддерживаются для источников данных SQL Server.

Это ограничение будет снято в более поздней версии.

### <a name="limited-support-for-sql-data-types-in-spexecuteexternalscript"></a>Ограниченная поддержка для типов данных SQL в`sp_execute_external_script`

Не все типы данных, поддерживаемые в SQL, можно использовать в R. В качестве обходного решения можно привести неподдерживаемый тип данных к поддерживаемому перед передачей данных в процедуру sp_execute_external_script.

Дополнительные сведения см. в разделе [библиотеки R и типы данных](r/r-libraries-and-data-types.md).

### <a name="possible-string-corruption"></a>Возможное повреждение строки

Любая передача строковых данных из [!INCLUDE[tsql](../includes/tsql-md.md)] в R, а затем снова в [!INCLUDE[tsql](../includes/tsql-md.md)] может привести к повреждению. Это происходит из-за различных кодировок, используемых в R и [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], а также из-за разных параметров сортировки и языков, поддерживаемых в R и [!INCLUDE[tsql](../includes/tsql-md.md)]. Любая строка в кодировке, отличной от ASCII, может обрабатываться неправильно.

При отправке строковых данных в R преобразуйте их в ASCII, если это возможно.

### <a name="only-one-value-of-type-raw-can-be-returned-from-spexecuteexternalscript"></a>Только одно значение типа `raw` могут быть возвращены из`sp_execute_external_script`

Если двоичный тип данных (тип данных **raw** R) возвращается из R, значением должно быть значение из блока выходных данных.

Поддержка множества выходных данных **raw** будет добавлена в последующих выпусках.

Одно возможное решение для использования нескольких выходных наборов — выполнить несколько вызовов хранимой процедуры и отправить результат назад в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с использованием ODBC.

Обратите внимание на то, что получить значения параметров можно вместе с результатами выполнения хранимой процедуры, просто добавив ключевое слово OUTPUT. Дополнительные сведения см. в разделе [Возвращение данных с помощью параметров OUTPUT](https://technet.microsoft.com/library/ms187004.aspx).

### <a name="loss-of-precision"></a>Потеря точности

[!INCLUDE[tsql](../includes/tsql-md.md)] и R поддерживают различные типы данных, поэтому во время преобразования возможна потеря точности числовых типов данных.

Дополнительные сведения о неявном преобразовании типов данных см. в разделе [Working with R Data Types](r/r-libraries-and-data-types.md).

### <a name="variable-scoping-error-the-sample-data-set-for-the-analysis-has-no-variables-when-using-the-transformfunc-parameter"></a>Ошибка области переменной "Образец набора данных для анализа не содержит переменных" при использовании параметра transformFunc

Вы можете передать аргумент *transfилиmFunc* в такой функции, как `rxLinmod` или `rxLogit` to transfилиm the data while modelling. Тем не менее вложенные вызовы функций могут привести к ошибкам области применения в контексте вычислений SQL Server, даже если вызовы правильно работают в локальном контексте.

Например, предположим, что в глобальной локальной среде определены две функции, `f` и `g` , и `g` вызывает `f`. В распределенных или удаленных вызовах с использованием `g`вызов `g` может вызвать ошибку, поскольку не удается найти `f` , даже если вы передали удаленному вызову `f` и `g` .

При возникновении этой проблемы можно внедрить определение `f` в ваше определение `g`в любом месте перед тем, где `g` обычно вызывает `f`.

Например:

```  
f <- function(x) { 2*x + 3 }  
g <- function(y) {   
              a <- 10 * y  
               f(a)  
}  
  
```  


Чтобы избежать этой ошибки, можно перепишите следующим образом:

```  
g <- function(y){  
              f <- function(x) { 2*x +3}  
              a <- 10 * y  
              f(a)  
}  
  
```  

### <a name="data-import-and-manipulation-using-revoscaler"></a>Импорт и обработка данных с помощью RevoScaleR

При чтении столбцов **varchar** из базы данных пробелы удаляются. Чтобы избежать этого, добавьте перед и после строк символы, отличные от пробелов.

При использовании таких функций, как `rxDataStep` , для создания таблиц баз данных со столбцами **varchar** ширина столбца вычисляется на основе образца данных. Если ширина может быть различной, может потребоваться дополнить все строки до одинаковой длины.

Использование преобразования для изменения типа данных переменной не поддерживается при повторном вызове `rxImport` или `rxTextToXdf` для импорта и дополнения строк с объединением нескольких входных файлов в один XDF-файл.

### <a name="limited-support-for-rxexec"></a>Ограниченная поддержка rxExec

В SQL Server 2016 `rxExec` пакета RevoScaleR, предоставляемые функция может использоваться только в однопоточном режиме.

Поддержка параллелизма `rxExec` в нескольких процессах будет добавлена в следующих выпусках.

### <a name="increase-maximum-parameter-size-to-support-rxgetvarinfo"></a>Увеличение максимального размера параметра для поддержки rxGetVarInfo

При использовании наборов данных с очень большим количеством переменных (например, более 40 000) следует задать флаг `max-ppsize` при запуске R для использования функций, таких как `rxGetVarInfo`.  Флаг `max-ppsize` указывает максимальный размер стека защиты указателей.

Если вы используете консоль R (например, в rgui.exe или rterm.exe), можно задать значение max-ppsize 500 000, введя:

```  
R --max-ppsize=500000  
```  
  
Если вы используете среду [!INCLUDE[rsql_developr](../includes/rsql-developr-md.md)] , можно задать флаг `max-ppsize` , вызвав исполняемый файл RevoIDE:

```  
RevoIDE.exe /RCommandLine --max-ppsize=500000  
```  

### <a name="issues-with-the-rxdtree-function"></a>Проблемы с функцией rxdtree

Функция `rxDTree` в настоящее время не поддерживает преобразование в формулах. В частности, использование синтаксиса `F()` для создания факторов в режиме реального времени не поддерживается. Однако числовые данные будут автоматически сегментироваться.

Упорядоченные факторы обрабатываются так же, как факторы, во всех функциях анализа RevoScaleR, за исключением `rxDTree`.

## <a name="revolution-r-enterprise-and-microsoft-r-open"></a>Revolution R Enterprise и Microsoft R Open

В этом разделе перечислены проблемы, связанные со средствами подключения, разработки и оценки производительности R, предоставляемыми Revolution Analytics. Эти средства предоставлялись в предварительных версиях  [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)]. 

В общем случае рекомендуется удалить эти предыдущие версии и установить последнюю версию SQL Server или Microsoft R Server.

### <a name="running-side-by-side-versions-of-revolution-r-enterprise"></a>Параллельная работа разных версий Revolution R Enterprise

Параллельная установка Revolution R Enterprise с любой другой версией [!INCLUDE[rsql_productname_md](../includes/rsql-productname-md.md)] не поддерживается.

У вас есть лицензия на использование другой версии Revolution R Enterprise, вам необходимо поместить ее на отдельном компьютере, где нет экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , и не на рабочей станции, которая будет использоваться для подключения к экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .

### <a name="use-of-r-productivity-environment-not-supported"></a>Использование среды производительности R не поддерживается

Некоторые предварительные версии [!INCLUDE[rsql_productname](../includes/rsql-productname-md.md)] включали в себя среду разработки R для Windows, которая была создана с помощью Revolution Analytics. Это средство больше не предоставляется и не поддерживается.

Для обеспечения совместимости с [!INCLUDE[rsql_productname](../includes/rsql-productname-md.md)], настоятельно рекомендуется установить клиент Microsoft R или Microsoft R Server вместо инструментов Revolution Analytics. [Средства R для Visual Studio](https://www.visualstudio.com/vs/rtvs/) — еще один рекомендуемый клиент, который поддерживает решения Microsoft R.

### <a name="compatibility-issues-with-sqlite-odbc-driver-and-revoscaler"></a>Проблемы совместимости с драйвером SQLite ODBC и RevoScaleR

Версия 0.92 драйвера SQLite ODBC не совместима с RevoScaleR, версии 0.88–0.91 и 0.93 и более поздние совместимы.

## <a name="see-also"></a>См. также:

[Что нового в SQL Server 2016](../sql-server/what-s-new-in-sql-server-2016.md)


