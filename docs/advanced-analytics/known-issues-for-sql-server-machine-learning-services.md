---
title: "Известные проблемы в работе службы обучения машины | Документы Microsoft"
ms.date: 02/05/2018
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.service: 
ms.component: 
ms.reviewer: 
ms.suite: sql
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 2b37a63a-5ff5-478e-bcc2-d13da3ac241c
caps.latest.revision: 
author: jeannt
ms.author: jeannt
manager: cgronlund
ms.workload: On Demand
ms.openlocfilehash: 2c3bd4ada6d234015ef1ab4d8b474f7ab45c4b85
ms.sourcegitcommit: acab4bcab1385d645fafe2925130f102e114f122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2018
---
# <a name="known-issues-in-machine-learning-services"></a>Известные проблемы в службах машин обучения

С помощью машинного обучения компонентов, которые предоставляются в виде параметра в SQL Server 2016 и 2017 г. SQL Server в этой статье описываются известные проблемы и ограничения.

Приведенные здесь сведения относятся ко всем следующим образом, если не указано иное:

SQL Server 2016

- Службы R (в базе данных)
- Microsoft R Server (изолированная версия)

SQL Server 2017

- Машинное обучение служб R (в базе данных)
- Машинное обучение служб для Python (в базе данных)
- Сервер машинного обучения (автономный)

## <a name="setup-and-configuration-issues"></a>Проблемы установки и настройки

Описание процессов и часто задаваемые вопросы, связанные с начальной установки и настройки см. в разделе [часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md). Он содержит сведения об обновлениях, -параллельную установку и установку из новых компонентов R или Python.

### <a name="unable-to-install-sql-server-machine-learning-features-on-a-domain-controller"></a>Не удалось выполнить установку функции обучения компьютера SQL Server на контроллере домена

Если вы пытаетесь установить SQL Server 2016 R Services или службы SQL Server 2017 г машины обучения на контроллере домена, произойдет сбой программы установки, с этими ошибками:

> *Произошла ошибка во время установки компонента*
> 
> *Не удается найти группу с идентификатором*
> 
> *Код ошибки компонента: 0x80131509*

Возникает ошибка, так как на контроллере домена службу не удается создать 20 локальные учетные записи, необходимые для запуска машинного обучения. В общем случае не рекомендуется устанавливать SQL Server на контроллере домена. Дополнительные сведения см. в разделе [поддержки бюллетеня 2032911](https://support.microsoft.com/en-us/help/2032911/you-may-encounter-problems-when-installing-sql-server-on-a-domain-cont).

### <a name="install-the-latest-service-release-to-ensure-compatibility-with-microsoft-r-client"></a>Установите последнюю версию службы для обеспечения совместимости с клиентом Microsoft R

Если вы установите последнюю версию клиента Microsoft R и использовать его для запуска R на сервере SQL Server в контексте удаленных вычислений, может появиться ошибка следующим образом:

> *9.x.x версия клиента Microsoft R выполняются на компьютере, которая несовместима с версией 8.x.x Microsoft R Server. Скачайте и установите совместимую версию*.

SQL Server 2016 требует, что библиотеки R на клиенте строго соответствовать библиотек R на сервере. Ограничение позже, чем R Server 9.0.1 было удалено для выпусков. Тем не менее если эта ошибка возникает, проверьте версию библиотек R, используемый клиентом и сервером и при необходимости обновите клиент в соответствии с версией сервера.

Версии R, который устанавливается вместе с SQL Server R Services обновляется при установке обновления выпуска SQL Server. Чтобы всегда иметь последние версии компонентов R, не забудьте установить все пакеты обновления.

Чтобы обеспечить совместимость с клиентом Microsoft R от 9.0.0, установить обновления, описанные в этом [статья службы поддержки](https://support.microsoft.com/kb/3210262).

Чтобы избежать проблем с пакетами R, можно обновить версию библиотек R, установленных на сервере, изменив обслуживания соглашении использовать политику современных жизненного цикла поддержки, как описано в [разделу](#bkmk_sqlbindr). При этом версии R, который устанавливается вместе с SQL Server обновляется по тому же расписанию, используемым для обновлений машины сервера обучения (прежнее название — Microsoft R Server).

**Применяется к:** служб SQL Server 2016 R, с сервером R версии от 9.0.0 или более ранней версии

### <a name="r-components-missing-from-cu3-setup"></a>Отсутствуют в программе установки CU3 компоненты R

Ограниченное число виртуальных машин Azure были подготовлены без файлов установки R, которые должны включаться вместе с SQL Server. Такая проблема распространяется на виртуальные машины, подготовленный в период с 2018-01-05 по 2018-01-23. Эта проблема также может повлиять на локальной установки, если примененной CU3 обновление для SQL Server 2017 г. до истечения 2018-01-05-2018-01-23.

Выпуск обновления предоставлен, включающего правильную версию R установочных файлов.

+ [Накопительный пакет обновления 3 для SQL Server 2017 г. KB4052987](https://www.microsoft.com/en-us/download/details.aspx?id=56128).

Чтобы установить компоненты и восстановить CU3 2017 г. SQL Server, необходимо удалить CU3 и повторно установить обновленную версию:

1. Загрузите обновленный файл установки CU3, включая установщики R.
2. Удалите CU3. В панели управления найдите **удалить обновление**, а затем выберите «Исправление 3015 для SQL Server 2017 г. (KB4052987) (64-разрядная версия)». Продолжите шаги для удаления.
3. Переустановите обновление CU3, дважды щелкнув обновление для только что загруженный KB4052987: `SQLServer2017-KB4052987-x64.exe`. Следуйте инструкциям по установке.

### <a name="unable-to-install-python-components-in-offline-installations-of-sql-server-2017-ctp-20-or-later"></a>Не удалось установить компоненты Python в автономной установки SQL Server 2017 г CTP 2.0 или более поздней версии

При установке предварительной версии 2017 г. SQL Server на компьютере без доступа к Интернету, программа установки может завершиться ошибкой для отображения страницы, которые запрашиваются расположение загруженных компонентов Python. В таком случае можно установить компонент служб машины обучения, но не компоненты Python.

Эта проблема исправлена в версии выпуска. Кроме того это ограничение не применяется для компонентов R.

**Применяется к:** SQL Server 2017 г. с Python

### <a name="bkmk_sqlbindr"></a>Предупреждение о несовместимой версии, при подключении к более старой версии SQL Server R Services из клиента с помощью[!INCLUDE[ssSQLv14_md](../includes/sssqlv14-md.md)]

При выполнении кода R контексте вычислений SQL Server 2016, может появиться следующая ошибка:

> *На компьютере используется версия 9.0.0 клиента Microsoft R, которая несовместима с Microsoft R Server версии 8.0.3. Скачайте и установите совместимую версию*.

Это сообщение появляется, если выполняется любое из следующих двух инструкций,

+ R Server (изолированный) установлены на клиентском компьютере с помощью мастера установки [!INCLUDE[ssSQLv14_md](../includes/sssqlv14-md.md)].
+ Установить Microsoft R Server с помощью [разделения установщика Windows](https://docs.microsoft.com/machine-learning-server/install/r-server-install-windows).

Чтобы убедиться, что сервер и клиент используют ту же версию, может потребоваться использовать _привязки_, поддерживаемых Microsoft R Server 9.0 и более поздние версии для обновления компонентов R в экземплярах SQL Server 2016. Чтобы определить, если обновление поддерживается для вашей версии службы R, см. на [обновления экземпляра служб R, с помощью SqlBindR.exe](/r/use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

**Применяется к:** служб SQL Server 2016 R, с сервером R версии от 9.0.0 или более ранней версии

### <a name="setup-for-sql-server-2016-service-releases-might-fail-to-install-newer-versions-of-r-components"></a>При установке выпусков служб SQL Server 2016 могут не установиться более новые версии компонентов R.

При установке накопительного пакета обновления или установки пакета обновления для SQL Server 2016 на компьютере, который не подключен к Интернету, мастер установки может не отобразить запрос, который можно изменять с помощью CAB-файлов, загруженных компонентов R. Эта ошибка обычно возникает при нескольких компонентов были установлены вместе с ядром базы данных.

Чтобы избежать этого, можно установить выпуск обновления, с помощью командной строки и указав `MRCACHEDIRECTORY` аргумент, как показано в этом примере выполняется установка обновлений CU1:

`C:\<path to installation media>\SQLServer2016-KB3164674-x64.exe /Action=Patch /IACCEPTROPENLICENSETERMS /MRCACHEDIRECTORY=<path to CU1 CAB files>`

Последние установщиков см. [установить компоненты обучения компьютер без доступа к Интернету](r/installing-ml-components-without-internet-access.md).

**Применяется к:** служб SQL Server 2016 R, с сервером R версии от 9.0.0 или более ранней версии

### <a name="launchpad-services-fails-to-start-if-the-version-is-different-from-the-r-version"></a>Панель запуска служб не запускается, если версия отличается от версии R

При установке SQL Server R Services отдельно от компонента database engine и имеют разные версии сборки, может появиться следующая ошибка в журнале системных событий:

> *Служба панели запуска SQL Server не удалось запустить из-за следующей ошибки: служба не отвечает на запрос в течение отведенного времени.*

Например Эта ошибка может возникать, если установить компонент database engine с помощью версии исправления для обновления компонент database engine и добавьте компонент служб R, с помощью версии.

Чтобы избежать этой проблемы, используйте служебную программу, например диспетчер файлов для сравнения версий Launchpad.exe с версией двоичные файлы SQL, таких как sqldk.dll. Все компоненты должны иметь тот же номер версии. Если вы обновляете один компонент, обязательно примените это же обновление ко всем остальным установленным компонентам.

Папка для запуска в `Binn` папку для экземпляра. Например, при установке по умолчанию SQL Server 2016, путь может быть `C:\Program Files\Microsoft SQL Server\MSSQL.13.InstanceNameMSSQL\Binn`. 

### <a name="remote-compute-contexts-are-blocked-by-a-firewall-in-sql-server-instances-that-are-running-on-azure-virtual-machines"></a>Контексты удаленных вычислений блокируются брандмауэром в экземплярах SQL Server, работающих на виртуальных машинах Azure

Если вы установили [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] на виртуальной машине Windows Azure, вы может не сможете использовать контексты вычислений, требующие использования рабочей виртуальной машины. Причиной является то, что по умолчанию брандмауэр на виртуальных машинах Azure использует правило, которое блокирует сетевой доступ для локальных учетных записей пользователей R.

Чтобы избежать этого, на виртуальной Машине Azure, откройте **брандмауэр Windows в режиме повышенной безопасности**выберите **правила для исходящих подключений**и отключите следующее правило: **блокировать сетевой доступ для учетных записей локальных пользователей R в Экземпляр SQL Server MSSQLSERVER**. Также можно оставить включено правило но измените значение свойства безопасности на **Разрешить безопасное подключение**.

### <a name="implied-authentication-in-sqlexpress"></a>Неявная проверка подлинности в SQLEXPRESS

При выполнении заданий R на рабочей станции удаленного-обработки и анализа данных с помощью встроенной проверки подлинности Windows, SQL Server использует *неявной проверки подлинности* для создания локального вызовы ODBC, необходимых для сценария. Но эта функция не работала в сборке RTM экспресс-выпуска SQL Server.

Чтобы устранить эту проблему, рекомендуем произвести обновление до более позднего выпуска службы.

Если обновление не может быть выполнено, чтобы избежать этого, используйте имя входа SQL для выполнения удаленных заданий R, которые могут потребовать внедренные вызовы ODBC.

**Применяется к:** экспресс-выпуск служб R SQL Server 2016

### <a name="performance-limits-when-libraries-used-by-sql-server-are-called-from-other-tools"></a>Ограничения производительности при вызове из других инструментов библиотеки, используемые SQL Server

Существует возможность вызова машинного обучения библиотек, которые устанавливаются для SQL Server из внешнего приложения, такие как RGui. Это может быть наиболее удобным способом для выполнения определенных задач, таких как установка новых пакетов или тестировать нерегламентированных очень короткие примеры кода. Однако за пределами SQL Server могут быть ограничены производительности. 

Например даже если вы используете Enterprise Edition SQL Server, R выполняется в однопоточном режиме при выполнении кода R с помощью внешних средств. Чтобы получить преимущества производительности в SQL Server и инициировать подключение к SQL Server с помощью [sp_execute_external_script](../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md) для вызова среды выполнения внешнего сценария.

Как правило Избегайте вызова машинного обучения библиотеки, которые используются SQL Server с помощью внешних средств. Если требуется отладка R или кода Python, обычно проще сделать это за пределами SQL Server. Чтобы получить те же библиотеки, которые находятся в SQL Server, можно установить клиент Microsoft R или [машины обучения Server](r/create-a-standalone-r-server.md).

### <a name="sql-server-data-tools-does-not-support-permissions-required-by-external-scripts"></a>SQL Server Data Tools не поддерживает разрешения, необходимые для внешних скриптов

При использовании Visual Studio или SQL Server Data Tools для публикации проекта базы данных, если любой субъект имеет разрешения, характерные для выполнения внешнего скрипта, может появиться ошибка похожее на следующее:

> *Модель TSQL: Ошибка при обратном проектирование базы данных. Разрешение не было распознано и поэтому не импортировано.*

В данный момент модель DACPAC не поддерживает разрешения, используемые службами R или службы обучения машины, таких как GRANT ANY EXTERNAL SCRIPT или EXECUTE ANY EXTERNAL SCRIPT. Эта проблема будет исправлена в будущем выпуске.

Чтобы избежать этого выполните предоставление дополнительной инструкции в скрипте после развертывания.

### <a name="external-script-execution-is-throttled-due-to-resource-governance-default-values"></a>Из-за значения по умолчанию управление ресурсов регулируется выполнении внешних скриптов

В выпуске Enterprise Edition можно использовать пулы ресурсов для управления внешними процессами скриптов. В некоторых ранних сборках выпуска максимальный объем памяти, который может быть распределен процессам R была 20 процентов. Таким образом Если на сервере есть 32 ГБ ОЗУ, исполняемые объекты R (RTerm.exe и BxlServer.exe) может использовать более 6,4 ГБ в одном запросе.

При возникновении ограничения ресурсов, проверьте текущего значения по умолчанию. Если 20% недостаточно, см. в документации для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] о том, как изменить это значение.

**Применяется к:** служб R SQL Server 2016, Enterprise Edition

## <a name="r-issues"></a>Проблемы R

Этот раздел содержит известные проблемы, относящиеся к выполнение R на сервере SQL Server, а также некоторые проблемы, связанные с библиотеки R и инструменты, опубликованные корпорацией Майкрософт, включая RevoScaleR.

Другие известные проблемы, которые могут повлиять на решения R см. в разделе [машины обучения Server](https://docs.microsoft.com/machine-learning-server/resources-known-issues) сайта.

### <a name="access-denied-warning-when-executing-r-scripts-on-sql-server-in-a-non-default-location"></a>Отказано в доступе предупреждение при выполнении скриптов R на сервере SQL Server в расположении по умолчанию не

Если экземпляр SQL Server был установлен в расположении не по умолчанию, такие как за пределами `Program Files` папку, предупреждение ACCESS_DENIED возникает при попытке запуска скриптов, которые устанавливают пакета. Например:

> *В `normalizePath(path.expand(path), winslash, mustWork)` : путь [2] = «~ExternalLibraries/R/8/1»: Отказано в доступе*

Причина заключается в функцию R пытается считать путь что не выполняется, если встроенной группе пользователей **SQLRUserGroup**, не имеет доступа на чтение. Предупреждение, которое возникает не блокирует выполнение текущего сценария R, но предупреждение может повторяться несколько раз всякий раз, когда пользователь запускает любой другой сценарий R.

При установке SQL Server по умолчанию, эта ошибка возникает, так как все пользователи Windows разрешения на чтение `Program Files` папки.

Эта проблема ia устранена в будущих исправлений. Чтобы избежать этого, представляет собой группу **SQLRUserGroup**, с доступом на чтение для всех родительских папок `ExternalLibraries`.

### <a name="serialization-error-between-old-and-new-versions-of-revoscaler"></a>Ошибка сериализации между старой и новой версий RevoScaleR

При передаче модели с помощью сериализованный формат для удаленного экземпляра SQL Server может появиться ошибка: 

> *Ошибка в memDecompress (данные, тип = распаковки) -3 memDecompress(2) внутренней ошибки.*

Эта ошибка возникает при сохранении модели, используя последнюю версию функция сериализации [rxSerializeModel](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxserializemodel), но экземпляр SQL Server, где выполняется десериализация модели установлена более старая версия API-интерфейсов RevoScaleR из SQL Server 2017 г. с накопительным обновлением 2 или более ранней версии.

Чтобы избежать этого можно обновить экземпляр SQL Server 2017 г., CU3 или более поздней версии.

Ошибка не отображается, если версия API или при перемещении модели, сохраненные на сервере, где используется более новая версия API сериализации Устаревшая функция сериализации.

Другими словами можно используйте одну и ту же версию RevoScaleR для сериализации и десериализации операций.

### <a name="real-time-scoring-does-not-correctly-handle-the-learningrate-parameter-in-tree-and-forest-models"></a>В режиме реального времени оценки неправильно обрабатывает _значение learningRate_ параметр в моделях дерева и леса

Если создать модель с помощью дерева принятия решений или метода леса принятия решений и укажите скорость обучения, может появиться несогласованным результатам при использовании `sp_rxpredict` или SQL `PREDICT` функции по сравнению с использованием `rxPredict`.

Причиной является ошибка в API-Интерфейсе, моделирующее процессы сериализации и ограничена `learningRate` параметр: например, в [rxBTrees](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxbtrees), или

Эта проблема устранена в будущих исправлений.

### <a name="limitations-on-processor-affinity-for-r-jobs"></a>Ограничения на соответствие процессоров для заданий R

В сборке первоначального выпуска SQL Server 2016 можно установить соответствие процессоров только для процессоров в первом k группе. Например если сервер выполняется на машине двумя процессорными разъемами с двумя k группами, только процессоры от первого k группе используются для процессов R. Такое же ограничение применяется при настройке ресурсами для заданий R-сценария.

Проблема исправлена в SQL Server 2016 с пакетом обновления 1 (SP1). Корпорация Майкрософт рекомендует обновление до последней версии службы.

**Применяется к:** версии RTM, службы R SQL Server 2016

### <a name="changes-to-column-types-cannot-be-performed-when-reading-data-in-a-sql-server-compute-context"></a>Изменение типов столбцов невозможно при считывании данных в контексте вычисления SQL Server.

Если в качестве контекста вычисления задан экземпляр SQL Server, вы не можете использовать аргумент _colClasses_ (или иные подобные аргументы) для изменения типа данных столбцов в коде R.

Например, следующая инструкция приведет к ошибке, если столбец CRSDepTimeStr уже не является целочисленным:

```R
data <- RxSqlServerData(
  sqlQuery = "SELECT CRSDepTimeStr, ArrDelay  FROM AirlineDemoSmall", 
  connectionString = connectionString, 
  colClasses = c(CRSDepTimeStr = "integer"))
```

Чтобы избежать этого, можно переписать запрос SQL для использования ПРИВЕДЕНИЯ или ПРЕОБРАЗОВАНИЯ и представления данных в R, используя правильный тип данных. Как правило производительность лучше при работе с данными с помощью SQL, а не путем преобразования данных в коде R.

**Применяется к:** служб R SQL Server 2016

### <a name="limits-on-size-of-serialized-models"></a>Ограничения на размер сериализованного моделей

При сохранении модели в таблицу SQL Server, необходимо сериализовать модели и сохраните его в двоичном формате. Теоретически максимальный размер модели, которые могут быть сохранены с помощью этого метода составляет 2 ГБ, что максимальный размер столбцов varbinary в SQL Server.

Если необходимо использовать модели большего размера, доступны следующие решения:

+ Выполните действия, чтобы уменьшить размер вашей модели. Некоторые пакеты R с открытым кодом включить много информации в объект модели, а большая часть этих сведений можно удалить для развертывания. 
+ Используйте Выбор компонентов для удаления ненужных столбцов.
+ При использовании алгоритма открытым исходным кодом, рассмотрите возможность с помощью соответствующего алгоритма в MicrosoftML или RevoScaleR аналогичную реализацию. Эти пакеты были оптимизированы для сценариев развертывания.
+ После были процессов оптимизации модели и размер уменьшается на предыдущих шагах, просматривать [memCompress](https://www.rdocumentation.org/packages/base/versions/3.4.1/topics/memCompress) в базовый R можно использовать для уменьшения размера модели перед его передачей в SQL Server. Этот вариант лучше всего подходит при использовании модели, близкую к 2 ГБ.
+ Для модели большего размера, можно использовать SQL Server [FileTable](..\relational-databases\blob\filetables-sql-server.md) компонентов для хранения моделей, а не с помощью столбцов varbinary.

    Чтобы использовать таблицы Filetable, необходимо добавить исключение брандмауэра, так как данные, хранящиеся в таблицах Filetable управляется драйвер файловой системы Filestream в SQL Server, и правила брандмауэра по умолчанию блокировать сетевой доступ к файлам. Дополнительные сведения см. в разделе [Включение необходимых компонентов для FileTable](../relational-databases/blob/enable-the-prerequisites-for-filetable.md). 

    После включения FileTable для записи модели, затем получить путь из SQL с помощью FileTable API и напишите модели в это расположение в коде. Если вам нужно прочитать модели, можно получить путь из SQL и вызвать модели, используя путь из скрипта. Дополнительные сведения см. в разделе [доступ к файлам с API-интерфейсов файла ввода-вывода](../relational-databases/blob/access-filetables-with-file-input-output-apis.md).

### <a name="avoid-clearing-workspaces-when-you-execute-r-code-in-a-includessnoversionincludesssnoversion-mdmd-compute-context"></a>Не снимайте рабочих областей, при выполнении кода R в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] контекста вычислений

При использовании команды R очистить рабочую область объектов во время выполнения кода R [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] вычислений контекста, или если требуется очистить рабочую область в рамках сценария R, вызванная с использованием [sp_execute_external_script](../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md), может появиться следующая ошибка : *revoScriptConnection объект рабочей области не найден*

`revoScriptConnection` — это объект в рабочей области R, который содержит информацию о сеансе R, вызываемом из [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Но если код R содержит команду для очистки рабочей области (например, `rm(list=ls()))`), вся информация о сеансе и других объектах в рабочей области R также очищается.

Чтобы избежать этого, избежать беспорядочное Очистка переменных и других объектов, запущенном R [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Несмотря на то, что при работе с консолью R, являются общими Очистка рабочей области, он может иметь непредвиденные последствия.

* Чтобы удалить определенных переменных, использовать R `remove` функция: например,`remove('name1', 'name2', ...)`
* Если нужно удалить несколько переменных, сохраните имена временных переменных в списке и периодически выполняйте сборку мусора.

### <a name="restrictions-on-data-that-can-be-provided-as-input-to-an-r-script"></a>Ограничения для данных, которые могут быть предоставлены как входные данные в сценарии R

Следующие типы результатов запросов невозможно использовать в сценарии R:

- данные из запроса [!INCLUDE[tsql](../includes/tsql-md.md)] , который ссылается на столбцы AlwaysEncrypted;
  
- данные из запроса [!INCLUDE[tsql](../includes/tsql-md.md)] , который ссылается на маскированные столбцы.
  
     Если вам необходимо использовать скрытые данные в сценарии R, при необходимости можно создать копию данных во временной таблице и использовать эти данные.

### <a name="use-of-strings-as-factors-can-lead-to-performance-degradation"></a>Использование строки, как факторы могут привести к снижению производительности

С помощью переменных типа строки, как факторы могут значительно увеличить объем памяти, используемой для операций R. Это известная проблема с R в целом, и существует множество статей на тему. Например, в разделе [факторов не являются привилегированными в R, Джон подключения, в R-Участники блогов)](https://www.r-bloggers.com/factors-are-not-first-class-citizens-in-r/) или [stringsAsFactors: несанкционированный биографию, Роджер Peng](https://simplystatistics.org/2015/07/24/stringsasfactors-an-unauthorized-biography/). 

Несмотря на то, что проблема не относится к SQL Server, он может значительно повлиять на производительность кода R, с SQl Server. Строки обычно хранится в виде varchar или nvarchar и если много уникальных значений столбца строковых данных, процесс преобразования их к целым числам и обратно в строки с помощью R внутренне даже может привести к ошибкам выделения памяти.

Если не требуется абсолютно строкового типа данных для других операций сопоставления строковых значений на числовой (целое число) тип данных, как этап подготовки данных может оказаться эффективным с точки зрения производительности и масштабируемости.

Описание этой проблемы и другие советы см. в разделе [производительности для служб R - оптимизация данных](r/r-and-data-optimization-r-services.md).

### <a name="arguments-varstokeep-and-varstodrop-are-not-supported-for-sql-server-data-sources"></a>Аргументы *varsToKeep* и *varsToDrop* не поддерживается для источников данных SQL Server

При использовании функции rxDataStep для записи результатов в таблицу с помощью *varsToKeep* и *varsToDrop* является удобным способом для определения столбцов, которые нужно включить или исключить как часть операции. Тем не менее эти аргументы не поддерживаются для источников данных SQL Server.

### <a name="limited-support-for-sql-data-types-in-spexecuteexternalscript"></a>Ограниченная поддержка для типов данных SQL в пакете обновления\_выполнение\_внешних\_сценария

Не все типы данных, которые поддерживаются в SQL можно использовать в R. Чтобы избежать этого, рассмотрите возможность приведения к типу данных не поддерживается поддерживаемый тип данных перед их передачей sp\_выполнение\_внешних\_сценария.

Дополнительные сведения см. в разделе [R библиотек и типы данных](r/r-libraries-and-data-types.md).

### <a name="possible-string-corruption"></a>Возможное повреждение строки

Любое обращение строковых данных из [!INCLUDE[tsql](../includes/tsql-md.md)] R, а затем в [!INCLUDE[tsql](../includes/tsql-md.md)] снова может привести к повреждению. Это происходит из-за различных кодировок, используемых в R и [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], а также различные параметры сортировки и языков, поддерживаемых в R и [!INCLUDE[tsql](../includes/tsql-md.md)]. Любая строка в кодировке, отличной от ASCII, может обрабатываться неправильно.

При отправке строковых данных в R преобразуйте их в ASCII, если возможно.

Это ограничение распространяется на данные, передаваемые между SQL Server и Python, а также. Многобайтовых символов должна передаваться как UTF-8 и сохраняется в Юникоде.

### <a name="only-one-value-of-type-raw-can-be-returned-from-spexecuteexternalscript"></a>Только одно значение типа `raw` могут быть возвращены из`sp_execute_external_script`

Если двоичный тип данных (R **необработанные** тип данных) возвращается из R, значения должны быть отправлены в выходных данных.

С данными типов, отличных от **необработанные**, может возвращать значения параметров и результаты хранимой процедуры, добавив ключевое слово OUTPUT. Дополнительные сведения см. в разделе [параметры](https://docs.microsoft.com/sql/relational-databases/stored-procedures/parameters).

Если вы хотите использовать в нескольких выходных наборов, которые включают значения типа **необработанные**, одно возможное решение — выполнить несколько вызовов хранимой процедуры или отправить результат назад задает [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с помощью ODBC.

### <a name="loss-of-precision"></a>Потеря точности

Поскольку [!INCLUDE[tsql](../includes/tsql-md.md)] и R поддерживают различные типы данных, и числовых типов данных во время преобразования возможна потеря точности.

Дополнительные сведения о преобразовании неявных типов данных см. в разделе [R библиотек и типы данных](r/r-libraries-and-data-types.md).

### <a name="variable-scoping-error-when-you-use-the-transformfunc-parameter"></a>При использовании параметра transformFunc, ошибка области переменной

Чтобы преобразовать данные во время моделирования, можно передать *transformFunc* аргумент в функции, такие как `rxLinmod` или `rxLogit`. Тем не менее вложенные вызовы функций могут привести к ошибкам области применения в контексте вычислений SQL Server, даже если вызовы правильно работают в локальном контексте.

> *Образец набора данных для анализа не имеет переменных*

Например, предположим, определены две функции `f` и `g`, в глобальной локальной среде, и `g` вызовов `f`. В распределенных или удаленных вызовах с использованием `g`, вызов `g` может завершиться с этой ошибкой, так как `f` отсутствует, даже если Вы передали `f` и `g` удаленному вызову.

При возникновении этой проблемы можно внедрить определение `f` в ваше определение `g`в любом месте перед тем, где `g` обычно вызывает `f`.

Например:

```r
f <- function(x) { 2*x * 3 }
g <- function(y) {
              a <- 10 * y
               f(a)
}
```

Чтобы избежать этой ошибки, перепишите определение следующим образом:

```r
g <- function(y){
              f <- function(x) { 2*x +3}
              a <- 10 * y
              f(a)
}
```

### <a name="data-import-and-manipulation-using-revoscaler"></a>Импорт и обработка данных с помощью RevoScaleR

Когда **varchar** столбцы считываются из базы данных, пробелы усекаются. Чтобы избежать этого, добавьте перед и после строк символы, отличные от пробелов.

Если функции, такие как `rxDataStep` используются для создания таблицы базы данных, которые имеют **varchar** столбцы, ширина столбца вычисляется на основе образца данных. Если ширина может быть различной, может потребоваться дополнить все строки до одинаковой длины.

Использование преобразования для изменения типа данных переменной не поддерживается при повторном вызове `rxImport` или `rxTextToXdf` для импорта и дополнения строк с объединением нескольких входных файлов в один XDF-файл.

### <a name="limited-support-for-rxexec"></a>Ограниченная поддержка rxExec

В SQL Server 2016 `rxExec` функцию, которая предоставляется с RevoScaleR пакет может использоваться только в однопоточном режиме.

Параллелизм для `rxExec` в нескольких процессах планируется в будущих выпусках.

### <a name="increase-the-maximum-parameter-size-to-support-rxgetvarinfo"></a>Увеличение максимального размера параметра для поддержки rxGetVarInfo

При использовании наборов данных с очень большим количеством переменных (например, более 40 000) свойству `max-ppsize` флаг при запуске R, чтобы использовать функции, такие как `rxGetVarInfo`. Флаг `max-ppsize` указывает максимальный размер стека защиты указателей.

Если вы используете консоль R (например, RGui.exe или RTerm.exe), можно задать значение _max-ppsize_ для 500000, введя:

```R
R --max-ppsize=500000
```

### <a name="issues-with-the-rxdtree-function"></a>Проблемы с функцией rxdtree

Функция `rxDTree` в настоящее время не поддерживает преобразование в формулах. В частности, использование синтаксиса `F()` для создания факторов в режиме реального времени не поддерживается. Однако числовые данные автоматически сегментироваться.

Упорядоченные факторы обрабатываются так же, как факторы, во всех функциях анализа RevoScaleR, за исключением `rxDTree`.

## <a name="python-code-execution-or-python-package-issues"></a>Выполнение кода Python или Python проблемы пакетов

В этом разделе содержатся известные проблемы, относящиеся к ОС Python SQL Server, а также проблемы, связанные с пакетами Python, опубликованные корпорацией Майкрософт, включая [revoscalepy](https://docs.microsoft.com/r-server/python-reference/revoscalepy/revoscalepy-package) и [microsoftml](https://docs.microsoft.com/r-server/python-reference/microsoftml/microsoftml-package).

### <a name="call-to-pretrained-model-fails-if-path-to-model-is-too-long"></a>Вызов предварительно обученные модели завершается неудачей, если указан слишком длинный путь к модели

При установке предварительно обученные модели в более ранней версии 2017 г. SQL Server полный путь к файлу обученной модели может быть слишком большим для Python для чтения. Это ограничение исправлена в более поздней версии службы.

Существует несколько обходные решения: 

+ При установке предварительно обученные модели, выберите пользовательское расположение.
+ Если это возможно Установка экземпляра SQL Server в разделе пользовательский путь установки с более короткий путь, например C:\SQL\MSSQL14. MSSQLSERVER.
+ Используйте служебную программу Windows [Fsutil](https://technet.microsoft.com/library/cc788097(v=ws.11).aspx) Чтобы создать жесткую связь, который сопоставляется более короткий путь файла модели.
+ Обновление до последней версии службы.

### <a name="error-when-saving-serialized-model-to-sql-server"></a>Произошла ошибка при сохранении сериализации модели в SQL Server

Если передать модель к удаленному экземпляру SQL Server и повторите двоичной модели с помощью `rx_unserialize` функционировать в [revoscalepy](https://docs.microsoft.com/machine-learning-server/python-reference/revoscalepy/revoscalepy-package), может появиться ошибка: 

> *NameError: имя «rx_unserialize_model» не определен*

Эта ошибка возникает в том случае, если при сохранении модели, использует последнюю версию функция сериализации, но экземпляр SQL Server, где выполняется десериализация модели не распознает сериализацией API.

Чтобы устранить проблему, обновите экземпляр SQL Server 2017 г. CU3 или более поздней версии.

### <a name="failure-to-initialize-a-varbinary-variable-causes-an-error-in-bxlserver"></a>Не удалось инициализировать переменную varbinary приводит к ошибке в BxlServer

При выполнении кода Python в SQL Server с помощью `sp_execute_external_script`и код есть выходные данные переменных типа varbinary(max), varchar(max) или подобных типов, переменной, необходимо инициализировать или как часть сценария. В противном случае компонент данных exchange, BxlServer, вызывает ошибку и прекращает работу.

Это ограничение будет исправлено в будущих службы. Избежать этого убедитесь, что переменная инициализируется в сценарий Python. Можно использовать любое допустимое значение, как показано в следующих примерах:

```sql
declare @b varbinary(max);
exec sp_execute_external_script
  @language = N'Python'
  , @script = N'b = 0x0'
  , @params = N'@b varbinary(max) OUTPUT'
  , @b = @b OUTPUT;
go
```

```sql
declare @b varchar(30);
exec sp_execute_external_script
  @language = N'Python'
  , @script = N' b = ""  '
  , @params = N'@b varchar(30) OUTPUT'
  , @b = @b OUTPUT;
go
```

### <a name="telemetry-warning-on-successful-execution-of-python-code"></a>Данные телеметрии предупреждение при успешном выполнении код Python

Начиная с SQL Server 2017 г. CU2, даже в случае успешного выполнения кода Python в противном случае может появиться следующее сообщение:

> *Сообщения STDERR из внешнего скрипта:*
> **~PYTHON_SERVICES\lib\site-packages\revoscalepy\utils\RxTelemetryLogger*
> *SyntaxWarning: telemetry_state используется до объявления глобальных*


Эта проблема устранена в SQL Server 2017 г накопительный пакет обновления 3 (CU3). 

## <a name="revolution-r-enterprise-and-microsoft-r-open"></a>Revolution R Enterprise и Microsoft R Open

В этом разделе перечислены проблемы, связанные с подключением R, разработки и средства повышения производительности, предоставляемые компанией Revolution Analytics. Эти средства были предоставлены в более ранних предварительных версий [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].

В общем случае рекомендуется удалить эти предыдущие версии и установить последнюю версию SQL Server или Microsoft R Server.

### <a name="revolution-r-enterprise-is-not-supported"></a>Revolution R Enterprise не поддерживается.

Установка Revolution R Enterprise рядом с любой версией [!INCLUDE[rsql_productname_md](../includes/rsql-productname-md.md)] не поддерживается.

При наличии существующего лицензии для Revolution R Enterprise, вам необходимо поместить на компьютере, отличном от обоих [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] экземпляра и рабочей станции, которая будет использоваться для подключения к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] экземпляра.

Некоторые предварительные версии [!INCLUDE[rsql_productname](../includes/rsql-productname-md.md)] включены среду разработки R для Windows, который был создан с помощью Revolution Analytics. Это средство больше не предоставляется и не поддерживается.

Для обеспечения совместимости с [!INCLUDE[rsql_productname](../includes/rsql-productname-md.md)], рекомендуется вместо этого установить клиент Microsoft R. [Средства R для Visual Studio](https://www.visualstudio.com/vs/rtvs/) и [кода Visual Studio](https://code.visualstudio.com/) также поддерживает Microsoft R решения.

### <a name="compatibility-issues-with-sqlite-odbc-driver-and-revoscaler"></a>Проблемы совместимости с драйвером SQLite ODBC и RevoScaleR

Версия 0.92 драйвера SQLite ODBC не совместима с RevoScaleR. Версии 0.88 – 0.91 и 0.93 и более поздние совместимы.

## <a name="see-also"></a>См. также:

[Что нового в SQL Server 2016](../sql-server/what-s-new-in-sql-server-2016.md)

[Устранение неполадок машинного обучения в SQL Server](machine-learning-troubleshooting-faq.md)
