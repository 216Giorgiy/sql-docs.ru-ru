---
title: "Часто задаваемые вопросы по обновлению и установке (службы R для SQL Server) | Microsoft Docs"
ms.custom: 
  - "SQL2016_New_Updated"
ms.date: "03/13/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 001e66b9-6c3f-41b3-81b7-46541e15f9ea
caps.latest.revision: 58
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 47
---
# Часто задаваемые вопросы по обновлению и установке (службы R для SQL Server)
  В этом разделе содержатся ответы на часто задаваемые вопросы об установке и обновлении предварительных выпусков [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)].  
  
 Если вы устанавливаете [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] в первый раз, следуйте процедурам настройки [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] и компонентов R, которые описаны здесь: [Установка служб SQL Server R Services &#40;в базе данных&#41;](../../advanced-analytics/r-services/set-up-sql-server-r-services-in-database.md).  

   
## <a name="important-changes-from-pre-releae-versions"></a>Важные изменения по сравнению с предварительными версиями  
 Если вы установили какую-либо предварительную версию SQL Server 2016 или используете инструкции по установке, которые были опубликованы до выхода общедоступной версии SQL Server 2016, необходимо иметь в виду, что процедуры установки предварительных версий и версий RTM полностью различаются. Различия касаются как параметров, доступных в мастере установки SQL Server, так и действий после установки. 
   
> [!WARNING] Новые установки предварительных версий [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] больше не поддерживаются. Рекомендуем произвести обновление как можно скорее.  
+ Если вы установили [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] в составе версии CTP3, CTP3.1, CTP3.2, RC0 или RC1, вам потребуется повторно выполнить скрипт настройки после установки, чтобы удалить предыдущие версии компонентов и служб R. 
+ Скрипт настройки после установки предназначен только для того, чтобы помочь клиентам удалить предварительные версии.  Не используйте его при установке более новых версий.

## <a name="how-to-uninstall-previous-versions-of-r-services"></a>Удаление предыдущих версий служб R

Удалять предыдущие версии [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] и связанных компонентов R необходимо в правильном порядке.

### <a name="1-run-script-to-deregister-windows-user-group-and-components-before-uninstalling-previous-components"></a>1. Перед удалением предыдущих версий компонентов выполните скрипт, чтобы отменить регистрацию группы пользователей Windows и компонентов.
Если вы установили предварительную версию [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)], сначала необходимо выполнить скрипт `RegisteREext.exe` с аргументом `/uninstall`.

Таким образом вы отменяете регистрацию старых компонентов и удаляете группу пользователей Windows, связанную с панелью запуска. Если не сделать этого, вы не сможете создать группу пользователей Windows, необходимую для новых устанавливаемых экземпляров.
  
Например, если вы установили службы R в экземпляре по умолчанию, выполните следующую команду из каталога, в котором установлен скрипт:  
  
~~~~
    RegisterRExt.exe /UNINSTALL  
~~~~ 
  
Если вы установили службы R в именованном экземпляре, укажите его имя после *INSTANCE:*  
  
~~~~ 
RegisterRExt.exe /UNINSTALL /INSTANCE:<instancename>   
~~~~  

Чтобы удалить все компоненты, может потребоваться выполнить скрипт несколько раз.

> [!NOTE]
> Расположение по умолчанию для этого скрипта может быть разным в зависимости от того, какая предварительная версия установлена. При попытке выполнить неправильную версию скрипта может произойти ошибка. 
> 
>  + В случае установки версии CTP 3.1, 3.2 или 3.3 перед удалением компонентов необходимо скачать обновленную версию скрипта настройки после установки из [Центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=723194). Обновленная версия скрипта позволяет отменять регистрацию старых компонентов. Щелкните ссылку и выберите **Сохранить как** для сохранения скрипта в локальную папку. Переименуйте существующий скрипт и скопируйте новый скрипт в папку, где он будет выполняться. 
>  + Для версии RC0 была установлена правильная версия скрипта, которая находится в следующей папке: `C:\Program Files\Microsoft\MRO-for-RRE\8.0\R-3.2.2\library\RevoScaleR\rxLibs\x64`.  
>  + Для предварительных версий (13.0.1601.5 или более поздних) скрипт для установки или настройки компонентов не требуется. Скрипт следует использовать исключительно для удаления старых компонентов. 


### <a name="2-uninstall-any-older-versions-of-the-revolution-enterprise-tools-including-components-installed-with-ctp-releases"></a>2. Удалите все старые версии средств Revolution Enterprise, включая компоненты, установленные вместе с выпусками CTP.

Порядок удаления компонентов R важен. Всегда в первую очередь удаляйте [!INCLUDE[rsql_rre-noversion](../../includes/rsql-rre-noversion-md.md)]. Затем удаляйте [!INCLUDE[rsql_rro-noversion](../../includes/rsql-rro-noversion-md.md)].  

 Если по ошибке сначала удалить R Open, при попытке удаления Revolution R Еnterprise возникнет ошибка. Единственным решением в этом случае является повторная установка Revolution R Open или Microsoft R Open, а затем удаление обоих компонентов в правильном порядке.  

### <a name="3-uninstall-any-other-version-of-microsoft-r-open"></a>3. Удалите все другие версии Microsoft R Open.

Наконец, удалите все другие версии Microsoft R Open.
 
### <a name="4-upgrade-sql-server"></a>4. Обновление SQL Server  
  
После удаления всех предварительных версий компонентов перезагрузите компьютер. Это обязательное требование для установки SQL Server. Вы не сможете продолжить новую процедуру установки, пока перезагрузка не завершится.     

После этого запустите программу установки SQL Server и выполните следующие инструкции, чтобы установить [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)]: [Установка служб SQL Server R](../../advanced-analytics/r-services/set-up-sql-server-r-services-in-database.md).  
  
Дополнительные компоненты не требуются. Пакеты R и пакеты подключения устанавливаются при установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . 


## <a name="upgrading-r-components"></a>Обновление компонентов R

По мере выпуска исправлений или улучшений для SQL Server 2016 компоненты R будут также обновляться, если ваш экземпляр уже включает компонент служб R. 

Но если вы обновляете серверы, которые не подключены к Интернету, или применяете к ним исправления, необходимо скачать обновленную версию компонентов R вручную, перед тем как начинать обновление. Дополнительные сведения см. в разделе [Установка компонентов R без доступа к Интернету](../../advanced-analytics/r-services/installing-r-components-without-internet-access.md).

## <a name="problems-uninstalling-older-versions-of-r"></a>Проблемы с удалением старых версий R  
В некоторых случаях при удалении предыдущих версий Revolution R Open или Revolution R Enterprise они могут удаляться не полностью.  
  
 Если у вас возникают проблемы с удалением предыдущей версии, вы также можете отредактировать реестр, удалив соответствующие разделы.  
  
 Откройте реестр Windows и найдите следующий раздел: `HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall`.  
  
 Удалите следующие записи, если они имеются и если раздел содержит только один параметр `sEstimatedSize2`:  
  
-   E0B2C29E-B8FC-490B-A043-2CAE75634972        (для версии 8.0.2)  
  
-   46695879-954E-4072-9D32-1CC84D4158F4        (для версии 8.0.1)  
  
-   2DF16DF8-A2DB-4EC6-808B-CB5A302DA91B        (для версии 8.0.0)  
  
-   5A2A1571-B8CD-4AAF-9303-8DF463DABE5A        (для версии 7.5.0)  


## <a name="new-license-agreement-for-r-components-required-for-unattended-installs"></a>Для автоматической установки необходимо новое лицензионное соглашение для компонентов R  
 Если использовать командную строку для обновления экземпляра [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с установленным компонентом [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)], необходимо изменить командную строку, чтобы использовать новый параметр лицензионного соглашения: */IACCEPTROPENLICENSEAGREEMENT*. 
 
 Если не использовать необходимый аргумент, может возникнуть сбой программы установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
## <a name="after-running-setup-includersqlproductnametokenrsqlproductnamemdmd-is-still-not-enabled"></a>После выполнения программы установки [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] по-прежнему не включены.  
 Компонент, обеспечивающий выполнение внешних скриптов, по умолчанию отключен, даже если он установлен. Это сделано намеренно для сокращения контактной зоны.  
  
 Чтобы обеспечить выполнение скриптов R, администратор может выполнить приведенную ниже инструкцию в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].  
  
1.  В экземпляре [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], в котором планируется использовать R, выполните следующую инструкцию:  
  
    ```  
    sp_configure 'external scripts enabled',1 
    reconfigure with override  
    ```  
  
2.  Перезапустите экземпляр.  
  
3.  После перезапуска экземпляра откройте **диспетчер конфигурации SQL Server** или панель **Службы** и проверьте, запущена ли служба [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)].  

> [!TIP] Чтобы установить предварительно настроенный экземпляр служб R, используйте образ виртуальной машины Azure, который содержит выпуск Enterprises Edition с включенными службами R. Дополнительные сведения см. в разделе [Установка служб SQL Server R на виртуальной машине Azure](../../advanced-analytics/r-services/installing-sql-server-r-services-on-an-azure-virtual-machine.md).
 

## <a name="setup-of-includersqlproductnametokenrsqlproductnamemdmd-not-available-in-a-failover-cluster"></a>Установка [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] в отказоустойчивом кластере невозможна.  
 В настоящее время установить [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] в отказоустойчивом кластере невозможно.  
    
 Но вы можете установить [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] на изолированном компьютере, на котором используется функция AlwaysOn и который входит в группу доступности. Дополнительные сведения об использовании служб R в группе доступности AlwaysOn см. в разделе [Группы доступности AlwaysOn: взаимодействие](../../database-engine/availability-groups/windows/always-on-availability-groups-interoperability-sql-server.md).  

Другой вариант — установить реплику в другом экземпляре SQL Server в целях выполнения скриптов R. Реплику можно создать путем репликации или доставки журналов.
 
## <a name="launchpad-service-cannot-be-started"></a>Служба панели запуска не может быть запущена.  

Запуску панели запуска может препятствовать ряд проблем.
+ **Не включена нотация 8dot3**.  Для установки служб R (в базе данных) диск, на котором устанавливается этот компонент, должен поддерживать создание коротких имен файлов в нотации **8dot3**.  Имя файла 8.3 также называется коротким именем файла и используется в целях совместимости с предыдущими версиями Microsoft Windows или в качестве альтернативы длинному имени файла. 

  Если том, в котором вы устанавливаете [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)], не поддерживает короткие имена файлов, процессы, запускающие R с сервера SQL Server, могут не найти соответствующий исполняемый файл и [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] не запустится.  
  
   В качестве обходного решения следует включить нотацию 8dot3 в томе, в котором установлен сервер SQL Server и службы R. Затем необходимо указать короткое имя для рабочего каталога в файле конфигурации служб R. 

    1. Чтобы включить нотацию 8dot3, выполните служебную программу **fsutil** с аргументом *8dot3name*, как описано в следующем разделе: [fsutil 8dot3name](https://technet.microsoft.com/library/ff621566(v=ws.11).aspx).
    2. После включения нотации 8dot3 откройте файл RLauncher.config. При установке с параметрами по умолчанию файл RLauncher.config находится в папке C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\Binn.
    3. Запишите значение свойства WORKING_DIRECTORY.
    4. Используйте программу fsutil с аргументом *file*, чтобы указать короткий путь к файлу для папки, указанной в свойстве WORKING_DIRECTORY.
    5. Измените файл конфигурации так, чтобы в нем использовалось короткое имя для WORKING_DIRECTORY.   
     
Кроме того, можно указать другой каталог для WORKING_DIRECTORY, путь к которому совместим с нотацией 8dot3.     
   
   > [!NOTE] Это ограничение будет снято в будущем выпуске. 
 
+ **Учетная запись, используемая для запуска панели запуска, изменилась, или были удалены необходимые разрешения**. По умолчанию [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] использует при запуске следующую учетную запись, которой программа установки [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] предоставляет все необходимые разрешения: NT Service\MSSQLLaunchpad.

  Поэтому, если вы назначите панели запуска другую учетную запись или разрешение будет удалено политикой на компьютере SQL Server, у учетной записи могут отсутствовать необходимые разрешения и вы можете получить следующую ошибку: *ERROR_LOGON_TYPE_NOT_GRANTED 1385 (0x569) Вход в систему не произведен: выбранный режим входа для данного пользователя на этом компьютере не предусмотрен*.

  Чтобы предоставить новой учетной записи службы необходимые разрешения, используйте приложение **Локальная политика безопасности** и добавьте следующие разрешения для учетной записи:
  + Назначение квот памяти процессам (SeIncreaseQuotaPrivilege)
  + Обход проходной проверки (SeChangeNotifyPrivilege)
  + Вход в систему в качестве службы (SeServiceLogonRight)
  + Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)

  Дополнительные сведения о разрешениях для запуска служб SQL Server см. в разделе [Настройка учетных записей службы Windows и разрешений](https://msdn.microsoft.com/library/ms143504.aspx#Windows).
  
## <a name="side-by-side-installation-not-supported"></a>Параллельная установка не поддерживается.  
 Не устанавливайте параллельно разные версии R или другие выпуски Revolution Analytics.  

## <a name="offline-installation-of-r-components-for-localized-version-of-sql-server"></a>Автономная установка компонентов R для локализованной версии SQL Server 
Если вы устанавливаете службы R на компьютере, на котором нет доступа к Интернету, необходимо выполнить два дополнительных действия: скачать установщик компонентов R в локальную папку перед запуском программы установки SQL Server и отредактировать файл установщика, чтобы обеспечить установку нужного языка. 

Идентификатор языка, используемый для компонентов R, должен соответствовать устанавливаемому языку SQL Server. В противном случае кнопка **Далее** будет неактивна и вы не сможете завершить установку.

Дополнительные сведения см. в разделе [Установка компонентов R без доступа к Интернету](../../advanced-analytics/r-services/installing-r-components-without-internet-access.md). 
  
## <a name="unable-to-launch-runtime-for-r-script"></a>Не удается запустить среду выполнения для скрипта R.
[!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] создают группу пользователей Windows, которую [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] использует для выполнения заданий R. У этой группы пользователей должна быть возможность входа в экземпляр, в котором запущены службы R, для выполнения кода R от имени удаленных пользователей, которые применяют встроенную проверку подлинности Windows.
  
 В среде, где у группы Windows для пользователей R (**SQLRUsers**) нет этого разрешения, могут возникнуть указанные ниже ошибки.  
  
-   При попытке запуска сценариев R  
  
     *Не удается запустить среду выполнения для скрипта R. Проверьте конфигурацию среды выполнения R*.  
  
     *Возникла ошибка во внешнем скрипте. Не удается запустить среду выполнения*.  
  
-   Ошибки, вызываемые службой [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)]  
  
     *Не удалось инициализировать средство запуска RLauncher.dll*.  
  
     *Библиотеки DLL средства запуска не зарегистрированы*.  
  
-   Согласно журналам безопасности учетной записи NT SERVICE\MSSQLLAUNCHPAD не удалось выполнить вход.  
  
Сведения о том, как предоставить этой группе пользователей необходимые разрешения, см. в разделе [Установка служб SQL Server R Services](../../advanced-analytics/r-services/set-up-sql-server-r-services-in-database.md). 

> [!NOTE]
> 
> Это ограничение не распространяется на тот случай, если вы используете имена входа SQL для выполнения скриптов R с удаленной рабочей станции. 

  
## <a name="remote-execution-via-odbc"></a>Удаленное выполнение через ODBC   
 Если вы используете рабочую станцию обработки и анализа данных и подключаетесь к компьютеру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для выполнения команд R с помощью функций **RevoScaleR**, при использовании вызовов ODBC, записывающих данные на сервер, может возникнуть ошибка. 
 
 Причина та же, что и в предыдущем разделе: при установке службы R создают группу рабочих учетных записей, которые служат для выполнения задач R. Но если этим учетным записям не удается подключиться к серверу, выполнение вызовов ODBC от вашего имени невозможно. 
 
 Обратите внимание на то, что это ограничение не распространяется на тот случай, когда вы используете имена входа SQL для выполнения скриптов R с удаленной рабочей станции, так как учетные данные имен входа SQL передаются в явной форме из клиента R в экземпляр SQL Server, а затем в ODBC.
  
Чтобы включить неявную проверку подлинности, необходимо предоставить этой группе рабочих учетных записей указанные ниже разрешения.  
    
1. Откройте [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] с правами администратора в экземпляре, в котором будет выполняться код R. 

2. Выполните приведенный ниже скрипт. Измените имя группы пользователей, если вы изменили имя по умолчанию, а также имена компьютера и экземпляра.
    ```sql
    USE [master]
    GO
    
    CREATE LOGIN [computername\SQLRUserGroup] FROM WINDOWS WITH DEFAULT_DATABASE=[master], DEFAULT_LANGUAGE=[language]
    GO  
    ```

Дополнительные сведения и инструкции по выполнению этой задачи с помощью пользовательского интерфейса [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] см. в разделе [Установка служб SQL Server R Services](../../advanced-analytics/r-services/set-up-sql-server-r-services-in-database.md).

    
## <a name="errors-during-setup-because-r-components-cannot-be-installed"></a>Ошибки во время установки из-за невозможности установить компоненты R  
 При установке служб R (в базе данных) с помощью программы установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], когда вы нажимаете кнопку **Принять** на странице с условиями лицензии Microsoft R Open, программа установки должна найти компоненты и начать установку, если остальные компоненты установлены. Но в указанных ниже случаях компоненты могут не установиться.  
  
-   Вы выполняете автономную установку, и компоненты не удается скачать.  
  
     [Установка компонентов R без доступа к Интернету](../../advanced-analytics/r-services/installing-r-components-without-internet-access.md)  
  
-   Вы включаете проверку наличия обновлений, но служба обновления возвращает ошибку, так как ей не удается найти правильную версию компонента.  
  
  Это известная проблема, которая была исправлена в версии RC3.  
  
 
  
## <a name="upgrade-of-r-server-standalone-to-rc3-requires-uninstallation-using-the-rc2-setup-utility"></a>Для обновления R Server (изолированной версии) до версии RC3 необходимо выполнить удаление с помощью программы установки RC2.
 Microsoft R Server (изолированная версия) впервые появился в версии [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] RC2. Чтобы выполнить обновление до версии RC3 Microsoft R Server, необходимо сначала произвести удаление с помощью программы установки [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] RC2, а затем выполнить повторную установку с помощью программы установки [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] RC3.  
  
1.  Удалите R Server (изолированную версию) для [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] RC2 с помощью программы установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
2.  Обновите [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] до версии RC3 и выберите установку служб R (в базе данных). Экземпляр [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] будет обновлен до версии RC3. Дополнительная настройка не требуется.  
  
3.  Еще раз запустите программу установки [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] для версии RC3 и установите Microsoft R Server (изолированную версию).  

Это обходное решение не требуется при обновлении до версии RTM Microsoft R Server.

## <a name="see-also"></a>См. также:  
 [Приступая к работе со службами SQL Server R Services](../../advanced-analytics/r-services/getting-started-with-sql-server-r-services.md)   
 [Приступая к работе с изолированным сервером Microsoft R Server](../../advanced-analytics/r-services/getting-started-with-microsoft-r-server-standalone.md)  
  
  