---
title: "Исследование производительности (службы R) | Microsoft Docs"
ms.custom: ""
ms.date: "03/10/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 0e902312-ad9c-480d-b82f-b871cd1052d9
caps.latest.revision: 8
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 6
---
# Исследование производительности (службы R)

Чтобы продемонстрировать эффект указаниями, приведенными в предыдущих разделах, были выполнены тесты с помощью таблицы из набора данных авиакомпании. 

## Тесты и данные для примера

Существует шесть таблиц с 10 М строк в каждой таблице.

| Имя таблицы | Description |
| ---------- | ----------- |
| _авиакомпании_ | Данные преобразуются с помощью исходного файла xdf *rxDataStep*. |
| _airlineWithIntCol_ | *DayOfWeek* преобразуется в целое число, а не строку. Также добавляет *rowNum* столбца. |
| _airlineWithIndex_ | Те же данные как *airlineWithIntCol* таблицы, но с одного кластеризованного индекса с помощью *rowNum* столбца. |
| _airlineWithPageComp_ | Те же данные как *airlineWithIndex* таблицы, но с включенным сжатием страниц. Также добавляет два столбца *CRSDepHour* и *Late*, который вычисляются из *CRSDepTime* и *ArrDelay*. |
| _airlineWithRowComp_ | Те же данные как *airlineWithIndex* таблицы, но с включенным сжатием строк. Также добавляет два столбца *CRSDepHour* и *Late* которого вычисляются из *CRSDepTime* и *ArrDelay*. 
| _airlineColumnar_ | Хранилище столбцов с одного кластеризованного индекса. Эта таблица заполняется данными из очищенных копирование CSV-файла. |

Сценарии, используемые для выполнения тестов, описанных в этом разделе, а также ссылки на примере данные, используемые для тестов, можно найти по адресу [https://github.com/Microsoft/SQL-Server-R-Services-Samples/tree/master/PerfTuning](https://github.com/Microsoft/SQL-Server-R-Services-Samples/tree/master/PerfTuning).

Каждый тест выполнялся шесть раз время первого выполнения (холодный запуск,) был удален. Чтобы разрешить случайные выбросов, максимальное время для выполнения оставшихся пять также удаляются. Среднее значение четыре оставшиеся запусков была сделана вычислить среднее затраченное время выполнения каждого теста. Перед каждым тестом наблюдались R сборки мусора. Значение *rowsPerRead* для каждого теста был значение 500000.

## Размер данных при использовании сжатия и таблицу хранилища столбцов

Ниже приведены результаты использования сжатия и один столбец таблицы для уменьшения объема данных.

| Имя таблицы | Строки | Зарезервировано | Data | index_size | Не используется | % Сохранение (зарезервировано) |
| ---------- | ---- | -------- | ---- | ---------- | ------ | ------------------- |
| airlineWithIndex | 10000000 | 2978816 КБ | 2972160 КБ | 6128 КБ | 528 КБ | 0 |
| airlineWithPageComp | 10000000 | 625784 КБ | 623744 КБ | 1352 КБ | 688 КБ | 79% |
| airlineWithRowComp | 10000000 | 1262520 КБ | 1258880 КБ | 2552 КБ | 1088 КБ | 58% |
| airlineColumnar | 9999999 | 201992 КБ | 201624 КБ | н/д | 368 КБ | 93% |

## С помощью vs целое число со знаком. Строка в формуле

В данном эксперименте `rxLinMod` был использован с таблицей авиакомпании (где *DayOfWeek* — это строка) и *airlineWithIndex* (где *DayOfWeek* представляет собой целое число). В первом случае `colInfo` используется для указания уровней фактора (`Monday`, `Tuesday`, ...). Для второго `colInfo` не указан. В обоих случаях та же формула была использована. Формула, используемая — `ArrDelay ~ CRSDepTime + DayOfWeek`. Следующие результаты ясно видно преимуществом использования строки vs целое число:

| Имя таблицы | Имя теста | Среднее время |
| ---------- | --------- | ------------ |
| авиакомпании | FactorCol | 10.72 |
| airlineWithIntCol | IntCol | 3.4475 |

## С помощью сжатия

В данном эксперименте `rxLinMod` использовался с *airlineWithIndex*, *airlineWithPageComp*, и *airlineWithRowComp* таблиц. Те же формулы и запроса использовался для всех таблиц. 

| Имя таблицы | Имя теста | numTasks | Среднее время |
| ---------- | --------- | -------- | ------------ |
| airlineWithIndex | NoCompression | 1 | 5.6775 |
| &nbsp; | &nbsp; | 4 | 5.1775 |
| airlineWithPageComp | PageCompression | 1 | 6.7875 |
| &nbsp; | &nbsp; | 4 | 5.3225 |
| airlineWithRowComp | RowCompression | 1 | 6.1325 |
| &nbsp; | &nbsp; | 4 | 5.2375 |

Обратите внимание, что только сжатие (*numTasks* значение 1) не поможет в этом примере, как увеличение ЦП, чтобы обработать сжатие компенсирует уменьшение времени ввода-ВЫВОДА. Однако когда тест выполняется параллельно, задав *numTasks* в 4, уменьшение среднего времени. Для более крупных наборов данных влияние сжатия может быть более заметно. Сжатие зависит от набора данных и значения, поэтому экспериментов может потребоваться, чтобы определить, что сжатие влияет на набор данных.

## Предотвращение функции преобразования

В данном эксперименте `rxLinMod` используется в таблице airlineWithIndex с и без использования функции преобразования.  

| Имя теста | Среднее время |
| --------- | ------------ |
| WithTransformation | 5.1675 |
| WithoutTransformation | 4.7 |

Обратите внимание, что увеличение времени без использования функции преобразования (в столбцах предварительно вычисляется и сохраняется в таблице). Экономия будет значительно больше, если существует множество дополнительных преобразований и набор данных больше (> 100 МБ).

## Использование хранилища столбцов

В данном эксперименте `rxLinMod` использовался с airlineWithIndex и airlineColumnar таблицы без использования любых преобразований. Результаты показывают, что хранилище столбцов можно лучше, чем хранилище строк. Будет существовать значительная разница в производительности на набором данных большего размера (> 100 МБ).  

| Имя таблицы | Имя теста |Среднее время |
| ---------- | --------- | ------------ |
| airlineWithIndex | RowStore | 4.67 |
| airlineColumnar | ColStore | 4.555 |

## Влияние параметра куба

В данном эксперименте `rxLinMod` используется в таблице авиакомпании где `DayOfWeek` хранится в виде строки. Формула, используемая — `ArrDelay ~ Origin:DayOfWeek + Month + DayofMonth + CRSDepTime`. Результаты ясно показывают, что использование `cube` параметр помогает повысить эффективность. 

| Имя теста | Параметр куба | numTasks | Среднее время | Одна строка прогнозирования (ArrDelay_Pred) |
| --------- | -------------- | -------- | ------------ | ------------------------------- |
| CubeArgEffect | `cube = F` | 1 | 91.0725 | 9.959204 |
| &nbsp; | &nbsp; | 4 | 44.09 | 9.959204 |
| &nbsp; | `cube = T` | 1 | 21.1125 | 9.959204 |
| &nbsp; | &nbsp; | 4 | 8.08 | 9.959204 |

## Эффект maxDepth для rxDTree

В данном эксперименте `rxDTree` используется в таблице airlineColumnar. Различными значениями для *maxDepth* были использованы, чтобы продемонстрировать, как это влияет на время выполнения сложности. При увеличении глубины экспоненциально увеличить общее количество узлов и значительно увеличит время. Для этого теста *numTasks* установлено значение 4.

| Имя теста | maxDepth | Среднее время |
| --------- | -------- | ------------ |
| TreeDepthEffect | 1 | 10.1975 |
| &nbsp; | 2 | 13.2575 |
| &nbsp; | 4 | 19.27 |
| &nbsp; | 8 | 45.5775 |
| &nbsp; | 16 | 339.54 |

## Действие параметра питания

В данном эксперименте `rxLinMod` с таблицей airlineWithIntCol использовалась во время установки Windows для Сбалансированный как, так и высокая производительность Электропитание. Для всех тестов *numTasks* равным 1. Тест выполнялся 6 раз и была выполнена дважды в обоих параметры электропитания для демонстрации Разброс результатов при использовании параметра балансировкой электропитания. Результаты показывают, что числа являются более согласованное и быстрее для параметра power высокой производительности. 

__Высокая производительность__ питания параметр:

| Имя теста | Выполнить # | Истекшее время | Среднее время |
| --------- | ----- | ------------ | ------------ |
| IntCol | 1 | 3,57 секунд | &nbsp; |
| &nbsp; | 2 | 3,45 секунд | &nbsp; |
| &nbsp; | 3 | 3,45 секунд | &nbsp; |
| &nbsp; | 4 | 3.55 секунд | &nbsp; |
| &nbsp; | 5 | 3.55 секунд | &nbsp; |
| &nbsp; | 6 | 3,45 секунд | &nbsp; |
| &nbsp; | &nbsp; | &nbsp; | 3.475 |
| &nbsp; | 1 | 3,45 секунд | &nbsp; |
| &nbsp; | 2 | 3.53 секунд | &nbsp; |
| &nbsp; | 3 | 3.63 секунд | &nbsp; |
| &nbsp; | 4 | 3,49 секунд | &nbsp; |
| &nbsp; | 5 | 3.54 секунд | &nbsp; |
| &nbsp; | 6 | 3.47 секунд | &nbsp; |
| &nbsp; | &nbsp; | &nbsp; | 3.5075 |

__Балансировка__ питания параметр:

| Имя теста | Выполнить # | Истекшее время | Среднее время |
| --------- | ----- | ------------ | ------------ |
| IntCol | 1 | 3.89 секунд | &nbsp; |
| &nbsp; | 2 | 4.15 секунд | &nbsp; |
| &nbsp; | 3 | 3.77 секунд | &nbsp; |
| &nbsp; | 4 | 5 секунд | &nbsp; |
| &nbsp; | 5 | 3.92 секунд | &nbsp; |
| &nbsp; | 6 | 3.8 секунд | &nbsp; |
| &nbsp; | &nbsp; | &nbsp; | 3.91 |
| &nbsp; | 1 | 3.82 секунд | &nbsp; |
| &nbsp; | 2 | 3,84 секунд | &nbsp; |
| &nbsp; | 3 | 3.86 секунд | &nbsp; |
| &nbsp; | 4 | 4.07 секунд | &nbsp; |
| &nbsp; | 5 | 4.86 секунд | &nbsp; |
| &nbsp; | 6 | 3,75 секунд | &nbsp; |
| &nbsp; | &nbsp; | &nbsp; | 3.88 |

## С помощью хранимых модели прогнозирования

В данном эксперименте модели создается и сохраняется в базе данных. Затем хранимая модель загружается из базы данных и прогнозов, созданных с помощью блок одну строку данных в памяти (локальном контексте). Время, необходимое для обучения, сохранить и загрузки модели и прогнозирование приведен ниже. Это — это быстрый способ сделать прогноз. Результаты теста Показывать время сохранения модели и время, необходимое для загрузки модели и прогнозирования. 

| Имя таблицы | Имя теста | Среднее время (для обучения модели) | Время для сохранения и загрузки модели |
| ---------- | --------- | ----- | ----- |
| авиакомпании | SaveModel | 21.59 | 2.08 | 
| &nbsp; | LoadModelAndPredict | &nbsp; |  2.09 (включает время для прогнозирования) |


## Устранение проблем с производительностью

Тесты, используемые в данном разделе создания выходных файлов для каждого запуска с помощью *reportProgress* параметр, который передается в тесты со значением `3`. Выходные данные в консоли направляется в файл в выходной каталог. Выходной файл содержит сведения, касающиеся время, затраченное на выполнение операций ввода-ВЫВОДА, время перехода и время вычисления. Эти значения полезны для устранения неполадок и диагностики. Сценарии тестирования обработать эти времена для различных запусков выдвигают среднее время над запусков. Эти скрипты теста и методов может быть полезна в разрешении проблем при использовании rx аналитические функции вашей [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)]. Например ниже приведен пример время для запуска. Всего чтения ввода-ВЫВОДА (времени), основной интерес затраты времени и переход времени (издержек при настройке процессы для вычисления).

    Running IntCol Test. Using airlineWithIntCol table.  
        run  1  took  3.66  seconds  
        run  2  took  3.44  seconds  
        run  3  took  3.44  seconds  
        run  4  took  3.44  seconds  
        run  5  took  3.45  seconds  
        run  6  took  3.75  seconds  

    Average Time:  3.4425  
                    metric   time    pct 
    1           Total time 3.4425 100.00 
    2 Overall compute time 2.8512  82.82 
    3      Total read time 2.5378  73.72 
    4      Transition time 0.5913  17.18 
    5    Total non IO time 0.3134   9.10 
 
 ## См. также
 [SQL Server R служб настройки руководства по повышению производительности](../../advanced-analytics/r-services/sql-server-r-services-performance-tuning.md)
 
 [Настройка SQL Server для служб R](../../advanced-analytics/r-services/sql-server-configuration-r-services.md)
 
 [R и оптимизация данных](../../advanced-analytics/r-services/r-and-data-optimization-r-services.md)