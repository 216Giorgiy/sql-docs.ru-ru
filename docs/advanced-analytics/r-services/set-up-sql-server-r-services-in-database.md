---
title: "Установка служб SQL Server R Services (в базе данных) | Microsoft Docs"
ms.custom: ""
ms.date: "03/07/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
keywords: 
  - "установка служб SQL Server R Services"
ms.assetid: 4d773c74-c779-4fc2-b1b6-ec4b4990950d
caps.latest.revision: 35
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 30
---
# Установка служб SQL Server R Services (в базе данных)
  В [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] и более поздних версиях можно установить все компоненты, связанные с [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)], с помощью мастера установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
 
 
 По завершении установки могут потребоваться дополнительные действия, чтобы включить службы R, настроить учетные записи и предоставить пользователям разрешения на доступ к определенным базам данных.   
  
Если после завершения установки возникают проблемы с доступом к базам данных или если необходимо удалить предыдущие версии, см. раздел [Часто задаваемые вопросы по обновлению и установке &#40;службы SQL Server R&#41;](../../advanced-analytics/r-services/upgrade-and-installation-faq-sql-server-r-services.md).  

> [!NOTE]
> Для установки служб R (в базе данных) диск, на котором устанавливается этот компонент, должен поддерживать создание коротких имен файлов в нотации 8dot3. В противном случае процессы, запускающие среду R с сервера SQL Server, могут не запуститься. Обязательно включите нотацию 8dot3 для тома перед установкой служб R. Это ограничение будет снято в будущем выпуске.

  
##  <a name="a-namebkmkinstallrservicesindatabasea-step-1-install-r-services-in-database-on-sql-server-2016-or-later"></a><a name="bkmk_installRServicesInDatabase"></a> Шаг 1. Установка служб R (в базе данных) в SQL Server 2016 или более поздней версии  
   
  
1.  Запустите программу установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
    Сведения об автоматической установке см. в статье [Unattended Installs of SQL Server R Services](../../advanced-analytics/r-services/unattended-installs-of-sql-server-r-services.md).  
  
2.  На вкладке **Установка** щелкните **Новая установка изолированного экземпляра SQL Server или добавление компонентов к существующей установке**.  
  
    > [!NOTE]  
    >  Установить [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] в отказоустойчивом кластере нельзя. Но вы можете установить [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] на изолированном компьютере, на котором используется функция AlwaysOn и который входит в группу доступности. Дополнительные сведения об использовании служб R в группе доступности AlwaysOn см. в разделе [Группы доступности AlwaysOn: взаимодействие](../../database-engine/availability-groups/windows/always-on-availability-groups-interoperability-sql-server.md).  
  
3.  На странице **Выбор компонентов** выберите следующие компоненты:  
  
    -   **Службы ядра СУБД**  
  
         Для использования [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)]требуется по крайней мере один экземпляр ядра СУБД. Вы можете использовать экземпляр по умолчанию или именованный экземпляр.  
  
    -   **Службы R (в базе данных)**  
  
         Этот параметр настраивает службы баз данных, которые используются заданиями R, а также устанавливает расширения, которые поддерживают внешние скрипты и процессы.  
    > [!NOTE]
    > 
    > Если код R необходимо выполнять в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], установите **[!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)]**. 
    > 
    > Чтобы использовать библиотеки Scale R на компьютере Windows без SQL Server, можно применять Microsoft R Server (изолированную версию). Мы рекомендуем установить Microsoft R Server (изолированную версию) на ноутбуке или другом компьютере, используемом для разработки на языке R, с целью создания решений R, которые затем можно развернуть в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] со службами R (в базе данных).
 
  
4.  На странице **Согласие на установку Microsoft R Open** нажмите кнопку **Принять**.  
  
     Принятие лицензионного соглашения необходимо для скачивания Microsoft R Open — дистрибутива, включающего базовые пакеты и средства R с открытым исходным кодом, а также поставщики услуг подключения и расширенные пакеты R от Revolution Analytics.  
  
    > [!NOTE]  
    >  Если используемый компьютер не подключен к Интернету, вы можете приостановить установку, чтобы скачать установщики отдельно, как описано здесь: [Установка компонентов R без доступа к Интернету](../../advanced-analytics/r-services/installing-r-components-without-internet-access.md).  
  
     Нажмите кнопку **Принять**, подождите, пока кнопка **Далее** станет активна, а затем нажмите кнопку **Далее**.  
  
5.  На странице **Все готово для установки** проверьте, включены ли указанные ниже компоненты, и нажмите кнопку **Установить**.  
  
     **Компоненты**  
  
     Службы компонента Database Engine  
  
     Службы R Services (в базе данных)  
  
6.  По завершении установки перезагрузите компьютер.   
  
  
##  <a name="a-namebkmkenablefeaturea-step-2-enable-r-services-and-verify-that-local-r-script-execution-works"></a><a name="bkmk_enableFeature"></a> Шаг 2. Включение служб R и проверка выполнения локальных скриптов R  
  
  
1. Откройте среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Если она еще не установлена, вы можете повторно запустить мастер установки SQL Server, чтобы скачать ее по ссылке и установить.  
  
2. Подключитесь к экземпляру, где установлены службы R (в базе данных), и выполните приведенную ниже команду, чтобы явно включить компонент служб R. В противном случае вы не сможете вызывать скрипты R, даже если компонент был установлен программой установки.  
  
   ```    
   Exec sp_configure  'external scripts enabled', 1  
   Reconfigure  with override    
   ```  
  
10. Перезапустите службу SQL Server для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Связанная служба [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] также будет автоматически перезагружена. Перезапустить службу можно с помощью панели "Службы" на панели управления или с помощью диспетчера конфигурации SQL Server.  
  
9. После того как служба SQL Server станет доступна, проверьте, включен ли компонент R, выполнив следующую команду и проверив, имеет ли свойство *run_value* значение 1:  
  
    ```    
    Exec sp_configure  'external scripts enabled'    
    ```  
   Вы также можете открыть панель **Службы** и проверить, работает ли служба панели запуска для вашего экземпляра. Каждый экземпляр имеет собственную службу панели запуска.
   
10. Теперь у вас должна быть возможность выполнять в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] простые скрипты R, наподобие следующего:  
  
    ```  
    exec sp_execute_external_script  @language =N'R',  
    @script=N'OutputDataSet<-InputDataSet',    
    @input_data_1 =N'select 1 as hello'  
    with result sets (([hello] int not null));  
    go  
    ```  
  
    **Результаты**  
  
    *hello*  
    *1*   
  
> [!IMPORTANT]  Если вам нужен доступ к данным SQL Server или возможность выполнять команды R из удаленного клиента обработки и анализа данных, требуются дополнительные действия. Ниже подробно описываются эти дополнительные требования.
 
  
##  <a name="a-namebkmkconfigureaccountsa-step-3-enable-implied-authentication-for-launchpad-accounts"></a><a name="bkmk_configureAccounts"></a> Шаг 3. Включение неявной проверки подлинности для учетных записей панели запуска  
   
  
В процессе установки создаются 20 учетных записей пользователей Windows в целях выполнения задач с токеном безопасности службы [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)]. Когда пользователь отправляет скрипт R из внешнего клиента, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] активирует доступную рабочую учетную запись, сопоставляет ее с удостоверением вызывающего пользователя и выполняет скрипт R от имени пользователя. Это новая служба ядра СУБД, которая обеспечивает безопасное выполнение внешних скриптов с помощью механизма, называемого *неявной проверкой подлинности*. 

Учетные записи можно просмотреть в группе пользователей Windows **SQLRUserGroup**.  Если вам нужно выполнять скрипты R из удаленного клиента обработки и анализа данных и вы используете проверку подлинности Windows, этим рабочим учетным записям необходимо предоставить разрешение на вход в экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] от вашего имени.  
  
1. В среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] в обозревателе объектов разверните узел **Безопасность**, щелкните правой кнопкой мыши **Имена входа** и выберите пункт **Создать имя входа**.  
2. В диалоговом окне **Создание имени входа** нажмите кнопку **Поиск**.  
3. Щелкните **Типы объектов** и выберите пункт **Группы**. Отмените выбор всех остальных пунктов.  
4. В поле "Введите имя объекта" введите *SQLRUserGroup* и щелкните **Проверить имена**.  
5. Имя локальной группы, связанной со службой панели запуска экземпляра, должно разрешиться в *имя_экземпляра\SQLRUserGroup*. Нажмите кнопку **ОК**.  
6. По умолчанию имя входа назначается **общедоступной** роли и имеет разрешение на подключение к ядру СУБД. 
7. Нажмите кнопку **ОК**.  
  
> [!NOTE] Если вы используете имя входа SQL для выполнения скриптов R в контексте вычисления SQL Server, это дополнительное действие не требуется.
  
  
## <a name="step-4-give-non-admin-users-r-script-permissions"></a>Шаг 4. Предоставление пользователям без административных прав разрешений на выполнение скриптов R  
  
Если вы установили [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] самостоятельно и выполняете скрипты R в собственном экземпляре, то, как правило, делаете это с правами администратора и поэтому имеете явное разрешение на совершение различных операций и доступ ко всем данным в базе данных, а также возможность устанавливать новые пакеты R по мере необходимости.  
  
Но в корпоративном сценарии большинство пользователей, включая тех, которые обращаются к базе данных с помощью имен входа SQL, не имеют таких повышенных прав. Поэтому каждому пользователю, который будет выполнять внешние скрипты, необходимо предоставить разрешения на выполнение скриптов R в каждой базе данных, в которой будет использоваться R.   
  
  
```  
USE <database_name>  
GO  
GRANT EXECUTE ANY EXTERNAL SCRIPT  TO [UserName]  
```  

> [!TIP] Нужно помочь в установке? Сомневаетесь, выполнили ли вы все действия?
>
> Используйте настраиваемые отчеты для проверки состояния установки служб R. Дополнительные сведения см. в разделе [Мониторинг служб R с помощью настраиваемых отчетов](../../advanced-analytics/r-services/monitor-r-services-using-custom-reports-in-management-studio.md).    
  
##  <a name="a-namebkmkadditionala-optional-modifications"></a><a name="bkmk_Additional"></a> Дополнительные изменения  
  
В этом разделе описываются дополнительные изменения, которые можно внести в конфигурацию экземпляра, или, если вы используете клиент обработки и анализа данных, изменения для обеспечения выполнения скриптов R.
  
### <a name="modify-the-number-of-worker-accounts-used-by-includersqllaunchpadtokenrsqllaunchpadmdmd"></a>Изменение числа рабочих учетных записей, используемых [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)]
  
Если вы предполагаете, что будете интенсивно использовать среду R или множество пользователей будут одновременно выполнять скрипты, вы можете увеличить количество рабочих учетных записей, назначенных службе панели запуска. Дополнительные сведения см. в разделе [Modify the User Account Pool for SQL Server R Services](../../advanced-analytics/r-services/modify-the-user-account-pool-for-sql-server-r-services.md).  
  
  
### <a name="give-your-r-users-or-logins-read-write-or-ddl-permissions-as-needed-in-additional-databases"></a>Предоставление пользователям или именам входа R необходимых разрешений на чтение, запись или DDL в дополнительных базах данных  
  
При выполнении скриптов R учетной записи пользователя может потребоваться считывать данные из других баз данных, создавать таблицы для хранения результатов и записывать данные в таблицы. 
     
Каждая четная запись пользователя, выполняющая скрипты R, должна иметь разрешения **db_datareader**, **db_datawriter** или **db_ddladmin** для определенной базы данных.   
       
Например, приведенная ниже инструкция [!INCLUDE[tsql](../../includes/tsql-md.md)] предоставляет имени входа SQL *MySQLLogin* права на выполнение запросов T-SQL в базе данных *RSamples*. Для выполнения этой инструкции имя входа SQL уже должно существовать в контексте безопасности сервера.  
  
```  
USE RSamples  
GO  
EXEC sp_addrolemember 'db_datareader', 'MySQLLogin'  
```  
  
Дополнительные сведения о разрешениях, включенных в каждую роль, см. в разделе [Роли уровня базы данных](../../relational-databases/security/authentication-access/database-level-roles.md).  
  
  
### <a name="create-an-odbc-data-source-for-the-instance-on-your-data-science-client"></a>Создание источника данных ODBC для экземпляра в клиенте обработки и анализа данных  
  
Если вы создаете решение R на клиентском компьютере обработки и анализа данных и вам необходимо подключаться к компьютеру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], который служит контекстом вычисления, вы можете использовать имя входа SQL или встроенную проверку подлинности Windows.  
  
При использовании имени входа SQL оно должно иметь соответствующие разрешения на доступ к базе данных, из которой будут считываться данные. Для этого можно добавить разрешения *Подключиться к* и *SELECT* или добавить имя входа к роли **db_datareader**. Если вам нужно создавать объекты, вам потребуются права **DDL_admin**.  Чтобы сохранять данные в таблицах, добавьте имя входа к роли **db_datawriter**.  
  
При использовании проверки подлинности Windows необходимо настроить источник данных ODBC в клиенте обработки и анализа данных, указав имя экземпляра и другие сведения о подключении.  
  
Дополнительные сведения см. в разделе [Работа с администратором источников данных ODBC](http://windows.microsoft.com/windows/using-odbc-data-source-administrator).  
  
### <a name="optimize-the-server-for-r"></a>Оптимизация сервера для R  

Параметры по умолчанию для программы установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] призваны оптимизировать выполнение на сервере различных служб, поддерживаемых ядром СУБД, включая процессы извлечения, преобразования и загрузки, ведение отчетности, аудит и приложения, использующие данные [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Поэтому при использовании параметров по умолчанию ресурсы для операций R могут быть ограничены или регулироваться, особенно в случае с операциями с интенсивным использованием памяти.  
  
 Чтобы задачам R назначались соответствующие приоритеты и выделялись необходимые ресурсы, рекомендуем использовать средство Resource Governor с целью настройки внешнего пула ресурсов для операций R. Кроме того, можно изменить размер памяти, выделенный ядру СУБД [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], или увеличить количество учетных записей в службе [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)].  
  
-   Настройка пула ресурсов для управления внешними ресурсами  
  
     [CREATE EXTERNAL RESOURCE POOL &#40;Transact-SQL&#41;](../../t-sql/statements/create-external-resource-pool-transact-sql.md)  
  
-   Изменение объема памяти, зарезервированного для ядра СУБД  
  
     [Параметры конфигурации сервера "Server Memory"](../../database-engine/configure-windows/server-memory-server-configuration-options.md)  
  
-   Изменение числа учетных записей R, которые могут быть запущены [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)]  
  
     [Изменение пула учетных записей пользователей для служб SQL Server R](../../advanced-analytics/r-services/modify-the-user-account-pool-for-sql-server-r-services.md)  
  
### <a name="get-the-r-source-code-optional"></a>Получение исходного кода R (необязательно)  

[!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] включает в себя дистрибутив базовых пакетов R с открытым исходным кодом.  
  
Чтобы немедленно начать скачивание исходного кода GPL/LGPL, щелкните одну из приведенных ниже ссылок. Исходный код доступен на условиях универсальной открытой лицензии GNU. Но он не является обязательным для установки или использования [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)].  
  
-   Совместимо с версией RC2: скачать архив [rre-gpl-src.8.0.2.tar.gz](http://go.microsoft.com/fwlink/?LinkId=786770) 
  
-   Совместимо с версией RC3: скачать архив [rre-gpl-src.8.0.3.tar.gz](http://go.microsoft.com/fwlink/?LinkId=786771) 

-   Совместимо с версией RTM: скачать архив [rre-gpl-src.8.0.3.tar.gz](http://go.microsoft.com/fwlink/?LinkID=786771)
  
## <a name="troubleshooting"></a>Устранение неполадок  
 Возникли проблемы? Ознакомьтесь со списком распространенных проблем при установке предварительных версий [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)].  
  
 [Часто задаваемые вопросы по обновлению и установке &#40;службы R для SQL Server&#41;](../../advanced-analytics/r-services/upgrade-and-installation-faq-sql-server-r-services.md)  
  
## <a name="see-also"></a>См. также:  
 [Настройка клиента обработки и анализа данных](../../advanced-analytics/r-services/set-up-a-data-science-client.md)   
 [Создание изолированного сервера R Server](../../advanced-analytics/r-services/create-a-standalone-r-server.md)  
  
  