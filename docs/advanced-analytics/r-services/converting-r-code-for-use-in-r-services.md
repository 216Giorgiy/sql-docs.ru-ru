---
title: "Преобразование кода R для использования в службах R | Microsoft Docs"
ms.custom: 
  - "SQL2016_New_Updated"
ms.date: "05/31/2016"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "R"
ms.assetid: 0b11ab52-b2f9-4a4f-b1ab-68ba09c8adcc
caps.latest.revision: 12
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 11
---
# Преобразование кода R для использования в службах R
При перемещении кода R в R Studio или другую среду SQL Server часто код будет работать без дополнительных изменений при добавлении *@script* параметр [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). Это особенно верно, если вы разработали решения с помощью функции проекционная, делая его относительно легко изменить контекстов выполнения.    
    
Тем не менее, обычно требуется изменение кода для выполнения в SQL Server, и пользоваться преимуществами более плотную интеграцию с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], и избежать дорогостоящей передачи данных.   
   
   
## Ресурсы  
  
Чтобы просмотреть примеры выполнения кода R в SQL Server, см. в этих пошаговых руководствах:   
+ [Аналитика в базе данных для разработчиков SQL](../../advanced-analytics/r-services/in-database-advanced-analytics-for-sql-developers-tutorial.md)    
  Показано, как обеспечить кода более удобным, заключив ее в хранимых процедурах  
+ [Решение для обработки и анализа данных End-to-End](../../advanced-analytics/r-services/data-science-end-to-end-walkthrough.md)    
  Включает сравнение конструируются в R и T-SQL

## Изменения в процессе обработки данных в SQL Server  
  
При работе [!INCLUDE[rsql_rtvs_md](../../includes/rsql-rtvs-md.md)], RStudio, или другие среды типичный рабочий процесс извлечения данных на компьютер, последовательно, анализировать данные и записать или отображения результатов. Тем не менее при переносе автономной R кода для SQL Server большая часть этого процесса можно упрощенное или делегировать другие средства SQL Server:

| Внешний код | R в SQL Server |
|-------|-------|
| Получение данных| Определить входные данные как запрос SQL в базе данных | 
| Объединение и визуализации данных| Без изменений; диаграммы можно экспортировать в виде изображения или отправляемые удаленной рабочей станции|
|Разработка компонентов| Можно использовать R в базу данных, но может быть эффективнее вызывать функции T-SQL или пользовательского определяемые пользователем функции|
|Очистка часть процесса анализа данных| Очистка данных можно делегировать процессов ETL и выполнить заранее|
|Вывод прогнозов в файл| Вывод прогнозов в таблице или заключите `predict` в хранимых процедурах для прямого доступа приложений|
  

  
## Рекомендации  
  
+ Запишите зависимости, такие как требуемые пакеты заранее. В среде разработки и тестирования может быть необходимо установить пакеты как часть вашего кода, но это не рекомендуется в производственной среде. Уведомите администратора, чтобы пакеты могут быть установлены и тестирование перед развертыванием кода.  
+ Создание контрольного списка возможных данных тип проблемы. Документ схемы в каждом разделе код ожидаемые результаты.  
+ Определение основных данных источников, таких как обучающие данные модели и входных данных для создания прогнозов и вторичных источников, таких как факторов, дополнительное группирование переменных и т. д. Сопоставление большого набора данных входной параметр [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md).  
+ Измените входные данные операторы для работы непосредственно в базе данных. Вместо перемещения данных в локальный файл CSV или внесения повторные вызовы ODBC, вы получите лучшую производительность с помощью SQL-запросов или представлений, которые могут выполняться непосредственно в базе данных, чтобы избежать перемещения данных.  
+ Планы запросов SQL Server используется для определения заданий, которые могут выполняться параллельно. Если входного запроса могут выполняться параллельно, установите `@parallel=1` как часть аргументов sp_execute_external_script. Параллельной обработки с помощью этого флага можно обычно любое время, SQL Server можно работать с секционированными таблицами или распределения запросов между несколькими процессами и статистическую обработку результатов в конце. 
   Параллельной обработки с помощью этого флага обычно не поддерживается при наличии обучения моделей с помощью алгоритмов, которые требуется выполнить чтение всех данных или если требуется создать статистические выражения. 
+ Там, где это возможно, замените обычной функции R с **проекционная** функции, поддерживающие распределенные выполнения. Дополнительные сведения см. в разделе [Сравнение функций в R масштабирования и CRAN R](Summary%20of%20rx%20Functions.md).
+ Просмотрите код R для определения действий, которые могут выполняться независимо или более эффективно выполнить с помощью вызова отдельную хранимую процедуру. Например можно выполнять отдельно engineering или функции извлечения компонентов и добавить значения в новый столбец. Используйте T-SQL, а не в коде R для вычислений с множествами. Пример одного решения R, сравнивает производительность определяемые пользователем функции и R для задач разработки компонентов см. в этом учебнике: [пошаговые обработки и анализа данных](../../advanced-analytics/r-services/data-science-end-to-end-walkthrough.md).  
  
    
## Ограничения    
 При преобразовании кода R учитывайте следующие ограничения:    
   
**Типы данных**    
-   Поддерживаются все типы данных R. Однако [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает разнообразные типы данных, чем R, поэтому некоторые неявные преобразования типов данных выполняется при отправке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] данных R и наоборот. Также необходимо явным образом приведения или преобразования некоторых данных.    
    
- Поддерживаются значения NULL. R использует `na` создания данных для представления отсутствующих значений которого подобен значения NULL.    
    
- Дополнительные сведения см. в разделе [Работа с типами данных R](../../advanced-analytics/r-services/working-with-r-data-types.md).    
 
 **Входы и выводы**   
+ Можно определить только один входной набор данных как часть параметров хранимых процедур. Это входного запроса для хранимой процедуры может быть любой допустимый одиночной инструкции SELECT. Рекомендуется использовать эти входные данные для больших наборов данных и при необходимости с помощью вызова RODBC получите наборов данных меньшего размера. 

+ Хранимая процедура вызывает предшествует EXECUTE нельзя использовать в качестве входных данных для sp_execute_external_script.    
    
+ Все столбцы во входном наборе данных должен быть сопоставлен переменным в скрипте R. Переменные, автоматически сопоставляются по имени. Например предположим, что сценарий R содержит формулу следующим образом:    
    
    ```    
    formula <- ArrDelay ~ CRSDepTime + DayOfWeek + CRSDepHour:DayOfWeek    
    ```    
    
     Если входной набор данных не содержит столбцы с совпадающими именами, ArrDelay, CRSDepTime, DayOfWeek, CRSDepHour и DayOfWeek, будет выдана ошибка.    

+ Также можно ввести нескольких скалярных параметров в качестве входных данных. Тем не менее все переменные, передаваемые в качестве параметров хранимой процедуры [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md) должна быть сопоставлена с переменным в коде R. По умолчанию переменные сопоставляются по имени.
+ Чтобы включить скалярных входных переменных в результат выполнения кода R, просто добавьте **ВЫВОДА** ключевое слово, если необходимо определить переменную.             
+ В [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)], код R ограничена вывод одного набора данных как объект data.frame. Однако можно также выводить нескольких скалярных выводит, включая графики в двоичном формате и модели в формате varbinary.    
    
+ Обычно можно выводить набора данных, возвращаемых сценарием R без указания имен выходных столбцов, с помощью параметра с RESULT SETS UNDEFINED. Тем не менее все переменные в скрипт R, который требуется направить вывод должен быть сопоставлен выходных параметров SQL.
    
+ Если сценарий R использует аргумент `@parallel=1`, необходимо определить выходные данные схемы. Причина заключается в том, что несколько процессов могут быть созданы по SQL Server для выполнения запроса в параллельном режиме с результатами, собранные в конце. Таким образом выходные данные схемы должны определяться перед созданием параллельных процессов.

 **Зависимости**
 + Следует Избегайте установки пакетов из кода R. На сервере SQL Server следует заранее установить пакетов.  
  
  
  

