---
title: "Шаг&#160;2. Импорт данных в SQL Server с помощью PowerShell (учебник по дополнительным аналитическим функциям в базе данных) | Microsoft Docs"
ms.custom: ""
ms.date: "08/05/2016"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
applies_to: 
  - "SQL Server 2016"
dev_langs: 
  - "R"
  - "TSQL"
ms.assetid: 3c5b5145-fa57-455a-b153-0400fc062dc0
caps.latest.revision: 11
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 11
---
# Шаг&#160;2. Импорт данных в SQL Server с помощью PowerShell (учебник по дополнительным аналитическим функциям в базе данных)
В этом шаге вы выполните один из скриптов, чтобы создать объекты базы данных, необходимые для работы с этим пошаговым руководством. Скрипт также создает большинство хранимых процедур, которые вы будете использовать, и добавляет образец данных в указанную таблицу базы данных.  
  
## Выполнение скриптов для создания объектов SQL  
Среди скачанных файлов имеется скрипт PowerShell. Чтобы подготовить среду к работе с пошаговым руководством, необходимо выполнить этот скрипт.  
  
Он выполняет следующие действия:  
  
-   Устанавливает SQL Native Client и программы командной строки SQL, если они еще не установлены. Эти программы необходимы для массовой загрузки данных в базу данных с помощью **bcp**.  
  
-   Создает базу данных и таблицу в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], а также выполняет массовую вставку данных в таблицу.  
  
-   Создает несколько функций и хранимых процедур SQL.  
  
#### Выполнение скрипта  
1.  Откройте командную строку PowerShell с правами администратора и выполните приведенную ниже команду.  
  
    ```  
    .\RunSQL_SQL_Walkthrough.ps1  
    ```  
  
    Появится запрос на ввод следующих сведений:  
  
    -   имя или адрес экземпляра [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], где установлены службы [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)];  
  
    -   имя пользователя и пароль учетной записи в экземпляре; используемая учетная запись должна иметь разрешения на создание баз данных, таблиц и хранимых процедур, а также на добавление данных в таблицы;  
  
    -   путь к скачанному файлу с образцом данных и его имя. Например:  
  
        `C:\tempRSQL\nyctaxi1pct.csv`  
  
2.  На этом этапе также необходимо изменить все скрипты [!INCLUDE[tsql](../../includes/tsql-md.md)], заменив заполнители на соответствующие имена базы данных и пользователя.  
  
    Изучите хранимые процедуры и функции, созданные скриптом.  
  
    |||  
    |-|-|  
    |**Имя файла скрипта SQL**|**Функция**|  
    |create-db-tb-upload-data.sql|Создает базу данных и две таблицы:<br /><br />nyctaxi_sample: содержит основной набор данных по работе такси в Нью-Йорке. К таблице добавляется кластеризованный индекс columnstore для оптимизации хранения данных и производительности запросов. В таблицу будет вставлена выборка, содержащая 1 % от общего объема набора данных по работе такси в Нью-Йорке.<br /><br />nyc_taxi_models: используется для сохранения обученной модели расширенной аналитики.|  
    |fnCalculateDistance.sql|Создает скалярную функцию, которая вычисляет прямое расстояние между местами посадки и высадки.|  
    |fnEngineerFeatures.sql|Создает табличную функцию, которая формирует новые характеристики данных для обучения модели.|  
    |PersistModel.sql|Создает хранимую процедуру, которую можно вызывать для сохранения модели. Хранимая процедура принимает модель, сериализованную как тип данных varbinary, и записывает ее в указанную таблицу.|  
    |PredictTipBatchMode.sql|Создает хранимую процедуру, которая вызывает обученную модель для составления прогнозов. Хранимая процедура принимает запрос в качестве входного параметра и возвращает столбец числовых значений, представляющих оценки для входных строк.|  
    |PredictTipSingleMode.sql|Создает хранимую процедуру, которая вызывает обученную модель для составления прогнозов. Эта хранимая процедура принимает новое наблюдение в качестве входных данных, причем отдельные значения характеристик передаются как встроенные параметры, и возвращает значение, представляющее прогнозируемый результат для нового наблюдения.|  
  
    В последней части этого пошагового руководства вы создадите ряд дополнительных хранимых процедур.  
  
    |||  
    |-|-|  
    |**Имя файла скрипта SQL**|**Функция**|  
    |PlotHistogram.sql|Создает хранимую процедуру для изучения данных. Эта хранимая процедура вызывает функцию R для построения гистограммы на основе переменной, а затем возвращает диаграмму в виде двоичного объекта.|  
    |PlotInOutputFiles.sql|Создает хранимую процедуру для изучения данных. Эта хранимая процедура создает график с помощью функции R, а затем сохраняет результат в виде локального файла PDF.|  
    |TrainTipPredictionModel.sql|Создает хранимую процедуру, которая обучает модель логистической регрессии, вызывая пакет R. Модель прогнозирует значение для столбца tipped и обучается на основе случайной выборки, содержащей 70 % данных. Выходными данными хранимой процедуры является обученная модель, которая сохраняется в таблице nyc_taxi_models.|  
  
3.  Войдите в экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] и указанного вами имени входа, чтобы убедиться в том, что в нем отображаются созданные база данных, таблицы, функции и хранимые процедуры.  
  
    ![rsql_devtut_BrowseTables](../../advanced-analytics/r-services/media/rsql-devtut-browsetables.PNG "rsql_devtut_BrowseTables")  
  
    > [!NOTE]  
    > Если объекты базы данных уже существуют, их нельзя создать еще раз.  
    >   
    > Если таблица уже существует, данные будут добавляться в нее, а не перезаписываться. Поэтому перед выполнением скрипта удалите все существующие объекты.  
  
## Следующий шаг  
[Шаг 3. Анализ и визуализация данных](../../advanced-analytics/r-services/step-3-explore-and-visualize-the-data-in-database-advanced-analytics-tutorial.md)  
  
## Предыдущий шаг  
[Шаг 1. Скачивание образца данных](../../advanced-analytics/r-services/step-1-download-the-sample-data-in-database-advanced-analytics-tutorial.md)  
  
## См. также:  
[Дополнительные аналитические функции в базе данных для разработчиков SQL (учебник)](../../advanced-analytics/r-services/in-database-advanced-analytics-for-sql-developers-tutorial.md)  
[Учебники по службам SQL Server R Services](../../advanced-analytics/r-services/sql-server-r-services-tutorials.md)  
  
  
  
