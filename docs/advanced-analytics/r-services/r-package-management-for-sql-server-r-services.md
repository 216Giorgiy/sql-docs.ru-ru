---
title: "Управление пакетами R для служб R Services SQL Server | Microsoft Docs"
ms.custom: ""
ms.date: "12/16/2016"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "R"
ms.assetid: 98c14b05-750e-44f9-8531-1298bf51e8d2
caps.latest.revision: 7
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 7
---
# Управление пакетами R для служб R Services SQL Server
Чтобы упростить управление пакетами R, выполняемыми в экземпляре SQL Server, пакет **RevoScaleR** теперь содержит функции для поддержки установки пакетов R и управления ими. 

Эта новая функциональность поддерживает несколько сценариев.

- Специалист по обработке данных может установить необходимые пакеты R в SQL Server без административного доступа к компьютеру с SQL Server. Пакеты устанавливаются отдельно для каждой базы данных.
- Пакеты удобно использовать совместно с другими пользователями. Достаточно создать локальный репозиторий пакетов и попросить специалистов по обработке данных установить пакеты для отдельных баз данных.
- Администратору баз данных не требуется изучать выполнение команд R или зависимости пакетов. Он использует роли базы данных для управления тем, каким пользователям SQL Server разрешено устанавливать, удалять или использовать пакеты.
 
**Принцип работы**

* Администратор баз данных отвечает за настройку ролей и добавление в них пользователей, чтобы контролировать, кто обладает разрешениями на добавление и удаление пакетов R в среде SQL Server.
* Если вы имеете разрешение на установку пакетов, запустите одну из функций управления пакетами из кода R и укажите контекст вычислений, где требуется добавить или удалить пакеты. Контекст вычислений может быть локальным компьютером или базой данных в экземпляре SQL Server. 
* Если вызов для установки пакетов выполняется в SQL Server, ваши учетные данные определяют возможность выполнения операции на сервере. 
- Функции установки пакета проверяют зависимости, чтобы убедиться, что в SQL Server можно установить все связанные пакеты, как и при установке пакета R в локальном контексте.
- Функция, которая удаляет пакеты, также вычисляет зависимости и гарантирует удаление пакетов, которые больше не используются другими пакетами в SQL Server, для освобождения ресурсов.
- Каждый специалист по обработке данных может установить закрытые пакеты, которые не видны другим пользователям, в результате чего он получает изолированную "песочницу" для работы с собственными пакетами R.
-  Поскольку пакеты могут задаваться для базы данных и каждый пользователь получает изолированную "песочницу" для пакетов в каждой базе данных, становится проще установить и использовать разные версии одного пакета R. 

> [!NOTE]
> Сейчас эта функция выпускается только для использования с [!INCLUDE[ssSQLv14_md](../../includes/sssqlv14-md.md)]. 

## <a name="database-roles-and-database-scoping"></a>Роли базы данных и определение области базы данных

Новые функции управления пакетами предоставляют две области для установки и использования пакетов в SQL Server для конкретной базы данных:

- **Общая область**

  *Общая область* означает, что пользователи с разрешением на роль общей области (**rpkgs-shared**) могут устанавливать и удалять пакеты в указанной базе данных. Пакет, установленный в библиотеке общей области, может использоваться другими пользователями базы данных в SQL Server при условии, что этим пользователям разрешено использовать установленные пакеты R. 

- **Закрытая область** 

  *Закрытая область* означает, что пользователи с членством в роли закрытой области (**rpkgs-private**) могут устанавливать и удалять пакеты в расположении закрытой библиотеки, определяемом отдельно для каждого пользователя. Таким образом, все пакеты, установленные в частной области, может использовать только пользователь, установивший их. Другими словами, пользователь в SQL Server не может использовать закрытые пакеты, установленные другим пользователем. 

Эти модели для *общей* и *закрытой* области можно совмещать, чтобы создать настраиваемые системы безопасности для развертывания пакетов в SQL Server и управления ими. 

Например, с помощью общей области руководителю группы специалистов по обработке данных можно предоставить разрешение на установку пакетов, после чего такие пакеты становятся доступны всем другим специалистам по обработке данных или пользователям, работающим в том же экземпляре SQL Server. 

В другом сценарии может потребоваться повышенный уровень изоляции пользователей или возможность использования разных версий пакетов. В этом случае с помощью закрытой области можно предоставить разрешения отдельным специалистам, которые будут отвечать за установку и использование нужных им пакетов. Поскольку пакеты устанавливаются на уровне пользователя, пакеты, установленные одним пользователем, не повлияют на работу других пользователей, работающих с той же базой данных SQL Server. 

### <a name="database-roles-for-package-management"></a>Роли базы данных для управления пакетами

Следующие новые роли базы данных поддерживают безопасную установку пакетов и управления ими в службах SQL R Services. 

- **rpkgs-users** позволяет пользователям использовать любые общие пакеты, установленные членами роли **rpkgs-shared**.

- **rpkgs-private** предоставляет доступ к общим пакетам с такими же разрешениями, как и роль **rpkgs-users**. Члены этой роли также могут устанавливать, удалять и использовать пакеты, относящиеся к частной области.

-  **rpkgs-shared** предоставляет такие же разрешения, как и роль **rpkgs-private**. Пользователи, являющиеся членами этой роли, также могут устанавливать и удалять общие пакеты. 
 
- **db_owner** имеет такие же разрешения, как и роль **rpkgs-shared**. Кроме того, позволяет предоставить пользователям право на установку или удаление как общих, так и закрытых пакетов.



## <a name="new-package-management-functions"></a>Новые функции управления пакетами


+ `rxInstalledPackages`: поиск сведений о пакетах, установленных в указанном контексте вычислений.

+ `rxInstallPackages`: установка пакетов в контексте вычислений из указанного репозитория или посредством считывания сжатых пакетов, сохраненных локально.

+ `rxRemovePackages`: удаление установленных пакетов из контекста вычислений.

+ `rxFindPackage`: получение пути для одного или нескольких пакетов в указанном контексте вычислений.

+ `rxSqlLibPaths`: получение пути поиска для деревьев библиотеки для пакетов во время выполнения внутри SQL Server.

## <a name="examples"></a>Примеры

### <a name="get-package-location-on-sql-server-compute-context"></a>Получение расположения пакета в контексте вычислений SQL Server

Этот пример возвращает путь для пакета **RevoScaleR** в контексте вычислений *sqlServer*.

  ```R
  sqlPackagePaths <- rxFindPackage(package = "RevoScaleR", computeContext = sqlServerL)
  ```
  
  ### <a name="get-locations-for-multiple-packages"></a>Получение расположений для нескольких пакетов

Этот пример возвращает пути для пакетов **RevoScaleR** и **lattice** в контексте вычислений *sqlServer*. При поиске сведений о нескольких пакетах передайте строковый вектор, содержащий имена пакетов.

  ```R
  packagePaths <- rxFindPackage(package = c("RevoScaleR", "lattice"), computeContext = sqlServer)
  ```



### <a name="list-packages-in-specified-compute-context"></a>Вывод списка пакетов в указанном контексте вычислений

Этот пример выводит на консоль список всех пакетов, установленных в контексте вычислений *sqlServer*.

  ```R
  myPackages <- rxInstalledPackages(computeContext = sqlServer) 
  myPackages
  ```

### <a name="get-package-versions"></a>Получение версий пакета

Этот пример возвращает номер сборки и номера версий для пакета, установленного в контексте вычислений *sqlServer*.

  ```R
  sqlPackages <- rxInstalledPackages(fields = c("Package", "Version", "Built"), computeContext = sqlServer) 
```

### <a name="install-a-package-on-sql-server"></a>Установка пакета в SQL Server

Этот пример устанавливает пакет **ggplot2** и его зависимости в контексте вычислений *sqlServer*.

  ```R
  pkgs <- c("ggplot2")
  rxInstallPackages(pkgs = pkgs, verbose = TRUE, scope = "private", computeContext = sqlServer)
  ```

### <a name="remove-a-package-from-sql-server"></a>Удаление пакета из SQL Server

Этот пример удаляет пакет **ggplot2** и его зависимости из контекста вычислений *sqlServer*.

  ```R
  pkgs <- c("ggplot2")
  rxRemovePackages(pkgs = pkgs, verbose = TRUE, scope = "private", computeContext = sqlServer)
  ```

## <a name="see-also"></a>См. также:

[Включение и отключение управления пакетами R](../../advanced-analytics/r-services/how-to-enable-or-disable-r-package-management.md)