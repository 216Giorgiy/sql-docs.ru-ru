---
title: "Определение и использование контекстов вычисления (глубокое погружение в обработку и анализ данных) | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
applies_to: 
  - "SQL Server 2016"
dev_langs: 
  - "R"
ms.assetid: b13058d0-9c6a-44e1-849b-72189d9050ba
caps.latest.revision: 17
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
---
# Определение и использование контекстов вычисления (глубокое погружение в обработку и анализ данных)
Вы решили, что некоторые более сложные вычисления должны выполняться на сервере, в не на локальном компьютере. Для этого необходимо создать контекст вычисления, позволяющий выполнять код на языке R на сервере.  
  
Функция [RxInSqlServer](https://msdn.microsoft.com/microsoft-r/scaler/rxinsqlserver) — это одна из расширенных функций R, входящих в состав пакета [RevoScaleR](https://msdn.microsoft.com/microsoft-r/scaler/scaler). Она отвечает за задачи создания подключения к базе данных и передачи объектов между локальным компьютером и удаленным контекстом выполнения.  
  
В этом шаге вы узнаете, как использовать функцию *RxInSqlServer* для определения контекста вычисления в своем коде R.  


  
## Создание и задание контекста вычисления  
Для создания контекста вычислений требуются следующие базовые сведения об экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]:  
  
-   строка подключения к экземпляру;  
-   спецификация способа обработки выходных данных;  
-   необязательные аргументы для включения трассировки или для указания общего каталога.


 Приступим.

1.  Укажите строку подключения к экземпляру, в котором будут производиться вычисления.  Это лишь одна из нескольких переменных, которые вы будете передавать в функцию *RxInSqlServer* для создания контекста вычислений. 

    **Использование имени для входа SQL**

      ```R
      sqlConnString <- "Driver=SQL Server;Server=<SQL Server instance name>; Database=<database name>;Uid=<SQL user name>;Pwd=<password>" 
      ```

    **Использование встроенной проверки подлинности Windows**

      ```R
      sqlConnString <- "Driver=SQL Server;Server=instance_name;Database=DeepDive;Trusted_Connection=True"" 
      ```
2.  Укажите способ обработки выходных данных. В следующем коде вы указываете, что сеанс R на рабочей станции всегда должен дожидаться результатов задания R, но не возвращать вывод с консоли от удаленных вычислений.  
  
    ```R  
    sqlWait <- TRUE   
    sqlConsoleOutput <- FALSE   
    ```  
  
    Аргумент *wait* функции *RxInSqlServer* может иметь перечисленные ниже значения.  
  
    -   **TRUE**. Задание будет блокироваться и не вернет результат, пока его выполнение не завершится успешно или с ошибкой.  Дополнительные сведения о заданиях блокировки и без блокировки см. в разделе 
  
    -   **FALSE**. Задания не будут блокироваться и будут возвращать результат немедленно, что позволит продолжать выполнять другой код на языке R. Однако даже в режиме без блокировки подключение клиента к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должно сохраняться, пока задание выполняется.  

3. При необходимости можно указать расположение локального каталога для совместного использования локальным сеансом R и удаленным компьютером [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и его учетными записями.
    
    ```R  
    sqlShareDir <- paste("c:\\AllShare\\", Sys.getenv("USERNAME"), sep="")   
    
    ## Add this line to create directory if it does not exist
    dir.create(sqlShareDir, recursive = TRUE) 
    ```  
    Рекомендуется использовать значение по умолчанию, а не указывать вручную папку для этого аргумента. Дополнительные сведения см. в [справочнике по ScaleR](https://msdn.microsoft.com/microsoft-r/scaler/rxinsqlserver).
    
    Если вы просто хотите узнать, какая папка используется, можно выполнить `rxGetComputeContext` для просмотра сведений о текущем контексте вычислений. 
  

4.  Подготовив все переменные, предоставьте их в качестве аргументов конструктору `RxInSqlServer`, чтобы определить объект контекста вычисления.  
  
    ```R  
    sqlCompute <- RxInSqlServer(  
         connectionString = sqlConnString,        
         #shareDir = sqlShareDir,       
         wait = sqlWait,   
         consoleOutput = sqlConsoleOutput)  
    ```  
  
    Можно заметить, что синтаксис *RxInSqlServer* почти идентичен синтаксису функции *RxSqlServerData*, которая ранее использовалась для определения источника данных. Однако есть несколько важных различий.  
  
    -   Объект источника данных, определенный с помощью функции *RxSqlServerData* указывает, где хранятся данные.  
  
    -   В свою очередь, контекст вычислений (определенный с помощью функции *RxInSqlServer*) указывает, где должно производиться агрегирование и другие вычисления.  
  
    Определение контекста вычислений не влияет на другие обычные вычисления R, которые могут выполняться на рабочей станции, и не изменяет источник данных. Например, можно определить в качестве источника данных локальный текстовый файл, но изменить контекст вычислений на SQL Server и выполнять все операции чтения и обобщения данных на компьютере SQL Server. 
  
## Включение трассировки в контексте вычислений  
Иногда в операциях, которые работают в локальном контексте, могут возникать проблемы при работе в определенном контексте удаленных вычислений. Если вы хотите анализировать проблемы или наблюдать за производительностью, можно включить трассировку в контексте вычислений для помощи при устранении неполадок во время выполнения.  
  
1. Создайте новый контекст вычислений, использующий ту же строку подключения, но добавьте аргументы *traceEnabled* и *traceLevel* в конструктор *RxInSqlServer*.  
  
    ```R  
    sqlComputeTrace <- RxInSqlServer(   
        connectionString = sqlConnString,        
        #shareDir = sqlShareDir,  
        wait = sqlWait,   
        consoleOutput = sqlConsoleOutput,       
        traceEnabled = TRUE,
        traceLevel = 7)  
    ```  
  
    В этом примере свойству *traceLevel* присваивается значение 7, что означает "показывать все данные трассировки".  

2. Для переключения в этот контекст вычислений в любое время используйте функцию *rxSetComputeContext* и указывайте контекст по имени.

    ```R  
    rxSetComputeContext( sqlComputeTrace)
    ```

    В этом учебнике мы будем использовать контекст вычислений, в котором трассировка не включена. Производительность при включенной трассировке не была проверена для всех операций, и ваша работа может отличаться в зависимости от сетевого подключения.  
  
Теперь, когда контекст удаленных вычислений создан, вы узнаете, как изменять контексты вычислений для запуска кода R на сервере или локально.  
  
## Следующий шаг  
[Занятие 2. Создание и выполнение скриптов R (глубокое погружение в обработку и анализ данных)](../../advanced-analytics/r-services/lesson-2-create-and-run-r-scripts-data-science-deep-dive.md)  
  
## Предыдущий шаг  
[Запрос и изменение данных SQL Server (глубокое погружение в обработку и анализ данных)](../../advanced-analytics/r-services/query-and-modify-the-sql-server-data-data-science-deep-dive.md)  
  
## См. также:  
[Глубокое погружение в обработку и анализ данных: использование пакетов RevoScaleR](../../advanced-analytics/r-services/data-science-deep-dive-using-the-revoscaler-packages.md)  
  
  
  
