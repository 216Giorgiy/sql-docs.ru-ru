---
title: "Новые компоненты SQL Server для поддержки служб R | Microsoft Docs"
ms.custom: ""
ms.date: "06/03/2016"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "r-services"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 54e9ef3f-1136-471e-865a-7cf013673186
caps.latest.revision: 9
author: "jeannt"
ms.author: "jeannt"
manager: "jhubbard"
caps.handback.revision: 9
---
# Новые компоненты SQL Server для поддержки служб R

[!INCLUDE[rsql_productname_md](../../includes/rsql-productname-md.md)] включает новые компоненты, предоставляемые [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] компонент database engine, поддержки расширяемости для языка R. Безопасность для этих компонентов осуществляется с помощью [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и будет подробно рассматриваться позднее.

## Новые компоненты SQL Server и поставщиков

Помимо оболочки, который загружает R и выполняет код R, как описано в обзор архитектуры [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] включает следующие дополнительные компоненты.

### **Панель запуска** 
   [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] — Это новая служба, предоставляемые [!INCLUDE[ssCurrent_md](../../includes/sscurrent-md.md)] для поддержки выполнения внешних скриптов, аналогично тому, как служба полнотекстового индексирования и выполнения запросов для обработки полнотекстовых запросов запускается отдельный узел. 
  
  Служба запуска будет запускаться только доверенным средства запуска, публикуются корпорацией Майкрософт или который был сертифицирован корпорацией Майкрософт как собрания требования к производительности и управления ресурсами. В [!INCLUDE[ssCurrent_md](../../includes/sscurrent-md.md)], R в данный момент только внешний язык, поддерживаемый [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)].
  
   [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] Служба выполняется под своей собственной учетной записи пользователя. Каждый процесс вспомогательные для конкретного языка среды выполнения будет наследовать учетной записи панели запуска. Дополнительные сведения о конфигурации и контекст безопасности панели запуска в разделе [Общие сведения о безопасности](../../advanced-analytics/r-services/security-overview-sql-server-r-services.md).

### **BxlServer и вспомогательных SQL**
  BxlServer является исполняемым, предоставленных корпорацией Майкрософт, который управляет связью между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и выполнения R, а также реализует функции проекционная. Он создает объекты заданий Windows содержат R сеансы, положения безопасности рабочих папок для каждого задания R и используемые вспомогательной SQL для управления передачей данных между R и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].  

  В результате BxlServer является дополнением к R, который работает с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] для поддержки интеграции R с SQL Server. BXL расшифровывается языка двоичных Exchange и ссылается на формат данных, используемый для эффективного перемещения данных между SQL Server и внешние процессы, такие как R. 

 Вспомогательная SQL представляет новый API расширяемости в SQL Server 2016, предоставляемые компонентом database engine поддерживает внешний код или внешней среды выполнения, реализованные с помощью C или C++. В настоящее время R является единственной поддерживаемой средой выполнения. BxlServer вспомогательные SQL использует для взаимодействия с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
 
  Вспомогательные SQL использует пользовательского формата данных, оптимизированный для передачи данных быстро между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и внешних языков сценариев. Он выполняет преобразования типов и определяет схемы наборов входных и выходных данных во время обмена данными между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и R.

  BxlServer использует вспомогательную SQL для выполнения следующих задач: 
  - Чтение входных данных
  - Запись выходных данных
  - Получение входных аргументов
  - Запись выходных данных аргументов
  - Обработка ошибок
  - Обратная запись STDOUT и STDERR для клиента

  Вспомогательные SQL можно отслеживать с помощью расширенных событий. Дополнительные сведения см. в разделе [расширенных событий для служб SQL Server R](../../advanced-analytics/r-services/extended-events-for-sql-server-r-services.md).


## Каналы связи между компонентами

+ **TCP/IP** по умолчанию внутренней связи между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и вспомогательных SQL используется протокол TCP/IP.

+ **Именованные каналы**

  Внутренние данные транспорта между BxlServer и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] через вспомогательные SQL использует формат собственности, сжатых данных для повышения производительности. Данные из памяти R BxlServer передаются по именованным каналам, в формате BXL. 
  
+ **ODBC** взаимодействие между клиентами обработки внешних данных и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] экземпляр использовать ODBC. Учетная запись, отправляет R задания в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] требуются оба разрешения для подключения к экземпляру и выполнения внешних сценариев. Кроме того учетная запись должна иметь разрешение на доступ к данным, используемый для задания, для записи данных (например, если сохранить результаты в таблицу) или для создания объектов базы данных (например, при сохранении функции R как часть новой хранимой процедуры).

  Когда [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] — используется контекст вычисления для задания R, отправленные с удаленного компьютера, а команда R должны получать данные из внешнего источника, ODBC используется для обратной записи. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] будет сопоставления идентификационной информации пользователя, выполняющего удаленной команды R для идентификации пользователя в текущем экземпляре и выполните команду ODBC, используя учетные данные пользователя. Строка подключения, необходимые для выполнения этого вызова ODBC получается из клиентского кода.
  
  Дополнительные вызовы ODBC можно вносить в сценарий с помощью **RODBC**. RODBC — это популярный пакет R, для доступа к данным в реляционных базах данных; Тем не менее, его производительность обычно медленнее, чем сравним поставщиков, используемых [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)]. Многие R-сценарии используют embedded вызовы RODBC как способ получения «вторичный» наборы данных для использования в анализе. Например хранимую процедуру, которая обучает модель может определить SQL-запрос для получения данных для обучения модели, но использовать внедренные RODBC вызов для получения дополнительных факторов, для выполнения операций поиска или для получения новых данных из внешних источников, таких как текстовые файлы или Excel.

  Следующий код иллюстрирует вызов RODBC, внедренных в R-сценарий:
   ~~~~
  library(RODBC);
  connStr <- paste("Driver=SQL Server;Server=", instance_name, ";Database=", database_name, ";Trusted_Connection=true;", sep="");
  dbhandle <- odbcDriverConnect(connStr)
  OutputDataSet <- sqlQuery(dbhandle, "select * from table_name");
  ~~~~

+ **Другие протоколы** можно также использовать процессы, которые может потребоваться работать в виде «фрагментов» или передачи данных удаленного клиента. XDF формат, поддерживаемый Microsoft R. фактическим перемещением данных осуществляется через кодировке больших двоичных объектов.

## Взаимодействие компонентов

Архитектура компонентов, которые только что описанной предоставляется для обеспечения работы R с открытым исходным кодом «как есть», тогда как предоставление существенно повышенную производительность для кода, выполняемого на [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] компьютере. Механизм как компоненты взаимодействуют со средой выполнения R и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] СУБД отличается, в зависимости от способа запуска кода R. В этом разделе описаны основные сценарии. 
 
### R-сценариев из SQL Server (в базы данных)

Код R, который запускается из «изнутри» [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] выполняется путем вызова хранимой процедуры. Таким образом любое приложение, которое можно сделать вызов хранимой процедуры может инициировать выполнение кода R.  После этого [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] управляет выполнением кода R, как показано на следующей схеме.

![rsql_indb780-01](../../advanced-analytics/r-services/media/rsql-indb780-01.png)

1. Запрос R в среде выполнения, указанный в параметре _@language = 'R'_ передается хранимой процедуре [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] отправляет этот запрос для запуска службы.
2. Служба запуска запускает соответствующий запуска; в данном случае RLauncher.
3. RLauncher запускает внешний процесс R.
4. Координаты BxlServer R времени выполнения для управления обмен данными с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и хранилище результатов работы.
5. Полное, вспомогательные SQL управляет взаимодействием связанные задачи и процессы с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
6. BxlServer использует вспомогательные SQL для передачи состояния и приводит к [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
7. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] Возвращает результаты и закрывает связанные задачи и процессы. 


### R скриптам, выполняемым с удаленного клиента

При подключении с клиента обработки удаленных данных, поддерживающего Microsoft R, могут запускать функции R в контексте [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] с помощью функции проекционная. Это является другой рабочий процесс из предыдущего и показан на следующей схеме.


![rsql_fromR2db-01](../../advanced-analytics/r-services/media/rsql-fromr2db-01.png)

1. Для функции проекционная R среда выполнения вызывает функцию связывания, которая в свою очередь вызывает BxlServer. 
2. BxlServer входит в состав Microsoft R и выполняется в отдельном процессе от R среды выполнения.
3. BxlServer определяет целевой объект соединения и инициирует подключение с использованием ODBC, передавая учетные данные, предоставленные как часть строки соединения в объекте источника данных R.
4. BxlServer открывает подключение к [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] экземпляра.
5. Для вызова R панели запуска при вызове службы, передаваемый в свою очередь запускает соответствующие средства запуска RLauncher. После этого обработки кода R аналогичен процессу для выполнения кода на R, T-SQL.
6. RLauncher вызывает экземпляр среды выполнения R, на котором установлен [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] компьютер. 
7. Результаты возвращаются в BxlServer.
8. Вспомогательные SQL управляет связью с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и очистки объектов связанных заданий.
9. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] передает результаты клиенту.

## См. также:
[Обзор архитектуры](../../advanced-analytics/r-services/architecture-overview-sql-server-r-services.md)
