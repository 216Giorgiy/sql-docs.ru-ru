---
title: Установка SQL Server 2017 службы машинного обучения (в базе данных) в Windows | Документация Майкрософт
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: b2c699a76d0a24bade258109fcee40e9e1f39a7d
ms.sourcegitcommit: 2f07d285824a8982c279f3816b220e61a2d91b06
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2018
ms.locfileid: "37093328"
---
# <a name="install-sql-server-2017-machine-learning-services-in-database-on-windows"></a>Установка SQL Server 2017 службы машинного обучения (в базе данных) на Windows 
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Компонент службы машинного обучения SQL Server добавляет прогнозной аналитики в базе данных, статистический анализ, визуализацию и алгоритмов машинного обучения. Библиотеки функций в R и Python и запуск от имени внешних скриптов на экземпляр ядра СУБД. 

В этой статье объясняется, как установить компонент машины обучения, выполнив [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] мастер установки и следующие инструкциям на экране.

## <a name="bkmk_prereqs"> </a> Контрольный список перед установкой

+ Программа установки SQL Server 2017 является обязательным, если вы хотите установить службы машинного обучения с поддержкой языка R и Python. Если вместо этого у вас есть установочный носитель SQL Server 2016, можно установить [SQL Server 2016 R Services (в базе данных)](sql-r-services-windows-install.md) для получения поддержка языка R.

+ Экземпляр ядра СУБД является обязательным. Невозможно установить только R или Python компоненты, несмотря на то, что их можно добавить постепенно в существующий экземпляр.

+ Не устанавливайте службы машинного обучения в отказоустойчивом кластере. Механизм безопасности, используемый для изолирования процессов R и Python не совместим с среде отказоустойчивого кластера Windows Server.

+ Не устанавливайте службы машинного обучения на контроллере домена. Службы машинного обучения часть установки завершится ошибкой.

+ Не устанавливайте **общие компоненты** > **сервера машинного обучения (изолированного)** на одном компьютере, где запущен экземпляр в базе данных. Автономный сервер будут конкурировать за те же ресурсы, ставя под угрозу производительность обеих установок.

+ Установка Side-by-side с другими версиями R и Python поддерживается, но не рекомендуется. Он поддерживается, так как экземпляр SQL Server использует своими собственными копиями открытым исходным кодом R и Anaconda распределений. Но не рекомендуется, так как код, который использует R и Python на компьютере SQL Server за пределами SQL Server может привести к различным проблемам:
    
  + Используется другая библиотека и другой исполняемый файл и получить разные результаты, чем при выполнении в SQL Server.
  + Скрипты R и Python, выполняющиеся на внешние библиотеки не могут управляться SQL Server, что приводит к конкуренции ресурсов.
  
> [!IMPORTANT]
> После завершения установки, обязательно выполните действия после конфигурации, описанные в этой статье. Эти шаги включают Включение SQL Server для использования внешних скриптов и добавление учетных записей, требуемых для SQL Server для выполнения заданий R и Python от вашего имени. Изменения конфигурации обычно требуют перезапуска данного экземпляра или перезапуск службы панели запуска.

## <a name="get-the-installation-media"></a>Получение установочного носителя

[!INCLUDE[GetInstallationMedia](../../includes/getssmedia.md)]

## <a name="run-setup"></a>Запуск программы установки

Для локальных установок необходимо запускать программу установки с правами администратора. При установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из удаленной общей папки необходимо использовать учетную запись домена с разрешениями на чтение и выполнение для удаленной общей папки.

1. Запустите мастер установки SQL Server 2017. Вы можете скачать 
  
2. На **установки** выберите **автономная установка нового SQL Server или добавление компонентов к существующей установке**.

   ![Установка служб в базе данных в машинном обучении](media/2017setup-installation-page-mlsvcs.PNG)
   
3. На странице **Выбор компонентов** выберите следующие компоненты:
  
    -   **Службы ядра СУБД**
  
         Чтобы использовать R и Python с SQL Server, необходимо установить экземпляр компонента database engine. Можно использовать значение по умолчанию или именованным экземпляром.
  
    -   **Службы машинного обучения (в базе данных)**
  
         Этот параметр устанавливает службы базы данных, которые поддерживают R и Python запуск сценария.

    -   **R**

        Установите этот флажок, чтобы добавить пакеты Microsoft R, интерпретатор и открытым исходным кодом R. 

    -   **Python**

        Установите этот флажок для добавления пакетов Microsoft Python, исполняемый файл Python 3.5 и выберите библиотеки дистрибутив Anaconda.
        
        ![Компонентов, R и Python](media/2017setup-features-page-mls-rpy.png "параметры установки для Python")

        > [!NOTE]
        > 
        > Не устанавливайте параметр для **сервера машинного обучения (изолированного)**. Возможность установки сервера машинного обучения в разделе **общие компоненты** предназначен для использования на отдельном компьютере.

4. На **согласие на установить R** выберите **Accept**. Лицензионное соглашение для ознакомления охватывает Microsoft R Open, который включает в себя дистрибутив базовых пакетов R с открытым кодом и средства, а также улучшенные пакеты R и поставщиков услуг подключения от команды разработчиков Microsoft.

5. На **согласие на установке Python** выберите **Accept**. Соглашение о лицензировании открытым исходным кодом Python также рассматривается Anaconda и связанные инструменты, а также некоторые новые библиотеки Python, от команды разработчиков Microsoft.
     
     ![Соглашения для лицензии Python](media/2017setup-python-license.png "лицензионное соглашение для Python")
  
    > [!NOTE]
    >  Если вы используете компьютер имеет доступ к Интернету, вы можете приостановить установку на этом этапе, чтобы скачать установщики отдельно. Дополнительные сведения см. в разделе [Установка компонентов машинного обучения без доступа к Интернету](../install/sql-ml-component-install-without-internet-access.md).
  
     Выберите **Accept**, подождите, пока **Далее** кнопка становится активной, а затем выберите **Далее**.
  
6. На **все готово для установки** странице, убедитесь, что эти параметры включены и выберите **установить**.
  
    + Службы ядра СУБД
    + Службы машинного обучения (в базе данных)
    + R или Python или оба

    Запишите расположение папки по пути `..\Setup Bootstrap\Log` где хранятся файлы конфигурации. По завершении установки можно просмотреть в файле сводки установленных компонентов.

## <a name="restart-the-service"></a>Перезапустите службу.

По завершении установки перезапустите компонент database engine, прежде чем переходить к следующему, Включение выполнения скрипта.

Я также автоматически при перезапуске связанный [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

Вы можете перезапустить службу, используя пункт контекстного меню **перезапустите** команду для экземпляра в среде SSMS или с помощью **служб** панели на панели управления или с помощью [диспетчер конфигурации SQL Server ](../../relational-databases/sql-server-configuration-manager.md).

## <a name="bkmk_enableFeature"></a>Включить выполнение внешних скриптов

1. Откройте среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. 

    > [!TIP]
    > Можно загрузить и установить соответствующую версию на этой странице: [скачать SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).
    > 
    > Можно также попробовать предварительную версию [SQL Operations Studio](https://docs.microsoft.com/sql/sql-operations-studio/what-is), который поддерживает административных задач и запросов к SQL Server.
  
2. Подключитесь к экземпляру, где установлены службы машинного обучения, щелкните **новый запрос** откройте окно запроса и выполните следующую команду:

   ```SQL
   sp_configure
   ```

    На данном этапе значение для свойства `external scripts enabled` должно быть **0**. Том, что эта функция отключена по умолчанию. Эту функцию необходимо явно включить администратор, перед запуском сценариев R или Python.
    
3.  Чтобы включить внешние средства написания сценариев, выполните следующую инструкцию:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled', 1
    RECONFIGURE WITH OVERRIDE
    ```
    
    Если вы уже включили функцию для языка R, не запускайте перенастроить во второй раз для Python. Базовая платформа расширяемости поддерживает оба языка.

4. Перезапустите службу SQL Server для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Перезапуск службы SQL Server автоматически перезапускает связанный [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

    Вы можете перезапустить службу, используя пункт контекстного меню **перезапустите** команду для экземпляра в среде SSMS или с помощью **служб** панели на панели управления или с помощью [диспетчер конфигурации SQL Server ](../../relational-databases/sql-server-configuration-manager.md).

## <a name="verify-installation"></a>Проверка установки

Следуйте инструкциям ниже, чтобы убедиться, что запущены все компоненты, используемые для запуска внешнего скрипта.

1. В SQL Server Management Studio откройте новое окно запроса и выполните следующую команду:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled'
    ```

    Задайте для **run_value** значение 1.
    
2. Откройте **служб** панели или диспетчер конфигурации SQL Server и проверьте **службы панели запуска SQL Server** выполняется. Вы должны иметь одну службу для каждого экземпляра ядра базы данных с R или Python устанавливается. Перезапустите службу, если не выполняется. Дополнительные сведения см. в разделе [компоненты для поддержки интеграции Python](../python/new-components-in-sql-server-to-support-python-integration.md). 
   
3. Если панель запуска работает, вы сможете выполнить простые скрипты R и Python, чтобы убедиться, что внешних сред выполнения сценариев может взаимодействовать с SQL Server.

   Откройте новую **запроса** окно в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем запустите следующий сценарий:
    
    + Для R
    
    ```SQL
    EXEC sp_execute_external_script  @language =N'R',
    @script=N'
    OutputDataSet <- InputDataSet;
    ',
    @input_data_1 =N'SELECT 1 AS hello'
    WITH RESULT SETS (([hello] int not null));
    GO
    ```

    + Для Python
    
    ```SQL
    EXEC sp_execute_external_script  @language =N'Python',
    @script=N'
    OutputDataSet = InputDataSet;
    ',
    @input_data_1 =N'SELECT 1 AS hello'
    WITH RESULT SETS (([hello] int not null));
    GO
    ```

 **Результаты**

    Скрипта может занять немного, пока для запуска в первый раз загружена среда выполнения внешнего скрипта. Результаты должны выглядеть следующим образом:

    | hello |
    |----|
    | 1|


> [!NOTE]
> Столбцы или заголовки, используемые в скрипте Python не возвращаются, намеренно. Чтобы добавить имена столбцов для выходных данных, необходимо указать схему для возврата набора данных. Сделать с помощью параметра WITH RESULTS хранимой процедуры, имен столбцов и указания типа данных SQL.
> 
> Например можно добавить следующую строку для создания произвольных столбец имени: `WITH RESULT SETS ((Col1 AS int))`

## <a name="additional-configuration"></a>Дополнительная настройка

При успешном выполнении шага проверки внешнего скрипта Python команды запускаются из SQL Server Management Studio, Visual Studio Code или любой другой клиент, который может отправлять инструкции T-SQL server.

Если вы получили ошибку при выполнении команды, просмотрите дополнительные шаги настройки в этом разделе. Может потребоваться внести дополнительные соответствующие конфигурации службы или базы данных.

Наиболее распространенные сценарии, которые требуют дополнительных изменений:

* [Настройка брандмауэра Windows для входящих подключений](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)
* [Включить дополнительные сетевые протоколы](../../database-engine/configure-windows/enable-or-disable-a-server-network-protocol.md)
* [Включение удаленных подключений](../../database-engine/configure-windows/configure-the-remote-access-server-configuration-option.md)
* [Расширить встроенные разрешения для удаленных пользователей](#bkmk_configureAccounts)
* [Предоставлены разрешения на выполнение внешних скриптов](#permissions-external-script)
* [Предоставление доступа к отдельным базам данных](#permissions-db)

> [!NOTE]
> Требуются не все перечисленные изменения и не могут быть необходимы. Требования зависят от схемы безопасности, где установлен SQL Server, а также как ожидается, что пользователи для подключения к базе данных и выполнения внешних скриптов. Дополнительные советы по устранению неполадок можно найти здесь: [вопросы и ответы по обновлению и установке](../r/upgrade-and-installation-faq-sql-server-r-services.md)

###  <a name="bkmk_configureAccounts"></a> Включить неявную проверку подлинности для учетной записи группы панели запуска

В процессе установки создается ряд учетных записей пользователей Windows в целях выполнения задач с токеном безопасности службы [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)]. Когда пользователь отправляет скрипт Python или R из внешнего клиента, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] активирует доступную рабочую учетную запись. Затем он сопоставляет его с удостоверением вызывающего пользователя и запускает сценарий от имени пользователя.

Это называется *неявной проверки подлинности*, и — это служба компонента database engine. Эта служба обеспечивает безопасное выполнение внешних скриптов в SQL Server 2016 и SQL Server 2017.

Учетные записи можно просмотреть в группе пользователей Windows **SQLRUserGroup**. По умолчанию создаются 20 рабочих учетных записей, которое обычно является более чем достаточно для выполнения внешних скриптов заданий.

> [!IMPORTANT]
> Группа рабочих называется **SQLRUserGroup** независимо от установки R или Python. Имеется одну группу для каждого экземпляра.

Если вам нужно выполнять скрипты из удаленного клиента обработки и анализа, а при использовании проверки подлинности Windows, существует ряд дополнительных рекомендаций. Этим рабочим учетным записям необходимо предоставить разрешение для входа в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляр от вашего имени.

1. В [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], в обозревателе объектов, разверните **безопасности**. Щелкните правой кнопкой мыши **имена входа**и выберите **новое имя входа**.
2. В **Создание имени входа** выберите **поиска**.
3. Выберите **типы объектов**и выберите **группы**. Очистите все остальное.
4. В **введите имена выбираемых объектов**, тип *SQLRUserGroup*и выберите **проверить имена**.
5. Имя локальной группы, связанной со службой панели запуска экземпляра, должно разрешиться в *имя_экземпляра\SQLRUserGroup*. Нажмите кнопку **ОК**.
6. По умолчанию назначается группе **открытый** роли, и имеет разрешение на подключение к компоненту database engine.
7. Нажмите кнопку **ОК**.

> [!NOTE]
> Если вы используете **имя входа SQL** выполнить скрипты в контексте вычислений SQL Server, это дополнительное действие не требуется.

### <a name="permissions-external-script"></a> Предоставление пользователям разрешения для выполнения внешних скриптов

Если вы установили [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] самостоятельно, а также при выполнении сценариев R или Python в собственном экземпляре, обычно выполнение скриптов с правами администратора. Таким образом имеется неявное разрешение совершение различных операций и все данные в базе данных.

Большинство пользователей, тем не менее, не имеют таких повышенных прав. Например пользователям в организации, использующим имена входа SQL для доступа к базе данных, как правило, нет повышенным уровнем разрешений. Таким образом для каждого пользователя, используя R или Python, необходимо предоставить пользователям служб машинного обучения разрешение для выполнения внешних скриптов в каждой базе данных, в которых используется язык. Вот как:

```SQL
USE <database_name>
GO
GRANT EXECUTE ANY EXTERNAL SCRIPT  TO [UserName]
```

> [!NOTE]
> Разрешения не относятся к поддерживаемый язык скриптов. Другими словами не отдельных уровней разрешений для скрипта R и сценарий Python. Если вам нужно поддерживать отдельные разрешения для этих языков, установите R и Python на отдельных экземплярах.

### <a name="permissions-db"></a> Предоставить пользователей чтения, записи или управляющего языка DDL разрешения для баз данных

Хотя пользователь запускает скрипты, пользователю может потребоваться считывать данные из других баз данных. Пользователь также может потребоваться создание новых таблиц для хранения результатов и записывать данные в таблицы.

Для каждой учетной записи пользователя Windows или имя входа SQL, на котором выполняется сценариев R или Python, убедитесь в наличии соответствующих разрешений на базу данных: `db_datareader`, `db_datawriter`, или `db_ddladmin`.

Например, следующая [!INCLUDE[tsql](../../includes/tsql-md.md)] инструкция предоставляет имя входа SQL *MySQLLogin* права на запуск запросов T-SQL *ML_Samples* базы данных. Для выполнения этой инструкции имя входа SQL уже должно существовать в контексте безопасности сервера.

```SQL
USE ML_Samples
GO
EXEC sp_addrolemember 'db_datareader', 'MySQLLogin'
```

Дополнительные сведения о разрешениях, включенных в каждой роли, см. в разделе [роли уровня базы данных](../../relational-databases/security/authentication-access/database-level-roles.md).


### <a name="create-an-odbc-data-source-for-the-instance-on-your-data-science-client"></a>Создание источника данных ODBC для экземпляра в клиенте обработки и анализа данных

Можно создать решение машинного обучения на клиентском компьютере обработки и анализа данных. Если вам нужно выполнять код, используя имя компьютера SQL Server в качестве контекста вычисления, у вас есть два варианта: доступ к экземпляру с помощью имени входа SQL или с помощью Windows учетной записи.

+ Для имен входа SQL: Убедитесь, что имя входа имеет соответствующие разрешения в базе данных, где выполняются операции чтения данных. Это можно сделать, добавив *подключиться к* и *ВЫБЕРИТЕ* разрешения, либо путем добавления имени входа `db_datareader` роли. Для создания объектов, присвойте `DDL_admin` права. Если необходимо сохранять данные в таблицах, добавить `db_datawriter` роли.

+ Для проверки подлинности Windows: может потребоваться создать источник данных ODBC на клиенте обработки и анализа данных, который указывает имя экземпляра и другие сведения о подключении. Дополнительные сведения см. в разделе [администратор источников данных ODBC](https://docs.microsoft.com/sql/odbc/admin/odbc-data-source-administrator).

## <a name="suggested-optimizations"></a>Предлагаемые оптимизации

Теперь, когда у вас есть все, что работа, может также потребоваться оптимизация сервера для поддержки машинного обучения или установки обученная моделей.

### <a name="add-more-worker-accounts"></a>Добавить дополнительные рабочие учетные записи

Если ожидается, что многие пользователи выполняться скрипты, одновременно, можно увеличить количество рабочих учетных записей, назначенных службе панели запуска. Дополнительные сведения см. в разделе [изменение пула учетных записей пользователей для службы машинного обучения SQL Server](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

### <a name="optimize-the-server-for-script-execution"></a>Оптимизация сервера для выполнения сценариев

Параметры по умолчанию для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] установки предназначены для оптимизации баланса сервера для различных служб, которые поддерживаются компонентом database engine, которая может включать извлечения, преобразования и загрузки (ETL) процессов, отчетов, аудита, и приложения, использующие [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] данных. Таким образом параметры по умолчанию, может оказаться, что ресурсы для машинного обучения быть ограничены или регулироваться, особенно в случае операции с интенсивным использованием памяти.

Чтобы убедиться, что заданий машинного обучения приоритеты и выделялись необходимые ресурсы в соответствующим образом, мы рекомендуем использовать для настройки внешнего пула ресурсов регулятора ресурсов SQL Server. Можно также изменить объем памяти, выделяемый для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] компонент database engine, либо увеличить количество учетных записей, которые работают под [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

- Чтобы настроить пул ресурсов для управления внешними ресурсами, см. в разделе [создания пула внешних ресурсов](../../t-sql/statements/create-external-resource-pool-transact-sql.md).
  
- Чтобы изменить объем памяти, зарезервированной для базы данных, см. в разделе [параметры конфигурации памяти сервера](../../database-engine/configure-windows/server-memory-server-configuration-options.md).
  
- Чтобы изменить количество учетных записей R, которые можно запустить, [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)], см. в разделе [изменение пула учетных записей пользователей для машинного обучения](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

Если вы используете Standard Edition и нет регулятора ресурсов, можно использовать динамические административные представления (DMV) и расширенных событий, а также события Windows, мониторинг, чтобы обеспечить управление ресурсами сервера. Дополнительные сведения см. в разделе [мониторинг и управление службами R](../r/managing-and-monitoring-r-solutions.md) и [мониторинг и управление службами Python](../python/managing-and-monitoring-python-solutions.md).

### <a name="install-additional-r-packages"></a>Установка дополнительных пакетов R

Решения R, созданные для SQL Server можно вызвать базовых функций R, функции из packes properietary, устанавливается вместе с SQL Server, а также сторонние пакеты R, несовместима с версией R с открытым кодом устанавливается SQL Server.

Пакеты, которыми вы хотите пользоваться из SQL Server, должны быть установлены в библиотеке по умолчанию, используемой экземпляром. Если у вас есть отдельная Установка R на компьютере, или если вы установили пакеты в библиотеки пользователей, нельзя будет использовать эти пакеты с T-SQL.

Процесс установки и управления пакетами R отличается в SQL Server 2016 и SQL Server 2017. В SQL Server 2016 администратор базы данных необходимо установить пакеты R, необходимые пользователям. В SQL Server 2017 можно настроить группы пользователей для совместного использования пакетов на уровне базы данных, или настроить роли базы данных, чтобы пользователи могли устанавливать собственные пакеты. Дополнительные сведения см. в разделе [Установка новых пакетов R в SQL Server](../r/install-additional-r-packages-on-sql-server.md).


## <a name="get-help"></a>Получить справку

Нужна помощь с установку или обновление? Ответы на часто задаваемые вопросы и известные проблемы обратитесь к следующей статье:

* [Обновление и установка часто задаваемые вопросы – службы машинного обучения](../r/upgrade-and-installation-faq-sql-server-r-services.md)

Чтобы проверить состояние установки экземпляра и исправлять распространенные проблемы, используйте эти пользовательские отчеты.

* [Пользовательские отчеты для служб R SQL Server](../r/monitor-r-services-using-custom-reports-in-management-studio.md)

## <a name="next-steps"></a>Следующие шаги

Разработчики R можно приступить к работе с простыми примерами и ознакомиться с основами как R работает с SQL Server. Следующий шаг см. следующие ссылки:

+ [Руководство: Запуск R в T-SQL](../tutorials/rtsql-using-r-code-in-transact-sql-quickstart.md)
+ [Учебник: Анализ в базе данных для разработчиков R](../tutorials/sqldev-in-database-r-for-sql-developers.md)

Разработчики Python рассказывается, как использовать Python с SQL Server с помощью этих учебных материалов:

+ [Руководство: Запуск Python в T-SQL](../tutorials/run-python-using-t-sql.md)
+ [Учебник: Анализ в базе данных для разработчиков Python](../tutorials/sqldev-in-database-python-for-sql-developers.md)

Чтобы просмотреть примеры машинного обучения, которые основаны на реальных сценариев, см. в разделе [машинного обучения учебники](../tutorials/machine-learning-services-tutorials.md).
