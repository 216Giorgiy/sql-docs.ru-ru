---
title: Установка SQL Server 2017 г. машинного самообучения, службы (в базе данных) в Windows | Документы Microsoft
ms.custom: ''
ms.date: 03/20/2018
ms.reviewer: ''
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: python
ms.technology: ''
ms.tgt_pltfrm: ''
ms.topic: article
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.workload: On Demand
ms.openlocfilehash: a620e7ede1976fbbc50c0c81a595f002410403c8
ms.sourcegitcommit: 2e130e9f3ce8a7ffe373d7fba8b09e937c216386
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="install-sql-server-2017-machine-learning-services-in-database-on-windows"></a>Установка SQL Server 2017 г. машинного самообучения, службы (в базе данных) в Windows 
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Компонент службы обучения машины SQL Server добавляет прогнозирующего анализа в базе данных, статистического анализа, визуализации и алгоритмов машинного обучения. Функции библиотеки доступны в R и Python и запуск от имени внешних скриптов на экземпляр ядра СУБД. 

В этой статье объясняется, как установить компонент обучения машины, выполнив [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] мастер установки, а ниже инструкциям.

## <a name="bkmk_prereqs"> </a> Контрольный список действий перед установкой

+ Программа установки SQL Server 2017 г. является обязательным, если вы хотите установить службы обучения компьютера с поддержкой языка R, Python или оба. Если вместо этого установочного носителя SQL Server 2016, можно установить [служб R SQL Server 2016 (в базе данных)](sql-r-services-windows-install.md) для получения поддержки языка R.

+ Требуется экземпляр ядра СУБД. Не удается установить только R или функций Python, хотя их можно добавить постепенно в существующий экземпляр.

+ Не устанавливайте службы обучения машины в отказоустойчивом кластере. Механизм безопасности, используемый для изоляции процессов R и Python не совместим с среде отказоустойчивого кластера Windows Server.

+ Не устанавливайте службы обучения машины контроллера домена. Службы обучения машины часть установки завершится ошибкой.

+ Не устанавливайте **общие компоненты** > **машины обучения Server (изолированный)** на том же компьютере, где запущен экземпляр в базе данных. Изолированный сервер будут конкурировать за те же ресурсы, нарушая работу производительность обеих установок.

+ Параллельную установку с другими версиями R и Python поддерживается, но не рекомендуется. Он поддерживается, так как экземпляр SQL Server использует своими собственными копиями с открытым исходным кодом R и Anaconda распределений. Однако не рекомендуется, так как выполнение кода, который использует Python и R на компьютере SQL Server за пределами SQL Server может привести к различным проблемам:
    
  + Можно использовать различные библиотеки и другой исполняемый файл и получить разные результаты, чем при выполнении в SQL Server.
  + SQL Server, что приведет к конфликтам ресурсов не может управляться Python и R-скриптов, запускаемых во внешних библиотеках.
  
> [!IMPORTANT]
> После завершения установки убедитесь, что для завершения настройки действия, описанные в этой статье. Эти действия включают Включение SQL Server для использования внешних скриптов и добавление учетных записей, требуемых для SQL Server для выполнения заданий R и Python от вашего имени. Изменения конфигурации обычно требуют перезапуска экземпляра или перезапуск службы панели запуска.

## <a name="get-the-installation-media"></a>Получение установочного носителя

[!INCLUDE[GetInstallationMedia](../../includes/getssmedia.md)]

## <a name="run-setup"></a>Запуск программы установки

Для локальных установок необходимо запускать программу установки с правами администратора. При установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из удаленной общей папки необходимо использовать учетную запись домена с разрешениями на чтение и выполнение для удаленной общей папки.

1. Запустите мастер установки для 2017 г. SQL Server. Вы можете загрузить 
  
2. На **установки** выберите **автономная установка нового SQL Server или добавление компонентов к существующей установке**.

   ![Установка машинного обучения службы в базе данных](media/2017setup-installation-page-mlsvcs.PNG)
   
3. На странице **Выбор компонентов** выберите следующие компоненты:
  
    -   **Службы ядра СУБД**
  
         Чтобы использовать R и Python с SQL Server, необходимо установить экземпляр компонента database engine. Можно использовать значение по умолчанию или именованный экземпляр.
  
    -   **Службы машинного обучения (в базе данных)**
  
         Этот параметр устанавливает службы базы данных, которые поддерживают R и выполнения сценария Python.

    -   **R**

        Проверьте этот параметр, чтобы добавить пакеты Microsoft R, интерпретатор и открытым кодом R. 

    -   **Python**

        Выберите этот параметр, чтобы добавить пакеты Microsoft Python, Python 3.5 исполняемого файла и выберите дистрибутив Anaconda библиотеки.
        
        ![Функция параметров R и Python](media/2017setup-features-page-mls-rpy.png "параметры установки для Python")

        > [!NOTE]
        > 
        > Не устанавливайте флажок для **машины обучения Server (изолированный)**. Возможность установки сервера обучения Machine в разделе **Общие средства** предназначен для использования на отдельном компьютере.

4. На **согласия для установки R** выберите **Accept**. Лицензионное соглашение для ознакомления охватывает Microsoft R Open, включая распространения базовых пакетов R с открытым исходным и средств, а также улучшенные пакеты R и поставщиков услуг подключения от команды разработчиков Microsoft.

5. На **согласия для установки Python** выберите **Accept**. Соглашение о лицензировании открытым исходным кодом Python, а также описание Anaconda и связанные средства, а также некоторые новые библиотеки Python от команды разработчиков Microsoft.
     
     ![Соглашение для лицензии Python](media/2017setup-python-license.png "лицензионное соглашение для Python")
  
    > [!NOTE]
    >  Если компьютер, на котором вы используете не имеет доступа к Интернету, вы можете приостановить программу установки на этом этапе для установщики скачать отдельно. Дополнительные сведения см. в разделе [установить компоненты обучения компьютер без доступа к Интернету](../install/sql-ml-component-install-without-internet-access.md).
  
     Выберите **Accept**, подождите, пока **Далее** кнопка становится активной, а затем выберите **Далее**.
  
6. На **все готово для установки** убедитесь, что эти параметры включены и выберите **установить**.
  
    + Службы ядра СУБД
    + Службы машинного обучения (в базе данных)
    + R Python и/или

    Запишите расположение папки по пути `..\Setup Bootstrap\Log` хранения файлов конфигурации. После завершения установки можно просмотреть установленные компоненты в файл сводки.

## <a name="restart-the-service"></a>Перезапустите службу.

По завершении установки перезапустите компонент database engine, прежде чем переходить к другому, Включение выполнения скрипта.

Я также автоматически при перезапуске связанный [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

Можно перезапустить службу при помощи правой кнопкой мыши **перезапустите** команды для экземпляра в среде SSMS или с помощью **службы** панели на панели управления или с помощью [диспетчер конфигурации SQL Server ](../../relational-databases/sql-server-configuration-manager.md).

## <a name="bkmk_enableFeature"></a>Разрешить выполнение внешних скриптов

1. Откройте среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. 

    > [!TIP]
    > Можно загрузить и установить соответствующую версию на этой странице: [загрузить SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).
    > 
    > Также можно попробовать предварительный выпуск [операций SQL Studio](https://docs.microsoft.com/sql/sql-operations-studio/what-is), который поддерживает административные задачи и запросы к SQL Server.
  
2. Подключитесь к экземпляру, в которой установлены службы обучения для компьютера, нажмите кнопку **новый запрос** откройте окно запроса и выполните следующую команду:

   ```SQL
   sp_configure
   ```

    На данном этапе значение для свойства `external scripts enabled` должно быть **0**. Это, так как функция отключена по умолчанию. Компонент должны явно включены администратором, прежде чем вы сможете выполнять сценарии R или Python.
    
3.  Чтобы включить внешние средства написания сценариев, выполните следующую инструкцию:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled', 1
    RECONFIGURE WITH OVERRIDE
    ```
    
    Если был включен компонент для языка R, не запускайте перенастроить еще раз для Python. Базовая платформа расширяемости поддерживает оба языка.

4. Перезапустите службу SQL Server для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Перезапуск службы SQL Server автоматически перезапускает связанный [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

    Можно перезапустить службу при помощи правой кнопкой мыши **перезапустите** команды для экземпляра в среде SSMS или с помощью **службы** панели на панели управления или с помощью [диспетчер конфигурации SQL Server ](../../relational-databases/sql-server-configuration-manager.md).

## <a name="verify-installation"></a>Проверка установки

Чтобы убедиться, что запущены все компоненты, используемые для запуска внешнего сценария, выполните следующие действия.

1. В SQL Server Management Studio откройте новое окно запроса и выполните следующую команду:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled'
    ```

    Задайте для **run_value** значение 1.
    
2. Откройте **служб** панели или диспетчер конфигурации SQL Server и проверьте **службы панели запуска SQL Server** выполняется. Следует установить одну службу для каждого экземпляра ядра базы данных, имеющего R или Python. Если не запущена, перезапустите службу. Дополнительные сведения см. в разделе [компоненты для поддержки интеграции Python](../python/new-components-in-sql-server-to-support-python-integration.md). 
   
3. Если выполняется панели запуска, можно будет выполнять простые сценарии R и Python, чтобы убедиться, что внешних сред выполнения сценариев может обмениваться данными с SQL Server.

   Откройте новый **запроса** окна в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем запустите скрипт примерно следующего вида:
    
    + Для R
    
    ```SQL
    EXEC sp_execute_external_script  @language =N'R',
    @script=N'
    OutputDataSet <- InputDataSet;
    ',
    @input_data_1 =N'SELECT 1 AS hello'
    WITH RESULT SETS (([hello] int not null));
    GO
    ```

    + Для Python
    
    ```SQL
    EXEC sp_execute_external_script  @language =N'Python',
    @script=N'
    OutputDataSet = InputDataSet;
    ',
    @input_data_1 =N'SELECT 1 AS hello'
    WITH RESULT SETS (([hello] int not null));
    GO
    ```

 **Результаты**

    Скрипт может занять несколько, для запуска в первый раз загружается среда выполнения внешнего сценария. Результаты должны выглядеть следующим образом:

    | hello |
    |----|
    | 1|


> [!NOTE]
> Столбцы или заголовки, используемые в скрипте, Python не возвращаются, намеренно. Чтобы добавить имена столбцов для получения выходных данных, необходимо указать схему для возврата набора данных. Сделать это с помощью параметра с РЕЗУЛЬТАТОВ хранимой процедуры, имен столбцов и указать тип данных SQL.
> 
> Например можно добавить следующую строку, чтобы создать имя произвольного столбца: `WITH RESULT SETS ((Col1 AS int))`

## <a name="additional-configuration"></a>Дополнительная настройка

При успешном выполнении шага проверки внешнего сценария Python команды запускаются из SQL Server Management Studio, Visual Studio Code или любым другим клиентом, можно отправить инструкции T-SQL на сервере.

Если при выполнении команды произошла ошибка, просмотрите дополнительные шаги настройки в этом разделе. Может потребоваться указать дополнительные соответствующие параметры конфигурации для службы или базы данных.

Наиболее распространенные сценарии, которые требуют дополнительных изменений:

* [Настройка брандмауэра Windows для входящих подключений](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)
* [Включить дополнительные сетевые протоколы](../../database-engine/configure-windows/enable-or-disable-a-server-network-protocol.md)
* [Разрешить удаленные подключения](../../database-engine/configure-windows/configure-the-remote-access-server-configuration-option.md)
* [Расширить встроенные разрешения для удаленных пользователей](#bkmk_configureAccounts)
* [Предоставлены разрешения на выполнение внешних скриптов](#permissions-external-script)
* [Предоставление доступа к отдельным базам данных](#permissions-db)

> [!NOTE]
> Не все перечисленные изменения требуются и не могут быть необходимы. Требования зависят от схемы безопасности, где установлен SQL Server, и как пользователи для подключения к базе данных и выполнения внешних скриптов. Дополнительные советы по устранению неполадок можно найти здесь: [часто задаваемые вопросы по обновлению и установке](../r/upgrade-and-installation-faq-sql-server-r-services.md)

###  <a name="bkmk_configureAccounts"></a> Включить неявной проверки подлинности для запуска учетной записи группы

В процессе установки создается ряд учетных записей пользователей Windows в целях выполнения задач с токеном безопасности службы [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)]. Когда пользователь отправляет сценарий Python или R от внешнего клиента, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] активирует учетной записи свободных рабочих. Затем он сопоставляется удостоверения вызывающего пользователя и запускает скрипт от имени пользователя.

Это называется *неявной проверки подлинности*, и служба компонента database engine. Эта служба поддерживает безопасное выполнение внешних скриптов в SQL Server 2016 и 2017 г. SQL Server.

Учетные записи можно просмотреть в группе пользователей Windows **SQLRUserGroup**. По умолчанию создаются 20 рабочих учетных записей, которое обычно является более чем достаточно для выполнения внешних скриптов заданий.

> [!IMPORTANT]
> Рабочая группа называется **SQLRUserGroup** независимо от установки R или Python. Нет отдельной группы для каждого экземпляра.

Если используется проверка подлинности Windows необходимо запустить скрипты из клиента обработки и анализа удаленных данных, существуют дополнительные рекомендации. Эти учетные записи работника необходимо предоставить разрешение для входа в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляр от вашего имени.

1. В [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]в обозревателе объектов, разверните **безопасности**. Щелкните правой кнопкой мыши **входа**и выберите **новое имя входа**.
2. В **Создание имени входа** выберите **поиска**.
3. Выберите **типы объектов**и выберите **группы**. Снимите все остальные.
4. В **введите имена выбираемых объектов**, тип *SQLRUserGroup*и выберите **проверить имена**.
5. Имя локальной группы, связанной со службой панели запуска экземпляра, должно разрешиться в *имя_экземпляра\SQLRUserGroup*. Нажмите кнопку **ОК**.
6. По умолчанию, назначаются группе **открытый** роли, и имеется разрешение на подключение к компоненту database engine.
7. Нажмите кнопку **ОК**.

> [!NOTE]
> Если вы используете **входа SQL** для выполнения скриптов в контексте вычислений SQL Server, этот дополнительный шаг не требуется.

### <a name="permissions-external-script"></a> Предоставить пользователям разрешение на выполнение внешних скриптов

Если вы установили [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] самостоятельно и вы запускаете скрипты R или Python в собственный экземпляр, обычно выполняются сценарии с правами администратора. Таким образом у вас неявные разрешения через различные операции и все данные в базе данных.

Большинство пользователей, однако имеют такие разрешения более высокого уровня. Например пользователи в организации, использующих имена входа SQL для доступа к базе данных, обычно имеют повышенные разрешения. Таким образом для каждого пользователя, использующего R или Python, необходимо предоставить пользователям служб обучения машины разрешений до выполнения внешних скриптов в каждой базе данных, где этот язык используется. Вот как:

```SQL
USE <database_name>
GO
GRANT EXECUTE ANY EXTERNAL SCRIPT  TO [UserName]
```

> [!NOTE]
> Разрешения не относится к языку поддерживаемом сценарии. Другими словами не существует отдельного разрешения уровней для R-скрипта сравнении сценарий Python. Если необходимо поддерживать отдельные разрешения для этих языков, установите на отдельных экземплярах R и Python.

### <a name="permissions-db"></a> Предоставить пользователям чтения, записи или управляющего языка DDL разрешения для баз данных

При выполнении скриптов пользователю может потребоваться прочитать данные из других баз данных. Пользователь также может потребоваться создать новые таблицы для хранения результатов и записывать данные в таблицах.

Для каждой учетной записи пользователя Windows или имя входа SQL, на котором выполняется скриптов R или Python, убедитесь в наличии соответствующих разрешений на базу данных: `db_datareader`, `db_datawriter`, или `db_ddladmin`.

Например, следующая [!INCLUDE[tsql](../../includes/tsql-md.md)] инструкция предоставляет имя входа SQL *MySQLLogin* прав для запуска запросов T-SQL в *ML_Samples* базы данных. Для выполнения этой инструкции имя входа SQL уже должно существовать в контексте безопасности сервера.

```SQL
USE ML_Samples
GO
EXEC sp_addrolemember 'db_datareader', 'MySQLLogin'
```

Дополнительные сведения о разрешениях, которые включены в каждой роли см. в разделе [роли уровня базы данных](../../relational-databases/security/authentication-access/database-level-roles.md).


### <a name="create-an-odbc-data-source-for-the-instance-on-your-data-science-client"></a>Создание источника данных ODBC для экземпляра в клиенте обработки и анализа данных

Можно создать решения машинного обучения на клиентском компьютере обработки и анализа данных. Если необходимо запустить код с помощью имени компьютера SQL Server в контексте, у вас есть два варианта: доступ к экземпляру с помощью имени входа SQL или с помощью Windows учетной записи.

+ Для имен входа SQL Server: Убедитесь, что учетная запись имеет соответствующие разрешения в базе данных, в котором считываются данные. Это можно сделать, добавив *подключиться к* и *ВЫБЕРИТЕ* разрешения, либо путем добавления имени входа `db_datareader` роли. Чтобы создать объекты, назначить `DDL_admin` права. Если необходимо сохранить данные в таблицах, добавить `db_datawriter` роли.

+ Для проверки подлинности Windows: может потребоваться создать источник данных ODBC на клиенте обработки и анализа данных, который указывает имя экземпляра и другие сведения. Дополнительные сведения см. в разделе [администратор источников данных ODBC](https://docs.microsoft.com/sql/odbc/admin/odbc-data-source-administrator).

## <a name="suggested-optimizations"></a>Предлагаемые оптимизации

Теперь, когда у вас есть все работает, может потребоваться оптимизировать сервер для поддержки машинного обучения или установки обученная моделей.

### <a name="add-more-worker-accounts"></a>Добавить больше рабочих учетных записей

Если предполагается, что несколько пользователей одновременно выполняться скрипты, можно увеличить количество рабочих учетных записей, назначенных для службы панели запуска. Дополнительные сведения см. в разделе [изменение пула учетных записей пользователей для служб SQL Server Machine Learning](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

### <a name="optimize-the-server-for-script-execution"></a>Оптимизировать сервер для выполнения скриптов

Параметры по умолчанию для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] установки предназначены для оптимизации баланса сервера для различных служб, поддерживаемые компонентом database engine, которая может включать извлечения, преобразования и загрузки (ETL) процессов, отчетов, аудите, и приложения, использующие [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] данных. Таким образом в конфигурации по умолчанию может оказаться ресурсы для машинного обучения иногда ограничен или регулировать, особенно в операции с интенсивным использованием памяти.

Чтобы обеспечить задач обучения машины приоритеты и соответствующим образом ресурсов, рекомендуется использовать для настройки внешнего пула ресурсов регулятора ресурсов SQL Server. Можно также изменить объем памяти, выделяемый для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] компонент database engine, или увеличьте количество учетных записей, которые работают под [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

- Чтобы настроить пул ресурсов для управления внешними ресурсами, см. [создания пула внешних ресурсов](../../t-sql/statements/create-external-resource-pool-transact-sql.md).
  
- Чтобы изменить объем памяти, зарезервированной для базы данных, в разделе [параметры конфигурации памяти сервера](../../database-engine/configure-windows/server-memory-server-configuration-options.md).
  
- Чтобы изменить количество учетных записей R можно запустить, [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)], в разделе [изменение пула учетных записей пользователей для машинного обучения](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

Если в выпуске Standard Edition и не имеют регулятора ресурсов, можно использовать динамические административные представления (DMV) и расширенных событий, а также события Windows, мониторинг, чтобы обеспечить управление ресурсами сервера. Дополнительные сведения см. в разделе [мониторинг и управление службами R](../r/managing-and-monitoring-r-solutions.md) и [мониторинг и управление службами Python](../python/managing-and-monitoring-python-solutions.md).

### <a name="install-additional-r-packages"></a>Установка дополнительных R-пакетов

Решения R, который создается для SQL Server может вызывать базовых функций R, функции из packes properietary, устанавливается вместе с SQL Server и пакетов сторонних R, совместимыми с версией открытым исходным кодом R, устанавливаемые с SQL Server.

Пакеты, которыми вы хотите пользоваться из SQL Server, должны быть установлены в библиотеке по умолчанию, используемой экземпляром. Если имеется отдельная Установка служб R на компьютере или установленных пакетов для библиотек пользователей, его нельзя будет использовать эти пакеты из T-SQL.

Процесс установки пакетов и управления ими R отличается в SQL Server 2016 и 2017 г. SQL Server. В SQL Server 2016 администратор базы данных необходимо установить пакеты R, которые нужны пользователю. В SQL Server 2017 г можно настроить группы пользователей для совместного использования пакетов на уровне каждой базы данных или настроить роли базы данных, чтобы пользователи могли установить собственные пакеты. Дополнительные сведения см. в разделе [пакета управления](../r/r-package-management-for-sql-server-r-services.md).


## <a name="get-help"></a>Получить справку

Нужна помощь с установку или обновление? Ответы на часто задаваемые вопросы и известные проблемы см. в следующей статье:

* [Обновление и установка часто задаваемые вопросы — Machine Services обучения](../r/upgrade-and-installation-faq-sql-server-r-services.md)

Чтобы проверить состояние установки экземпляра и устранить распространенные проблемы, попробуйте следующие пользовательские отчеты.

* [Пользовательские отчеты для служб SQL Server R](../r/monitor-r-services-using-custom-reports-in-management-studio.md)

## <a name="next-steps"></a>Следующие шаги

Разработчики R можно начать работу с несколько простых примеров и основные сведения о работе с SQL Server R. Следующий шаг см. по следующим ссылкам:

+ [Учебник: Запускать в T-SQL](../tutorials/rtsql-using-r-code-in-transact-sql-quickstart.md)
+ [Учебник: Анализ в базе данных для разработчиков R](../tutorials/sqldev-in-database-r-for-sql-developers.md)

Разработчиков Python можно освоить использование Python с SQL Server, выполнив следующие учебники:

+ [Учебник: Запустите Python в T-SQL](../tutorials/run-python-using-t-sql.md)
+ [Учебник: Анализ в базе данных для разработчиков Python](../tutorials/sqldev-in-database-python-for-sql-developers.md)

Чтобы просмотреть примеры машинного обучения, основанные на реальных сценариев, в разделе [машинного обучения учебники](../tutorials/machine-learning-services-tutorials.md).
