---
title: Установка служб R SQL Server 2016 (в базе данных) | Документация Майкрософт
description: R в SQL Server доступна при установке служб R SQL Server 2016 на Windows.
ms.prod: sql
ms.technology: machine-learning
ms.date: 09/08/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 92d477434460c9395342e1a522173a301b5a0ad8
ms.sourcegitcommit: b7fd118a70a5da9bff25719a3d520ce993ea9def
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46713306"
---
# <a name="install-sql-server-2016-r-services"></a>Установка служб SQL Server 2016 R Services
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье объясняется, как установить и настроить **SQL Server 2016 R Services**. Если у вас есть SQL Server 2016, установите этот компонент позволяет выполнение кода R в SQL Server.

Интеграция R в SQL Server 2017, предлагаемое в [служб машинного обучения](../r/r-server-standalone.md), отражая Добавление Python. Если вы хотите выполнить интеграцию R и наличие установочного носителя SQL Server 2017, см. в разделе [установить SQL Server 2017 Machine Learning Services](sql-machine-learning-services-windows-install.md) добавить компонент. 

## <a name="bkmk_prereqs"> </a> Контрольный список перед установкой

+ Экземпляр ядра СУБД является обязательным. Невозможно установить только R, несмотря на то, что постепенно добавить его к существующему экземпляру.

+ Не устанавливайте службы R в отказоустойчивом кластере. Механизм безопасности, используемый для изолирования процессов R несовместим с среде отказоустойчивого кластера Windows Server.

+ Не устанавливайте службы R на контроллере домена. Службы R часть установки завершится ошибкой.

+ Не устанавливайте **общие компоненты** > **R Server (изолированный)** на одном компьютере, где запущен экземпляр в базе данных. 

  Параллельную установку с другими версиями R и Python возможны, так как экземпляр SQL Server использует своими собственными копиями открытым исходным кодом R и Anaconda распределений. Тем не менее код, который использует R и Python на компьютере SQL Server за пределами SQL Server может привести к различным проблемам:
    
  + Используется другая библиотека и другой исполняемый файл и получить разные результаты, чем при выполнении в SQL Server.
  + Скрипты R и Python, выполняющиеся на внешние библиотеки не могут управляться SQL Server, что приводит к конкуренции ресурсов.
  
Если вы использовали все предыдущие версии среды разработки Revolution Analytics или пакетов RevoScaleR или если вы установили все предварительные версии SQL Server 2016, необходимо удалить их. Выполнение нескольких версий RevoScaleR и других частных пакетах не поддерживается. Помощь в удалении предыдущих версий, см. в разделе [обновления и часто задаваемые вопросы установки служб машинного обучения SQL Server](../r/upgrade-and-installation-faq-sql-server-r-services.md).

> [!IMPORTANT]
> После завершения установки необходимо выполнить дополнительные шаги настройки, описанные в этой статье. Эти шаги включают Включение SQL Server для использования внешних скриптов и добавление учетных записей, требуемых для SQL Server для выполнения заданий R от вашего имени. Изменения конфигурации обычно требуют перезапуска данного экземпляра или перезапуск службы панели запуска.

## <a name="get-the-installation-media"></a>Получение установочного носителя

[!INCLUDE[GetInstallationMedia](../../includes/getssmedia.md)]

 ###  <a name="bkmk_ga_instalpatch"></a> Требование для установки исправления 

Корпорация Майкрософт выявила проблему с определенной версией двоичных файлов среды выполнения Microsoft VC++ 2013, которые SQL Server устанавливает в качестве необходимого компонента. Если это обновление двоичных файлов среды выполнения VC не установлено, в SQL Server могут возникать проблемы с надежностью в определенных сценариях. Перед установкой SQL Server выполните инструкции, приведенные в [заметках о выпуске SQL Server](../../sql-server/sql-server-2016-release-notes.md#bkmk_ga_instalpatch), чтобы узнать, требуется ли на вашем компьютере исправление для двоичных файлов среды выполнения VC.  

## <a name="bkmk2016top"></a>Запустите программу установки

Для локальных установок необходимо запускать программу установки с правами администратора. При установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из удаленной общей папки необходимо использовать учетную запись домена с разрешениями на чтение и выполнение для удаленной общей папки.

1. Запустите мастер установки для SQL Server 2016.

2. На **установки** выберите **автономная установка нового SQL Server или добавление компонентов к существующей установке**.
    
   ![Установка служб R (в базе данных)](media/2016-setup-installation-rsvcs.png "запуск установки компонента database engine с помощью служб R")
   
3. На **Выбор компонентов** выберите следующие параметры:

   - Выберите **службы компонента Database Engine**. Ядро базы данных требуется в каждом экземпляре, который использует машинное обучение.
   - Выберите **службы R (в базе данных)**. Устанавливает поддержку для использования в базе данных R.
    
     ![Выбор компонентов служб R](media/2016setup-rsvcs-features.png "выберите эти компоненты для R Services в базе данных")

    > [!IMPORTANT]
    > Не следует устанавливать R Server и R Services в то же время. Обычно бы установить R Server (изолированный), чтобы создать среду, специалист по обработке данных или разработчик использует для подключения к SQL Server и развертывания решений R. Поэтому вы можете установить только R Server.

4.  На **согласие на установку Microsoft R Open** щелкните **Accept**.
  
    Для скачивания Microsoft R Open, который включает в себя дистрибутив базовых пакетов R открытым исходным кодом и средства, а также улучшенные пакеты R и поставщиков услуг подключения от команды разработчиков Microsoft R требуется лицензионное соглашение для ознакомления.
  
5. После принятия лицензионного соглашения есть небольшой паузы, во время подготовки установщик. Нажмите кнопку **Далее** когда кнопка становится доступной.

6. На **все готово для установки** странице, убедитесь, что включены следующие элементы, а затем выберите **установить**.

   + Службы ядра СУБД
   + Службы R (в базе данных)

    Запишите расположение папки по пути `..\Setup Bootstrap\Log` где хранятся файлы конфигурации. По завершении установки можно просмотреть в файле сводки установленных компонентов.

7. После установки, если будет предложено перезагрузить компьютер, сделайте это сейчас. После завершения установки важно прочитать сообщение мастера установки. Дополнительные сведения см. в разделе [View and Read SQL Server Setup Log Files](https://docs.microsoft.com/sql/database-engine/install-windows/view-and-read-sql-server-setup-log-files).


##  <a name="bkmk_enableFeature"></a>Включение сценариев

1. Откройте среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. 

    > [!TIP]
    > Можно загрузить и установить соответствующую версию на этой странице: [скачать SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).
    > 
    > Можно также попробовать предварительную версию [Azure Data Studio](../../azure-data-studio/what-is.md), который поддерживает административных задач и запросов к SQL Server.
  
2. Подключитесь к экземпляру, где установлены службы машинного обучения, щелкните **новый запрос** откройте окно запроса и выполните следующую команду:

   ```SQL
   sp_configure
   ```
    На данном этапе значение для свойства `external scripts enabled` должно быть **0**. Том, что эта функция отключена по умолчанию. Эту функцию необходимо явно включить администратор, перед запуском сценариев R или Python.
     
3. Чтобы включить внешние средства написания сценариев, выполните следующую инструкцию:
  
    ```SQL
    EXEC sp_configure  'external scripts enabled', 1
    RECONFIGURE WITH OVERRIDE
    ```
  
## <a name="restart-the-service"></a>Перезапустите службу.

По завершении установки перезапустите компонент database engine, прежде чем переходить к следующему, Включение выполнения скрипта.

Перезапуск службы также автоматически перезапускает связанный [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

Вы можете перезапустить службу, используя пункт контекстного меню **перезапустите** команду для экземпляра в среде SSMS или с помощью **служб** панели на панели управления или с помощью [диспетчер конфигурации SQL Server ](../../relational-databases/sql-server-configuration-manager.md).

## <a name="verify-installation"></a>Проверка установки

Следуйте инструкциям ниже, чтобы убедиться, что запущены все компоненты, используемые для запуска внешнего скрипта.

1. В SQL Server Management Studio откройте новое окно запроса и выполните следующую команду:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled'
    ```

    Задайте для **run_value** значение 1.

2. Откройте **служб** панели или диспетчер конфигурации SQL Server и проверьте **службы панели запуска SQL Server** выполняется. Вы должны иметь одну службу для каждого экземпляра ядра базы данных с R или Python устанавливается. Дополнительные сведения о службе см. в разделе [Extensibility framework](../concepts/extensibility-framework.md).

7. Если панель запуска работает, можно выполнить простые R, чтобы убедиться, что внешних сред выполнения сценариев может взаимодействовать с SQL Server. 

    Откройте новую **запроса** окно в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем запустите следующий сценарий:
    
    ```SQL
    EXEC sp_execute_external_script  @language =N'R',
    @script=N'
    OutputDataSet <- InputDataSet;
    ',
    @input_data_1 =N'SELECT 1 AS hello'
    WITH RESULT SETS (([hello] int not null));
    GO
    ```

    Скрипта может занять немного, пока для запуска в первый раз загружена среда выполнения внешнего скрипта. Результаты должны выглядеть следующим образом:

    | hello |
    |----|
    | 1|

## <a name="bkmk_FollowUp"></a> Дополнительная настройка

При успешном выполнении шага проверки внешнего скрипта Python команды запускаются из SQL Server Management Studio, Visual Studio Code или любой другой клиент, который может отправлять инструкции T-SQL server.

Если вы получили ошибку при выполнении команды, просмотрите дополнительные шаги настройки в этом разделе. Может потребоваться внести дополнительные соответствующие конфигурации службы или базы данных.

Наиболее распространенные сценарии, которые требуют дополнительных изменений:

* [Настройка брандмауэра Windows для входящих подключений](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)
* [Включить дополнительные сетевые протоколы](../../database-engine/configure-windows/enable-or-disable-a-server-network-protocol.md)
* [Включение удаленных подключений](../../database-engine/configure-windows/configure-the-remote-access-server-configuration-option.md)
* [Расширить встроенные разрешения для удаленных пользователей](#bkmk_configureAccounts)
* [Предоставлены разрешения на выполнение внешних скриптов](#bkmk_AllowLogon)
* [Предоставление доступа к отдельным базам данных](#permissions-db)

> [!NOTE]
> Требуются не все перечисленные изменения и не могут быть необходимы. Требования зависят от схемы безопасности, где установлен SQL Server, а также как ожидается, что пользователи для подключения к базе данных и выполнения внешних скриптов. Дополнительные советы по устранению неполадок можно найти здесь: [вопросы и ответы по обновлению и установке](../r/upgrade-and-installation-faq-sql-server-r-services.md)

### <a name="bkmk_configureAccounts"></a>Включить неявную проверку подлинности для учетной записи группы панели запуска

Во время установки, некоторые учетные записи пользователей Windows создаются для выполнения задач с токеном безопасности [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] службы. Когда пользователь отправляет скрипт R из внешнего клиента, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] активирует доступную рабочую учетную запись, сопоставляет его с удостоверением вызывающего пользователя и запускает скрипт R от имени пользователя. Эта новая служба компонента database engine поддерживает безопасное выполнение внешних скриптов, вызывается *неявной проверки подлинности*.

Эти учетные записи можно просмотреть в группе пользователей Windows **SQLRUserGroup**. По умолчанию создаются 20 рабочих учетных записей, которое обычно является более чем достаточно для запуска R заданий.

Тем не менее, если нужно выполнять скрипты R из удаленного клиента обработки и анализа и при использовании проверки подлинности Windows, необходимо предоставить этим рабочим учетным записям разрешение для входа в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляр от вашего имени.

1. В среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]в обозревателе объектов разверните узел **Безопасность**, щелкните правой кнопкой мыши **Имена входа**и выберите пункт **Создать имя входа**.
2. В **Создание имени входа** выберите **поиска**.
3. Выберите **типы объектов** и **группы** установите флажки и снимите все остальные флажки.
4. Нажмите кнопку **Дополнительно**, убедитесь, что расположение для поиска текущего компьютера, а затем нажмите кнопку **найти**.
5. В списке учетных записей групп на сервере, пока не найдете начинающееся `SQLRUserGroup`.
    
    + Имя группы, связанной со службой панели запуска для _экземпляр по умолчанию_ всегда является просто **SQLRUserGroup**. Выберите эту учетную запись только для экземпляра по умолчанию.
    + Если вы используете _именованный экземпляр_, добавляется имя по умолчанию имя экземпляра `SQLRUserGroup`. Таким образом, если экземпляр имеет имя «MLTEST», имя группы пользователей по умолчанию для этого экземпляра будет **SQLRUserGroupMLTest**.
5. Нажмите кнопку **ОК** закрыть диалоговое окно расширенного поиска и убедитесь, что вы выбрали правильная учетная запись для экземпляра. Каждый экземпляр может использовать только свою собственную службу панели запуска и группы, созданной для этой службы.
6. Нажмите кнопку **ОК** еще раз, чтобы закрыть **Выбор пользователя или группы** диалоговое окно.
7. В **Создание имени входа** диалоговом окне щелкните **ОК**. По умолчанию имя входа назначается **общедоступной** роли и имеет разрешение на подключение к ядру СУБД.

### <a name="bkmk_AllowLogon"></a>Предоставление пользователям разрешения для выполнения внешних скриптов

> [!NOTE]
> Если вы используете имя входа SQL для выполнения скриптов R в контексте вычислений SQL Server, этот шаг не является обязательным.

Если вы установили [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в собственном экземпляре, обычно выполнении скриптов с правами администратора, или по крайней мере, в качестве владельца базы данных, и имеют неявные разрешения для различных операций, все данные в базе данных, а также возможность установить новые пакеты При необходимости.

Тем не менее в корпоративном сценарии большинство пользователей, включая пользователей, обращающихся к базе данных с помощью имен входа SQL, не имеют таких повышенных прав. Таким образом для каждого пользователя, который будет выполняться скрипты R, необходимо предоставить разрешения на выполнение скриптов в каждой базе данных, где будут использоваться внешних скриптов.

```SQL
USE <database_name>
GO
GRANT EXECUTE ANY EXTERNAL SCRIPT  TO [UserName]
```

> [!TIP]
> Нужно помочь в установке? Сомневаетесь, выполнили ли вы все действия? Используйте настраиваемые отчеты для проверки состояния установки и выполнить дополнительные действия. 
> 
> [Мониторинг служб машинного обучения с помощью настраиваемых отчетов](../r/monitor-r-services-using-custom-reports-in-management-studio.md).

### <a name="permissions-db"></a> Предоставление пользователям чтение, запись или DDL разрешений в базе данных

Учетная запись пользователя, который используется для запуска R может должны считывать данные из других баз данных, создания новых таблиц для хранения результатов и записывать данные в таблицы. Таким образом, для каждого пользователя, который будет выполнять скрипты R, убедитесь, что пользователь имеет соответствующие разрешения в базе данных: *db_datareader*, *db_datawriter*, или *db_ddladmin*.

Например, приведенная ниже инструкция [!INCLUDE[tsql](../../includes/tsql-md.md)] предоставляет имени входа SQL *MySQLLogin* права на выполнение запросов T-SQL в базе данных *RSamples* . Для выполнения этой инструкции имя входа SQL уже должно существовать в контексте безопасности сервера.

```SQL
USE RSamples
GO
EXEC sp_addrolemember 'db_datareader', 'MySQLLogin'
```

Дополнительные сведения о разрешениях, включенных в каждой роли, см. в разделе [роли уровня базы данных](../../relational-databases/security/authentication-access/database-level-roles.md).


### <a name="create-an-odbc-data-source-for-the-instance-on-your-data-science-client"></a>Создание источника данных ODBC для экземпляра в клиенте обработки и анализа данных

Если вы создаете решение R на клиентском компьютере обработки и анализа данных и вам необходимо выполнять код, используя имя компьютера SQL Server в качестве контекста вычисления, можно использовать имя входа SQL или встроенную проверку подлинности Windows.

* Для имен входа SQL: имя входа должно иметь соответствующие разрешения на доступ к базе данных, из которой будут считываться данные. Это можно сделать, добавив *подключиться к* и *ВЫБЕРИТЕ* разрешения, либо путем добавления имени входа *db_datareader* роли. Для имен входа, которые необходимо создать объекты, добавить *DDL_admin* права. Для имен входа, которые необходимо сохранять данные в таблицах, добавьте имя входа для *db_datawriter* роли.

* Для проверки подлинности Windows: может потребоваться настроить источник данных ODBC на клиенте обработки и анализа данных, который указывает имя экземпляра и другие сведения о подключении. Дополнительные сведения см. в разделе [администратор источников данных ODBC](https://docs.microsoft.com/sql/odbc/admin/odbc-data-source-administrator).

## <a name="suggested-optimizations"></a>Предлагаемые оптимизации

Теперь, когда у вас есть все, что работа, может также потребоваться оптимизация сервера для поддержки машинного обучения или установки обученная моделей.

### <a name="add-more-worker-accounts"></a>Добавить дополнительные рабочие учетные записи

Если вы считаете, что можно активно использовать R, или если ожидается, что многие пользователи будут одновременно выполнять скрипты, можно увеличить количество рабочих учетных записей, назначенных службе панели запуска. Дополнительные сведения см. в разделе [изменение пула учетных записей пользователей для службы машинного обучения SQL Server](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

### <a name="bkmk_optimize"></a>Оптимизация сервера для выполнения внешних скриптов

Параметры по умолчанию для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] установки предназначены для оптимизации баланса сервера для различных служб, которые поддерживаются компонентом database engine, которая может включать извлечения, преобразования и загрузки (ETL) процессов, отчетов, аудита, и приложения, использующие [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] данных. Таким образом параметры по умолчанию, может оказаться, что ресурсы для машинного обучения быть ограничены или регулироваться, особенно в случае операции с интенсивным использованием памяти.

Чтобы убедиться, что заданий машинного обучения приоритеты и выделялись необходимые ресурсы в соответствующим образом, мы рекомендуем использовать для настройки внешнего пула ресурсов регулятора ресурсов SQL Server. Можно также изменить объем памяти, выделяемый для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] компонент database engine, либо увеличить количество учетных записей, которые работают под [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

- Чтобы настроить пул ресурсов для управления внешними ресурсами, см. в разделе [создания пула внешних ресурсов](../../t-sql/statements/create-external-resource-pool-transact-sql.md).
  
- Чтобы изменить объем памяти, зарезервированной для базы данных, см. в разделе [параметры конфигурации памяти сервера](../../database-engine/configure-windows/server-memory-server-configuration-options.md).
  
- Чтобы изменить количество учетных записей R, которые можно запустить, [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)], см. в разделе [изменение пула учетных записей пользователей для машинного обучения](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

Если вы используете Standard Edition и нет регулятора ресурсов, можно использовать динамические административные представления (DMV) и расширенных событий, а также события Windows, мониторинг, чтобы обеспечить управление ресурсами сервера, которые используются R. Дополнительные сведения см. в разделе [мониторинг и управление службами R](../r/managing-and-monitoring-r-solutions.md).

### <a name="install-additional-r-packages"></a>Установка дополнительных пакетов R

Решения R, созданные для SQL Server можно вызвать базовых функций R, функции из частных пакетах, установленная с SQL Server и сторонние пакеты R, несовместима с версией R с открытым кодом устанавливается SQL Server.

Пакеты, которыми вы хотите пользоваться из SQL Server, должны быть установлены в библиотеке по умолчанию, используемой экземпляром. Если у вас есть отдельная Установка R на компьютере, или если вы установили пакеты в библиотеки пользователей, нельзя будет использовать эти пакеты с T-SQL.

Процесс установки и управления пакетами R отличается в SQL Server 2016 и SQL Server 2017. В SQL Server 2016 администратор базы данных необходимо установить пакеты R, необходимые пользователям. В SQL Server 2017 можно настроить группы пользователей для совместного использования пакетов на уровне базы данных, или настроить роли базы данных, чтобы пользователи могли устанавливать собственные пакеты. Дополнительные сведения см. в разделе [Установка новых пакетов R](../r/install-additional-r-packages-on-sql-server.md).


## <a name="get-help"></a>Получить справку

Нужна помощь с установку или обновление? Ответы на часто задаваемые вопросы и известные проблемы обратитесь к следующей статье:

* [Обновление и установка часто задаваемые вопросы – службы машинного обучения](../r/upgrade-and-installation-faq-sql-server-r-services.md)

Чтобы проверить состояние установки экземпляра и исправлять распространенные проблемы, используйте эти пользовательские отчеты.

* [Пользовательские отчеты для служб R SQL Server](../r/monitor-r-services-using-custom-reports-in-management-studio.md)

## <a name="next-steps"></a>Следующие шаги

Разработчики R можно приступить к работе с простыми примерами и ознакомиться с основами как R работает с SQL Server. Следующий шаг см. следующие ссылки:

+ [Руководство: Запуск R в T-SQL](../tutorials/rtsql-using-r-code-in-transact-sql-quickstart.md)
+ [Учебник: Анализ в базе данных для разработчиков R](../tutorials/sqldev-in-database-r-for-sql-developers.md)

Чтобы просмотреть примеры машинного обучения, которые основаны на реальных сценариев, см. в разделе [машинного обучения учебники](../tutorials/machine-learning-services-tutorials.md).


