---
title: Ошибок создания скриптов R в SQL Server машинного обучения и R Services | Документы Microsoft
ms.prod: sql
ms.technology: machine-learning
ms.date: 05/31/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 0b695111849b234f6ca38fc89c538e905f187fb6
ms.sourcegitcommit: 808d23a654ef03ea16db1aa23edab496b73e5072
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2018
ms.locfileid: "34709109"
---
# <a name="r-scripting-errors-in-sql-server"></a>Ошибок создания скриптов R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье приведены несколько gerrors scriptin при выполнении кода R в SQL Server. Список не является исчерпывающим. Существует много пакетов, а ошибки может различаться для разных версий одного пакета. Рекомендуется задать ошибок в скриптах на [форум Server обучения машины](https://social.msdn.microsoft.com/Forums/home?category=MicrosoftR), который поддерживает машинного обучения компонентов, используемых в R Services (в базе данных), клиент Microsoft R и Microsoft R Server.

**Применяется к:** служб R SQL Server 2016, SQL Server 2017 г машинного обучения служб


## <a name="valid-script-fails-in-t-sql-or-in-stored-procedures"></a>Допустимый сценарий завершается с ошибкой в T-SQL или хранимых процедур

Перед упаковкой кода R в хранимой процедуре, это хороший способ запуска кода R в внешних интегрированной среды разработки или в одном из средств R, например RTerm или RGui. С помощью этих методов, тестирования и отладки кода с помощью подробных сообщений об ошибках, возвращаемых R.

Тем не менее иногда код, который идеально работает в внешнего интерфейса IDE или программа может не работать в хранимой процедуре или контекста вычислений SQL Server. В этом случае существует множество проблем для поиска, прежде чем можно предположить, что пакет не работает в SQL Server.

1. Проверьте, запущена ли панель запуска.

2. Просмотрите сообщения, чтобы узнать, содержит ли выходные данные или входные данные столбцы с типами данных несовместимы или не поддерживается. Например запросы к базе данных SQL часто также возвращают идентификаторы GUID или идентификаторами RowGUIDs, которые не поддерживаются. Дополнительные сведения см. в разделе [R библиотек и типы данных](r/r-libraries-and-data-types.md).

3. Просмотрите страницы справки для отдельных функций R определить, поддерживаются ли все параметры для контекста вычислений SQL Server. Справка ScaleR команд справки встроенного R, либо [ссылки на пакет](https://docs.microsoft.com/r-server/r-reference/revoscaler/revoscaler).

Если работает среды выполнения R, но сценарий возвращает ошибки, рекомендуется попробовать отладка скриптов в специальной среде разработки R, такие как средства R для Visual Studio.

Также рекомендуется изучить и немного измените сценарий для исправления любых проблем с типами данных, которые могут возникнуть при перемещении данных между R и компонент database engine. Дополнительные сведения см. в разделе [R библиотек и типы данных](r/r-libraries-and-data-types.md).

Кроме того можно использовать пакет sqlrutils для формирования пакета R-скриптов в формате, который является более простой в использовании как хранимую процедуру. Дополнительные сведения см. в разделе:
* [Создание хранимой процедуры для кода R с помощью пакета sqlrutils](r/generating-an-r-stored-procedure-for-r-code-using-the-sqlrutils-package.md)
* [Создание хранимой процедуры с помощью sqlrutils](r/how-to-create-a-stored-procedure-using-sqlrutils.md)

## <a name="script-returns-inconsistent-results"></a>Сценарий возвращает несогласованные результаты.

R-скриптов могут возвращать различные значения в контексте SQL Server, по следующим причинам:

- Неявное преобразование выполняется автоматически для некоторых типов данных при передаче данных между SQL Server и R. Дополнительные сведения см. в разделе [R библиотек и типы данных](r/r-libraries-and-data-types.md).

- Определите, является ли разрядность фактор. Например часто существуют различия в результатах выполнения математических операций для 32-разрядных и 64-разрядных библиотек с плавающей точки.

- Определите, созданы ли значения NaN в любой операции. Это может нарушить целостность результатов.

- Небольшая разница может усиливаться при выполнении обратное числа близок к нулю.

- Накопленные ошибки округления может привести к таких объектов, как значения, которые меньше нуля, а не с нуля.

## <a name="implied-authentication-for-remote-execution-via-odbc"></a>Неявной проверки подлинности для удаленного выполнения через ODBC

При подключении к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] компьютер для запуска R команд с помощью **RevoScaleR** функции, может появиться ошибка при использовании вызовов ODBC, которые записывают данные на сервер. Эта ошибка возникает только в том случае, если вы используете проверку подлинности Windows.

Причина заключается в том, что рабочих учетных записей, созданных для служб R имеют разрешение на подключение к серверу. Таким образом вызовы ODBC не может выполняться от имени пользователя. Проблема не возникает с именами входа SQL, поскольку с именами входа SQL, учетные данные передаются явным образом от клиента R в экземпляре SQL Server, а затем в ODBC. Однако с помощью имен входа SQL Server также менее безопасен, чем проверка подлинности Windows.

Чтобы включить учетные данные Windows для безопасной передачи из сценария, который запустил удаленно, SQL Server необходимо эмулировать учетные данные. Этот процесс называется _неявной проверки подлинности_. Чтобы добиться этого, учетные записи работника, выполняемых скриптов R или Python на компьютере SQL Server должны иметь правильные разрешения.

1. Откройте [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] с правами администратора на экземпляре, где будет выполняться код R.

2. Выполните приведенный ниже скрипт. Не забудьте изменить имя группы пользователей, если вы изменили значение по умолчанию, а имена компьютера и экземпляра.

    ```SQL
    USE [master]
    GO
    
    CREATE LOGIN [computername\\SQLRUserGroup] FROM WINDOWS WITH
    DEFAULT_DATABASE=[master], DEFAULT_LANGUAGE=[language]
    GO
    ```

## <a name="avoid-clearing-the-workspace-while-youre-running-r-in-a-sql-compute-context"></a>Не снимайте рабочей области, запущенном R в контексте вычислений SQL

Несмотря на то, что при работе в консоли R, являются общими Очистка рабочей области, он может иметь непредвиденные последствия в SQL контекста вычислений.

`revoScriptConnection` — Это объект в рабочую область R, который содержит сведения о сеанса R, который вызывается из SQL Server. Тем не менее если код R содержит команду, чтобы очистить рабочую область (такие как `rm(list=ls())`), все сведения о сеансе и других объектов в рабочую область R также очищается.

Чтобы избежать этого Избегайте беспорядочное Очистка переменных и других объектов запущенном R в SQL Server. Можно удалить с помощью определенных переменных **удалить** функции:

```R
remove('name1', 'name2', ...)
```

Если существует несколько переменных для удаления, рекомендуется сохранить имена временные переменные в список и затем выполнить периодических сборок мусора в списке.



## <a name="next-steps"></a>Следующие шаги

[Устранение неполадок службы обучения машины и известные проблемы](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок соединения с ядром СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
