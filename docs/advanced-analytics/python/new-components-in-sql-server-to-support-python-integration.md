---
title: Компоненты интеграции Python с SQL Server машинного обучения | Документы Microsoft
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: f00735c78b59a9eec41f8ef4ae77fb6accf013d1
ms.sourcegitcommit: 7a6df3fd5bea9282ecdeffa94d13ea1da6def80a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="components-in-sql-server-to-support-python-integration"></a>Компоненты SQL Server для поддержки интеграции Python
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Начиная с SQL Server 2017 г., Machine Learning Services поддерживает Python как внешний язык, который может быть выполнен из T-SQL, или выполняется удаленно с помощью SQL Server в контексте.

В этом разделе описывает компоненты в 2017 г. SQL Server, поддерживают расширяемости в целом и языка Python специально.

## <a name="sql-server-components-and-providers"></a>Компоненты SQL Server и поставщиков

Для настройки SQL Server 2017 г. Чтобы разрешить выполнение сценариев Python — это многоступенчатый процесс.

1. Установите компонент расширяемости.
2. Включите функцию выполнения внешнего сценария.
3. Перезапустите службы компонента database engine.

Для поддержки удаленных сценариев выполнения могут потребоваться дополнительные действия.

Дополнительные сведения см. в разделе [установки служб SQL Server 2017 г машины обучения (в базе данных)](../install/sql-machine-learning-services-windows-install.md).

### <a name="launchpad"></a>Панель запуска

Панель запуска SQL Server доверенные — это служба, появившегося в SQL Server 2016, осуществляющая управление и выполнение внешних скриптов, аналогично тому, как служба полнотекстового индексирования и выполнения запросов для обработки полнотекстовых запросов запускается отдельный узел.

Служба панели запуска можно запустить только доверенным средства запуска, которые опубликованы корпорацией Майкрософт или, сертифицированных корпорацией Майкрософт как соответствующие требованиям для производительности и управление ресурсами.

+ 2017 г. SQL Server поддерживает R и Python 3.5
+ SQL Server 2016 поддерживает R

Служба [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] выполняется со своей собственной учетной записью пользователя.

> [!TIP]
> Если изменяется учетная запись, которая запускает панели запуска, убедитесь, что сделать с помощью диспетчера конфигурации SQL Server, чтобы убедиться, что изменения записываются в соответствующие файлы.

Для выполнения задач, поддерживаемых конкретного языка, панель запуска получает защищенной рабочей учетной записи из пула и запускает процесс вспомогательных для управления внешней среды выполнения:

+ RLauncher.dll языка R
+ Pythonlauncher.dll для Python 3.5

Каждому вспомогательному процессу наследует учетная запись пользователя панели запуска и использует этой рабочей учетной записи во время выполнения скрипта. Если сценарий Python используются параллельные процессы, они создаются под учетной записью одного, один работник.

Дополнительные сведения о контексте безопасности панели запуска см. в разделе [безопасности](security-overview-sql-server-python-services.md).

### <a name="bxlserver-and-sql-satellite"></a>BxlServer и вспомогательных SQL

При запуске [Process Explorer](https://technet.microsoft.com/sysinternals/processexplorer.aspx) в ходе задания Python, может появиться один или несколько экземпляров BxlServer.

**BxlServer** — это исполняемый файл, предоставленный корпорацией Майкрософт, который управляет связью между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и Python (или R). Он создает объекты заданий Windows используется для включения других сеансов внешних скриптов, подготавливает безопасного рабочие папки для каждого задания внешнего скрипта и использует вспомогательные SQL для управления передачей данных между внешней среды выполнения и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].

По сути, BxlServer является вспомогательным для работы с Python [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] для передачи данных и управления задачами. BXL расшифровывается языка двоичных Exchange и ссылается на формат данных, используемый для эффективного перемещения данных между SQL Server и внешних процессов. BxlServer также является важной частью клиент Microsoft R и Microsoft R Server.

**Вспомогательные SQL** API расширяемости, включенных в компоненте database engine, начиная с SQL Server 2016, которая поддерживает внешний код или внешних сред выполнения, реализовано с помощью C или C++.

BxlServer использует вспомогательное соединение SQL для следующих задач:

+ чтение входных данных;
+ запись выходных данных;
+ получение входных аргументов;
+ запись входных аргументов;
+ Обработка ошибок
+ обратная запись StdOut и StdErr в клиент.

Вспомогательные SQL использует формат пользовательских данных, который оптимизирован для быстрого данных передачи между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и внешних языки сценариев. Он выполняет преобразования типов и определяет схемы наборов входных и выходных данных во время обмена данными между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и среда выполнения внешнего сценария.

Вспомогательные SQL можно отслеживать с помощью windows расширенные события (xEvents). Дополнительные сведения см. в разделе [расширенных событий для R](../../advanced-analytics/r/extended-events-for-sql-server-r-services.md).

## <a name="communication-channels-between-components"></a>Каналы связи между компонентами

+ **TCP/IP**

  По умолчанию внутренней связи между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и вспомогательных SQL использует протокол TCP/IP.

+ **Именованные каналы**

  Для внутренней передачи данных между BxlServer и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] через вспомогательное соединение SQL используется внутренний формат сжатых данных для оптимизации производительности. Обмен данными между Python и BxlServer в формате BXL, с помощью именованных каналов.

+ **ODBC**

  Взаимодействие между клиентами обработки и анализа внешних данных и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] экземпляр использовать ODBC. Учетная запись, отправить скрипт заданий для [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] должен иметь оба разрешения для подключения к экземпляру и выполнения внешних скриптов.

  Кроме того в зависимости от задач, учетной записи могут потребоваться следующие разрешения:

  + Чтение данных, используемое заданием
  + Записи данных в таблицы: например, при сохранении результатов в таблицу
  + Создание объектов базы данных: например, при сохранении внешнего скрипта в рамках новой хранимой процедуры.

  Когда [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] — используется в качестве контекста вычислений для выполнения сценария Python с удаленного клиента, а исполняемый файл Python должны получать данные из внешнего источника, ODBC используется для обратной записи. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] Сопоставляет удостоверение пользователя, выполняющего удаленной команды к удостоверению пользователя в текущем экземпляре и выполняет команду ODBC, используя учетные данные пользователя. Строка подключения, необходимая для выполнения этого вызова ODBC, получается из клиентского кода.

## <a name="interaction-of-components"></a>Взаимодействие компонентов

Следующие диаграммы изображают взаимодействие компонентов SQL Server со средой выполнения Python в каждом из поддерживаемых сценариев: выполнение скрипта в базе данных и удаленного выполнения из терминала Python, с помощью контекста вычислений SQL Server.

### <a name="python-scripts-executed-in-database"></a>Python скриптов, выполненных в базе данных

При запуске Python «внутренних» [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], сценарий Python в особой хранимой процедуры, должен быть инкапсулирован [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md).

После скрипт внедренными в хранимой процедуре, любое приложение, которое можно сделать вызов хранимой процедуры можно инициировать выполнение кода Python.  После этого [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] управляет выполнением кода, как показано на следующей схеме.

![сценарий в db python](../../advanced-analytics/python/media/script-in-db-python2.png)

1. Запрос для среды выполнения Python, определяемый параметром `@language='Python'` передается хранимой процедуре. SQL Server отправляет запрос службы панели запуска.
2. Служба панели запуска начинается соответствующие запуска; в этом случае PythonLauncher.
3. PythonLauncher запускается внешний процесс Python35.
4. BxlServer координаты с помощью среды выполнения Python для управления обмен данными и хранения результатов работы.
5. Вспомогательные SQL управляет взаимодействием связанные задачи и процессы, [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
6. BxlServer использует вспомогательное соединение SQL для передачи состояния и результатов в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
7. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] получает результаты и закрывает связанные задачи и процессы.

### <a name="python-scripts-executed-from-a-remote-client"></a>Python скриптов, выполненных с помощью удаленного клиента

Можно запускать сценарии Python с удаленного компьютера, например переносного компьютера и их выполнения в контексте компьютера SQl Server, при соблюдении следующих условий:

+ Сценарии разработки соответствующим образом
+ Удаленный компьютер после установки библиотеки расширения, которые используются службами машины обучения. [Revoscalepy](what-is-revoscalepy.md) пакет необходим для использования в контекстах удаленных вычислений.

На следующей диаграмме показаны общего рабочего процесса, если сценарии осуществляется с удаленного компьютера.

![удаленное sqlcc из python](../../advanced-analytics/python/media/remote-sqlcc-from-python3.png)

1. Для функций, которые поддерживаются в **revoscalepy**, среда выполнения Python вызывает связывания функции, которая в свою очередь вызывает BxlServer.
2. BxlServer входит в состав службы обучения машины (в базе данных) и выполняется в отдельном процессе от среды выполнения Python.
3. BxlServer определяет целевой объект подключения и открывает соединение с использованием ODBC, передавая учетные данные, предоставленные как часть строки подключения в сценарий Python.
4. BxlServer устанавливает подключение к экземпляру [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
5. Вызывается при вызове среды выполнения внешнего сценария службы панели запуска, в свою очередь, которая запускает средство запуска соответствующего: в этом случае PythonLauncher.dll. После этого кода Python обрабатываются в рабочем процессе, подобно тому, как при вызове кода Python из хранимой процедуры в T-SQL.
6. PythonLauncher вызывает экземпляр Python, на котором установлен [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] компьютер.
7. Результаты возвращаются в BxlServer.
8. Вспомогательное соединение SQL управляет взаимодействием с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и очисткой связанных объектов задания.
9. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] передает результаты клиенту.

## <a name="next-steps"></a>Следующие шаги

[Общие сведения об архитектуре для Python в SQL Server](architecture-overview-sql-server-python.md)
