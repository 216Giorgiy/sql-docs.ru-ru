---
title: "Установка и настройка для обучения службы Python машины | Документы Microsoft"
ms.custom: 
ms.date: 12/20/2017
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: python
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
author: jeannt
ms.author: jeannt
manager: cgronlund
ms.workload: On Demand
ms.openlocfilehash: 9ecd54dcb1fe829c51e0e05346abf04d80af3cf9
ms.sourcegitcommit: 6bd21109abedf64445bdb3478eea5aaa7553fa46
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2018
---
# <a name="set-up-python-machine-learning-services-in-database"></a>Настройка службы обучения машины Python (в базе данных)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

  В этой статье описывается установка компонентов, необходимых для Python, запустив [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] мастер установки, а далее интерактивные запросы.

## <a name="machine-learning-options-in-sql-server-setup"></a>Машинное обучение параметры в программе установки SQL Server

Выберите **службы обучения машины** компонент и выберите **Python** в качестве языка.

**Общие компоненты** раздел содержит параметр отдельной установки **машины обучения Server (изолированный)**. Этот параметр поддерживает ввода в эксплуатацию кода Python на сервере, не установлен SQL Server, или не требуется использование контекстов вычислений SQL Server. Таким образом, мы рекомендуем вам *не* установить на том же компьютере, что и экземпляр SQL Server. Вместо этого установите машины обучения Server (изолированного) на отдельном компьютере.

После завершения установки перенастройте данный экземпляр, чтобы разрешить выполнение сценариев, использующих внешний исполняемого файла. Может потребоваться внести дополнительные изменения для поддержки рабочих нагрузок обучения компьютера на сервер. Изменения конфигурации обычно требуют перезапуска экземпляра или перезапуск службы панели запуска.

### <a name="prerequisites"></a>предварительные требования

+ SQL Server 2017 г. является обязательным. Интеграция Python не поддерживается в предыдущих версиях SQL Server.
+ Не забудьте установить компонент database engine. Экземпляр SQL Server необходим для выполнения Python скриптов в базе данных.
+ Необходимые компоненты установлены в процессе установки компонент Python.
+ Не удается установить машинного обучения со службами Python в отказоустойчивом кластере. Механизм безопасности, используемый для изоляции процессов, Python не совместим с среде отказоустойчивого кластера Windows Server.
   
  Чтобы избежать этого можно использовать репликации копирование необходимых таблиц к автономным экземпляром SQL Server, которое использует службы Python. Кроме того можно установить машинного обучения со службами Python на отдельном компьютере, используя параметра AlwaysOn и является частью группы доступности.

+ Параллельную установку с другими версиями Python невозможна, так как экземпляр SQL Server использует свою собственную копию дистрибутив Anaconda. Однако выполнение кода, который использует Python на компьютере SQL Server за пределами SQL Server может привести к различным проблемам:
    
    - Можно использовать различные библиотеки и другой исполняемый файл и получить разные результаты, чем при выполнении в SQL Server.
    - SQL Server, что приведет к конфликтам ресурсов не может управляться Python скриптов, запускаемых во внешних библиотеках.
  
> [!IMPORTANT]
> После завершения установки убедитесь, что для выполнения дополнительных действий после конфигурации, описанной в этой статье. Эти действия включают Включение SQL Server для использования внешних скриптов и добавление учетных записей, требуемых для SQL Server для выполнения заданий Python от вашего имени.

### <a name="unattended-installation"></a>Автоматическая установка

Для выполнения автоматической установки, используйте параметры командной строки для программы установки SQL Server и аргументы, связанные с Python. Дополнительные сведения см. в разделе [устанавливает автоматическая установка SQL Server с Python Machine Learning Services](unattended-installs-of-sql-server-python-services.md).

##  <a name="bkmk_installPythonInDatabase"></a> Шаг 1: Установка машинного обучения службы (в базе данных) на сервере SQL Server

1. Запустите мастер настройки для 2017 г. SQL Server.
  
2. На **установки** выберите **автономная установка нового SQL Server или добавление компонентов к существующей установке**.

    ![Установка Python в базе данных](media/2017setup-installation-page-mlsvcs.PNG)
   
3. На странице **Выбор компонентов** выберите следующие компоненты:
  
    -   **Службы ядра СУБД**
  
         Чтобы использовать Python с SQL Server, необходимо установить экземпляр компонента database engine. Можно использовать значение по умолчанию или именованный экземпляр.
  
    -   **Машинное обучение службы (в базе данных)**
  
         Этот параметр устанавливает службы базы данных, которые поддерживают выполнение сценария Python.

    -   **Python** флажок, чтобы получить Python 3.5 исполняемый файл и выберите из дистрибутив Anaconda библиотеки. Установите только один язык для каждого экземпляра.
        
        ![Параметры для Python компонентов](media/ml-svcs-features-python-highlight.png "параметры установки для Python")

        > [!NOTE]
        > 
        > Не устанавливайте флажок для **машины обучения Server (изолированный)**. Возможность установки сервера обучения Machine в разделе **Общие средства** предназначен для использования на отдельном компьютере. Например может потребоваться установить ту же версию машинного обучения компонентов на другой компьютер, который используется для разработки проекта, такие как ноутбук анализу данных.

4. На **согласия для установки Python** выберите **Accept**.
  
     Это лицензионное соглашение, необходимое для загрузки Python исполняемый файл и пакеты Python из Anaconda.
     
     ![Соглашение для лицензии Python](media/ml-svcs-license-python.png "лицензионное соглашение для Python")
  
    > [!NOTE]
    >  Если компьютер, на котором вы используете не имеет доступа к Интернету, вы можете приостановить программу установки на этом этапе для установщики скачать отдельно. Дополнительные сведения см. в разделе [Установка компонентов без доступа к Интернету](../r/installing-ml-components-without-internet-access.md).
  
     Выберите **Accept**, подождите, пока **Далее** кнопка становится активной, а затем выберите **Далее**.
  
5. На **все готово для установки** убедитесь, что эти параметры включены и выберите **установить**.
  
     + Службы ядра СУБД
     + Службы машинного обучения (в базе данных)
     + Python
  
    Эти параметры представляют минимальная конфигурация, необходимая для использования Python с [!INCLUDE[ssnoversion](../../includes/ssnoversion.md)].
    
    ![Все готово для установки Python](media/ready-to-install-python.png "компоненты, необходимые для установки Python")

    При необходимости Запишите расположение папки по пути `..\Setup Bootstrap\Log` хранения файлов конфигурации. После завершения установки можно просмотреть установленные компоненты в файл сводки.

6. По завершении установки перезагрузите компьютер.

##  <a name="bkmk_enableFeature"></a> Шаг 2: Включить выполнение сценариев Python

1. Откройте среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. 

    > [!TIP]
    > Можно загрузить и установить соответствующую версию на этой странице: [загрузить SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).
    > 
    > Также можно попробовать предварительный выпуск [операций SQL Studio](https://docs.microsoft.com/sql/sql-operations-studio/what-is), который поддерживает административные задачи и запросы к SQL Server.
  
2. Подключитесь к экземпляру, в которой установлены службы обучения для компьютера и выполните следующую команду:

   ```SQL
   sp_configure
   ```

    На данном этапе значение для свойства `external scripts enabled` должно быть **0**. Это, так как функция отключена по умолчанию. Компонент должны явно включены администратором, прежде чем вы сможете выполнять сценарии R или Python.
    
3.  Чтобы включить внешние средства написания сценариев, поддерживающий Python, выполните следующую инструкцию:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled', 1
    RECONFIGURE WITH OVERRIDE
    ```
    
    Если был включен компонент для языка R, не запускайте перенастроить еще раз для Python. Базовая платформа расширяемости поддерживает оба языка.

4. Перезапустите службу SQL Server для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Перезапуск службы SQL Server автоматически перезапускает связанный [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы.

    Службу можно перезапустить с помощью **службы** панели на панели управления или с помощью [диспетчер конфигурации SQL Server](../../relational-databases/sql-server-configuration-manager.md).

## <a name="step-3-verify-that-the-external-script-execution-feature-is-running"></a>Шаг 3: Убедитесь, что запущен возможности выполнения внешнего сценария

Теперь пора убедитесь, что запущены все компоненты, используемые для запуска сценария Python.

1. В SQL Server Management Studio откройте новое окно запроса и выполните следующую команду:
    
    ```SQL
    EXEC sp_configure  'external scripts enabled'
    ```

    Задайте для **run_value** значение 1.
    
2. Откройте **служб** панели или диспетчер конфигурации SQL Server и убедитесь в работоспособности службы панели запуска для конкретного экземпляра. Если панель запуска не запущена, перезапустите службу.
  
    При установке нескольких экземпляров SQL Server в любой экземпляр, для которого включена Python или R имеет собственную службу запуска.

    При установке на одном экземпляре R и Python устанавливается только одна панель запуска. Отдельный, зависящие от языка запуска DLL добавляется для каждого языка. Дополнительные сведения см. в разделе [компоненты для поддержки интеграции Python](new-components-in-sql-server-to-support-python-integration.md). 
   
3. Если выполняется панели запуска, можно выполнять простые сценарии Python, как показано ниже в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]:
    
    ```SQL
    EXEC sp_execute_external_script  @language =N'Python',
    @script=N'OutputDataSet = InputDataSet',
    @input_data_1 = N'SELECT 1 AS col'
    ```
    
    **Результаты**
    
    *<code>&nbsp;&nbsp;</code>* *1*

> [!NOTE]
> Столбцы или заголовки, используемые в скрипте, Python не возвращаются, намеренно. Чтобы добавить имена столбцов для получения выходных данных, необходимо указать схему для возврата набора данных. Сделать это с помощью параметра с РЕЗУЛЬТАТОВ хранимой процедуры, имен столбцов и указать тип данных SQL.
> 
> Например можно добавить следующую строку, чтобы создать имя произвольного столбца: `WITH RESULT SETS ((Col1 AS int))`

## <a name="step-4-additional-configuration"></a>Шаг 4: Дополнительная настройка

Если предыдущая команда выполнена успешно, можно выполнить команды Python в SQL Server Management Studio, Visual Studio Code или любым другим клиентом, можно отправить инструкции T-SQL на сервере.

Если при выполнении команды произошла ошибка, просмотрите следующий список. Может потребоваться указать дополнительные соответствующие параметры конфигурации для службы или базы данных.

> [!NOTE]
> 
> Не все перечисленные изменения требуются и не могут быть необходимы. Требования зависят от схемы безопасности, где установлен SQL Server, и как пользователи для подключения к базе данных и выполнения внешних скриптов.

###  <a name="bkmk_configureAccounts"></a> Включить неявной проверки подлинности для запуска учетной записи группы

В процессе установки создается ряд учетных записей пользователей Windows в целях выполнения задач с токеном безопасности службы [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)]. Когда пользователь отправляет сценарий Python или R от внешнего клиента, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] активирует учетной записи свободных рабочих. Затем он сопоставляется удостоверения вызывающего пользователя и запускает скрипт от имени пользователя.

Это называется *неявной проверки подлинности*, и служба компонента database engine. Эта служба поддерживает безопасное выполнение внешних скриптов в SQL Server 2016 и 2017 г. SQL Server.

Учетные записи можно просмотреть в группе пользователей Windows **SQLRUserGroup**. По умолчанию создаются 20 рабочих учетных записей, которое обычно является более чем достаточно для выполнения внешних скриптов заданий.

> [!IMPORTANT]
> Рабочая группа называется **SQLRUserGroup** независимо от установки R или Python. Нет отдельной группы для каждого экземпляра.

Если используется проверка подлинности Windows необходимо запустить скрипты из клиента обработки и анализа удаленных данных, существуют дополнительные рекомендации. Эти учетные записи работника необходимо предоставить разрешение для входа в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляр от вашего имени.

1. В [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]в обозревателе объектов, разверните **безопасности**. Щелкните правой кнопкой мыши **входа**и выберите **новое имя входа**.
2. В **Создание имени входа** выберите **поиска**.
3. Выберите **типы объектов**и выберите **группы**. Снимите все остальные.
4. В **введите имена выбираемых объектов**, тип *SQLRUserGroup*и выберите **проверить имена**.
5. Имя локальной группы, связанной со службой панели запуска экземпляра, должно разрешиться в *имя_экземпляра\SQLRUserGroup*. Нажмите кнопку **ОК**.
6. По умолчанию, назначаются группе **открытый** роли, и имеется разрешение на подключение к компоненту database engine.
7. Нажмите кнопку **ОК**.

> [!NOTE]
> Если вы используете **входа SQL** для выполнения скриптов в контексте вычислений SQL Server, этот дополнительный шаг не требуется.

### <a name="give-users-permission-to-run-external-scripts"></a>Предоставить пользователям разрешение на выполнение внешних скриптов

Если вы установили [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] самостоятельно и вы запускаете сценариев Python в собственный экземпляр, обычно выполняются сценарии с правами администратора. Таким образом у вас неявные разрешения через различные операции и все данные в базе данных.

Большинство пользователей, однако имеют такие разрешения более высокого уровня. Например пользователи в организации, использующих имена входа SQL для доступа к базе данных, обычно имеют повышенные разрешения. Таким образом для каждого пользователя, использующего Python, необходимо предоставить пользователям служб обучения машины разрешений до выполнения внешних скриптов в каждой базе данных, в которых используется Python. Вот как:

```SQL
USE <database_name>
GO
GRANT EXECUTE ANY EXTERNAL SCRIPT  TO [UserName]
```

> [!NOTE]
> Разрешения не относится к языку поддерживаемом сценарии. Другими словами не существует отдельного разрешения уровней для R-скрипта сравнении сценарий Python. Если необходимо поддерживать отдельные разрешения для этих языков, установите на отдельных экземплярах R и Python.

### <a name="give-your-users-read-write-or-data-definition-language-ddl-permissions-to-databases"></a>Предоставить пользователям чтения, записи или управляющего языка DDL разрешения для баз данных

При выполнении скриптов пользователю может потребоваться прочитать данные из других баз данных. Пользователь также может потребоваться создать новые таблицы для хранения результатов и записывать данные в таблицах.

Для каждой учетной записи пользователя Windows или имя входа SQL, на котором выполняется скриптов R или Python, убедитесь в наличии соответствующих разрешений на базу данных: `db_datareader`, `db_datawriter`, или `db_ddladmin`.

Например, следующая [!INCLUDE[tsql](../../includes/tsql-md.md)] инструкция предоставляет имя входа SQL *MySQLLogin* прав для запуска запросов T-SQL в *ML_Samples* базы данных. Для выполнения этой инструкции имя входа SQL уже должно существовать в контексте безопасности сервера.

```SQL
USE ML_Samples
GO
EXEC sp_addrolemember 'db_datareader', 'MySQLLogin'
```

Дополнительные сведения о разрешениях, которые включены в каждой роли см. в разделе [роли уровня базы данных](../../relational-databases/security/authentication-access/database-level-roles.md).

### <a name="ensure-that-the-sql-server-installation-supports-remote-connections"></a>Убедитесь, что установка SQL Server поддерживает удаленные подключения

Если вы не можете подключиться с удаленного компьютера, проверьте ли брандмауэр разрешает доступ к SQL Server. При установке по умолчанию удаленные подключения могут быть отключены или конкретный порт, используемый SQL Server может быть заблокирован брандмауэром. Дополнительные сведения см. в разделе [Настройка брандмауэра Windows для доступа к компоненту database engine](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md).

### <a name="create-an-odbc-data-source-for-the-instance-on-your-data-science-client"></a>Создание источника данных ODBC для экземпляра в клиенте обработки и анализа данных

Можно создать решения машинного обучения на клиентском компьютере обработки и анализа данных. Если необходимо запустить код с помощью имени компьютера SQL Server в контексте, у вас есть два варианта: доступ к экземпляру с помощью имени входа SQL или с помощью Windows учетной записи.

+ Для имен входа SQL Server: Убедитесь, что учетная запись имеет соответствующие разрешения в базе данных, в котором считываются данные. Это можно сделать, добавив *подключиться к* и *ВЫБЕРИТЕ* разрешения, либо путем добавления имени входа `db_datareader` роли. Чтобы создать объекты, назначить `DDL_admin` права. Если необходимо сохранить данные в таблицах, добавить `db_datawriter` роли.

+ Для проверки подлинности Windows: может потребоваться создать источник данных ODBC на клиенте обработки и анализа данных, который указывает имя экземпляра и другие сведения. Дополнительные сведения см. в разделе [администратор источников данных ODBC](https://docs.microsoft.com/sql/odbc/admin/odbc-data-source-administrator).

## <a name="additional-optimizations"></a>Дополнительная оптимизация

Теперь, когда у вас есть все работает, может потребоваться оптимизировать сервер для поддержки машинного обучения или установки обученная моделей.

### <a name="add-more-worker-accounts"></a>Добавить больше рабочих учетных записей

Если предполагается, что несколько пользователей одновременно выполняться скрипты, можно увеличить количество рабочих учетных записей, назначенных для службы панели запуска. Дополнительные сведения см. в разделе [изменение пула учетных записей пользователей для служб SQL Server Machine Learning](../r/modify-the-user-account-pool-for-sql-server-r-services.md).

### <a name="optimize-the-server-for-script-execution"></a>Оптимизировать сервер для выполнения скриптов

Параметры по умолчанию для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] установки оптимизации баланса сервера для различных служб. Эти службы включают ETL процессы, отчетов, аудит и приложений, использующих [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] данных.

Если используются параметры по умолчанию, может оказаться ограничен или регулировать, особенно в операции с интенсивным использованием памяти, ресурсов для выполнения внешних скриптов. Если приоритет машинного обучения, измените параметры по умолчанию базы данных, чтобы приоритеты и соответствующим образом ресурсов внешних скриптов с заданиями. Эти изменения могут включать:

+ Сокращение объема памяти, выделенной для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] компонент database engine.
+ Увеличение числа учетных записей работать [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)] службы. Это не увеличивает число ресурсов, но увеличить количество сценариев, которые могут выполняться параллельно.

Если SQL Server Enterprise Edition, использование регулятора ресурсов для настройки внешнего пула ресурсов для Python. Дополнительные сведения см. в следующих статьях:

-   Настройка пула ресурсов для управления внешними ресурсами
  
     [CREATE EXTERNAL RESOURCE POOL &#40;Transact-SQL&#41;](../../t-sql/statements/create-external-resource-pool-transact-sql.md)
  
-   Изменение объема памяти, зарезервированного для ядра СУБД
  
     [Параметры конфигурации сервера памяти сервера](../../database-engine/configure-windows/server-memory-server-configuration-options.md)
  
-   Изменение числа рабочих учетных записей, может быть запущена [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)]
  
     [Изменение пула учетных записей пользователей для SQL Server R Services](../r/modify-the-user-account-pool-for-sql-server-r-services.md)

Если вы используете SQL Server Standard Edition и могут не регулятора ресурсов, можно использовать динамические административные представления и расширенные события для управления ресурсами сервера. Можно также использовать отслеживание событий Windows для этой цели. Дополнительные сведения см. в разделе [мониторинг и управление службами R](../r/managing-and-monitoring-r-solutions.md).

### <a name="upgrade-the-machine-learning-components"></a>Обновление машинного обучения компонентов

При установке службы обучения машины с помощью 2017 г. SQL Server вы получаете версии компонентов во время выпуска была опубликована. Каждый раз, исправление или обновление экземпляра SQL Server, машины обучения обновление компонентов также.

Вы можете обновить машинного обучения компонентов по расписанию быстрее, чем поддерживается только в версиях SQL Server, установив сервер обучения Майкрософт машины. После этого, можно также получить любые новые функции поддерживаются в последнем выпуске машины обучения Server, такие как:

+ Обновления, пакеты Python для [revoscalepy](https://docs.microsoft.com/r-server/python-reference/revoscalepy/revoscalepy-package) и [microsoftml для Python](https://docs.microsoft.com/r-server/python-reference/microsoftml/microsoftml-package).
+ [Обученная моделей](https://docs.microsoft.com/r-server/install/microsoftml-install-pretrained-models) для классификации и текст анализ образов.

Сведения о том, как обновить экземпляр см. в разделе [R Обновление компонентов с помощью привязки](..\r\use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

### <a name="tutorials"></a>Учебники

См. в следующих учебниках для некоторые примеры того, как использовать Python с SQL Server для построения и развертывания решений машины обучения:

[С помощью Python в T-SQL](../tutorials/run-python-using-t-sql.md)

[Создать модель Python, с помощью revoscalepy](../tutorials/use-python-revoscalepy-to-create-model.md)
