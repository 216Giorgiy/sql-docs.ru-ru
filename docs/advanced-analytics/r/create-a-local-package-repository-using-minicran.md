---
title: "Создать репозиторий локального пакета с помощью miniCRAN | Документы Microsoft"
titleSuffix: SQL Server
ms.custom: 
ms.date: 02/20/2018
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 27f2a1ce-316f-4347-b206-8a1b9eebe90b
caps.latest.revision: 
author: jeannt
ms.author: jeannt
manager: cgronlund
ms.workload: Inactive
ms.openlocfilehash: 9d0a234b0b1112ee01f6eb6c67979ae84d72fd92
ms.sourcegitcommit: c08d665754f274e6a85bb385adf135c9eec702eb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2018
---
# <a name="create-a-local-package-repository-using-minicran"></a>Создать репозиторий локального пакета с помощью miniCRAN
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

[MiniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) пакет был создан Андре де Врие компании для поддержки этих общих сценариев: 

+ Анализ пакета зависимостей для одного пакета или набора пакетов
+ Подготовка набор пакетов R для установки на сервер без доступа к Интернету.

Пользователь указывает набор нужные пакеты и рекурсивно miniCRAN считывает дерево зависимостей для этих пакетов и загружает только перечисленные пакеты и их зависимости с CRAN или аналогичные репозиториев.

В качестве выходных данных miniCRAN создает внутреннего согласования репозитория, состоящий из выбранных пакетов и все необходимые зависимости. Затем можно переместить этот локальный репозиторий на сервер и приступить к установке пакеты без использования Интернета.

Опытным пользователям R часто найдите список зависимых пакетов в файл ОПИСАНИЯ для загруженного пакета. Однако пакеты перечисляются в **Imports** могут иметь зависимости второго уровня. По этой причине рекомендуется использовать **miniCRAN** метод.

## <a name="what-is-a-package-repository"></a>Что такое репозитория пакетов

Создание локального пакета репозитория предназначена для того, чтобы в одном месте, администратор сервера или другим пользователям в организации можно использовать для установки новых пакетов R на сервере, который не имеет доступа к Интернету. После создания репозитория, его можно изменить, добавив новые пакеты или обновления версии существующих пакетов.

[MiniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) пакетом для R было написано с [де Врие компании Андре](http://blog.revolutionanalytics.com/2016/05/minicran-sql-server.html) для упрощения создания согласованного, управляемый набор пакетов R в организации. 

Пакет репозиториев полезны в следующих сценариях:

- **Безопасность**: R многие пользователи привык к загрузке и установке новых пакетов R, по желанию, CRAN или одним из его узлов зеркальной. Однако из соображений безопасности рабочих серверов под управлением [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] обычно не подключен к Интернету.

- **Процесс установки в автономном режиме**: для установки пакета для отключения сервера требует также загрузить все зависимости пакета, с помощью miniCRAN упрощает получение всех зависимостей в правильном формате.

    С помощью miniCRAN, можно избежать ошибки пакета зависимостей при подготовке пакеты для установки с [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) инструкции.

- **Улучшенное управление версиями**: В многопользовательской среде есть достаточные основания для того чтобы избежать неограниченный установки нескольких версий пакета на сервере. Используйте локальный репозиторий для предоставления согласованного набора пакетов для использования аналитики. 

> [!TIP]
> Можно также использовать miniCRAN Подготовка пакетов для использования в машинном обучении Azure. Дополнительные сведения см. в записи: [с помощью miniCRAN в Azure ML, Мишель Usuelli](https://www.r-bloggers.com/using-minicran-in-azure-ml/) 

## <a name="prepare-packages-using-minicran"></a>Подготовка пакетов с помощью miniCRAN

**MiniCRAN** сам пакет зависит от 18 пакетов CRAN среди это **RCurl** пакет, который имеет зависимость от системы на **curl devel** пакета. Аналогичным образом, пакет **XML** имеет зависимость от **libxml2 devel**. 

По этим причинам рекомендуется построить изначально ваш локальный репозиторий на компьютере с полный доступ к Интернету, чтобы легко может удовлетворять все зависимости. 

После создания репозитория репозиторий можно переместить в другое место.

### <a name="step-1-install-the-minicran-package"></a>Шаг 1. Установите пакет miniCRAN

Начните с создания **miniCRAN** репозитория для использования в качестве источника. На компьютере, который имеет доступ к Интернету, необходимо создать этот репозиторий.

1. Установка **miniCRAN** пакетов и необходимых **igraph** пакета. В этом примере проверяет ли пакет уже установлен, но вы можете обойти это, если инструкции и непосредственно установки пакетов.

    ```R
    if(!require("miniCRAN")) install.packages("miniCRAN") 
    if(!require("igraph")) install.packages("igraph") 
    library("miniCRAN")
    ```

### <a name="step-2-define-a-package-source-a-cran-mirror-or-an-mran-snapshot"></a>Шаг 2. Определить источник пакета: CRAN зеркала или моментальный снимок MRAN

1. Указываете зеркальный сайт для использования в получении пакетов. Например можно использовать MRAN сайта или любого другого узла в вашем регионе, содержащий нужные пакеты. При сбое загрузки, попробуйте другой зеркальный сайт.

    ```R
    CRAN_mirror <- c(CRAN = "https://mran.microsoft.com")
    CRAN_mirror <- c(CRAN = "https://cran.cnr.berkeley.edu")
    ```

2. Введите имя локальной папке, в котором хранятся собранные пакеты. 

    Необходимо заранее создать папку. Если возникает ошибка `local_repo` папка не существует, при выполнении кода R в более поздней версии.

    Имя папки должно совпадать с описательное имя. Здесь мы использовали «miniCRAN», но если повторить это часто, возможно, следует использовать более описательное имя, например «miniCRANZooPackages» или «miniCRANMyRPackagev2».

    ```R
    local_repo <- "~/miniCRAN"
    ```

    Расширения оператором "тильда" возвращает переменную среды с результатами эквивалентно `Sys.getenv("R_USER")`.

### <a name="step-3-add-packages-to-the-repository"></a>Шаг 3. Добавление пакетов в репозиторий

1. После **miniCRAN** будет установлен, создать список, который указывает дополнительные пакеты, которые требуется загрузить.

    Сделать **не** добавить зависимости к этот исходный список. **Igraph** пакета, используемый **miniCRAN** создает список зависимостей для вас. Дополнительные сведения об использовании диаграммы созданный зависимостей см. в разделе [определить зависимости пакета с помощью miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/vignettes/miniCRAN-dependency-graph.html).

    Следующий скрипт R добавляет пакеты целевой «zoo» и «прогноз» на переменную.

    ```R
    pkgs_needed <- c("zoo", "forecast")
    ```
2. Это не требуется отобразить диаграмму зависимостей, что может быть информативной.
    
    ```R
    plot(makeDepGraph(pkgs_needed))
    ```

3. Создание локального репозитория. Убедитесь, что если требуется изменить версию r.

    ```R
    pkgs_expanded <- pkgDep(pkgs_needed, repos = CRAN_mirror);
    makeRepo(pkgs_expanded, path = local_repo, repos = CRAN_mirror, type = "win.binary", Rversion = "3.3");
    ```

    На основе данных, структура папок, необходимых для копирования пакетов, создаются в пакете miniCRAN [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] позже.

4. На этом этапе должен иметь папку, содержащую пакеты, которые требуется, и любые дополнительные пакеты не требуются.

    Можно запустить следующий код для перечисления пакетов, содержащихся в репозитории miniCRAN.

    ```R
    pdb <- as.data.frame(pkgAvail(local_repo, type = "win.binary", Rversion = "3.3"), stringsAsFactors = FALSE);
    head(pdb);
    pdb$Package;
    pdb[, c("Package", "Version", "License")]
    ```

### <a name="step-4-use-the-repository-to-add-r-packages-to-the-instance-library"></a>Шаг 4. Использование репозитория пакетов R добавляемый экземпляр библиотеки

После создания репозитория и добавлении нужных пакетов необходимо переместить репозитория пакетов на сервере и убедитесь, что R-пакеты устанавливаются в соответствующую библиотеку для использования с SQL Server.

Следующая процедура описывает установку пакетов, с помощью средства R.

1. Скопируйте папку, содержащую репозитории miniCRAN в полном объеме, на сервер, на котором планируется установить пакеты. Папка обычно имеет следующую структуру: корневой miniCRAN > -> bin -> windows -> contrib -> версия не все пакеты "->".

2. Откройте командную строку R с помощью средства R, связанные с экземпляром.

    - Папка по умолчанию для 2017 г. SQL Server — `C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library`.

    - Для SQL Server 2016 по умолчанию используется папка `C:/Program Files/Microsoft SQL Server/MSSQL13.MSSQLSERVER/R_SERVICES/library`.

    - Для именованного экземпляра, путь по умолчанию будет иметь примерно так: `<instance_path>.RTEST/R_SERVICES/library`.

    -  Если вы установили SQL Server на другой диск или внесли другие изменения, касающиеся пути установки, не забудьте отразить их.

3. Получить путь к библиотеке экземпляра и добавить его в список путей к библиотеке.

    ```R
    .libPaths()[1];
    lib <- .libPaths()[1]
    ```

    На сервере SQL Server, эта команда должна возвращать путь библиотеки, связанные с экземпляром, такие как: «C:/Program файлы или Microsoft SQL Server/MSSQL14. MSSQLSERVER/R_SERVICES/библиотека»

4. Укажите новое расположение на сервере, куда был скопирован **miniCRAN** репозитория, как `server_repo`.

    В этом примере предполагается, которые вы скопировали репозитория во временную папку на сервере.

    ```R
    source_repo <- "C:\\temp\\miniCRAN"
    ```

5. Поскольку вы работаете в новую рабочую область R на сервере, также необходимо указать список пакеты для установки.

    ```R
    tspackages <- c("zoo", "forecast")
    ```

6. Установите пакеты, указав путь к локальной копии miniCRAN репозитория.

    ```R
    install.packages(tspackages, repos = file.path("file://", normalizePath;(source_repo, winslash = "/")), lib = lib, type = "win.binary", dependencies = TRUE);
    ```

7. В библиотеке экземпляра можно просмотреть установленные пакеты с помощью команды следующим образом:

    ```R
    installed.packages()
    ```

> [!NOTE] 
> Чтобы использовать пакет в SQL Server, пакеты должны устанавливаться в библиотеке по умолчанию, используемые экземпляром. 

## <a name="manually-install-a-single-package-from-a-zipped-file"></a>Вручную установите один пакет ZIP-файл

Если вы устанавливаете один пакет, не имеет зависимостей или нельзя использовать **miniCRAN**, пакет необходимо также вручную можно загрузить. Для этого требуется наличие единственного владельца сервера или администратора.

После загрузки пакетов, необходимо установить пакеты R из расположения сжатый ZIP-файл.

1. Загрузить пакет в виде ZIP-файл и сохраните его в локальной папке

2. Скопируйте эту папку для [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] компьютера.

3. Установите пакеты в библиотеке экземпляра SQL Server с помощью стандартной команды R. Если пакет имеет зависимости, которые еще не установлены, и их не включены, установка может завершиться неудачно. 

Также можно отправить отдельных пакетов в экземпляр SQL Server 2017 г, с помощью [инструкции СОЗДАНИЯ ВНЕШНЕЙ БИБЛИОТЕКИ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql). Этот процесс также требуется административный доступ.
