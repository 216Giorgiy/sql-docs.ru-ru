---
title: Создать локальный репозиторий пакетов R, с помощью miniCRAN (машинного обучения для SQL Server) | Документы Microsoft
ms.prod: sql
ms.technology: machine-learning
ms.date: 05/29/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 1f7ba3b4acde90d9e416eb092ac80cb0dfcbba8a
ms.sourcegitcommit: 808d23a654ef03ea16db1aa23edab496b73e5072
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2018
ms.locfileid: "34585646"
---
# <a name="create-a-local-r-package-repository-using-minicran"></a>Создать локальный репозиторий пакетов R, с помощью miniCRAN
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

[miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) пакет, созданный [де Врие Андре компании](http://blog.revolutionanalytics.com/2016/05/minicran-sql-server.html), идентифицирует и загружает пакеты и зависимости в одну папку, которую можно копировать на другие компьютеры для автономной установки R-пакета.

В качестве входных данных укажите один или несколько пакетов. **miniCRAN** рекурсивно считывает дерево зависимостей для этих пакетов и загружает только перечисленные пакеты и их зависимости с CRAN или аналогичные репозиториев.

В качестве выходных данных **miniCRAN** создает внутреннего согласования репозитория, состоящий из выбранных пакетов и все необходимые зависимости. Затем можно переместить этот локальный репозиторий на сервер и приступить к установке пакетов без подключения к Интернету.

> [!NOTE]
> Опытным пользователям R часто найдите список зависимых пакетов в файл ОПИСАНИЯ для загруженного пакета. Однако пакеты перечисляются в **Imports** могут иметь зависимости второго уровня. По этой причине мы рекомендуем **miniCRAN** для сборки полную совокупность необходимые пакеты.

## <a name="why-create-a-local-repository"></a>Зачем создавать локальный репозиторий

Создание локального пакета репозитория предназначена для того, чтобы в одном месте, администратор сервера или другим пользователям в организации можно использовать для установки новых пакетов R на сервере, особенно тот, который не имеет доступа к Интернету. После создания репозитория, его можно изменить, добавив новые пакеты или обновления версии существующих пакетов.

Пакет репозиториев полезны в следующих сценариях:

- **Безопасность**: R многие пользователи привык к загрузке и установке новых пакетов R, по желанию, CRAN или одним из его узлов зеркальной. Однако из соображений безопасности рабочих серверов под управлением [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] обычно не подключен к Интернету.

- **Процесс установки в автономном режиме**: для установки пакета для отключения сервера требует также загрузить все зависимости пакета, с помощью miniCRAN упрощает получение всех зависимостей в правильном формате.

    С помощью miniCRAN, можно избежать ошибки пакета зависимостей при подготовке пакеты для установки с [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) инструкции.

- **Улучшенное управление версиями**: В многопользовательской среде есть достаточные основания для того чтобы избежать неограниченный установки нескольких версий пакета на сервере. Используйте локальный репозиторий для предоставления согласованного набора пакетов для использования аналитики. 

> [!TIP]
> Можно также использовать miniCRAN Подготовка пакетов для использования в машинном обучении Azure. Дополнительные сведения см. в записи: [с помощью miniCRAN в Azure ML, Мишель Usuelli](https://www.r-bloggers.com/using-minicran-in-azure-ml/) 

## <a name="install-minicran"></a>Установить miniCRAN

**MiniCRAN** сам пакет зависит от 18 пакетов CRAN среди это **RCurl** пакет, который имеет зависимость от системы на **curl devel** пакета. Аналогичным образом, пакет **XML** имеет зависимость от **libxml2 devel**. Чтобы разрешить зависимости, рекомендуется построить изначально ваш локальный репозиторий на компьютере с полным доступом к Интернету. 

Выполните следующие команды на компьютере с базовым R, средства R и подключения к Интернету. Предполагается, что это *не* компьютера с SQL Server. Следующие команды устанавливают **miniCRAN** пакетов и необходимых **igraph** пакета. В этом примере проверяет ли пакет уже установлен, но вы можете обойти это, если инструкции и непосредственно установки пакетов.

```R
if(!require("miniCRAN")) install.packages("miniCRAN") 
if(!require("igraph")) install.packages("igraph") 
library("miniCRAN")
```

## <a name="set-the-cran-mirror-and-mran-snapshot"></a>Задать CRAN зеркальный сервер и MRAN моментальных снимков

Указываете зеркальный сайт для использования в получении пакетов. Например можно использовать MRAN сайта или любого другого узла в вашем регионе, содержащий нужные пакеты. При сбое загрузки, попробуйте другой зеркальный сайт.

```R
CRAN_mirror <- c(CRAN = "https://mran.microsoft.com")
CRAN_mirror <- c(CRAN = "https://cran.cnr.berkeley.edu")
```

## <a name="create-a-local-folder"></a>Создать локальную папку

Создать локальную папку, например `C:\mylocalrepo` для хранения собранных пакетов. Если повторить это часто, возможно, следует использовать более описательное имя, например «miniCRANZooPackages» или «miniCRANMyRPackagev2».

Задайте папку в качестве локального репозитория. Синтаксис R использует косую черту для пути, которой является противоположностью из соглашений по Windows.

```R
local_repo <- "C:/mylocalrepo"
```

## <a name="add-packages-to-the-local-repo"></a>Добавление пакетов в локальном репозитории

После **miniCRAN** установки и загрузки, создать список, который указывает дополнительные пакеты, которые требуется загрузить.

Сделать **не** добавить зависимости к этот исходный список. **Igraph** пакета, используемый **miniCRAN** создает список зависимостей для вас. Дополнительные сведения об использовании диаграммы созданный зависимостей см. в разделе [определить зависимости пакета с помощью miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/vignettes/miniCRAN-dependency-graph.html).

1. Добавление целевого пакетов, «zoo» и «прогноз» на переменную.

    ```R
    pkgs_needed <- c("zoo", "forecast")
    ```

2. При необходимости построения графика зависимостей, но может быть информативной.
    
    ```R
    plot(makeDepGraph(pkgs_needed))
    ```

3. Создание локального репозитория. Не забудьте изменить версию R, при необходимости, до версии, установленных на экземпляре SQL Server. Версия 3.2.2 на SQL Server 2016, версии 3.3 включен 2017 г. SQL Server. Если вы выполнили обновление компонента, ваша версия может оказаться более новым. Дополнительные сведения см. в разделе [данные пакетов R, получения и Python](determine-which-packages-are-installed-on-sql-server.md).

    ```R
    pkgs_expanded <- pkgDep(pkgs_needed, repos = CRAN_mirror);
    makeRepo(pkgs_expanded, path = local_repo, repos = CRAN_mirror, type = "win.binary", Rversion = "3.3");
    ```

   На основе данных, структура папок, необходимых для копирования пакетов, создаются в пакете miniCRAN [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] позже.

На этом этапе должен иметь папку, содержащую пакеты, которые требуется, и любые дополнительные пакеты не требуются. Путь должен быть как показано в примере: C:\mylocalrepo\bin\windows\contrib\3.3 и он должен содержать коллекцию ZIP-пакеты. Не Распакуйте пакеты или переименовать файлы.

При необходимости выполните следующий код, чтобы вывести список пакетов, содержащихся в хранилище локального miniCRAN.

```R
pdb <- as.data.frame(pkgAvail(local_repo, type = "win.binary", Rversion = "3.3"), stringsAsFactors = FALSE);
head(pdb);
pdb$Package;
pdb[, c("Package", "Version", "License")]
```

## <a name="add-packages-to-the-instance-library"></a>Добавление пакетов в библиотеку экземпляра

После локального репозитория с нужных пакетов, переместите репозитория пакетов на сервере SQL Server. Следующая процедура описывает установку пакетов, с помощью средства R.

1. Скопируйте папку, содержащую репозитории miniCRAN в полном объеме, на сервер, на котором планируется установить пакеты. Папка обычно имеет следующую структуру: корневой miniCRAN > bin > windows > contrib > версии > все пакеты. В следующих примерах предполагается папку off в корне диска: 

2. Откройте средство R, связанные с экземпляром (например, можно использовать Rgui.exe). Щелкните правой кнопкой мыши **Запуск от имени администратора** чтобы разрешить средству для выполнения обновлений в системе.

    - Для SQL Server 2017 г задано расположение файла для RGUI `C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64`.

    - Для SQL Server 2016 — расположение файла для RGUI `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\bin\x64`.

3. Получить путь к библиотеке экземпляра и добавить его в список путей к библиотеке. В SQL Server 2017 г путь примерно в следующем примере.

    ```R
    outputlib <- "C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library"
    ```

4. Укажите новое расположение на сервере, куда был скопирован **miniCRAN** репозитория, как `server_repo`.

    В этом примере предполагается, которые вы скопировали репозитория во временную папку на сервере.

    ```R
    inputlib <- "C:/temp/mylocalrepo"
    ```

5. Поскольку вы работаете в новую рабочую область R на сервере, также необходимо указать список пакеты для установки.

    ```R
    mypackages <- c("zoo", "forecast")
    ```

6. Установите пакеты, указав путь к локальной копии miniCRAN репозитория.

    ```R
    install.packages(mypackages, repos = file.path("file://", normalizePath(inputlib, winslash = "/")), lib = outputlib, type = "win.binary", dependencies = TRUE);
    ```

7. В библиотеке экземпляра можно просмотреть установленные пакеты с помощью команды следующим образом:

    ```R
    installed.packages()
    ```

## <a name="see-also"></a>См. также

+ [Получение сведений о пакете](determine-which-packages-are-installed-on-sql-server.md)
+ [Учебники R](../tutorials/sql-server-r-tutorials.md)
+ [Практические руководства](sql-server-machine-learning-tasks.md)


