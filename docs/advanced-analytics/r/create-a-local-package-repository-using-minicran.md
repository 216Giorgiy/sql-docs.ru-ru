---
title: "Создать репозиторий локального пакета с помощью miniCRAN | Документы Microsoft"
ms.custom: 
ms.date: 01/04/2018
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 27f2a1ce-316f-4347-b206-8a1b9eebe90b
caps.latest.revision: "4"
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 066e09747684ede5837d93736f32792736b8985d
ms.sourcegitcommit: 60d0c9415630094a49d4ca9e4e18c3faa694f034
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/09/2018
---
# <a name="create-a-local-package-repository-using-minicran"></a>Создать репозиторий локального пакета с помощью miniCRAN

Существует два способа, можно подготовить R-пакеты для установки на сервер без доступа к Интернету.

-   [Используйте пакет miniCRAN для создания одного локального репозитория](#bkmk_miniCRAN)

    [MiniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) создает внутреннего согласования репозитория, состоящий из выбранных пакетов из репозиториев CRAN like. Пользователь указывает набор нужные пакеты и рекурсивно miniCRAN считывает дерево зависимостей для этих пакетов и загружает только перечисленные пакеты и их зависимости.

    Затем можно переместить этот локальный репозиторий на сервер и приступить к установке пакеты без использования Интернета.

-   [Вручную Загрузите и скопируйте пакеты один за другим](#bkmk_manual)

    Список зависимых пакетов можно найти в файле ОПИСАНИЯ для загруженного пакета. 
    
    Однако пакеты перечисляются в **Imports** могут иметь зависимости второго уровня. По этой причине рекомендуется использовать **miniCRAN** метод.

> [!TIP]
> Знали ли вы, что можно использовать miniCRAN Подготовка пакетов для использования в машинном обучении Azure? Дополнительные сведения см. в записи: [с помощью miniCRAN в Azure ML, Мишель Usuelli](https://www.r-bloggers.com/using-minicran-in-azure-ml/) 

## <a name="prepare-packages-using-minicran"></a>Подготовка пакетов с помощью miniCRAN

Создание локального пакета репозитория предназначена для того, чтобы в одном месте, администратор сервера или другим пользователям в организации можно использовать для установки новых пакетов R на сервере, который не имеет доступа к Интернету.

[MiniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) пакетом для R было написано с [де Врие компании Андре](http://blog.revolutionanalytics.com/2016/05/minicran-sql-server.html) для упрощения создания согласованного, управляемый набор пакетов R в организации. 

Есть много преимуществ, с помощью miniCRAN для создания репозитория:

-   **Безопасность**: R многие пользователи привык к загрузке и установке новых пакетов R, по желанию, CRAN или одним из его узлов зеркальной. Однако из соображений безопасности рабочих серверов под управлением [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] обычно не подключен к Интернету.

-   **Процесс установки в автономном режиме**: для установки пакета для отключения сервера требует также загрузить все зависимости пакета, с помощью miniCRAN упрощает получение всех зависимостей в правильном формате.

-   **Улучшенное управление версиями**: В многопользовательской среде есть достаточные основания для того чтобы избежать неограниченный установки нескольких версий пакета на сервере.

После создания репозитория, его можно изменить, добавив новые пакеты или обновления версии существующих пакетов.

> [!NOTE]
> Сам пакет miniCRAN является зависимым от 18 другими пакетами CRAN, среди которых является RCurl пакета, который зависит от системы перелистывание devel пакета. Аналогичным образом код XML пакета имеет зависимость от libxml2 devel. Мы рекомендуем, таким образом, создать ваш локальный репозиторий изначально на компьютере с полный доступ к Интернету, чтобы может легко выполнить эти зависимости. После создания репозитория можно переместить в другое место.

### <a name="step-1-install-the-minicran-package"></a>Шаг 1. Установите пакет miniCRAN

Начните с создания репозитория miniCRAN для использования в качестве источника. На компьютере, который имеет доступ к Интернету, необходимо создать этот репозиторий.

1.  Установка пакета miniCRAN и необходимая **igraph** пакета.

    ```R
    if(!require("miniCRAN")) install.packages("miniCRAN") if(!require("igraph"))
    install.packages("igraph") library(miniCRAN)
    ```

### <a name="step-2-define-a-package-source-a-cran-mirror-or-an-mran-snapshot"></a>Шаг 2. Определить источник пакета: CRAN зеркала или моментальный снимок MRAN

1. Указываете зеркальный сайт для использования в получении пакетов.

    ```R
    CRAN_mirror \<- c(CRAN = "https://mran.microsoft.com/snapshot/2017-08-01")
    ```

2.  Введите имя локальной папке, в котором хранятся собранные пакеты. 

    Необходимо заранее создать папку. Если возникает ошибка `local_repo` папка не существует, при выполнении кода R в более поздней версии.

    Имя папки должно совпадать с описательное имя. Например, старайтесь не использовать «miniCRAN» и вместо этого введите любой как «GeneticsPackages» или «TeamRPackages1.0.2».

    ```R
    local_repo <- "~/miniCRAN"
    ```

    Расширения оператором "тильда" возвращает переменную среды с результатами эквивалентно `Sys.getenv("R_USER")`.

### <a name="step-3-add-packages-to-the-repository"></a>Шаг 3. Добавление пакетов в репозиторий

1.  После установки miniCRAN создайте список, который указывает дополнительные пакеты, которые требуется загрузить.

    Не добавляйте зависимости для этого начального списка; **igraph** пакета, используемый miniCRAN создает список зависимостей для вас. Дополнительные сведения об использовании диаграммы созданный зависимостей см. в разделе [определить зависимости пакета с помощью miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/vignettes/miniCRAN-dependency-graph.html).

    Следующий скрипт R показано, как получить целевой пакеты, «zoo» и «прогноза».

    ```R
    pkgs_needed <- c("zoo", "forecast")
    ```
2. Это не требуется отобразить диаграмму зависимостей, что может быть информативной.
    
    ```R
    plot(makeDepGraph(pkgs_needed))
    ```

3. Создание локального репозитория. Убедитесь, что если требуется изменить версию r.

    ```R
    pkgs_expanded <- pkgDep(pkgs_needed, repos = CRAN_mirror)
    makeRepo(pkgs_expanded, path = local_repo, repos = CRAN_mirror, type = "win.binary", Rversion = "3.3")
    ```

    На основе данных, структура папок, необходимых для копирования пакетов, создаются в пакете miniCRAN [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] позже.

4. На этом этапе должен иметь папку, содержащую пакеты, которые требуется, и любые дополнительные пакеты не требуются.

    Можно запустить следующий код для перечисления пакетов, содержащихся в репозитории miniCRAN.

    ```R
    pdb <- as.data.frame(pkgAvail(local_repo, type = "win.binary", Rversion = "3.3"), stringsAsFactors = FALSE)
    head(pdb)
    pdb$Package
    pdb[, c("Package", "Version", "License")]
    ```

### <a name="step-4-use-the-repository-to-add-r-packages-to-the-instance-library"></a>Шаг 4. Использование репозитория пакетов R добавляемый экземпляр библиотеки

После создания репозитория и добавлении нужных пакетов необходимо переместить репозитория пакетов на сервере и убедитесь, что R-пакеты устанавливаются в соответствующую библиотеку для использования с SQL Server.

В зависимости от версии SQL Server существует два варианта для добавления новых пакетов в библиотеке R, связанные с экземпляром SQL Server:

- Установите в библиотеку экземпляра с помощью средств R и miniCRAN репозитория.

- Отправить пакеты в базе данных SQL Server и установить с помощью инструкции СОЗДАНИЯ ВНЕШНЕЙ БИБЛИОТЕКИ. Этот параметр требует 2017 г. SQL Server. В разделе [Установка дополнительных пакетов R в SQL Server](install-additional-r-packages-on-sql-server.md).

Следующая процедура описывает установку пакетов, с помощью средства R.

1. Скопируйте папку, содержащую репозитории miniCRAN в полном объеме, на сервер, на котором планируется установить пакеты.

2. Откройте командную строку R с помощью средства R, связанные с экземпляром.

    - Папка по умолчанию для 2017 г. SQL Server — `C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library`.

    - Для SQL Server 2016 по умолчанию используется папка `C:/Program Files/Microsoft SQL Server/MSSQL13.MSSQLSERVER/R_SERVICES/library`.

    - Для именованного экземпляра, путь по умолчанию будет иметь примерно так: `<instance_path>.RTEST/R_SERVICES/library`.

    -  Если вы установили SQL Server на другой диск или внесли другие изменения, касающиеся пути установки, не забудьте отразить их.

3.  Получить путь к библиотеке экземпляра и добавить его в список путей к библиотеке.

    ```R
    .libPaths()[1]  
    lib \<- .libPaths()[1]
    ```

    На сервере SQL Server, эта команда должна возвращать путь библиотеки, связанные с экземпляром, такие как: «C:/Program файлы или Microsoft SQL Server/MSSQL14. MSSQLSERVER/R_SERVICES/библиотека»

4.  Укажите расположение на сервере, куда был скопирован в репозитории mininCRAN `server_repo`.

    В этом примере предполагается, что репозитория скопированы в папку пользователя на сервере.

    ```R
    R server_repo <- "C:\\Users\\MyUserName\\miniCRAN"
    ```

5.  Поскольку вы работаете в новую рабочую область R на сервере, также необходимо указать список пакеты для установки.

    ```R
    tspackages <- c("zoo", "forecast")
    ```

6.  Установите пакеты, указав путь к локальной копии miniCRAN репозитория.

    ```R
    install.packages(tspackages, repos = file.path("file://", normalizePath(server_repo, winslash = "/")), lib = lib, type = "win.binary", dependencies = TRUE)
    ```

7.  В библиотеке экземпляра можно просмотреть установленные пакеты с помощью команды следующим образом:

    ```R
    installed.packages()
    ```

> [!NOTE] 
> В SQL Server администратор сервера необходимо установить пакеты из репозитория miniCRAN в библиотеке по умолчанию, используемые экземпляром. 

## <a name="manually-download-single-packages"></a>Вручную Загрузите один пакетов

Если вы не хотите использовать miniCRAN, можно также вручную загрузить необходимые пакеты и их зависимости. Для этого требуется наличие единственного владельца сервера или администратора.

После загрузки пакетов, необходимо установить пакеты R из расположения сжатый ZIP-файл.

1. Загрузите ZIP-файлы пакетов и сохраните их в локальной папке

2. Скопируйте эту папку для [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] компьютера.

3. Установите пакеты в библиотеке экземпляра SQL Server.

> [!NOTE]
> При использовании средств R для установки пакетов, они устанавливаются для экземпляра в целом. 
> 
> Если требуется установить пакет в базу данных и обмениваться с ним пакет с пользователями с помощью ролей базы данных, необходимо загрузить библиотеку с помощью инструкции СОЗДАНИЯ ВНЕШНЕЙ БИБЛИОТЕКИ. В разделе [Установка дополнительных R-пакетов в SQL Server](install-additional-r-packages-on-sql-server.md)
