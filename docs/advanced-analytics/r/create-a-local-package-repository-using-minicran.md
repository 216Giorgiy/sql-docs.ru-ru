---
title: "Создать репозиторий локального пакета с помощью miniCRAN | Документы Microsoft"
ms.custom: 
ms.date: 09/29/2017
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: r-services
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 27f2a1ce-316f-4347-b206-8a1b9eebe90b
caps.latest.revision: "4"
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: f78470d347c96186f0960530a7482d22e4bc4e49
ms.sourcegitcommit: 23433249be7ee3502c5b4d442179ea47305ceeea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2017
---
# <a name="create-a-local-package-repository-using-minicran"></a>Создать репозиторий локального пакета с помощью miniCRAN

Существует два способа, можно подготовить R-пакеты для установки на сервер без доступа к Интернету.

-   [Используйте пакет miniCRAN для создания одного локального репозитория](#bkmk_miniCRAN)

    [MiniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) создает внутреннего согласования репозитория, состоящий из выбранных пакетов из репозиториев CRAN like. Пользователь указывает набор нужные пакеты и рекурсивно miniCRAN считывает дерево зависимостей для этих пакетов и загружает только перечисленные пакеты и их зависимости.

    Затем можно переместить этот локальный репозиторий на сервер и приступить к установке пакеты без использования Интернета.

-   [Вручную Загрузите и скопируйте пакеты один за другим](#bkmk_manual)

В этой статье описываются способы создания репозитория пакетов R, используя оба метода, и корпорация Майкрософт рекомендует использовать **miniCRAN** пакета.

## <a name="prepare-packages-using-minicran"></a>Подготовка пакетов с помощью miniCRAN

Создание локального пакета репозитория предназначена для того, чтобы в одном месте, администратор сервера или другим пользователям в организации можно использовать для установки новых пакетов R на сервере, который не имеет доступа к Интернету.

[MiniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) пакетом для R было написано с [де Врие компании Андре](http://blog.revolutionanalytics.com/2016/05/minicran-sql-server.html) для упрощения создания согласованного, управляемый набор пакетов R в организации. 

Есть много преимуществ, с помощью miniCRAN для создания репозитория:

-   **Безопасность**: R многие пользователи привык к загрузке и установке новых пакетов R, по желанию, CRAN или одним из его узлов зеркальной. Однако из соображений безопасности рабочих серверов под управлением [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] обычно не подключен к Интернету.

-   **Процесс установки в автономном режиме**: для установки пакета для отключения сервера требует также загрузить все зависимости пакета, с помощью miniCRAN упрощает получение всех зависимостей в правильном формате.

-   **Улучшенное управление версиями**: В многопользовательской среде есть достаточные основания для того чтобы избежать неограниченный установки нескольких версий пакета на сервере.

После создания репозитория, его можно изменить, добавив новые пакеты или обновления версии существующих пакетов.

### <a name="step-1-install-the-minicran-package"></a>Шаг 1. Установите пакет miniCRAN

Начните с создания репозитория miniCRAN для использования в качестве источника. На компьютере, который имеет доступ к Интернету, необходимо создать этот репозиторий.

1.  Установка пакета miniCRAN и необходимая **igraph** пакета.

    ```R
    if(!require("miniCRAN")) install.packages("miniCRAN") if(!require("igraph"))
    install.packages("igraph") library(miniCRAN)
    ```

### <a name="step-2-define-a-package-source-a-cran-mirror-or-an-mran-snapshot"></a>Шаг 2. Определить источник пакета: CRAN зеркала или моментальный снимок MRAN

1. Указываете зеркальный сайт для использования в получении пакетов.

    ```R
    CRAN_mirror \<- c(CRAN = "https://mran.microsoft.com/snapshot/2017-08-01")
    ```

2.  Укажите локальную папку, в которой хранятся собранные пакеты. Не имя miniCRAN папки; Это может быть более описательное имя, например «GeneticsPackages» или «ClientRPackages1.0.2».

    Убедитесь создать папку заранее. Если возникает ошибка `local_repo` папка не существует, при выполнении кода R в более поздней версии.

    ```R
    local_repo <- "~/miniCRAN"
    ```

    Расширения оператором "тильда" возвращает переменную среды с результатами эквивалентно `Sys.getenv("R_USER")`.

### <a name="step-3-add-packages-to-the-repository"></a>Шаг 3. Добавление пакетов в репозиторий

1.  После установки miniCRAN создайте список, который указывает дополнительные пакеты, которые требуется загрузить.

    Не добавляйте зависимости для этого начального списка; **igraph** пакета, используемый miniCRAN создает список зависимостей для вас. Дополнительные сведения об использовании этой диаграммы см. в разделе [определить зависимости пакета с помощью miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/vignettes/miniCRAN-dependency-graph.html).

    Следующий скрипт R показано, как получить целевой пакеты, «zoo» и «прогноза».

    ```R
    pkgs_needed <- c("zoo", "forecast")
    ```
2. При необходимости отобразите диаграмму зависимостей, который может быть информативной и стильного вида.
    
    ```R
    plot(makeDepGraph(pkgs_needed))
    ```

3. Создание локального репозитория. Убедитесь, что если требуется изменить версию r.

    ```R
    pkgs_expanded <- pkgDep(pkgs_needed, repos = CRAN_mirror)
    makeRepo(pkgs_expanded, path = local_repo, repos = CRAN_mirror, type = "win.binary", Rversion = "3.3")
    ```

    На основе данных, структура папок, необходимых для копирования пакетов, создаются в пакете miniCRAN [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] позже.

4. На этом этапе должен иметь папку, содержащую пакеты, которые требуется, и любые дополнительные пакеты не требуются.

    Можно запустить следующий код для перечисления пакетов, содержащихся в репозитории miniCRAN.

    ```R
    pdb <- as.data.frame(pkgAvail(local_repo, type = "win.binary", Rversion = "3.3"), stringsAsFactors = FALSE)
    head(pdb)
    pdb$Package
    pdb[, c("Package", "Version", "License")]
    ```

### <a name="step-4-use-the-repository-to-add-r-packages-to-the-instance-library"></a>Шаг 4. Использование репозитория пакетов R добавляемый экземпляр библиотеки

После создания репозитория и добавлении нужных пакетов необходимо переместить репозитория пакетов на сервере и убедитесь, что R-пакеты устанавливаются в соответствующую библиотеку для использования с SQL Server.

В зависимости от версии SQL Server существует два варианта для добавления новых пакетов в библиотеке R, связанные с экземпляром SQL Server:

-   Установите в библиотеку экземпляра с помощью средств R и miniCRAN репозитория.

-   Отправить пакеты в базе данных SQL и установите пакеты отдельно для каждой базы данных, с помощью инструкции СОЗДАНИЯ ВНЕШНЕЙ БИБЛИОТЕКИ. В разделе [Установка дополнительных пакетов R в SQL Server](install-additional-r-packages-on-sql-server.md).

Следующая процедура описывает установку пакетов, с помощью средства R.

1.  Скопируйте папку, содержащую репозитории miniCRAN в полном объеме, на сервер, где будут установлены пакеты.

2.  Откройте командную строку R с помощью средства R, связанные с экземпляром.

    - Папка по умолчанию для 2017 г. SQL Server — `C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library`.

    - Для SQL Server 2016 по умолчанию используется папка `C:/Program Files/Microsoft SQL Server/MSSQL13.MSSQLSERVER/R_SERVICES/library`.

    - Для именованного экземпляра, путь по умолчанию будет иметь примерно так: `<instance_path>.RTEST/R_SERVICES/library`.

    -  Если вы установили SQL Server на другой диск или внесли другие изменения, касающиеся пути установки, не забудьте отразить их.

3.  Получить путь к библиотеке экземпляра (в случае, в котором вы находитесь в каталоге пользователя) и добавить его в список путей к библиотеке.

    ```R
    .libPaths()[1]  
    lib \<- .libPaths()[1]
    ```

    Данный метод должен вернуть путь к экземпляру «C:/Program файлы или Microsoft SQL Server/MSSQL14. MSSQLSERVER/R_SERVICES/библиотека»

2.  Укажите расположение на сервере, куда был скопирован в репозитории mininCRAN `server_repo`.

    В этом примере предполагается, что репозитория скопированы в папку пользователя на сервере.

    ```R
    R server_repo <- "C:\\Users\\MyUserName\\miniCRAN"
    ```

3.  Поскольку вы работаете в новую рабочую область R на сервере, также необходимо указать список пакеты для установки.

    ```R
    tspackages <- c("zoo", "forecast")
    ```

4.  Установите пакеты, используя путь к локальной копии репозитория miniCRAN.

    ```R
    install.packages(tspackages, repos = file.path("file://", normalizePath(server_repo, winslash = "/")), lib = lib, type = "win.binary", dependencies = TRUE)
    ```

5.  Теперь можно просмотрите установленные пакеты.

    ```R
    installed.packages()
    ```

> [!NOTE] 
> 
> На 2017 г. SQL Server помогающий администраторам сервера управления разрешениями на пакеты предоставляются дополнительные базы данных и инструкции T-SQL. Администратор базы данных может быть владельцем задачу установки пакетов с помощью R или T-SQL, при желании. Тем не менее администратор базы данных также роли можно использовать для предоставления пользователям возможность устанавливать их собственных пакетов. Дополнительные сведения см. в разделе [R пакета управления для SQL Server](r-package-management-for-sql-server-r-services.md).
> 
> В SQL Server 2016 администратором сервера необходимо установить пакеты из репозитория miniCRAN в библиотеке по умолчанию, используемые экземпляром. Чтобы сделать это, используйте средства R, как описано в [предшествующий раздел](#bkmk_Rtools).

## <a name="manually-download-single-packages"></a>Вручную Загрузите один пакетов

Если вы не хотите использовать miniCRAN, можно также вручную загрузить необходимые пакеты и их зависимости. Для этого требуется наличие единственного владельца сервера или администратора.

После загрузки пакетов, необходимо установить пакеты R из расположения сжатый ZIP-файл.

1.  Загрузите ZIP-файлы пакетов и сохраните их в локальной папке

2.  Скопируйте эту папку для [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)] компьютера.

3.  Установите пакеты в библиотеке экземпляра SQL Server.

> [!NOTE]
> При использовании средств R для установки пакетов, они устанавливаются для экземпляра в целом. 
> 
> Если требуется установить пакет в базу данных и обмениваться с ним пакет с пользователями с помощью ролей базы данных, необходимо загрузить библиотеку с помощью инструкции СОЗДАНИЯ ВНЕШНЕЙ БИБЛИОТЕКИ. В разделе [Установка дополнительных R-пакетов в SQL Server](install-additional-r-packages-on-sql-server.md)
