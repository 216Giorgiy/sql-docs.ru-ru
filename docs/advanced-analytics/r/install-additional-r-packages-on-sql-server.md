---
title: "Установка дополнительных пакетов R в SQL Server | Документы Microsoft"
ms.date: 03/05/2018
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 21456462-e58a-44c3-9d3a-68b4263575d7
caps.latest.revision: 
author: jeannt
ms.author: jeannt
manager: cgronlund
ms.workload: On Demand
ms.openlocfilehash: acb1727c85cae1d8176703c93cc77c971980d394
ms.sourcegitcommit: ab25b08a312d35489a2c4a6a0d29a04bbd90f64d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2018
---
# <a name="install-additional-r-packages-on-sql-server"></a>Установка дополнительных пакетов R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье описывается установка нового R-пакетов в экземпляр SQL Server, где включена машинного обучения.

Существует несколько методов для установки новых пакетов R, в зависимости от версии SQL Server имеется, и является ли сервер имеет доступ к Интернету.

+ [Установить новые пакеты, с помощью средств R с доступом в Интернет](#bkmk_rInstall)

    Используйте обычные команды R для установки пакетов из Интернета. Это — самый простой метод, но требуется административный доступ.

    **Применяется к:**[!INCLUDE[sssql15-md](../../includes/sssql15-md.md)][!INCLUDE[rsql-productname-md](../../includes/rsql-productname-md.md)]. Также требуется для экземпляров [!INCLUDE[sssql17-md](../../includes/sssql17-md.md)] [!INCLUDE[rsql-productnamenew-md](../../includes/rsql-productnamenew-md.md)] где пакета управления через DDL не включен.

+ [Установить новые пакеты R на сервере с **не** доступ к Интернету](#bkmk_offlineInstall)

    Если сервер не имеет доступа к Интернету, некоторые дополнительные действия необходимы для подготовки пакеты. В этом разделе описывается Подготовка файлы, необходимые для установки пакета и его зависимости.

+ [Установить пакеты, используя инструкцию СОЗДАНИЯ ВНЕШНЕЙ БИБЛИОТЕКИ](#bkmk_createlibrary) 

    [Создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) инструкции предоставляются в SQL Server 2017 г, чтобы сделать возможным создание библиотеки пакет без выполнения R или Python code напрямую. Однако этот метод требует заранее подготовить все необходимые пакеты и требуются дополнительные базы данных разрешения.

    **Применяется к:** [!INCLUDE[sssql17-md](../../includes/sssql17-md.md)] [!INCLUDE[rsql-productnamenew-md](../../includes/rsql-productnamenew-md.md)]; других ограничений.

## <a name="bkmk_rInstall"></a> Установка нового R-пакетов через Интернет

Можно использовать стандартные средства R, чтобы установить новые пакеты на экземпляре SQL Server 2016 или 2017 г. SQL Server. Этот процесс требует, что вы являетесь администратором на компьютере.

> [!IMPORTANT] 
> Не забудьте установить пакеты из библиотеки по умолчанию, связанный с текущим экземпляром. Никогда не устанавливать пакеты в каталоге пользователя.

В этой процедуре описывается способ установки пакетов с помощью RGui; Тем не менее можно использовать RTerm или любые другие командной строки средства R, поддерживающий доступ с повышенными привилегиями.

### <a name="install-a-package-using-rgui-or-rterm"></a>Установка пакета с помощью RGui или RTerm

1. Перейдите в папку на сервере, где установлены библиотеки R для экземпляра.

  **Экземпляр по умолчанию**

    SQL Server 2017: `C:\Program Files\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64`
    
    SQL Server 2016: `C:\Program Files\MSSQL13.MSSQLSERVER\R_SERVICES\bin\x64`

  **Именованный экземпляр**

    SQL Server 2017: `C:\Program files\MSSQL14.<instanceName>\R_SERVICES\bin\x64`
    
    SQL Server 2016: `C:\Program files\MSSQL13.<instanceName>\R_SERVICES\bin\x64`

  При использовании привязки для обновления машинного обучения компоненты могли измениться путь. Всегда проверяйте путь к экземпляру, прежде чем устанавливать новые пакеты. 

2. Щелкните правой кнопкой мыши RGui.exe и выберите **Запуск от имени администратора**.

    Если у вас необходимые разрешения, обратитесь к администратору базы данных и укажите список нужных пакетов.

3. Из командной строки, если известно имя пакета, можно ввести: `install.packages("the_package-name")` двойные кавычки необходимы для имени пакета.

4. Если указать зеркальный сайт, выберите любой сайт, удобный для вашего расположения.

5. Если целевой пакет зависит от дополнительных пакетов, установщик R автоматически загружаются зависимости и установит их.

6. Для каждого экземпляра, где необходимо использовать пакет выполните установку отдельно. Пакеты не могут использоваться совместно экземпляров.

## <a name = "bkmk_offlineInstall"></a> Автономной установки с помощью средств r.

Чтобы установить пакеты R на сервере, который не имеет доступа к Интернету, необходимо выполнить следующее:

+ Заранее анализа зависимостей.
+ Загрузите целевой пакет на компьютере с доступом в Интернет.
+ Загрузите необходимые пакеты на одном компьютере и во всех пакетов в архиве одного пакета.
+ Если она отсутствует в сжатый формат ZIP-архиве.
+ Скопируйте пакет архив расположение на сервере.
+ Установите пакет цели, указав файл архива в качестве источника.

> [!IMPORTANT] 
> > Убедитесь, что все зависимости проанализировать и загрузить **все** необходимые пакеты **перед** начала установки. Мы рекомендуем [miniCRAN](https://mran.microsoft.com/package/miniCRAN) для этого процесса. Этот пакет R принимает список пакетов, необходимо установить, анализирует зависимости и получает ZIP-файл. затем miniCRAN создает одного репозитория, можно скопировать на сервер.
> 
> Дополнительные сведения см. в разделе [Создать репозиторий локального пакета с помощью miniCRAN](create-a-local-package-repository-using-minicran.md)

Эта процедура предполагает, что вы подготовили пакетов, необходимых, сжатый формат и все готово для их копирования на сервере.

1. Копировать пакет ZIP-файл, или для нескольких пакетов завершения репозиторий, содержащий все пакеты в ZIP-формате, в расположении, доступном для сервера.

2. Откройте папку на сервере, где установлены библиотеки R для экземпляра. Например при использовании командной строки Windows, перейдите в каталог, где находятся RTerm.Exe или RGui.exe.

  **Экземпляр по умолчанию**

    SQL Server 2017: `C:\Program Files\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64`
    
    SQL Server 2016: `C:\Program Files\MSSQL13.MSSQLSERVER\R_SERVICES\bin\x64`

  **Именованный экземпляр**

    SQL Server 2017: `C:\Program files\MSSQL14.<instanceName>\R_SERVICES\bin\x64`
    
    SQL Server 2016: `C:\Program files\MSSQL13.<instanceName>\R_SERVICES\bin\x64`

3. Щелкните правой кнопкой мыши на RGui или из командной строки и выберите **Запуск от имени администратора**.

4. Выполните команду R `install.packages` и укажите пакет или имя репозитория и расположение ZIP-файл.

    ```R
    install.packages("C:\\Temp\\Downloaded packages\\mynewpackage.zip", repos=NULL)
    ```

    Эта команда извлекает R-пакет `mynewpackage` из своего локального ZIP-файла, при условии, что копия сохранена в каталоге `C:\Temp\Downloaded packages`и устанавливает пакет на локальном компьютере. Если пакет имеет зависимости, программа установки проверяет наличие существующих пакетов в библиотеке. При создании репозитории, которая включает в себя зависимости, то установщик устанавливает также необходимые пакеты.

    Если необходимые пакеты не присутствуют в библиотеке экземпляра, а не удается найти в ZIP-файл, происходит сбой установки целевого пакета.

## <a name="bkmk_createlibrary"></a> Установка пакета с помощью инструкции DDL 

В SQL Server 2017 г, можно использовать [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) инструкцию, чтобы добавить пакет или набор пакетов для экземпляра или определенной базы данных. Эта инструкция DDL и вспомогательных ролей базы данных, предназначены для упрощения установки и управления пакетов владельца базы данных без использования средств R или Python.

Этот процесс требуется некоторая подготовка, по сравнению с установкой пакетов с помощью стандартных методов R или Python.

+ Все пакеты должен быть доступен в качестве локального ZIP-файла, вместо загрузки из Интернета.

    Если на сервере нет доступа к файловой системе, можно также передать полный пакет как переменную, с использованием двоичного формата. Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](../../t-sql/statements/create-external-library-transact-sql.md).

+ Выполнение инструкции завершается неудачно, если требуемые пакеты недоступны. Необходимо проанализировать зависимости пакета, который вы хотите установить и убедитесь, что пакеты передаются серверу и базе данных. Мы рекомендуем использовать **miniCRAN** или **igraph** для анализа зависимостей пакетов.

+ Необходимо иметь соответствующие разрешения в базе данных. Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql).

### <a name="prepare-the-packages-in-archive-format"></a>Подготовьте пакеты в формате архива

1. При установке одного пакета, загрузите пакет в ZIP-формате. 

2. Если пакет требует любых других пакетов, необходимо убедиться, что доступны необходимые пакеты. MiniCRAN можно использовать для анализа целевой пакет и определения его зависимостей. 

3. Скопируйте ZIP-файл или репозиторий miniCRAN, содержащий все пакеты в локальную папку на сервере.

4. Откройте **запроса** окно, используя учетную запись с правами администратора.

5. Выполните инструкцию T-SQL `CREATE EXTERNAL LIBRARY` для передачи коллекции ZIP-пакета в базе данных.

    Например, следующая инструкция называет в качестве источника пакета в репозиторий miniCRAN, содержащее **randomForest** пакет, вместе с его зависимости. 

    ```R
    CREATE EXTERNAL LIBRARY randomForest
    FROM (CONTENT = 'C:\Temp\Rpackages\randomForest_4.6-12.zip')
    WITH (LANGUAGE = 'R');
    ```

    Нельзя использовать произвольное имя; Имя внешней библиотеки должен иметь же имя, которое будет использоваться при загрузке или при вызове пакета.

6. Если библиотеке успешно создан, можно запускать пакет в SQL Server, путем вызова внутри хранимой процедуры.
    
    ```SQL
    EXEC sp_execute_external_script
    @language =N'R',
    @script=N'
    library(randomForest)'
    ```

### <a name="known-issues-with-create-external-library"></a>Известные проблемы с ВНЕШНЕЙ БИБЛИОТЕКИ, создание

Создание ВНЕШНЕЙ БИБЛИОТЕКИ поддерживается при следующих условиях:

+ При установке одного пакета без зависимостей.
+ Установка пакетов с зависимостями и заранее подготовлены все пакеты. 

Инструкции DDL не выполняется, если отсутствуют любые зависимости пакетов. Например сбой в таких случаях известен в процессе установки:

+ Вы установили пакет, имеющий зависимости второго уровня и анализа не распространялись на втором уровне пакетов. Например, вы хотите установить **gglot2**и определить все пакеты, перечисленные в манифесте; тем не менее, эти пакеты должны другие зависимости, которые не были установлены.
+ Вы установили набор пакетов, для которых требуются разные версии пакета поддержки, и ваш сервер имеет неправильную версию.

## <a name="package-installation-tips"></a>Рекомендации по установке пакета

Этот раздел содержит различные советы и часто задаваемые вопросы, связанные с установкой пакета R на сервере SQL Server.

###  <a name="packageVersion"></a> Получите правильный пакет версии и формат

Существует несколько источников R-пакетов, таких как CRAN и Bioconductor. Официальный сайт языка R (<https://www.r-project.org/>) перечислены многие такие ресурсы. Многие пакеты публикуются на портале GitHub, где можно получить исходный код. И, наконец вам могут предоставить R-пакеты, разработанные в вашей организации или у вас есть пользовательского пакета, который вы написали.

Независимо от источника перед установкой пакета убедитесь, что вы получили двоичный формат для платформы Windows. 

### <a name="bkmk_zipPreparation"></a> Загрузить пакет как ZIP-файл

Для установки на сервере без доступа к Интернету необходимо загрузить копию пакета в формате ZIP-файл для установки в автономном режиме. **Не распаковать пакет.**

Например, следующая процедура описывает, чтобы получить правильную версию [FISHalyseR](http://bioconductor.org/packages/release/bioc/html/FISHalyseR.html) пакет с сайта Bioconductor, при условии, что у компьютера есть доступ к Интернету.

1.  В списке **Package Archives** (Архивы пакетов) найдите версию **Windows binary** (Двоичный файл Windows).

2.  Щелкните правой кнопкой мыши ссылку. ZIP-файл и выберите **сохранить объект как**.

3.  Перейдите к локальной папке, где хранятся ZIP-пакеты и нажмите кнопку **Сохранить**.

    Будет создана локальная копия пакета. 

4. Если появляется ошибка загрузки, попробуйте другой зеркальный сайт.

5. После загрузки пакета архива можно установить пакет, или скопируйте ZIP-пакет на сервере, у которого нет доступа к Интернету.

> [!TIP]
> Если по ошибке устанавливается пакет вместо загрузки двоичных файлов, копия загруженный ZIP-файл сохраняется на компьютере. Следите за сообщения о состоянии пакета установки, чтобы определить расположение файла. Этот ZIP-файл можно скопировать на сервер, который не имеет доступа к Интернету.
> 
> Тем не менее при получении пакетов с помощью этого метода зависимости, не включаются. 

### <a name="bkmk_packageDependencies"></a> Получить требуемые пакеты

Пакеты R часто зависят от нескольких других пакетов, некоторые из которых могут оказаться недоступными в библиотеке R по умолчанию, используемые экземпляром. Иногда пакета требуется другая версия зависимый пакет, который уже установлен.

Если вам нужно установить несколько пакетов или нужно гарантировать, что все сотрудники вашей организации возвращает правильный пакет типа и версии, мы рекомендуем использовать [miniCRAN](https://mran.microsoft.com/package/miniCRAN) пакетов для анализа цепочка зависимости. minicRAN будет создан локальный репозиторий, могут использоваться совместно в нескольких пользователей или компьютеров. Дополнительные сведения см. в разделе [Создать репозиторий локального пакета с помощью miniCRAN](create-a-local-package-repository-using-minicran.md).


### <a name="know-which-library-you-are-using-for-installation"></a>Узнать, какие библиотеки, которые вы используете для установки

Если ранее вы изменили среда R на компьютере перед установкой ничего, остановитесь на мгновение и убедитесь, что переменная среды R `.libPath` использует только один путь.

Этот путь должен указывать папку R_SERVICES для экземпляра. Дополнительные сведения см. в разделе [пакетов R, установленных с SQL Server](installing-and-managing-r-packages.md).

### <a name="side-by-side-installation-with-r-server"></a>Установка Side-by-side с помощью R Server

При установке Microsoft машины обучения Server (изолированный) помимо служб SQL Server Machine Learning ваш компьютер должен иметь отдельные установки служб R для каждого дубликатов средств R и библиотек.

Пакеты, установленные в библиотеку R_SERVER используются только в Microsoft R Server и будет невозможен с помощью SQL Server. Обязательно используйте `R_SERVICES` библиотеки при установке пакетов, которые вы хотите использовать в SQL Server.

### <a name="how-to-determine-which-packages-are-already-installed"></a>Как определить, какие пакеты уже установлены?

 В разделе [пакеты R, установленных с SQL Server](installing-and-managing-r-packages.md)