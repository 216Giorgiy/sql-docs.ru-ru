---
title: Установить новые пакеты R на машины обучения SQL Server Services | Документы Microsoft
description: Добавить новый R-пакеты служб SQL Server 2016 R или обучения машины службы (в базе данных) для SQL Server 2017 г.
ms.prod: sql
ms.technology: machine-learning
ms.date: 05/10/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 1106d0f1505f29a3b54f9fc036fcaf28b8715b75
ms.sourcegitcommit: feff98b3094a42f345a0dc8a31598b578c312b38
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2018
---
# <a name="install-new-r-packages-on-sql-server"></a>Установить новые пакеты R на сервере SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье описывается установка нового R-пакетов в экземпляр SQL Server, где включена машинного обучения. Существует несколько методов для установки новых пакетов R, в зависимости от версии SQL Server имеется, и является ли сервер подключен к Интернету.

## <a name="bkmk_rInstall"></a> Установка R-пакетов через подключение к Интернету

Стандартные средства R можно использовать, чтобы установить новые пакеты на экземпляре SQL Server 2016 или SQL Server 2017 г., предоставляя компьютер имеет открытый порт 80 и иметь права администратора.

> [!IMPORTANT] 
> Не забудьте установить пакеты из библиотеки по умолчанию, связанный с текущим экземпляром. Никогда не устанавливать пакеты в каталоге пользователя.

В этой процедуре используется RGui, но можно использовать RTerm или любые другие командной строки средства R, поддерживающий доступ с повышенными привилегиями.

### <a name="install-a-package-using-rgui"></a>Установка пакета с помощью RGui

1. [Определить расположение библиотеки экземпляр](installing-and-managing-r-packages.md). Перейдите к папке, где установлены средства R. Например путь по умолчанию для экземпляра SQL Server 2017 г. по умолчанию выглядит следующим образом: `C:\Program Files\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64`

1. Щелкните правой кнопкой мыши RGui.exe и выберите **Запуск от имени администратора**. Если у вас необходимые разрешения, обратитесь к администратору базы данных и укажите список нужных пакетов.

1. Из командной строки, если известно имя пакета, можно ввести: `install.packages("the_package-name")` двойные кавычки необходимы для имени пакета.

1. Если указать зеркальный сайт, выберите любой сайт, удобный для вашего расположения.

Если целевой пакет зависит от дополнительных пакетов, установщик R автоматически загружаются зависимости и установит их.

При наличии нескольких экземпляров SQL Server, например side-by-side экземпляров служб R SQL Server 2016 и службы SQL Server 2017 г машины обучения, запустите установку отдельно для каждого экземпляра, если вы хотите использовать пакет в контекстах. Пакеты не могут использоваться совместно экземпляров.

## <a name = "bkmk_offlineInstall"></a> Автономной установки с помощью средств r.

Если сервер не имеет доступа к Интернету, чтобы подготовить пакеты необходимы дополнительные действия. Чтобы установить пакеты R на сервере, который не имеет доступа к Интернету, необходимо выполнить следующее:

+ Заранее анализа зависимостей.
+ Загрузите целевой пакет на компьютере с доступом в Интернет.
+ Загрузите необходимые пакеты на одном компьютере и во всех пакетов в архиве одного пакета.
+ Если она отсутствует в сжатый формат ZIP-архиве.
+ Скопируйте пакет архив расположение на сервере.
+ Установите пакет цели, указав файл архива в качестве источника.

> [!IMPORTANT] 
> > Убедитесь, что все зависимости проанализировать и загрузить **все** необходимые пакеты **перед** начала установки. Мы рекомендуем [miniCRAN](https://mran.microsoft.com/package/miniCRAN) для этого процесса. Этот пакет R принимает список пакетов, необходимо установить, анализирует зависимости и получает ZIP-файл. затем miniCRAN создает одного репозитория, можно скопировать на сервер.
> 
> Дополнительные сведения см. в разделе [Создать репозиторий локального пакета с помощью miniCRAN](create-a-local-package-repository-using-minicran.md)

Эта процедура предполагает, что вы подготовили пакетов, необходимых, сжатый формат и все готово для их копирования на сервере.

1. Копировать пакет ZIP-файл, или для нескольких пакетов завершения репозиторий, содержащий все пакеты в ZIP-формате, в расположении, доступном для сервера.

2. Откройте папку на сервере, где установлены средства R для экземпляра. Например, если вы используете командную строку Windows на компьютере со службами R SQL Server 2016, переключитесь в `C:\Program Files\MSSQL13.MSSQLSERVER\R_SERVICES\bin\x64`.

3. Щелкните правой кнопкой мыши на RGui или RTerm и выбрать **Запуск от имени администратора**.

4. Выполните команду R `install.packages` и укажите пакет или имя репозитория и расположение ZIP-файл.

    ```R
    install.packages("C:\\Temp\\Downloaded packages\\mynewpackage.zip", repos=NULL)
    ```

    Эта команда извлекает R-пакет `mynewpackage` из своего локального ZIP-файла, при условии, что копия сохранена в каталоге `C:\Temp\Downloaded packages`и устанавливает пакет на локальном компьютере. Если пакет имеет зависимости, программа установки проверяет наличие существующих пакетов в библиотеке. При создании репозитории, которая включает в себя зависимости, то установщик устанавливает также необходимые пакеты.

    Если необходимые пакеты не присутствуют в библиотеке экземпляра, а не удается найти в ZIP-файл, происходит сбой установки целевого пакета.

## <a name="bkmk_createlibrary"></a> Использовать создание ВНЕШНЕЙ БИБЛИОТЕКИ

**Область применения:**  [!INCLUDE[sssql17-md](../../includes/sssql17-md.md)] [!INCLUDE[rsql-productnamenew-md](../../includes/rsql-productnamenew-md.md)]

[Создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) инструкция делает возможным добавление пакета или набора пакетов экземпляра или определенной базы данных без выполнения R или Python code напрямую. Однако этот метод требует подготовки пакета и разрешения дополнительные базы данных.

+ Все пакеты должны быть доступны в качестве локальный ZIP-файл, а не загружаться по запросу из Интернета.

    Если на сервере нет доступа к файловой системе, можно также передать полный пакет как переменную, с использованием двоичного формата. Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](../../t-sql/statements/create-external-library-transact-sql.md).

+ Все зависимости необходимо определить по имени и версии и включены в ZIP-файл. Выполнение инструкции завершается неудачно, если требуемые пакеты недоступны, включая зависимости пакетов подчиненных. Мы рекомендуем использовать **miniCRAN** или **igraph** для анализа зависимостей пакетов. Установка Неверная версия пакета или зависимость пакета также может вызвать ошибку выполнения инструкции. 

+ Необходимо иметь соответствующие разрешения в базе данных. Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql).

### <a name="prepare-the-packages-in-archive-format"></a>Подготовьте пакеты в формате архива

1. При установке одного пакета, загрузите пакет в ZIP-формате. 

2. Если пакет требует любых других пакетов, необходимо убедиться, что доступны необходимые пакеты. MiniCRAN можно использовать для анализа целевой пакет и определения его зависимостей. 

3. Скопируйте ZIP-файл или репозиторий miniCRAN, содержащий все пакеты в локальную папку на сервере.

4. Откройте **запроса** окно, используя учетную запись с правами администратора.

5. Выполните инструкцию T-SQL `CREATE EXTERNAL LIBRARY` для передачи коллекции ZIP-пакета в базе данных.

    Например, следующая инструкция называет в качестве источника пакета в репозиторий miniCRAN, содержащее **randomForest** пакет, вместе с его зависимости. 

    ```R
    CREATE EXTERNAL LIBRARY randomForest
    FROM (CONTENT = 'C:\Temp\Rpackages\randomForest_4.6-12.zip')
    WITH (LANGUAGE = 'R');
    ```

    Нельзя использовать произвольное имя; Имя внешней библиотеки должен иметь же имя, которое будет использоваться при загрузке или при вызове пакета.

6. Если библиотеке успешно создан, можно запускать пакет в SQL Server, путем вызова внутри хранимой процедуры.
    
    ```SQL
    EXEC sp_execute_external_script
    @language =N'R',
    @script=N'
    library(randomForest)'
    ```

## <a name="tips-for-package-installation"></a>Советы по установке пакета

Этот раздел содержит различные советы и часто задаваемые вопросы, связанные с установкой пакета R на сервере SQL Server.

###  <a name="packageVersion"></a> Получите правильный пакет версии и формат

Существует несколько источников R-пакетов, таких как CRAN и Bioconductor. Официальный сайт языка R (<https://www.r-project.org/>) перечислены многие такие ресурсы. Многие пакеты публикуются на портале GitHub, где можно получить исходный код. И, наконец вам могут предоставить R-пакеты, разработанные в вашей организации или у вас есть пользовательского пакета, который вы написали.

Независимо от источника перед установкой пакета убедитесь, что вы получили двоичный формат для платформы Windows. 

### <a name="bkmk_zipPreparation"></a> Загрузить пакет как ZIP-файл

Для установки на сервере без доступа к Интернету необходимо загрузить копию пакета в формате ZIP-файл для установки в автономном режиме. **Не распаковать пакет.**

Например, следующая процедура описывает, чтобы получить правильную версию [FISHalyseR](http://bioconductor.org/packages/release/bioc/html/FISHalyseR.html) пакет с сайта Bioconductor, при условии, что у компьютера есть доступ к Интернету.

1.  В списке **Package Archives** (Архивы пакетов) найдите версию **Windows binary** (Двоичный файл Windows).

2.  Щелкните правой кнопкой мыши ссылку. ZIP-файл и выберите **сохранить объект как**.

3.  Перейдите к локальной папке, где хранятся ZIP-пакеты и нажмите кнопку **Сохранить**.

    Будет создана локальная копия пакета. 

4. Если появляется ошибка загрузки, попробуйте другой зеркальный сайт.

5. После загрузки пакета архива можно установить пакет, или скопируйте ZIP-пакет на сервере, у которого нет доступа к Интернету.

> [!TIP]
> Если по ошибке устанавливается пакет вместо загрузки двоичных файлов, копия загруженный ZIP-файл сохраняется на компьютере. Следите за сообщения о состоянии пакета установки, чтобы определить расположение файла. Этот ZIP-файл можно скопировать на сервер, который не имеет доступа к Интернету.
> 
> Тем не менее при получении пакетов с помощью этого метода зависимости, не включаются. 

### <a name="bkmk_packageDependencies"></a> Получить требуемые пакеты

Пакеты R часто зависят от нескольких других пакетов, некоторые из которых могут оказаться недоступными в библиотеке R по умолчанию, используемые экземпляром. Иногда пакета требуется другая версия зависимый пакет, который уже установлен.

Если вам нужно установить несколько пакетов или нужно гарантировать, что все сотрудники вашей организации возвращает правильный пакет типа и версии, мы рекомендуем использовать [miniCRAN](https://mran.microsoft.com/package/miniCRAN) пакетов для анализа цепочка зависимости. minicRAN будет создан локальный репозиторий, могут использоваться совместно в нескольких пользователей или компьютеров. Дополнительные сведения см. в разделе [Создать репозиторий локального пакета с помощью miniCRAN](create-a-local-package-repository-using-minicran.md).


### <a name="know-which-library-you-are-installing-to-and-which-packages-are-already-installed"></a>Знать библиотеку, в которой вы устанавливаете и какие пакеты уже установлены.

Если ранее вы изменили среда R на компьютере перед установкой ничего, остановитесь на мгновение и убедитесь, что переменная среды R `.libPath` использует только один путь.

Этот путь должен указывать папку R_SERVICES для экземпляра. Дополнительные сведения, включая способ определить, какие пакеты уже установлены, в разделе [пакетов R, установленных с SQL Server](installing-and-managing-r-packages.md).

### <a name="side-by-side-installation-with-standalone-r-or-python-servers"></a>Параллельную установку с R автономный или серверами Python

Если вы установили 2017 г. Корпорация Майкрософт машины обучения сервером SQL (автономный) или SQL Server 2016 R Server (изолированный) помимо аналитика в базе данных (службы SQL Server 2017 г машины обучения и служб R SQL Server 2016), на компьютере уже отдельные установки R для каждого дубликатов средств R и библиотек.

Пакеты, установленные в библиотеку R_SERVER используются только на отдельном сервере и не доступны для экземпляра SQL Server (в базе данных). Всегда используйте `R_SERVICES` библиотеки при установке пакетов, которые вы хотите использовать в базе данных на сервере SQL Server.
