---
title: Динамических административных представлений (DMV) для SQL Server службы машинного обучения | Документация Майкрософт
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 8d7d20d396ca5b853d959c84a371fe808415c5fb
ms.sourcegitcommit: 79d4dc820767f7836720ce26a61097ba5a5f23f2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2018
ms.locfileid: "40395356"
---
# <a name="dmvs-for-sql-server-machine-learning-services"></a>Динамические административные представления для служб машинного обучения SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В ней указаны представления системного каталога и динамические административные представления, связанные с машинным обучением в SQL Server.

Сведения о расширенных событиях см. в разделе [расширенные события для машинного обучения](../../advanced-analytics/r/extended-events-for-sql-server-r-services.md).

> [!TIP]
> С помощью встроенных отчетов для монитора сеансов машинного обучения и использования пакета. Дополнительные сведения см. в разделе [отслеживать машинного обучения с помощью настраиваемых отчетов в среде Management Studio](../../advanced-analytics/r/monitor-r-services-using-custom-reports-in-management-studio.md).

## <a name="system-configuration-and-system-resources"></a>Конфигурации системы и системных ресурсов

Вы можете отслеживать и анализировать ресурсы, используемые внешних скриптов с помощью [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] представления системного каталога и динамических административных представлений.

+ [ sys.dm_exec_sessions](../../relational-databases/system-dynamic-management-views/sys-dm-exec-sessions-transact-sql.md)

  Возвращает сведения о подключениях пользователей и сеансах системы. Сеансы системы можно определить, просмотрев столбец *session_id*. Значения, превышающие или равные 51, являются подключениями пользователей, а значения меньше 51 — системными процессами.

+ [sys.dm_os_performance_counters (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-os-performance-counters-transact-sql.md)

  Возвращает строку для каждого счетчика производительности системы, используемого сервером.  На основе этих сведений можно узнать, сколько скриптов выполнялось, какой режим проверки подлинности использовался для каждого из них или общее количество отправленных вызовов R для экземпляра.

  В этом примере возвращаются только счетчики, относящиеся к скрипту R:

  ```SQL
  SELECT * from sys.dm_os_performance_counters WHERE object_name LIKE '%External Scripts%'
  ```

  Это динамическое административное представление возвращает данные следующих счетчиков для внешних скриптов по каждому экземпляру.

  + **Общее число выполнений**: количество внешних процессов, запущенных с локальных или удаленных вызовов
  + **Параллельное выполнение**: сколько раз скрипт содержал _@parallel_ спецификации и что [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] смогла создать и использовать параллельный план запроса
  + **Потоковая передача выполнений**: сколько раз была вызвана функция потоковой передачи
  + **Выполнение SQL CC**: число внешних сценариев, выполнение которых вызов был создан удаленно, и SQL Server был использован в качестве контекста вычисления
  + **Имена для входа с подразумеваемой проверкой подлинности** — количество петлевых вызовов ODBC с использованием подразумеваемой проверки подлинности, то есть [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] выполнял вызов от имени пользователя, отправившего запрос скрипта.
  + **Общее время выполнения (мс)**: время, прошедшее между вызовом и его завершением вызова
  + **Ошибки выполнения** — количество ошибок, возникших при выполнении скриптов. Этот счетчик не содержит ошибки R.


+ [sys.dm_external_script_requests](../../relational-databases/system-dynamic-management-views/sys-dm-external-script-requests.md)

  Это динамическое административное представление возвращает одну строку для каждой рабочей учетной записи, которая в данный момент выполняет внешний скрипт. Обратите внимание, что эта рабочая учетная запись отличается от учетных данных отправителя скрипта. Если один пользователь Windows отправляет несколько запросов скриптов, для их обработки будет назначена только одна рабочая учетная запись. Если другой пользователь Windows выполняет вход для запуска внешнего скрипта, запрос будет обрабатываться с помощью отдельной рабочей учетной записи.

  Это динамическое административное представление не возвращает результатов, если в данный момент скрипты не выполняются. Поэтому это представление эффективно для отслеживания длительных скриптов. Оно возвращает следующие значения:

  + **external_script_request_id**: GUID, который также используется в качестве временного имени рабочего каталога, используемого для хранения скриптов и промежуточных результатов
  + **Язык**: значение, например `R` , обозначающее язык внешнего скрипта
  + **degree_of_parallelism**: целое число, представляющее число параллельных процессов, которые использовались
  + **external_user_name**: панель запуска рабочей учетной записи, такие как **SQLRUser01**

+ [sys.dm_external_script_execution_stats (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-external-script-execution-stats.md)

  Это динамическое административное Представление предоставляется для внутреннего мониторинга (телеметрии) для отслеживания количества внешних скриптов вызовы выполняются в экземпляре. Служба телеметрии запускается вместе [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и увеличивает значение счетчика на диске при каждом вызове определенной функции машинного обучения.

  Этот счетчик увеличивается на один вызов к определенной функции отслеживаемые. Например, если вызывается `rxLinMod` , который запускается параллельно, счетчик увеличивается на 1.
  
  В общем случае счетчики производительности допустимы только при условии, что активен создавший их процесс. Таким образом, запрос к динамическому административному представлению не может отобразить подробные данные для остановленной службы. Например, если панель запуска создает несколько параллельных заданий R, которые быстро выполняются, а затем очищаются объектом задания Windows, динамическое административное представление может не отображать данные.
 
  Поэтому счетчики, отслеживаемые этим динамическим административным представлением, продолжают выполняться, а состояние для счетчика dm_external_script_execution сохраняется путем записи на диск, даже при завершении работы экземпляра.
 
 Дополнительные сведения о счетчиках производительности системы, используемых [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], см. в статье [Использование объектов SQL Server](../../relational-databases/performance-monitor/use-sql-server-objects.md).

## <a name="resource-governor-views"></a>Представления регулятора ресурсов

В выпусках, поддерживающих регулятор ресурсов Создание внешних пулов ресурсов для рабочих нагрузок R или Python можно en эффективный способ отслеживания ресурсов и управления ими.

+ [sys.resource_governor_resource_pools](../../relational-databases/system-catalog-views/sys-resource-governor-resource-pools-transact-sql.md)

  Возвращает информацию о текущем состоянии пула ресурсов, текущую конфигурацию пула ресурсов и статистику пула ресурсов.

  > [!IMPORTANT]
  > 
  > Прежде чем выделить дополнительные ресурсы для служб R, необходимо изменить пулы ресурсов, которые применяются к другим службам сервера.

+ [sys.resource_governor_external_resource_pools](../../relational-databases/system-catalog-views/sys-resource-governor-external-resource-pools-transact-sql.md)

  Новое представление каталога, отображающее текущие значения конфигурации внешних пулов ресурсов.
  В выпуске Enterprise Edition можно настроить дополнительные внешние пулы ресурсов. Например, может потребоваться управлять ресурсами заданий R, запущенных в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], отдельно от тех, которые исходят от удаленного клиента.

  > [!NOTE]
  > 
  > В выпуске Standard Edition все задания внешнего скрипта выполняются в том же пуле ресурсов по умолчанию внешние.

+ [sys.resource_governor_workload_groups](../../relational-databases/system-catalog-views/sys-resource-governor-workload-groups-transact-sql.md)

  Возвращает статистику и текущую конфигурацию группы рабочей нагрузки. Это представление можно объединить с представлением `sys.dm_resource_governor_resource_pools` для получения имени пула ресурсов.
  Для внешних скриптов добавлен новый столбец, содержащий идентификатор внешнего пула, связанного с группой рабочей нагрузки.

+ [sys.dm_resource_governor_external_resource_pool_affinity](../../relational-databases/system-dynamic-management-views/sys-dm-resource-governor-external-resource-pool-affinity-transact-sql.md)

  Новое представление системного каталога, в котором можно увидеть процессоры и ресурсы, привязанные к определенному пулу ресурсов.

  Возвращает по одной строке для каждого планировщика [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], сопоставленного с отдельным процессором. Используйте это представление для мониторинга состояния планировщика или для определения отклонившихся от расписания задач.

  В конфигурации по умолчанию пулы рабочей нагрузки автоматически назначаются процессорам, и поэтому значения сопоставления отсутствуют.

  Расписание сопоставления сопоставляет пул ресурсов с расписаниями [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], обозначенными заданными идентификаторами. Эти идентификаторы сопоставляются со значениями в `scheduler_id` столбца в `sys.dm_os_schedulers`.


> [!NOTE] 
> 
> Несмотря на то что возможность настройки пулов ресурсов доступна только в выпусках Enterprise и Developer, пулы по умолчанию, а также динамические административные представления доступны во всех выпусках. Таким образом чтобы определить ограничения ресурсов для внешних скриптов заданий можно использовать следующие динамические административные представления в выпуске Standard Edition.

Общие сведения об отслеживании экземпляров [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] см. в статьях [System Catalog Views (Transact-SQL)](../../relational-databases/system-catalog-views/catalog-views-transact-sql.md) (Представления системного каталога (Transact-SQL)) и [Resource Governor Related Dynamic Management Views](../../relational-databases/system-dynamic-management-views/resource-governor-related-dynamic-management-views-transact-sql.md) (Динамические административные представления регулятора ресурсов (Transact-SQL)).

## <a name="monitoring-script-execution"></a>Мониторинг выполнения скрипта

Скрипты R и Python, которые выполняются в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] , запускаются с [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] интерфейс. Панель запуска не регулируется ресурсами и не отслеживается отдельно, так как считается безопасной службой, предоставляемой корпорацией Майкрософт, которая управляет ресурсами соответствующим образом.

Управление отдельных сценариев, запускаемых от службы панели запуска выполняется с помощью [объект задания Windows](/windows/desktop/ProcThread/job-objects). Объект задания позволяет управлять группой процессов как единым целым. Каждый объект задания является иерархическим и управляет атрибутами всех связанных с ним процессов. Операции, выполняемые объектом задания, влияют на все связанные с ним процессы.

Таким образом, если необходимо завершить одно задание, связанное с объектом, учтите, что все связанные с ним процессы также будут завершены. Если вы используете скрипт R, который назначен объекту задания Windows и выполняет задание, связанное с ODBC, которое необходимо завершить, родительский процесс скрипта R также будет завершен.

Если запустить внешний скрипт, использующего параллельную обработку, один объект задания Windows управляет всеми параллельными дочерними процессами.

Чтобы определить, выполняется ли процесс в задании, используйте функцию `IsProcessInJob`.

## <a name="next-steps"></a>Следующие шаги

[Управление решениями машинного обучения и их мониторинг](../../advanced-analytics/r/managing-and-monitoring-r-solutions.md)
