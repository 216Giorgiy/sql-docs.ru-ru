---
title: "Управление пакетами R для SQL Server | Документы Microsoft"
ms.custom: 
ms.date: 10/09/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology: r-services
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: R
ms.assetid: 98c14b05-750e-44f9-8531-1298bf51e8d2
caps.latest.revision: "7"
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.workload: On Demand
ms.openlocfilehash: 5cd3924b79ce5d33adf88bb6c7c267cdc43a3418
ms.sourcegitcommit: 531d0245f4b2730fad623a7aa61df1422c255edc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2017
---
# <a name="r-package-management-for-sql-server"></a>Управление пакетами R для SQL Server

В этой статье описываются функции для управления пакетов R в 2017 г. SQL Server и SQL Server 2016.

+ Изменения в методы установки пакета R между 2016 и 2017 г.
+ Рекомендуемые методы для управления пакетами R
+ Новые роли базы данных для пакета управления в SQL Server 2017 г.
+ Новые инструкции T-SQL для пакета управления в SQL Server 2017 г.

**Применяется к:** служб R SQL Server 2016, SQL Server 2017 г машинного обучения служб

## <a name="differences-in-package-management-between-sql-server-2016-and-sql-server-2017"></a>Различия в пакет управления SQL Server 2016 и 2017 г. SQL Server

В **2017 г. SQL Server**, можно включить управление пакетами на уровне экземпляра и управлять разрешениями пользователей, чтобы добавить или использовать пакеты на уровне базы данных.

Для этого необходимо включить, администратор базы данных компонент пакета управления, выполнив скрипт, который создает необходимые объекты базы данных. Дополнительные сведения см. в разделе [Включение управления пакета R](r-package-how-to-enable-or-disable.md).

В **SQL Server 2016**, администратор должен установить пакеты R в библиотеке R, связанные с экземпляром. Все пользователи выполнения кода R в экземпляре использовать эти пакеты. Код R, выполняющемся на SQL server нельзя использовать пакеты, установленные в библиотеках пользователя. Тем не менее администратор может предоставить отдельным пользователям возможность запуска сценариев R в определенной базе данных.

**Сводка различия и преимущества**

+ При использовании службы обучения машины 2017 г. SQL Server можно управлять и установить пакеты R с помощью традиционного метода, на основе средств R, или с помощью инструкций T-SQL и новой роли базы данных.

+ Мы рекомендуем последний метод, так как она обеспечивает более точное управление администраторами, вместе с оптимизатору больше возможностей для пользователей. Например, пользователи могут устанавливать свои собственные пакеты, либо при помощи хранимой процедуры или с помощью кода R и пакеты общей папки с другими разделами. 

    Пакеты могут предназначаться для базы данных, и каждый пользователь получит изолированной изолированного пакета, проще установить разные версии того же пакета R. Можно также легко скопировать или переместить пользователей и их пакеты между базами данных. 

+ Использование функции пакета управления в SQL Server значительно упрощает операции резервного копирования и восстановления. При переносе рабочей базе данных на новый сервер можно использовать функцию синхронизации пакета для чтения список всех пакетов и устанавливать их в базе данных на новом сервере.

+ Может оказаться более удобным для установки пакетов R с правами администратора на компьютере, с помощью традиционных средств R, если вы являетесь единственным лицом, использующим сервер для заданий машины обучения.

+ При использовании служб R SQL Server 2016 следует продолжать Установка R-пакетов, используемые экземпляром, с помощью средств R > убедитесь, что для использования библиотеки R, связанные с экземпляром.

В следующих разделах содержатся дополнительные сведения о том, как управление пакетами выполнить с помощью этих двух вариантов.

## <a name="r-package-management-using-t-sql"></a>Управление пакетами R с помощью T-SQL

2017 г. SQL Server включает в себя новые инструкции T-SQL, которые предоставляют больший контроль над пакеты R на уровне базы данных администратор базы данных. В то же время администратор базы данных можно дать пользователям возможность установки пакетов, применяя необходимые и использовать их совместно с другими разделами.

Если необходимо обеспечить обмен пакетами с другими пользователями или если несколько сотрудников должны выполняться задания обучения машин на сервере, мы рекомендуем включить управление пакетами, назначать пользователей ролям базы данных и отправить пакеты, чтобы пользователи могут использовать их совместно.

Пакет управления в 2017 г. SQL Server использует эти новые объекты базы данных и компоненты:

+ Новые роли базы данных, для управления доступ к пакету и использование
+ Область пакета, отдельные общие и закрытые пакеты
+ Создание ВНЕШНЕЙ БИБЛИОТЕКИ инструкции, для передачи на сервер новые библиотеки кода
+ Новые функции R в RevoScaleR для поддержки установки пакетов в SQL Server контекста вычислений
+ Пакет синхронизации, чтобы обеспечить легкая резервное копирование и восстановление пакетов

### <a name="database-roles-for-package-management"></a>Роли базы данных для управления пакетами

Администратор базы данных должен создать ролей, используемых для управления пакетами, выполнив сценарий как описано здесь: [включить или отключить управление пакетами](r-package-how-to-enable-or-disable.md).

После выполнения этого сценария вы увидите следующие новые роли базы данных:

+ `rpkgs-users`: Члены этой роли можно использовать любой общей пакет, который был установлен ни один `rpkgs-shared` члена роли.

+ `rpkgs-private`: Члены этой роли имеют доступ к общей пакетов с теми же разрешениями, члены `rpkgs-users` роли. Члены этой роли можно также установить, удалить и использовать пакеты в частном порядке с областью.

+ `rpkgs-shared`: Члены этой роли имеют те же разрешения, что и члены `rpkgs-private` роли. Кроме того члены этой роли можно установить или удалить общие пакеты.

+ `db_owner`: Члены этой роли имеют те же разрешения, что и члены `rpkgs-shared` роли. Кроме того, члены этой роли могут **предоставить** другим пользователям, право устанавливать или удалять как общие и закрытые пакеты.

Администратор базы данных добавляет пользователей в роли на основе каждой базы данных для пользователя возможность установить пакеты управления.

### <a name="package-scope"></a>Область пакета

Новые возможности пакета управления различать пакеты по того, они являются закрытыми или могут совместно использоваться несколькими пользователями.

+ **Общая область**

    *Общая область* означает пользователи разрешение на роль общей области (`rpkgs-shared`) можно устанавливать и удалять пакеты для указанной базы данных. Пакет, установленный в библиотеке общей области, может использоваться другими пользователями базы данных в SQL Server при условии, что этим пользователям разрешено использовать установленные пакеты R.

+ **Закрытая область**

    *Закрытая область* означает пользователи были присвоены членство в роли закрытая область (`rpkgs-private`) можно установить или удалить пакеты в расположение библиотеки частного определено для каждого пользователя. Таким образом, все пакеты, установленные в частной области, может использовать только пользователь, установивший их. Другими словами, пользователь в SQL Server не может использовать закрытые пакеты, установленные другим пользователем.

Эти модели для *общей* и *закрытой* области можно совмещать, чтобы создать настраиваемые системы безопасности для развертывания пакетов в SQL Server и управления ими.

Например, с помощью общей области руководителю группы специалистов по обработке данных можно предоставить разрешение на установку пакетов, после чего такие пакеты становятся доступны всем другим специалистам по обработке данных или пользователям, работающим в том же экземпляре SQL Server.

В другом сценарии может потребоваться повышенный уровень изоляции пользователей или возможность использования разных версий пакетов. В этом случае с помощью закрытой области можно предоставить разрешения отдельным специалистам, которые будут отвечать за установку и использование нужных им пакетов. Поскольку пакеты устанавливаются на уровне пользователя, пакеты, установленные одним пользователем, не повлияют на работу других пользователей, работающих с той же базой данных SQL Server.

### <a name="create-external-library"></a>СОЗДАНИЕ ВНЕШНЕЙ БИБЛИОТЕКИ

[Создание ВНЕШНЕЙ БИБЛИОТЕКИ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) является новой инструкции T-SQL, появившиеся в SQL Server 2017 г. для работы с пакетами без необходимости пользовательская R администратор базы данных. 

Вы используете **создать ВНЕШНЮЮ БИБЛИОТЕКУ** инструкции для загрузки внешней библиотеки экземпляра в формате ZIP-файл. Авторизованные пользователи можно получить доступ к библиотекам и устанавливать их для собственных нужд.

Например можно создать несколько копий проекта R, каждый из них на другую версию. Передача их как отдельные библиотеки позволяет сохранять некоторые версии частного и поделиться с другими пользователями в некоторых версиях.

По сути, «Библиотека» — это совокупность внешние пакеты, которые требуется сделать доступными для пользователей под одним именем. Например могут быть опубликованы следующие в SQL Server как внешней библиотеки:

+ Один пакет R написания, без зависимостей
+ Пакет, который вы хотите установить и зависимости, необходимые для установки
+ Коллекция пакетов R, связанные с некоторой задачи или проекта, с их зависимости

Имя библиотеки — для управления пакет или набор пакетов в SQL Server и могут не зависеть от пакетов, которые будут установлены. Однако имена библиотеки должны быть уникальными в экземпляре.

Чтобы использовать эту инструкцию, необходимо включить компонент пакета управления на экземпляре. Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql).

> [!NOTE]
> В настоящее время этот оператор можно использовать для создания библиотек только под управлением Windows, для поддержки R. запланировано в будущем пакеты Python, а также для пакетов, которые выполняются на других платформах, например в Linux.

После передачи внешней библиотеки на сервере необходимо установить его в библиотеку пакет R, связанные с экземпляром. Существует несколько способов это сделать:

+ Стандартная команда R `install.packages` внутри sp_execute_external_script. Убедитесь, что подключение с учетной записью, обладающей разрешениями на установку пакетов.

+ Подключитесь к SQL Server с удаленного клиента R и выполните [rxInstallPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxinstallpackages) в контексте вычислений SQL Server. Опять же должен иметь разрешения для установки пакетов либо в закрытые или общие области для этого.

Примеры установки с помощью R и T-SQL см. в разделе [Установка дополнительных пакетов в SQL Server](install-additional-r-packages-on-sql-server.md).

### <a name="new-r-functions-for-package-installation"></a>Новые функции R для установки пакета

После включения роли базы данных для управления пакетами, пользователи также могут использовать новые функции в [ **RevoScaleR** ](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler) для установки пакетов в экземпляре, указанном в качестве контекста вычислений SQL Server.

+ Специалист по анализу данных можно установить необходимые пакеты R на сервере SQL Server без необходимости прямого доступа к серверу SQL Server.

+ Пользователь может установить пакет и совместно использовать, путем установки пакета с общей области. Затем другим авторизованным пользователям одной и той же базе данных SQL Server можно получить доступ к пакет.

+ Пользователи могут устанавливать закрытые пакеты, которые не видны другим пользователям, Создание частной изолированной среде R-пакетов.

Для установки и удаления пакетов в контексте указанной вычислений в RevoScaleR, предусмотрены следующие функции пакета управления:

-   [rxInstalledPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxinstalledpackages): найти сведения о пакеты, установленные в контексте указанной вычислений.

-   [rxInstallPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxinstallpackages): установки пакетов в контексте вычислений, из указанного хранилища или чтении локально сохраненные ZIP-пакеты.

-   [rxRemovePackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxremovepackages): Удаление установленных пакетов из контекста вычислений.

-   [rxFindPackage](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxfindpackage): получить путь для одного или нескольких пакетов в контексте указанной вычислений.

-   [rxSyncPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsyncpackages): копирует библиотеку пакета между файловой системы и баз данных в контексте указанной вычислений.

-   [rxSqlLibPaths](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsqllibpaths): получить путь поиска для деревьев библиотеки для пакетов во время выполнения в SQL Server.

Чтобы использовать эти функции, подключитесь к экземпляру SQL Server, где есть необходимые разрешения, с помощью контекста вычислений SQL Server. При подключении, учетные данные определить, можно ли выполнить операцию на сервере.

Функции установки пакета проверяют зависимости, чтобы убедиться, что в SQL Server можно установить все связанные пакеты, как и при установке пакета R в локальном контексте. Функция, которая удаляет пакеты, также вычисляет зависимости и гарантирует удаление пакетов, которые больше не используются другими пакетами в SQL Server, для освобождения ресурсов.

> [!NOTE]
> 
> Эти функции включены по умолчанию в 2017 г. SQL Server. Можно обновить версию RevoScaleR для получения этих функций после обновления экземпляра, чтобы использовать более позднюю версию Microsoft R Server, например Microsoft R Server 9.0.1.
> 
> Дополнительные сведения см. в разделе [с помощью SqlBindR.exe для программного обеспечения](use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

### <a name="synchronization-of-r-package-libraries"></a>Синхронизация библиотек пакета R

В выпуске CTP 2.0 2017 г. SQL Server (и в выпуске Microsoft R Server апреле 2017 г) включает новые функции R для *синхронизация пакеты*.

Пакет синхронизация означает, что компонент database engine отслеживает пакеты, которые используются в конкретного пользователя и группы и при необходимости можно написать эти пакеты в файловую систему. Синхронизацию пакета можно использовать в следующих сценариях:

+ Требуется переместить пакеты R между экземплярами SQL Server.
+ Необходимо переустановить пакетов для конкретного пользователя или группы, после восстановления базы данных.

Дополнительные сведения о том, как включение и использование этой функции см. в разделе [синхронизацию пакета R для SQL Server](package-install-uninstall-and-sync.md).

## <a name="r-package-management-using-traditional-r-tools"></a>Управление пакетами R с помощью традиционных средств r.

Традиционный метод управления пакеты R в экземпляре является установка, а также перечисление пакетов с помощью команд и средств R. 

+ Эта возможность может быть единственный параметр, если вы используете более раннего выпуска SQL Server 2016.  
+ Этот параметр также может быть удобным, если являетесь единственным пользователем пакеты R и иметь административный доступ к серверу.
+ Чтобы упростить управление версии пакетов R, можно использовать [miniCRAN](create-a-local-package-repository-using-minicran.md) для создания локального репозитория и общей папке, между экземплярами.

Дополнительные сведения см. статьи:

+ [Установка дополнительных пакетов R в SQL Server](install-additional-r-packages-on-sql-server.md)
+ [Определение установленных пакетов на SQL Server](determine-which-packages-are-installed-on-sql-server.md)

Для 2017 г. SQL Server, рекомендуется использовать ВНЕШНИЕ БИБЛИОТЕКИ, создание и ролей базы данных предоставляет для управления пользователями и R-пакеты.

## <a name="next-steps"></a>Следующие шаги

[Как включить или отключить управление пакета R](../r/r-package-how-to-enable-or-disable.md)
