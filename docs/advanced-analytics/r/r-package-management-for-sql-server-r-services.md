---
title: "Управление пакетами R для SQL Server | Документы Microsoft"
ms.custom: 
ms.date: 08/20/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- r-services
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- R
ms.assetid: 98c14b05-750e-44f9-8531-1298bf51e8d2
caps.latest.revision: 7
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: f19982251b629d12215595685c0633b4c6b61c98
ms.contentlocale: ru-ru
ms.lasthandoff: 09/01/2017

---
# <a name="r-package-management-for-sql-server"></a>Управление пакетами R для SQL Server

В этом разделе описываются функции управления пакетами, которые можно использовать для управления пакетами R, запущенных на экземпляре SQL Server.

**Применяется к:** служб R SQL Server 2016, SQL Server 2017 г машинного обучения служб

## <a name="package-management-using-t-sql"></a>Пакет управления с помощью T-SQL

Можно установить пакеты R с правами администратора на компьютере, если у вас этих прав, и в том случае, если вы являетесь единственным лицом, использующим сервер для заданий машины обучения.

Тем не менее если требуется предоставлять другим пользователям пакетов, или если требуется несколько пользователей для запуска заданий обучения компьютера на сервере, является более эффективным библиотеку общих пакета. SQL Server поддерживает это посредством ролей базы данных.

Для установки ролей и добавление пользователей ролям отвечает администратор базы данных. Через роли Администратор базы данных можно контролировать, кто имеет разрешение на добавление и удаление пакетов R из среды SQL Server и можно проводить аудит установки пакета.

### <a name="database-roles-for-package-management"></a>Роли базы данных для управления пакетами

Следующие новые роли базы данных поддерживают безопасное установки и управления пакета R в SQL Server:

- `rpkgs-users`: Позволяет пользователям использовать любой общей пакеты, которые были установлены членами `rpkgs-shared` роли.

- `rpkgs-private`-Обеспечивает доступ к общей пакеты с теми же разрешениями, `rpkgs-users` роли. Члены этой роли также могут устанавливать, удалять и использовать пакеты, относящиеся к частной области.

-  `rpkgs-shared`-Обеспечивает те же разрешения, что `rpkgs-private` роли. Пользователи, являющиеся членами этой роли, также могут устанавливать и удалять общие пакеты.

- `db_owner`: Имеет те же разрешения, как `rpkgs-shared` роли. Кроме того, позволяет предоставить пользователям право на установку или удаление как общих, так и закрытых пакетов.

### <a name="creating-an-external-package-library-using-t-sql"></a>Создание библиотеки внешнего пакета с помощью T-SQL

Кроме того, 2017 г. SQL Server поддерживает инструкции T-SQL, **Создание ВНЕШНЕЙ БИБЛИОТЕКИ**, для поддержки управления внешние библиотеки, администратор базы данных. В настоящее время можно использовать эту инструкцию для создания библиотеки под управлением Windows для R. дополнительную поддержки запланировано в будущем пакеты Python, а также для пакетов, написанные для выполнения на других платформах, например в Linux.

Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql).

## <a name="package-management-using-r"></a>Пакет управления с помощью R

**RevoScaleR** пакет теперь содержит функции для поддержки упрощает установку и управление ими R-пакеты. Эти новые функции в сочетании с ролями базы данных для управления пакетами, поддерживает следующие сценарии:

- Специалист по анализу данных можно установить необходимые пакеты R на сервере SQL Server без необходимости административного доступа к компьютеру SQL Server.
- Пакеты устанавливаются отдельно для каждой базы данных, и при перемещении базы данных, пакеты перемещается вместе с ним.
- Проще сделать пакеты для других пользователей. Если вы настроили репозиторий локального пакета, каждый специалист может использовать хранилище для установки пакетов для своей базы данных.
- Администратор базы данных не требуется выполнение команды R и не требуется для отслеживания зависимостей сложных пакетов.
- Администратор базы данных можно использовать знакомые объекты ролей для пользователей SQL Server, которые разрешены для установки, удаления или использование пакетов управления.

### <a name="r-package-management-functions"></a>Функции управления пакета R

Для установки и удаления пакетов в контексте указанной вычислений в RevoScaleR, предусмотрены следующие функции пакета управления:

+ [rxInstalledPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxinstalledpackages): найти сведения о пакеты, установленные в контексте указанной вычислений.

+ [rxInstallPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxinstallpackages): установки пакетов в контексте вычислений, из указанного хранилища или чтении локально сохраненные ZIP-пакеты.

+ [rxRemovePackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxremovepackages): Удаление установленных пакетов из контекста вычислений.

+ [rxFindPackage](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxfindpackage): получить путь для одного или нескольких пакетов в контексте указанной вычислений.

+ [rxSyncPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsyncpackages): копирует библиотеку пакета между файловой системы и баз данных в контексте указанной вычислений.

+ [rxSqlLibPaths](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsqllibpaths): получить путь поиска для деревьев библиотеки для пакетов во время выполнения в SQL Server.

Эти пакеты также включаются в 2017 г. SQL Server по умолчанию. Можно добавить пакеты на экземпляре SQL Server 2016 при обновлении экземпляра для использования по крайней мере Microsoft R 9.0.1. Дополнительные сведения см. в разделе [SqlBindR.exe с помощью обновления R](use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

Сведения об этих функциях см. в разделе страницы ссылка функции RevoScaleR: (https://docs.microsoft.com/r-server/r-reference/revoscaler/revoscaler)

## <a name="how-package-management-works"></a>Как работает пакет управления

Если вы имеете разрешение на установку пакетов, запустите одну из функций управления пакетами из кода R и укажите контекст вычислений, где требуется добавить или удалить пакеты. Контекст вычислений может быть локальным компьютером или базой данных в экземпляре SQL Server. Если вызов для установки пакетов выполняется в SQL Server, ваши учетные данные определяют возможность выполнения операции на сервере. Функции установки пакета проверяют зависимости, чтобы убедиться, что в SQL Server можно установить все связанные пакеты, как и при установке пакета R в локальном контексте. Функция, которая удаляет пакеты, также вычисляет зависимости и гарантирует удаление пакетов, которые больше не используются другими пакетами в SQL Server, для освобождения ресурсов.

Каждый специалист по анализу данных можно установить закрытые пакеты, которые не видны другим пользователям, Создание частной изолированной среде R-пакетов. Так как пакеты, которые можно задавать в базе данных, и каждый пользователь получит изолированной отдельного пакета в каждой базе данных, проще установить разные версии того же пакета R.

Если вы переносите рабочей базе данных на новый сервер, можно использовать функцию синхронизации пакета считывает список всех пакетов и устанавливать их в базе данных на новом сервере.

> [!NOTE]
> 
> Предоставляются функции R для управления пакетами, начиная с Microsoft R Server 9.0.1. Если функции не удается найти в RevoScaleR, возможно, необходимо обновление до последней версии.

### <a name="bkmk_scope"></a>Определение областей пакеты по ролям

Новые функции управления пакетами предоставляют две области для установки и использования пакетов в SQL Server для конкретной базы данных:

- **Общая область**

  *Общая область* означает пользователи разрешение на роль общей области (`rpkgs-shared`) можно устанавливать и удалять пакеты для указанной базы данных. Пакет, установленный в библиотеке общей области, может использоваться другими пользователями базы данных в SQL Server при условии, что этим пользователям разрешено использовать установленные пакеты R.

- **Закрытая область**

  *Закрытая область* означает пользователи были присвоены членство в роли закрытая область (`rpkgs-private`) можно установить или удалить пакеты в расположение библиотеки частного определено для каждого пользователя. Таким образом, все пакеты, установленные в частной области, может использовать только пользователь, установивший их. Другими словами, пользователь в SQL Server не может использовать закрытые пакеты, установленные другим пользователем.

Эти модели для *общей* и *закрытой* области можно совмещать, чтобы создать настраиваемые системы безопасности для развертывания пакетов в SQL Server и управления ими.

Например, с помощью общей области руководителю группы специалистов по обработке данных можно предоставить разрешение на установку пакетов, после чего такие пакеты становятся доступны всем другим специалистам по обработке данных или пользователям, работающим в том же экземпляре SQL Server.

В другом сценарии может потребоваться повышенный уровень изоляции пользователей или возможность использования разных версий пакетов. В этом случае с помощью закрытой области можно предоставить разрешения отдельным специалистам, которые будут отвечать за установку и использование нужных им пакетов. Поскольку пакеты устанавливаются на уровне пользователя, пакеты, установленные одним пользователем, не повлияют на работу других пользователей, работающих с той же базой данных SQL Server.

### <a name="synchronizing-r-package-libraries"></a>Синхронизация библиотеки пакета R

В выпуске CTP 2.0 2017 г. SQL Server (и в выпуске Microsoft R Server апреле 2017 г) включает новые функции R для *синхронизация пакеты*.

Пакет синхронизация означает, что компонент database engine отслеживает пакеты, которые используются в конкретного пользователя и группы и при необходимости можно написать эти пакеты в файловую систему. Синхронизацию пакета можно использовать в следующих сценариях:

+ Чтобы переместить пакеты R между экземплярами SQL Server
+ Необходимо повторно установить пакеты для конкретного пользователя или группы, после восстановления базы данных

Дополнительные сведения см. в разделе [rxSyncPackages](../r/package-install-uninstall-and-sync.md).

## <a name="examples"></a>Примеры

Эти примеры демонстрируют простейшие варианты использования для функций пакета управления. Для выполнения этих команд требует наличия разрешения на выполнение команды R в экземпляре.

+ При запуске из удаленных терминалов R, можно создать объект контекста вычислений, указывающий экземпляр SQL Server и выполнить функции, передача контекст вычислений в качестве аргумента.

+ Для выполнения функций пакета управления из хранимой процедуры, необходимо заключить их в вызове `sp_execute_external_script`.

### <a name="package-scoping"></a>Определение области пакет

В этом примере проверяется для пакетов, которые были установлены на экземпляре `myServer`, в базе данных `TestDB`. Пакет управления, ограничиваются конкретной базы данных и пользователей. Если пользователь не указан, предполагается пользователь, выполняющий вызова контекста вычислений. Дополнительные сведения см. в разделе [Scoping пакетов по ролям](#bkmk_scope).

```R
sqlServerCompute <- RxInSqlServer(connectionString = "Driver=SQL Server;Server=myServer;Database=TestDB;Uid=myID;Pwd=myPwd;");
sqlPackagePaths <- rxFindPackage(package = "RevoScaleR", computeContext = sqlServerCompute);
```

### <a name="get-package-location-on-a-remote-sql-server-compute-context"></a>Получить расположение пакета на удаленный SQL Server контекст вычислений.

Этот пример возвращает путь для пакета **RevoScaleR** в контексте вычислений *sqlServer*.

  ```R
  sqlPackagePaths <- rxFindPackage(package = "RevoScaleR", computeContext = sqlServerL)
  ```

### <a name="get-locations-for-multiple-packages"></a>Получение расположений для нескольких пакетов

Этот пример возвращает пути для пакетов **RevoScaleR** и **lattice** в контексте вычислений *sqlServer*. Чтобы получить сведения о нескольких пакетов, передайте строку вектор, содержащий имена пакетов.

  ```R
  packagePaths <- rxFindPackage(package = c("RevoScaleR", "lattice"), computeContext = sqlServer)
  ```

### <a name="use-a-stored-procedure-to-list-packages-in-sql-server"></a>Использование хранимой процедуры, чтобы вывести список пакетов в SQL Server

Выполните следующую команду из среды Management Studio или другое средство, которое поддерживает T-SQL, чтобы получить список установленных пакетов в текущем экземпляре, с помощью `rxInstalledPackages` в хранимой процедуре.

```SQL
EXEC sp_execute_external_script 
  @language=N'R', 
  @script=N'
    myPackages <- rxInstalledPackages();
    OutputDataSet <- as.data.frame(myPackages);
    '
```

### <a name="get-package-versions-on-a-remote-compute-context"></a>Получение версии пакетов в контексте удаленного вычислений.

Выполните следующую команду из консоли R: получить номер сборки и номера версий для пакетов, установленных в контексте вычислений, *sqlServer*.

  ```R
  sqlPackages <- rxInstalledPackages(fields = c("Package", "Version", "Built"), computeContext = sqlServer)
```

### <a name="install-a-package-on-sql-server"></a>Установка пакета в SQL Server

Этот пример устанавливает пакет **ggplot2** и его зависимости в контексте вычислений *sqlServer*.

  ```R
  pkgs <- c("ggplot2")
  rxInstallPackages(pkgs = pkgs, verbose = TRUE, scope = "private", computeContext = sqlServer)
  ```

### <a name="remove-a-package-from-sql-server"></a>Удаление пакета из SQL Server

Этот пример удаляет пакет **ggplot2** и его зависимости из контекста вычислений *sqlServer*.

  ```R
  pkgs <- c("ggplot2")
  rxRemovePackages(pkgs = pkgs, verbose = TRUE, scope = "private", computeContext = sqlServer)
  ```

### <a name="package-synchronization"></a>Синхронизация пакета

Следующий пример синхронизирует пакеты, установленные в файловой системе со списком пакетов, управляемых в базе данных. Если отсутствуют некоторые пакеты, они устанавливаются в файловой системе.

```R
# Instantiate the compute context
connectionString <- "Driver=SQL Server;Server=myServer;Database=TestDB;Trusted_Connection=True;"
computeContext <- RxInSqlServer(connectionString = connectionString )

# Synchronize the packages in the file system for all scopes and users
rxSyncPackages(computeContext=computeContext, verbose=TRUE)
```

## <a name="next-steps"></a>Следующие шаги

[Как включить или отключить управление пакета R](../r/r-package-how-to-enable-or-disable.md)

