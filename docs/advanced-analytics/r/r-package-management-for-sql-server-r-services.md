---
title: "Управление пакетами R для SQL Server | Документы Microsoft"
ms.custom: 
ms.date: 01/04/2018
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- R
ms.assetid: 98c14b05-750e-44f9-8531-1298bf51e8d2
caps.latest.revision: 
author: jeannt
ms.author: jeannt
manager: cgronlund
ms.workload: On Demand
ms.openlocfilehash: cebafeabd73260f166244e963754a2bd740bfe0f
ms.sourcegitcommit: b4fd145c27bc60a94e9ee6cf749ce75420562e6b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2018
---
# <a name="r-package-management-for-sql-server"></a>Управление пакетами R для SQL Server

В этой статье описываются функции для управления пакетов R в SQL Server 2017 г. и в SQL Server 2016.

+ Рекомендуемые методы для управления пакетами R 
+ Изменения в пакете управления между SQL Server 2016 и 2017 г.

**Применяется к:** служб R SQL Server 2016, SQL Server 2017 г машинного обучения служб

## <a name="recommended-methods-for-package-management"></a>Рекомендуемые методы для управления пакетами

В SQL Server 2016 и 2017 г. SQL Server администратор компьютера можно установить пакеты для каждого экземпляра, где была включена машинного обучения. 

Пакеты устанавливаются в файловой системе, с помощью библиотек экземпляра и не может совместно использоваться экземплярами. В настоящее время это рекомендуется для SQL Server 2016 и 2017 г. SQL Server.

+ [Установка дополнительных пакетов R в SQL Server](install-additional-r-packages-on-sql-server.md)
+ [Определение установленных пакетов на SQL Server](determine-which-packages-are-installed-on-sql-server.md)

Кроме того Если у вас есть **dbo** членство в роли на экземпляр SQL Server, где была включена машинного обучения, можно установить пакеты R с удаленного клиента, с помощью новых функций в RevoScaleR.

+ [Новые функции R для установки пакета](#bkmk_remoteInstall)

### <a name="installation-on-servers-with-no-internet-access"></a>Установка на серверах без доступа к Интернету

Чтобы было проще определить требуемые версии пакета R и предоставляют все зависимости пакетов, можно использовать [miniCRAN](https://mran.microsoft.com/package/miniCRAN). R-пакет принимает список пакетов в целевой и будет создан локальный репозиторий, содержащую пакеты, цели и все их зависимости, в ZIP-формате. Затем можно скопировать это автономный сервер или совместно использовать хранилище несколькими экземплярами.

Дополнительные сведения см. в разделе [Создать репозиторий локального пакета с помощью miniCRAN](create-a-local-package-repository-using-minicran.md).

### <a name="python-packages"></a>Пакеты Python

Установить новые пакеты Python имеет те же правила: 

+ Просмотрите пакеты Python заранее, чтобы определить совместимость с текущей версией Python
+ Оценить пригодность пакета Python для зафиксированного среды SQL Server
+ Используйте средства Python для установки пакетов от имени администратора
+ Установите пакеты, которые необходимо выполнить в контексте только в библиотеке экземпляра SQL Server. 
+ При использовании нескольких сред для тестирования, производства, т. д., убедитесь, что та же версия пакета Python установлен в библиотеке экземпляра.

Инструкции по установке см. в разделе [установить новые пакеты Python на сервере SQL Server](../python/install-additional-python-packages-on-sql-server.md)

## <a name="features-for-package-management-in-sql-server-2016-and-sql-server-2017"></a>Функции для управления пакетами в SQL Server 2016 и 2017 г. SQL Server

SQL Server 2017 г. добавлены некоторые новые возможности для поддержки упрощает управление пакеты R (и Python) администраторы баз данных. Эти новые функции:

+ Возможность установки и управления им пакет библиотеки с помощью T-SQL
+ Управление разрешениями пользователя на уровне базы данных с помощью ролей базы данных. 

В будущих версиях эти функции должны предоставлять метод основной пакет управления администраторами баз данных и упростить специалистами по анализу данных для установки библиотек, которые им необходимы.

В то же время Microsoft R Server и машины обучения Server добавлены новые функции R для упрощения установки и обмениваться с ним пакетов в контексте вычислений SQL Server. Эти функции работают независимо от функций SQL Server, основанных на T-SQL и должны выполняться с удаленного клиента R.

Этот раздел содержит обзор этих возможностей.

### <a name="bkmk_remoteInstall"></a>Новые функции RevoScaleR для установки пакета 

Пользователи в последней версии R или сервер обучения машины также могут использовать новые функции в [ **RevoScaleR** ](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler) для установки пакетов на экземпляр, указанный в качестве контекста вычислений SQL Server.

+ Специалист по анализу данных можно установить необходимые пакеты R на сервере SQL Server без необходимости прямого доступа к серверу SQL Server. Тем не менее, пользователь должен быть членом владелец базы данных (**dbo**) роли.

+ Пользователь может совместно использовать пакеты, путем установки пакетов с общей области. Другим авторизованным пользователям одной и той же базе данных SQL Server можно получить доступ к пакет.

+ Пользователи могут устанавливать закрытые пакеты, которые не видны другим пользователям, Создание частной изолированной среде R-пакетов.

+ Обеспечивает синхронизацию пакета легкая резервное копирование и восстановление пакетов

#### <a name="package-installation-functions"></a>Функции установки пакета

Для установки и удаления пакетов в контексте указанной вычислений в RevoScaleR, предусмотрены следующие функции пакета управления:

-   [rxInstalledPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxinstalledpackages): найти сведения о пакеты, установленные в контексте указанной вычислений.

-   [rxInstallPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxinstallpackages): установки пакетов в контексте вычислений, из указанного хранилища или чтении локально сохраненные ZIP-пакеты.

-   [rxRemovePackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxremovepackages): Удаление установленных пакетов из контекста вычислений.

-   [rxFindPackage](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxfindpackage): получить путь для одного или нескольких пакетов в контексте указанной вычислений.

-   [rxSyncPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsyncpackages): копирует библиотеку пакета между файловой системы и баз данных в контексте указанной вычислений.

-   [rxSqlLibPaths](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsqllibpaths): получить путь поиска для деревьев библиотеки для пакетов во время выполнения в SQL Server.

Чтобы использовать эти функции, подключитесь к экземпляру SQL Server, где есть необходимые разрешения, с помощью контекста вычислений SQL Server. 

> [!IMPORTANT]
> Учетные данные, которые в соединении определяют, можно ли выполнить операцию на сервере.

Эти функции установки пакета проверка зависимостей и убедитесь, что все связанные пакеты могут быть установлены для SQL Server, так же, как установка пакетов R в локальном контексте. Функция, которая удаляет пакеты, также вычисляет зависимости и гарантирует удаление пакетов, которые больше не используются другими пакетами в SQL Server, для освобождения ресурсов.

Эти функции включаются в версии RevoScaleR, установленного в 2017 г. SQL Server. Эти функции можно также получить, [обновление экземпляра SQL Server](use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md) для использования последней версии [Microsoft R Server или обучения машины](https://docs.microsoft.com/machine-learning-server/rebranding-microsoft-r-server). Требуется версия 9.0.1 или более поздней версии.

#### <a name="package-synchronization-functions"></a>Функции синхронизации пакета

Синхронизация пакета — это новая функция только R-пакетов. Компонент database engine отслеживает пакеты, которые используются в конкретного пользователя и группы и при необходимости можно написать эти пакеты в файловую систему. Обычно в таких случаях следует использовать синхронизацию пакета:

+ Требуется переместить пакеты R между экземплярами SQL Server.
+ Необходимо переустановить пакетов для конкретного пользователя или группы, после восстановления базы данных.

Дополнительные сведения о том, как включение и использование этой функции см. в разделе [синхронизацию пакета R для SQL Server](package-install-uninstall-and-sync.md).

### <a name="package-management-using-t-sql"></a>Пакет управления с помощью T-SQL

2017 г. SQL Server добавлены новые инструкции T-SQL для предоставления больший контроль над пакеты R на уровне базы данных администратор базы данных. Администратор базы данных не следует узнать, как использовать R или средства Python, но вместо этого должны иметь возможность разрешить пользователям R или Python для установки пакетов, применяя необходимые и использовать их совместно с другими разделами.

Эта функция предназначена для упрощения управления совместной работы и версии в многопользовательских средах: пример:

+ Вы хотите поделиться пакеты, разработанные с другими пользователями вашей команды.
+ Другие аналитики работаете в той же базе данных и должны использовать разные версии того же пакета.
+ Требуется переместить в то же время, при перемещении базы данных или во время выполнения резервного копирования и восстановления операций пакеты и их разрешения.

Пакет управления в 2017 г. SQL Server использует эти новые объекты базы данных и компоненты:

+ [Новые роли базы данных](#bkmk_roles), для управления пакета доступ и использование
+ [Создание ВНЕШНЕЙ БИБЛИОТЕКИ](#bkmk_createExternalLibrary) инструкции, для передачи на сервер библиотеки пакета

Использование этих функций требует некоторых дополнительных подготовки на уровне экземпляра и базы данных: 

+  Администратор базы данных необходимо явно включить компонент пакета управления, выполнив скрипт, который создает необходимые объекты базы данных. Дополнительные сведения см. в разделе [Включение управления пакета R](r-package-how-to-enable-or-disable.md).

+ Пользователи должны назначаться ролей на уровне каждой базы данных. Эти роли предоставляют пользователям возможность устанавливать пакеты совместно используемой или закрытой.

+ Библиотеки пакета можно установить с помощью новой инструкции T-SQL, создание ВНЕШНЕЙ БИБЛИОТЕКИ. Тем не менее все зависимости пакета должны быть заранее подготовлены и установлены в рамках одного ZIP-файла.

> [!NOTE]
> Несмотря на то, что в данный момент полнофункциональны описываемые здесь функции, будущие выпуски содержат дополнительные усовершенствования для упрощения для подготовки пакета библиотек и для управления зависимостями. Если вы знакомы с установки пакета R, рекомендуется продолжать использовать средства R сейчас.

#### <a name="bkmk_createExternalLibrary"></a>СОЗДАНИЕ ВНЕШНЕЙ БИБЛИОТЕКИ 

[Создание ВНЕШНЕЙ БИБЛИОТЕКИ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) является новой инструкции T-SQL, появившиеся в SQL Server 2017 г. для работы с пакетами без необходимости пользовательская R администратор базы данных. 

Вы используете **создать ВНЕШНЮЮ БИБЛИОТЕКУ** инструкции для загрузки внешней библиотеки экземпляра в формате ZIP-файл. Авторизованные пользователи можно получить доступ к библиотекам и устанавливать их для собственных нужд.

Например можно создать несколько копий проекта R, каждый из них на другую версию. Передача их как отдельные библиотеки позволяет сохранять некоторые версии частного и поделиться с другими пользователями в некоторых версиях.

По сути, «Библиотека» — это совокупность внешние пакеты, которые требуется сделать доступными для пользователей под одним именем. Например могут быть опубликованы следующие в SQL Server как внешней библиотеки:

+ Один пакет R написания, без зависимостей
+ Пакет, который вы хотите установить и зависимости, необходимые для установки
+ Коллекция пакетов R, связанные с некоторой задачи или проекта, с их зависимости

Имя библиотеки — для управления пакет или набор пакетов в SQL Server и могут не зависеть от пакетов, которые будут установлены. Однако имена библиотеки должны быть уникальными в экземпляре.

Чтобы использовать эту инструкцию, необходимо включить компонент пакета управления на экземпляре. Дополнительные сведения см. в разделе [создать ВНЕШНЮЮ БИБЛИОТЕКУ](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql).

> [!NOTE]
> В настоящее время этот оператор можно использовать для создания библиотек только под управлением Windows, для поддержки R. запланировано в будущем пакеты Python, а также для пакетов, которые выполняются на других платформах, например в Linux.

После передачи внешней библиотеки на сервере необходимо установить его в библиотеку пакет R, связанные с экземпляром. Существует несколько способов это сделать:

+ Стандартная команда R `install.packages` внутри sp_execute_external_script. Убедитесь, что подключение с учетной записью, обладающей разрешениями на установку пакетов.

+ Подключитесь к SQL Server с удаленного клиента R и выполните [rxInstallPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxinstallpackages) в контексте вычислений SQL Server. Опять же должен иметь разрешения для установки пакетов либо в закрытые или общие области для этого.

Чтобы убедиться, что предоставляются все зависимости пакета, мы рекомендуем использовать [miniCRAN](create-a-local-package-repository-using-minicran.md) для создания локального репозитория. Затем можно использовать этот ZIP-файл для установки целевой пакет и его зависимости.

#### <a name="bkmk_roles"></a>Роли базы данных для пакета управления 

Новые роли, предоставленные в SQL Server для пакета управления не включаются по умолчанию, даже в случаях, где установлена и включена машинного обучения. Необходимо добавить роли с помощью скрипта как описано здесь: [включить или отключить управление пакетами](r-package-how-to-enable-or-disable.md).

После выполнения этого сценария вы увидите следующие новые роли базы данных:

+ `rpkgs-users`: Члены этой роли можно использовать любой общей пакет, который был установлен ни один `rpkgs-shared` члена роли.

+ `rpkgs-private`: Члены этой роли имеют доступ к общей пакетов с теми же разрешениями, члены `rpkgs-users` роли. Члены этой роли можно также установить, удалить и использовать пакеты в частном порядке с областью.

+ `rpkgs-shared`: Члены этой роли имеют те же разрешения, что и члены `rpkgs-private` роли. Кроме того члены этой роли можно установить или удалить общие пакеты.

+ `db_owner`: Члены этой роли имеют те же разрешения, что и члены `rpkgs-shared` роли. Кроме того, члены этой роли могут **предоставить** другим пользователям, право устанавливать или удалять как общие и закрытые пакеты.

Администратор базы данных могут добавлять пользователей к ролям отдельно для каждой базы данных.



## <a name="next-steps"></a>Следующие шаги

[Пакет управления для SQL Server машинного обучения](r-package-management-for-sql-server-r-services.md)
