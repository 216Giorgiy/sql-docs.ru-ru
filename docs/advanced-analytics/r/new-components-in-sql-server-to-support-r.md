---
title: "Компоненты SQL Server для поддержки R | Документы Microsoft"
ms.custom: 
ms.date: 04/05/2017
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: r-services
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 54e9ef3f-1136-471e-865a-7cf013673186
caps.latest.revision: "9"
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 2aa7a79610433c11270d146473f233747fda3d39
ms.sourcegitcommit: 23433249be7ee3502c5b4d442179ea47305ceeea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2017
---
# <a name="components-in-sql-server-to-support-r"></a>Компоненты SQL Server для поддержки R

В SQL Server 2016 и 2017 г. компонент database engine включает дополнительные компоненты, поддерживающие расширяемости для внешнего сценария языков, включая R и Python. Была добавлена поддержка языка R в SQL Server 2016; Поддержка Python был добавлен в службах SQL Server 2017 г машины обучения.

В этом разделе описываются новые компоненты, которые работают в частности, с помощью языка r. Описание принципов работы этих компонентов с открытым исходным кодом R см. в разделе [взаимодействие R](r-interoperability-in-sql-server.md)

## <a name="components-and-providers"></a>Компоненты и поставщиков

Помимо оболочки, которая загружает объекты R и выполняет код R, как описано в обзоре архитектуры, [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] содержит следующие дополнительные компоненты.

### <a name="launchpad"></a>Панель запуска 

[!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] — Служба, предоставляемая [!INCLUDE[ssCurrent_md](../../includes/sscurrent-md.md)] для поддержки выполнение внешних скриптов, аналогично тому, как служба полнотекстового индексирования и выполнения запросов для обработки полнотекстовых запросов запускается отдельный узел.

Служба панели запуска запускает только доверенные средства запуска, опубликованные или сертифицированные корпорацией Майкрософт как соответствующие требованиям к управлению ресурсами и производительностью. Нетрудно именования для средства запуска конкретного языка:

  + R - RLauncher.dll
  + Python — PythonLauncher.dll

Служба [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] выполняется со своей собственной учетной записью пользователя. Каждый вспомогательный процесс для определенной языковой среды наследует эту учетную запись. Дополнительные сведения о конфигурации и контекст безопасности панели запуска см. в разделе [Общие сведения о безопасности](../../advanced-analytics/r/security-overview-sql-server-r.md).

### <a name="bxlserver-and-sql-satellite"></a>BxlServer и вспомогательных SQL

BxlServer является исполняемым, предоставляемых корпорацией Майкрософт, который управляет связью между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и среды выполнения R и также реализует функции RevoScaleR. Он создает объекты заданий Windows, которые содержат сеансы R, подготавливает безопасные рабочие папки для каждого задания R и использует вспомогательное соединение SQL для управления передачей данных между R и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].

Таким образом, BxlServer является дополнением к R, которое работает с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] для поддержки интеграции R с SQL Server. BXL расшифровывается языка двоичных Exchange и ссылается на формат данных, используемый для перемещения данных эффективно между SQL Server и внешних процессов, таких как R. BxlServer.dll также устанавливается при установке клиента Microsoft R или Microsoft R Server.

Вспомогательное соединение SQL — это новый API расширяемости в SQL Server 2016, который предоставляется ядром СУБД для поддержки внешнего кода или внешних сред выполнения, реализованных на языке C или C++. BxlServer использует вспомогательное соединение SQL для взаимодействия с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].

Вспомогательное соединение SQL использует пользовательский формат данных, оптимизированный для быстрой передачи данных между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и языками внешних скриптов. Оно выполняет преобразования типов и определяет схемы входных и выходных наборов данных во время обмена данными между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и R.

BxlServer использует вспомогательное соединение SQL для следующих задач:

  + чтение входных данных;
  + запись выходных данных;
  + получение входных аргументов;
  + запись входных аргументов;
  + Обработка ошибок
  + Написание стандартный выход и ошибки с клиентом

Вспомогательное соединение SQL можно отслеживать с помощью расширенных событий. Дополнительные сведения см. в статье [Расширенные события для служб R SQL Server](extended-events-for-sql-server-r-services.md).

## <a name="communication-channels-between-components"></a>Каналы связи между компонентами

+ **TCP/IP**

    По умолчанию внутренней связи между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и вспомогательных SQL использует протокол TCP/IP.

+ **Именованные каналы**

    Внутренние данные транспорта между BxlServer и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] через спутник SQL использует формат собственности, сжатых данных для повышения производительности. Обмен данными между памятью R и BxlServer происходит по именованным каналам в формате BXL.

+ **ODBC**

    Взаимодействие между клиентами обработки и анализа внешних данных и [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] экземпляр использовать ODBC. Учетная запись, отправляющая задания R в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], должна иметь разрешения и для подключения к экземпляру, и для выполнения внешних скриптов. Она должна иметь разрешение на доступ к данным, используемым заданием, записи данных (например, для сохранения результатов в таблицу) или создания объектов баз данных (например, при сохранении функций R в качестве части новой хранимой процедуры).

    Когда [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] используется как контекст вычислений для задания R, отправленного с удаленного клиента, а команда R должна получать данные из внешнего источника, для обратной записи используется ODBC. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] сопоставляет идентификатор пользователя, вызывающего удаленную команду R, с идентификатором пользователя в текущем экземпляре и выполняет команду ODBC, используя учетные данные этого пользователя. Строка подключения, необходимая для выполнения этого вызова ODBC, получается из клиентского кода.

    Дополнительные вызовы ODBC можно вносить в скрипт с помощью **RODBC**. RODBC — это популярный пакет R для доступа к данным в реляционных базах данных. Тем не менее его производительность обычно медленнее, чем у поставщиков, используемых сервером [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)]. Многие скрипты R используют встроенные вызовы RODBC как способ получения "вторичных" наборов данных для использования при анализе. Например, хранимая процедура, которая обучает модель, может определить SQL-запрос, чтобы получить данные для обучения модели, но использовать встроенный вызов RODBC, чтобы получить дополнительные факторы для выполнения операций поиска или для получения новых данных из внешних источников, таких как текстовые файлы или Excel.

    Следующий код иллюстрирует вызов RODBC, встроенный в скрипт R:

    ```R
    library(RODBC);
    connStr <- paste("Driver=SQL Server;Server=", instance_name, ";Database=", database_name, ";Trusted_Connection=true;", sep="");
    dbhandle <- odbcDriverConnect(connStr)
    OutputDataSet <- sqlQuery(dbhandle, "select * from table_name");
    ```

+ **Другие протоколы**

    Можно также использовать процессы, которые может потребоваться работать в виде «фрагментов» или передавать данные удаленного клиента. XDF формат, поддерживаемый Microsoft R. фактическое передача данных осуществляется через кодировке больших двоичных объектов.

## <a name="interaction-of-components"></a>Взаимодействие компонентов

Описанная выше архитектура компонентов гарантирует, что код R с открытым исходным кодом работает "как есть" и существенно повышает производительность кода, выполняемого на компьютере [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)]. Механизм взаимодействия компонентов со средой выполнения R и ядром СУБД [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] отличается в зависимости от способа запуска кода R. В этом разделе описаны основные сценарии.

### <a name="r-scripts-executed-from-sql-server-in-database"></a>R-скриптов, выполненных из SQL Server в базе данных

Код R, который запускается "внутри" [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], выполняется с помощью вызова хранимой процедуры. Таким образом, любое приложение, которое может сделать вызов хранимой процедуры, может также инициировать выполнение кода R.  После этого [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] управляет выполнением кода R, как показано на следующей схеме.

![rsql_indb780-01](media/script_in-db-r.png)

1. Запрос к среде выполнения R, указанный с помощью параметра _@language='R'_, передается хранимой процедуре [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] отправляет этот запрос в службу панели запуска.
2. Служба панели запуска запускает соответствующее средство запуска. В данном случае RLauncher.
3. RLauncher запускает внешний процесс R.
4. BxlServer взаимодействует со средой выполнения R для управления обменом данными между [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и хранилищем результатов работы.
5. Вспомогательные SQL управляет взаимодействием связанные задачи и процессы, [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
6. BxlServer использует вспомогательное соединение SQL для передачи состояния и результатов в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
7. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] получает результаты и закрывает связанные задачи и процессы.

### <a name="r-scripts-executed-from-a-remote-client"></a>Скрипты R, выполняемые из удаленного клиента

При подключении из клиента обработки и анализа удаленных данных, который поддерживает Microsoft R, можно запустить функций R в контексте [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] с помощью функции RevoScaleR. Этот рабочий процесс отличается от предыдущего и показан на следующей схеме.

![rsql_fromR2db-01](media/remote-sqlcc-from-r2.png)

1. Для функции RevoScaleR R среда выполнения вызывает связывания функцию, которая в свою очередь вызывает BxlServer.
2. BxlServer входит в состав Microsoft R и выполняется в процессе, отдельном от среды выполнения R.
3. BxlServer определяет целевой объект подключения и инициирует подключение с использованием ODBC, передавая учетные данные, предоставленные в виде части строки подключения в объекте источника данных R.
4. BxlServer устанавливает подключение к экземпляру [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
5. Для вызова R, панели запуска при вызове службы, передаваемый в свою очередь запускает соответствующие средства запуска RLauncher. После этого обработка кода R происходит аналогично процессу выполнения кода R из T-SQL.
6. RLauncher вызывает экземпляр среды выполнения R, установленный на компьютере [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)].
7. Результаты возвращаются в BxlServer.
8. Вспомогательное соединение SQL управляет взаимодействием с [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] и очисткой связанных объектов задания.
9. [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] передает результаты клиенту.

## <a name="next-steps"></a>Следующие шаги

[Общие сведения об архитектуре](architecture-overview-sql-server-r.md)

[Общие сведения о безопасности](security-overview-sql-server-r.md)

[Вопросы безопасности](security-considerations-for-the-r-runtime-in-sql-server.md)
