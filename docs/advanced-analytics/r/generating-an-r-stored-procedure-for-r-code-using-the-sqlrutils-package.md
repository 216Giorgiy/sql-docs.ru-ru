---
title: "Создание хранимой процедуры R для кода R с помощью пакета sqlrutils | Документация Майкрософт"
ms.custom: 
ms.date: 02/28/2017
ms.reviewer: 
ms.suite: sql
ms.prod: machine-learning-services
ms.prod_service: machine-learning-services
ms.component: r
ms.technology: 
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: R
ms.assetid: d8739f16-ac26-4f69-870c-51c77cf286d3
caps.latest.revision: "8"
author: jeannt
ms.author: jeannt
manager: cgronlund
ms.workload: Inactive
ms.openlocfilehash: 4948cdd841c2b97e50623dac7b9d6ba9ef923220
ms.sourcegitcommit: 9e6a029456f4a8daddb396bc45d7874a43a47b45
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2018
---
# <a name="generating-an-r-stored-procedure-for-r-code-using-the-sqlrutils-package"></a>Создание хранимой процедуры R для кода R с помощью пакета sqlrutils
Пакет **sqlrutils** предоставляет пользователям R механизм для помещения скриптов R в хранимую процедуру T-SQL, регистрации этой хранимой процедуры с базой данных и ее запуска из среды разработки R. 

Преобразование кода R для выполнения в рамках одной хранимой процедуры позволяет более эффективно использовать службы SQL Server R Services, которые требуют внедрить скрипт R в качестве параметра в [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). Пакет **sqlrutils** помогает создать такой внедренный скрипт R и правильно настроить соответствующие параметры.

Пакет **sqlrutils** выполняет следующие задачи.

- Сохраняет созданный скрипт T-SQL в виде строки внутри структуры данных R.
- При необходимости создает SQL-файл для скрипта T-SQL, который можно изменить или выполнить, чтобы создать хранимую процедуру.
- Регистрирует созданную хранимую процедуру в экземпляре SQL Server из среды разработки R.

Вы также можете выполнить хранимую процедуру из среды R, передав параметры с правильным форматом и обработав результаты. Или вы можете использовать хранимую процедуру из SQL Server для поддержки стандартных сценариев интеграции базы данных, таких как извлечение, преобразование и загрузка, обучение модели и оценка большого объема.

  > [!NOTE]
  > Если планируется выполнить хранимую процедуру из среды R путем вызова функции *executeStoredProcedure* , следует использовать поставщик ODBC 3.8, например драйвер ODBC 13 для SQL Server.  
  
## <a name="functions-provided-in-sqlrutils"></a>Функции, предоставляемые в sqlrutils

Ниже представлен обзор функций, которые можно вызывать из пакета **sqlrutils** в целях разработки хранимой процедуры для использования в службах SQL Server R Services. Сведения о параметрах для каждого метода или каждой функции см. в справке R для этого пакета.

```R
help(package="sqlrutils") 
```

**Определение параметров и входных данных хранимой процедуры**

- `InputData`. Определяет источник данных в SQL Server, который будет использоваться в кадре данных R. Укажите имя data.frame для хранения входных данных и запрос для получения данных или значение по умолчанию. Поддерживаются только простые запросы SELECT.

- `InputParameter`. Определяет отдельный входной параметр, который будет внедрен в скрипт T-SQL. Необходимо указать имя параметра и его тип данных R.

- `OutputData`. Cоздает объект промежуточных данных, который требуется, когда функция R возвращает список, содержащий data.frame. 
   Объект *OutputData* используется для хранения имени отдельного data.frame, полученного из списка. 

- `OutputParameter`. Cоздает объект промежуточных данных, который требуется, когда функция R возвращает список. Объект *OutputParameter* хранит имя и тип данных для одного элемента списка при условии, что он **не** является кадром данных. 


**Создание и регистрация хранимой процедуры**


- `StoredProcedure` является основным конструктором, используемым для создания хранимой процедуры.  Этот конструктор создает объект *хранимой процедуры SQL Server* и при необходимости создает текстовый файл, содержащий запрос, который можно использовать для создания хранимой процедуры с помощью команды T-SQL. При необходимости функция *StoredProcedure* может зарегистрировать хранимую процедуру с помощью указанного экземпляра и базы данных.

   + Используйте аргумент `func` для указания допустимой функции R. Все переменные, которые использует функция, должны быть определены внутри функции либо представления в виде входных параметров. Эти параметры могут включать не более одного кадра данных.
   + Функция R должна возвращать кадр данных, именованный список или значение NULL. Если функция возвращает список, он может содержать не более одного data.frame.
   + Используйте аргумент `spName` для указания имени создаваемой хранимой процедуры.
   + Можно передать необязательные входные и выходные параметры с помощью объектов, созданных следующими вспомогательными функциями: `setInputData`, `setInputParameter`и `setOutputParameter`.
   +  При необходимости используйте `filePath` для указания пути и имени создаваемого SQL-файла. Этот файл можно запустить на экземпляре SQL Server для создания хранимой процедуры с помощью T-SQL.
   + Для определения сервера и базы данных, где будет сохранена хранимая процедура, используйте аргументы `dbName` и  `connectionString`.
   + Чтобы получить список объектов *InputData* и *InputParameter* , которые использовались для создания определенного объекта *StoredProcedure* , вызовите `getInputParameters`. 
   + Чтобы зарегистрировать хранимую процедуру в указанной базе данных, используйте `registerStoredProcedure`.

   Объект хранимой процедуры обычно не имеет связанных с ним данных или значений, если только не указано значение по умолчанию. Данные не извлекаются до выполнения хранимой процедуры. 


**Указание входных данных и выполнение**

- Используйте `setInputDataQuery` для назначения запроса объекту *InputParameter* . Например, если вы создали объект хранимой процедуры в R, можно использовать `setInputDataQuery` для передачи аргументов в *StoredProcedure* для выполнения хранимой процедуры с нужными входными данными.

- Используйте `setInputValue` для назначения конкретного значения параметру, сохраненному в виде объекта *InputParameter* . Затем передайте объект параметра и его назначение значения в *StoredProcedure* , чтобы выполнить хранимую процедуру с заданными значениями.

- Используйте `executeStoredProcedure` для выполнения хранимой процедуры, определенной в виде объекта *StoredProcedure* . Вызывайте эту функцию только при выполнении хранимой процедуры из кода R. Не используйте ее при запуске хранимой процедуры из SQL Server с помощью T-SQL.

  > [!NOTE]
  > Функции *executeStoredProcedure* требуется поставщик ODBC 3.8, например драйвер ODBC 13 для SQL Server.  
  
  



## <a name="see-also"></a>См. также
[Создание хранимой процедуры с помощью sqlrutils](../../advanced-analytics/r-services/how-to-create-a-stored-procedure-using-sqlrutils.md)

