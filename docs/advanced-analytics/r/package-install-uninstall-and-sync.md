---
title: "Синхронизация пакета R для SQL Server | Документы Microsoft"
ms.custom: 
ms.date: 10/02/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- r-services
ms.tgt_pltfrm: 
ms.topic: article
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 29122bdf543e82c1f429cf401b5fe1d8383515fc
ms.openlocfilehash: ed7dbf99b0f492b5ca8879bb67a7256fdfae3306
ms.contentlocale: ru-ru
ms.lasthandoff: 10/10/2017

---

# <a name="r-package-synchronization-for-sql-server"></a>Синхронизация пакета R для SQL Server

2017 г. SQL Server включает в себя возможность синхронизировать коллекции пакетов R в файловой системе с экземпляра и базы данных использования пакетов.
Эта функция, предоставленная упростить резервное копирование коллекции пакет R, связанные с базами данных SQL Server. Используя эту возможность, администратор сможет восстановить не только базы данных, но все пакеты R, используемые в работе с базой данных специалистами по анализу данных.

В этом разделе описываются функции синхронизации пакета и способ использования [rxSyncPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsyncpackages) функцию для выполнения следующих задач:

+ Синхронизировать список пакетов для всей базы данных SQL Server

+ Синхронизация пакетов, используемого отдельного пользователя или группы пользователей

+ Если пользователь переходит на другой сервер SQL Server, можно создать резервную копию рабочей базы данных пользователя и восстановите ее на новый сервер, и пакеты для пользователя будут установлены в файловую систему на новом сервере, как того требует R.

Например можно использовать синхронизацию пакета в следующих сценариях:

+ Администратор базы данных восстанавливает экземпляр SQL Server на новом компьютере и просит пользователей для подключения от клиентов их R и запуска `rxSyncPackages` для обновления и восстановления своих пакетов.

+ Вы считаете, что повреждены R-пакет в файловой системе, чтобы запустить `rxSyncPackages` на сервере SQL Server.

## <a name="requirements"></a>Требования

Прежде чем использовать синхронизацию пакета, необходимо иметь соответствующую версию платформы Microsoft R и включена функция связанные базы данных.

### <a name="determine-whether-your-server-supports-package-management"></a>Определить, поддерживает ли ваш сервер пакета управления

Эта функция доступна в CTP-версии 2 SQL Server 2017 г. или более поздней.

Так как эта функция использует функции R в 9.1.0 версии Microsoft R, можно добавить этот компонент к экземпляру SQL Server 2016 после обновления экземпляра, чтобы использовать последнюю версию Microsoft R. Дополнительные сведения см. в разделе [SqlBindR.exe используется для обновления SQL Server R Services](use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

### <a name="enable-the-package-management-feature"></a>Включить функции пакета управления

Для использования пакета синхронизации требуется включить новые функции управления пакетами в экземпляре SQL Server, а также на отдельных баз данных, используемых для запуска задач R.

1. Администратор сервера включает функцию для экземпляра SQL Server.
2. Для каждой базы данных администратор предоставляет пользователям возможность установки или совместного использования R-пакеты.

После этого, сведения о пользователях и пакетов, которые они установлены хранится в экземпляре SQL Server. Эти данные затем могут применяться для обновления R-пакеты в файловой системе.

Каждый раз при добавлении нового пакета с помощью функций пакета управления, обновляются записи в SQL Server и в файловой системе.

> [!NOTE]
> Нельзя использовать синхронизацию пакета, если вы занимались установкой пакетов R традиционным способом с помощью средства R для установки пакетов непосредственно в файловой системе.
### <a name="permissions"></a>Permissions

+ Кто выполняет функцию синхронизации пакета должно быть участника на экземпляр SQL Server и базы данных, в котором пакеты безопасности.

+ Вызывающий эту функцию участник должен быть членом одной из этих ролей пакета управления: **общих rpkgs** или **rpkgs частного**.

+ Для синхронизации пакеты, которые помечены как **общего**, пользователя, выполняющего функции необходимо быть членом **rpkgs общих** роли и пакетами, которые перемещаются должен быть установлен к общей Библиотека области.

+ Для синхронизации пакеты, которые помечены как **закрытый**, либо владелец пакета или администратор должен запустить функцию, и пакеты должны быть закрытыми.

+ Чтобы синхронизировать пакеты от лица других пользователей, владелец должен быть членом **db_owner** роли базы данных.

## <a name="how-package-synchronization-works"></a>Как работает синхронизация пакета

Чтобы использовать синхронизацию пакета, вызовите [rxSyncPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsyncpackages), который представляет собой новую функцию в [RevoScaleR](https://docs.microsoft.com/r-server/r-reference/revoscaler/revoscaler). Эту функцию можно вызывать из SQL Server с помощью sp_execute_external_script, или можно запустить с удаленного клиента R и указать контекста вычислений SQL Server. 

Поскольку пакеты управляются на уровне базы данных, для каждого вызова `rxSyncPackages`, необходимо указать экземпляр SQL Server и базы данных, а затем список пакетов, или указать область пакета.

1. Создание контекста вычислений SQL Server с помощью `RxInSqlServer` функции. Если не указать контекст вычислений, используется текущий контекст вычислений.

2. Укажите имя базы данных в экземпляре в контексте указанного вычислений. Пакеты управляются на одну базу данных.

3. Список пакетов для синхронизации.

4.  При необходимости использовать *область* аргументом ли синхронизации пакеты для одного пользователя или группы пользователей. Если запустить функцию без указания либо **закрытый** или **общего** область действия, весь набор пакетов, доступных для всех областей, пользователи будут скопированы.

Если команда выполняется успешно, существующие пакеты в файловой системе добавляются в базу данных с заданной областью и владельца. В случае повреждения файловой системы пакеты будут восстановлены на основе списка, сохраняется в базе данных.

### <a name="example-1-synchronize-all-package-by-database"></a>Пример 1. Синхронизировать всех пакетов, базы данных

В этом примере извлекаются все пакеты, установленные в базе данных [TestDB]. Так как владелец не является подходящим, этот список включает все пакеты, которые были установлены для личных и общих областей.

```R
connectionString <- "Driver=SQL Server;Server=myServer;Database=TestDB;Trusted_Connection=True;"
computeContext <- RxInSqlServer(connectionString = connectionString )
rxSyncPackages(computeContext=computeContext, verbose=TRUE)
```

### <a name="example-2-restrict-synchronized-packages-by-scope"></a>Пример 2. Ограничить синхронизированных пакетов по области

Следующие примеры синхронизировать только пакетов в указанной области.

```R
#Shared scope
rxSyncPackages(computeContext=computeContext, scope="shared", verbose=TRUE)

#Private scope
rxSyncPackages(computeContext=computeContext, scope="private", verbose=TRUE)
```

### <a name="example-3-restrict-synchronized-packages-by-owner"></a>Пример 3. Ограничить синхронизированных пакетов владельцем

Ниже приведен пример, как получить только пакеты, установленные для определенного пользователя. В этом примере пользователь идентифицируется по имени входа SQL, *user1*.

```R
rxSyncPackages(computeContext=computeContext, scope="private", owner = "user1", verbose=TRUE))
```

### <a name="example-4-restrict-synchronized-packages-by-owner"></a>Пример 4. Ограничить синхронизированных пакетов владельцем

Следующий пример синхронизирует пакеты, установленные в файловой системе со списком пакетов, управляемых в базе данных. Если ни один из пакетов отсутствует, он устанавливается в файловой системе.

```R
# Instantiate the compute context
connectionString <- "Driver=SQL Server;Server=myServer;Database=TestDB;Trusted_Connection=True;"
computeContext <- RxInSqlServer(connectionString = connectionString )

# Synchronize the packages in the file system for all scopes and users
rxSyncPackages(computeContext=computeContext, verbose=TRUE)
```

## <a name="related-resources"></a>Связанные ресурсы

[Управление пакетами R для SQL Server](r-package-management-for-sql-server-r-services.md)

