---
title: "Определение и использование контекстов вычислений (глубокое погружение в обработку и анализ данных) | Документация Майкрософт"
ms.custom: 
ms.date: 05/22/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology: r-services
ms.tgt_pltfrm: 
ms.topic: article
applies_to: SQL Server 2016
dev_langs: R
ms.assetid: b13058d0-9c6a-44e1-849b-72189d9050ba
caps.latest.revision: "17"
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: a682a40a9a62af3e1ff18ec0cc777ac9c1da7a9e
ms.sourcegitcommit: 531d0245f4b2730fad623a7aa61df1422c255edc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2017
---
# <a name="define-and-use-compute-contexts"></a>Определение и использование контекстов вычисления


Представьте себе, что вы решили, что некоторые более сложные вычисления должны выполняться на сервере, а не на локальном компьютере. Для этого вы можете создать контекст вычислений, который позволяет выполнять на сервере код R.

Функция **RxInSqlServer** — это одна из расширенных функций R, входящих в состав пакета [RevoScaleR](https://msdn.microsoft.com/microsoft-r/scaler/scaler) . Она отвечает за задачи создания подключения к базе данных и передачи объектов между локальным компьютером и удаленным контекстом выполнения.

В этом шаге вы узнаете, как использовать функцию **RxInSqlServer** для определения контекста вычисления в своем коде R.

Для создания контекста вычислений требуются следующие базовые сведения об экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] :

- строка подключения к экземпляру;
- спецификация способа обработки выходных данных;
- необязательные аргументы для включения трассировки или для указания общего каталога.

## <a name="create-and-set-a-compute-context"></a>Создание и задание контекста вычисления

1. Укажите строку подключения к экземпляру, в котором будут производиться вычисления.  Это лишь одна из нескольких переменных, которые вы будете передавать в функцию *RxInSqlServer* для создания контекста вычислений. Вы можете использовать уже существующую строку подключения или создать новую, если нужно переместить вычисления на другой сервер или использовать другое удостоверение.

    **Использование имени для входа SQL**

      ```R
      sqlConnString <- "Driver=SQL Server;Server=<SQL Server instance name>; Database=<database name>;Uid=<SQL user name>;Pwd=<password>"
      ```

    **Использование проверки подлинности Windows**

      ```R
      sqlConnString <- "Driver=SQL Server;Server=instance_name;Database=DeepDive;Trusted_Connection=True"
      ```
2. Укажите способ обработки выходных данных. В следующем коде вы указываете, что сеанс R на рабочей станции всегда должен дожидаться результатов задания R, но не возвращать вывод с консоли от удаленных вычислений.
  
    ```R
    sqlWait <- TRUE
    sqlConsoleOutput <- FALSE
    ```
  
    Аргумент *wait* функции *RxInSqlServer* может иметь перечисленные ниже значения.
  
    -   **TRUE**. Задание будет блокироваться и не вернет результат, пока его выполнение не завершится успешно или с ошибкой.  Дополнительные сведения см. в разделе [распределенных и параллельных вычислений в Microsoft R](https://msdn.microsoft.com/microsoft-r/scaler-distributed-computing).
  
    -   **FALSE**. Задания не будут блокироваться и будут возвращать результат немедленно, что позволит продолжать выполнять другой код на языке R. Однако даже в режиме без блокировки подключение клиента к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должно сохраняться, пока задание выполняется.

3. При необходимости можно указать расположение локального каталога для совместного использования локальным сеансом R и удаленным компьютером  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и его учетными записями.

    ```R
    sqlShareDir <- paste("c:\\AllShare\\", Sys.getenv("USERNAME"), sep="")
    ```
    
4. Если вы хотите создать вручную в определенный каталог для общего доступа, можно добавить строку следующим образом. Чтобы определить, какие папки используются в настоящее время для совместного использования, выполните `rxGetComputeContext`, которая возвращает сведения о текущего контекста вычислений. Дополнительные сведения см. в [справочнике по ScaleR](https://msdn.microsoft.com/microsoft-r/scaler/packagehelp/rxinsqlserver).

    ```
    dir.create(sqlShareDir, recursive = TRUE)
    ```

4. Подготовлены все переменные, предоставить их в качестве аргументов в RxInSqlServer конструктор для создания *объект контекста вычислений*.

    ```R
    sqlCompute <- RxInSqlServer(  
         connectionString = sqlConnString,
         wait = sqlWait,
         consoleOutput = sqlConsoleOutput)
    ```
    
    Вы заметите, что синтаксис RxInSqlServer * идентичен формату RxSqlServerData функции, которые ранее использовались для определения источника данных. Однако есть несколько важных различий.
      
    - Объект источника данных, определенные с помощью функции RxSqlServerData, указывает, где хранятся данные.
    
    - Напротив контексте (определяется с помощью функции RxInSqlServer) указывает, агрегаты и других вычислений, в которых вступили в силу.
    
    Определение контекста вычислений не влияет на другие обычные вычисления R, которые могут выполняться на рабочей станции, и не изменяет источник данных. Например, можно определить в качестве источника данных локальный текстовый файл, но изменить контекст вычислений на SQL Server и выполнять все операции чтения и обобщения данных на компьютере SQL Server.

## <a name="enable-tracing-on-the-compute-context"></a>Включение трассировки в контексте вычислений

Иногда в операциях, которые работают в локальном контексте, могут возникать проблемы при работе в контексте удаленных вычислений. Если вы хотите анализировать проблемы или наблюдать за производительностью, можно включить трассировку в контексте вычислений для помощи при устранении неполадок во время выполнения.

1. Создает контекст вычислений, использует ту же строку подключения, но добавить аргументы *traceEnabled* и *traceLevel* для *RxInSqlServer* конструктор.

    ```R
    sqlComputeTrace <- RxInSqlServer(
        connectionString = sqlConnString,
        #shareDir = sqlShareDir,
        wait = sqlWait,
        consoleOutput = sqlConsoleOutput,
        traceEnabled = TRUE,
        traceLevel = 7)
    ```
  
    В этом примере свойству *traceLevel* присваивается значение 7, что означает "показывать все данные трассировки".

2. Чтобы изменить контекст вычислений, используйте функцию rxSetComputeContext и укажите контекст, по имени.

    ```R
    rxSetComputeContext( sqlComputeTrace)
    ```

    > [!NOTE]
    > 
    > В этом учебнике мы будем использовать контекст вычислений, в котором трассировка не включена. Это, так как производительность для параметра включена трассировка не были проверены для всех операций.
    > 
    > Тем не менее если вы решили использовать трассировку, следует помнить, что работы могут быть затронуты сетевое подключение.

Теперь, когда контекст удаленных вычислений создан, вы узнаете, как изменять контексты вычислений для запуска кода R на сервере или локально.

## <a name="next-step"></a>Следующий шаг

[Создание и выполнение сценариев R](../../advanced-analytics/tutorials/deepdive-create-and-run-r-scripts.md)


## <a name="previous-step"></a>Предыдущий шаг

[Запрашивать и изменять данных SQL Server](../../advanced-analytics/tutorials/deepdive-query-and-modify-the-sql-server-data.md)


