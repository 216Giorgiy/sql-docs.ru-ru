---
title: "Шаг 2. Импорт данных в SQL Server с помощью PowerShell | Документация Майкрософт"
ms.custom: 
ms.date: 05/25/2017
ms.prod: sql-server-vnext-ctp2
ms.reviewer: 
ms.suite: 
ms.technology:
- r-services
ms.tgt_pltfrm: 
ms.topic: article
applies_to:
- SQL Server 2017
dev_langs:
- Python
- TSQL
ms.assetid: 
caps.latest.revision: 2
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: 62a06d6c442428132f84b3f8e5a665e872a8d361
ms.contentlocale: ru-ru
ms.lasthandoff: 09/01/2017

---
# <a name="step-2-import-data-to-sql-server-using-powershell"></a>Шаг 2. Импорт данных в SQL Server с помощью PowerShell

В этом шаге вы выполните один из скриптов, чтобы создать объекты базы данных, необходимые для работы с этим пошаговым руководством. Скрипт также создает большинство хранимых процедур, которые вы будете использовать, и добавляет образец данных в указанную таблицу базы данных.

## <a name="create-sql-objects-and-data"></a>Создание объектов SQL и данных

Среди скачанных файлов имеется скрипт PowerShell. Чтобы подготовить среду к работе с пошаговым руководством, необходимо выполнить этот скрипт.  Скрипт выполняет следующие действия:

- Устанавливает собственный клиент SQL и служебные программы командной строки SQL, если еще не установлена. Эти программы необходимы для массовой загрузки данных в базу данных с помощью **bcp**.

- Создает базу данных и таблицу на [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляра и массовые вставки данных в таблицу.

- Создает несколько функций SQL и хранимых процедур.

### <a name="run-the-script"></a>Запустите сценарий

1. Откройте командную строку PowerShell с правами администратора и выполните приведенную ниже команду.
  
    ```  
    .\RunSQL_SQL_Walkthrough.ps1  
    ```  

    Появится запрос на ввод следующих сведений:
    - Имя или адрес [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] экземпляра, где установлено машинного обучения служб с Python
    - имя пользователя и пароль учетной записи в экземпляре; используемая учетная запись должна иметь разрешения на создание баз данных, таблиц и хранимых процедур, а также на добавление данных в таблицы; Если не указано имя пользователя и пароль для входа в SQL Server используется удостоверения Windows.
    - путь к скачанному файлу с образцом данных и его имя. Например `C:\tempRSQL\nyctaxi1pct.csv`

    > [!NOTE]
    > Убедитесь в том, ваш файл xmlrw.dll находится в той же папке вашего bcp.exe. В противном случае следует скопировать его.

2.  На этом этапе также необходимо изменить все скрипты [!INCLUDE[tsql](../../includes/tsql-md.md)] , заменив заполнители на соответствующие имена базы данных и пользователя.
  
3. Изучите хранимые процедуры и функции, созданные скриптом.
     
    |**Имя файла скрипта SQL**|**Функция**|
    |------|------|
    |create-db-tb-upload-data.sql|Создает базу данных и две таблицы:<br /><br />nyctaxi_sample: содержит основной набор данных по работе такси в Нью-Йорке. К таблице добавляется кластеризованный индекс columnstore для оптимизации хранения данных и производительности запросов. В таблицу будет вставлена выборка, содержащая 1 % от общего объема набора данных по работе такси в Нью-Йорке.<br /><br />nyc_taxi_models: используется для сохранения обученной модели расширенной аналитики.|
    |fnCalculateDistance.sql|Создает скалярную функцию, которая вычисляет прямое расстояние между местами посадки и высадки.|
    |fnEngineerFeatures.sql|Создает табличную функцию, которая формирует новые характеристики данных для обучения модели.|
    |TrainingTestingSplit.sql|Разделить данные в таблице nyctaxi_sample на две части: nyctaxi_sample_training и nyctaxi_sample_testing.|
    |PredictTipSciKitPy.sql|Создает хранимую процедуру, которая вызывает обученной модели (scikit-узнать) для создания прогнозов с помощью модели. Хранимая процедура принимает запрос в качестве входного параметра и возвращает столбец числовых значений, представляющих оценки для входных строк.|
    |PredictTipRxPy.sql|Создает хранимую процедуру, которая вызывает обученной модели (revoscalepy) для создания прогнозов с помощью модели. Хранимая процедура принимает запрос в качестве входного параметра и возвращает столбец числовых значений, представляющих оценки для входных строк.|
    |PredictTipSingleModeSciKitPy.sql|Создает хранимую процедуру, которая вызывает обученной модели (scikit-узнать) для создания прогнозов с помощью модели. Эта хранимая процедура принимает новое наблюдение в качестве входных данных, причем отдельные значения характеристик передаются как встроенные параметры, и возвращает значение, представляющее прогнозируемый результат для нового наблюдения.|
    |PredictTipSingleModeRxPy.sql|Создает хранимую процедуру, которая вызывает обученной модели (revoscalepy) для создания прогнозов с помощью модели. Эта хранимая процедура принимает новое наблюдение в качестве входных данных, причем отдельные значения характеристик передаются как встроенные параметры, и возвращает значение, представляющее прогнозируемый результат для нового наблюдения.|
  
4. В последней части этого пошагового руководства вы создадите ряд дополнительных хранимых процедур.
    
    |**Имя файла скрипта SQL**|**Компонент**|
    |------|------|
    |SerializePlots.sql|Создает хранимую процедуру для изучения данных. Эта хранимая процедура создает графический объект, с помощью Python и последующей сериализации графа объектов.|
    |TrainTipPredictionModelSciKitPy.sql|Создает хранимую процедуру, которая обучает модель логистической регрессии (scikit-узнать). Модель прогнозирует значение скошенные столбца и обучается с помощью случайно выбранных 60% данных. Выходными данными хранимой процедуры является обученная модель, которая сохраняется в таблице nyc_taxi_models.|
    |TrainTipPredictionModelRxPy.sql|Создает хранимую процедуру, которая обучает модель логистической регрессии (revoscalepy). Модель прогнозирует значение скошенные столбца и обучается с помощью случайно выбранных 60% данных. Выходными данными хранимой процедуры является обученная модель, которая сохраняется в таблице nyc_taxi_models.|
  
3. Войдите в экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] и указанного вами имени входа, чтобы убедиться в том, что в нем отображаются созданные база данных, таблицы, функции и хранимые процедуры.

    ![Обзор таблиц в среде SSMS](media/sqldev-python-browsetables1.png "просмотреть таблицы в среде SSMS")

    > [!NOTE]
    > Если объекты базы данных уже существуют, их нельзя создать еще раз. Если таблица уже существует, данные будут добавляться в нее, а не перезаписываться. Поэтому перед выполнением скрипта удалите все существующие объекты.
    > Следуйте инструкциям [здесь](https://docs.microsoft.com/en-us/sql/advanced-analytics/r/set-up-sql-server-r-services-in-database#bkmk_enableFeature) для включения служб внешнего сценария.
    


## <a name="next-step"></a>Следующий шаг

[Шаг 3. Анализ и визуализация данных](sqldev-py3-explore-and-visualize-the-data.md)

## <a name="previous-step"></a>Предыдущий шаг

[Шаг 1. Скачивание образца данных](sqldev-py1-download-the-sample-data.md)

## <a name="see-also"></a>См. также:

[Машинного обучения служб с Python](../python/sql-server-python-services.md)



