---
title: Шаг 2 Импорт данных в SQL Server с помощью PowerShell | Документация Майкрософт
ms.prod: sql
ms.technology: machine-learning
ms.date: 06/07/2018
ms.topic: tutorial
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: f8b90a18c0cdce9c4c2c73db4b599e488570f018
ms.sourcegitcommit: 3cd6068f3baf434a4a8074ba67223899e77a690b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2018
ms.locfileid: "49461870"
---
# <a name="step-2-import-data-to-sql-server-using-powershell"></a>Шаг 2: Импорт данных в SQL Server с помощью PowerShell
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Эта статья входит учебник по, [Python в базе данных аналитики для разработчиков SQL](sqldev-in-database-python-for-sql-developers.md). 

На этом шаге вы выполните одну из скриптов для создания объектов базы данных, необходимых для данного пошагового руководства. Скрипт также создает несколько хранимых процедур и добавляет образец данных в таблицу в указанной базе данных.

## <a name="create-database-objects-and-load-data"></a>Создание объектов базы данных и загрузка данных

Среди скачанных файлов вы должны увидеть сценарий PowerShell, `RunSQL_SQL_Walkthrough.ps1`. Этот сценарий предназначен для подготовки среды для данного пошагового руководства.

Скрипт выполняет следующие действия:

- Устанавливает SQL Native Client и служебные программы командной строки SQL, если еще не установлены. Эти программы необходимы для массовой загрузки данных в базу данных с помощью **bcp**.

- Создает базу данных и таблицу на [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляра и массовые вставки данных в таблицу.

- Создает несколько функций SQL и хранимых процедур.

Если возникли проблемы, можно использовать сценарий как ссылку для выполнения действий вручную.

### <a name="modify-the-script-to-use-a-trusted-windows-identity"></a>Изменить сценарий, чтобы использовать удостоверение Windows

По умолчанию в скрипте предполагается имя пользователя базы данных SQL Server и пароль. Если вы являетесь db_owner под учетной записью пользователя Windows, можно использовать свое удостоверение Windows для создания объектов. Чтобы сделать это, откройте `RunSQL_SQL_Walkthrough.ps1` в редакторе кода для добавления **`-T`** для bcp Массовая вставка команды:

```text
bcp $db_tb in $csvfilepath -t ',' -S $server -f taxiimportfmt.xml -F 2 -C "RAW" -b 200000 -U $u -P $p -T
```

### <a name="run-the-script"></a>Запустите сценарий

1. Откройте командную строку PowerShell от имени администратора. Если вы еще не в папке, созданной на предыдущем шаге, перейдите к папке и выполните следующую команду:
  
    ```ps
    .\RunSQL_SQL_Walkthrough.ps1
    ```

2. Сценарий запрашивает следующие сведения:

    - Имя или адрес [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] экземпляра, где установлено служб машинного обучения с помощью Python.
    - имя пользователя и пароль учетной записи в экземпляре; Учетная запись, которую вы используете должен иметь возможность создавать базы данных, создавать таблицы и хранимые процедуры и массовой загрузки данных в таблицы. 
    - Если вы не укажете имя пользователя и пароль, ваше удостоверение Windows используется для входа в SQL Server.
    - путь к скачанному файлу с образцом данных и его имя. Например `C:\temp\pysql\nyctaxi1pct.csv` 

    > [!NOTE]
    > Для успешной загрузки данных библиотеку xmlrw.dll должен быть в той же папке, что bcp.exe.

3. Скрипт также изменяет [!INCLUDE[tsql](../../includes/tsql-md.md)] сценарии вы загрузили ранее, что имя базы данных и пользователь заменяет заполнители именем, которое вы предоставляют.
  
4. После завершения сценария, войдите в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляра с помощью имени входа, заданного, чтобы убедиться, что базы данных, таблицы, функции и хранимые процедуры были созданы. На следующем рисунке показаны объекты в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].

    ![Обзор таблиц в среде SSMS](media/sqldev-python-browsetables1.png "просматривать таблицы в SSMS")

    > [!NOTE]
    > Если объекты базы данных уже существует, их нельзя создать снова.
    > 
    > Если обнаруживается существующую таблицу таким же именем, схемы, будут добавляться данные, не перезаписываются. Таким образом не забудьте удалить или усечь существующих таблиц перед выполнением скрипта.

## <a name="list-of-stored-procedures-and-functions"></a>Список хранимых процедур и функций

Следующие объекты SQL Server создаются с помощью сценария:

|**Имя файла скрипта SQL**|**Функция**|
|------|------|
|create-db-tb-upload-data.sql|Создает базу данных и две таблицы:<br /><br />nyctaxi_sample: содержит основной набор данных по работе такси в Нью-Йорке. К таблице добавляется кластеризованный индекс columnstore для оптимизации хранения данных и производительности запросов. В таблицу будет вставлена выборка, содержащая 1 % от общего объема набора данных по работе такси в Нью-Йорке.<br /><br />nyc_taxi_models: используется для сохранения обученной модели расширенной аналитики.|
|fnCalculateDistance.sql|Создает скалярную функцию, которая вычисляет прямое расстояние между местами посадки и высадки.|
|fnEngineerFeatures.sql|Создает табличную функцию, которая формирует новые характеристики данных для обучения модели.|
|TrainingTestingSplit.sql|Разделить на две части данных в таблицу nyctaxi_sample: nyctaxi_sample_training и nyctaxi_sample_testing.|
|PredictTipSciKitPy.sql|Создает хранимую процедуру, которая вызывает обученную модель (scikit-Узнайте) для создания прогнозов с помощью модели. Хранимая процедура принимает запрос в качестве входного параметра и возвращает столбец числовых значений, представляющих оценки для входных строк.|
|PredictTipRxPy.sql|Создает хранимую процедуру, которая вызывает обученную модель (revoscalepy) для создания прогнозов с помощью модели. Хранимая процедура принимает запрос в качестве входного параметра и возвращает столбец числовых значений, представляющих оценки для входных строк.|
|PredictTipSingleModeSciKitPy.sql|Создает хранимую процедуру, которая вызывает обученную модель (scikit-Узнайте) для создания прогнозов с помощью модели. Эта хранимая процедура принимает новое наблюдение в качестве входных данных, причем отдельные значения характеристик передаются как встроенные параметры, и возвращает значение, представляющее прогнозируемый результат для нового наблюдения.|
|PredictTipSingleModeRxPy.sql|Создает хранимую процедуру, которая вызывает обученную модель (revoscalepy) для создания прогнозов с помощью модели. Эта хранимая процедура принимает новое наблюдение в качестве входных данных, причем отдельные значения характеристик передаются как встроенные параметры, и возвращает значение, представляющее прогнозируемый результат для нового наблюдения.|

В последней части этого пошагового руководства вы создадите этими дополнительными хранимыми процедурами:
    
|**Имя файла скрипта SQL**|**Компонент**|
|------|------|
|SerializePlots.sql|Создает хранимую процедуру для изучения данных. Эта хранимая процедура создает график с помощью Python и последующей сериализации графа объектов.|
|TrainTipPredictionModelSciKitPy.sql|Создает хранимую процедуру, которая обучает модель логистической регрессии (scikit-Узнайте). Модель прогнозирует значение столбца tipped и обучена с использованием случайно выбранного 60% данных. Выходными данными хранимой процедуры является обученная модель, которая сохраняется в таблице nyc_taxi_models.|
|TrainTipPredictionModelRxPy.sql|Создает хранимую процедуру, которая обучает модель логистической регрессии (revoscalepy). Модель прогнозирует значение столбца tipped и обучена с использованием случайно выбранного 60% данных. Выходными данными хранимой процедуры является обученная модель, которая сохраняется в таблице nyc_taxi_models.|

## <a name="next-step"></a>Следующий шаг

[Шаг 3. Анализ и визуализация данных](sqldev-py3-explore-and-visualize-the-data.md)

## <a name="previous-step"></a>Предыдущий шаг

[Шаг 1. Скачивание образца данных](demo-data-nyctaxi-in-sql.md)

