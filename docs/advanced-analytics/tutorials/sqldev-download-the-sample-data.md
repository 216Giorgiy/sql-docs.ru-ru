---
title: Загрузите демонстрационные данные о такси Нью-ЙОРКА и сценарии для внедренных R и Python (машинного обучения SQL Server) | Документация Майкрософт
description: Инструкции по скачиванию демонстрационные данные о такси Нью-Йорке и создании базы данных. Данные используются в SQL Server учебников, показывающих, как внедрить R и Python в SQL Server хранимых процедур и функций T-SQL.
ms.prod: sql
ms.technology: machine-learning
ms.date: 08/22/2018
ms.topic: tutorial
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 58a996ae500a27a6878b30fc072bf09a75d4ba43
ms.sourcegitcommit: b7fd118a70a5da9bff25719a3d520ce993ea9def
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46712757"
---
# <a name="nyc-taxi-demo-data-for-sql-server"></a>Демонстрационные данные о такси Нью-ЙОРКА для SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье подготавливает систему для руководства по использованию R и Python для анализа в базе данных в SQL Server.

В этом упражнении вы сможете скачать образец данных, скрипт PowerShell для подготовки среды, и [!INCLUDE[tsql](../../includes/tsql-md.md)] файлы скриптов, используемые в нескольких учебных курсах. Когда вы закончите, **NYCTaxi_Sample** база данных доступна на локальном экземпляре, предоставляя демонстрационных данных пройти Практическое обучение. 

## <a name="prerequisites"></a>предварительные требования

Вам потребуется подключение к Интернету, PowerShell и правами локального администратора на компьютере. Вы должны иметь [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) или другое средство для проверки создания объекта.

## <a name="download-nyc-taxi-demo-data-and-scripts-from-github"></a>Скачайте демонстрационные данные о такси Нью-ЙОРКА и сценариев из Github

1.  Откройте командную консоль Windows PowerShell.
  
    Используйте **Запуск от имени администратора** параметр для создания каталога назначения или записи файлов в указанное место назначения.
  
2.  Выполните приведенные ниже команды PowerShell, изменив значение параметра *DestDir* на любой локальный каталог. Здесь использовано значение по умолчанию **TempRSQL**.
  
    ```ps
    $source = ‘https://raw.githubusercontent.com/Azure/Azure-MachineLearning-DataScience/master/Misc/RSQL/Download_Scripts_SQL_Walkthrough.ps1’  
    $ps1_dest = “$pwd\Download_Scripts_SQL_Walkthrough.ps1”
    $wc = New-Object System.Net.WebClient
    $wc.DownloadFile($source, $ps1_dest)
    .\Download_Scripts_SQL_Walkthrough.ps1 –DestDir ‘C:\tempRSQL’
    ```
  
    Если папка, указанная в параметре *DestDir* , не существует, она будет создана скриптом PowerShell.
  
    > [!TIP]
    > Если отобразится сообщение об ошибке, можно временно задать политику выполнения скриптов PowerShell **Неограниченный** только для этого пошагового руководства, используйте аргумент Bypass и ограничьте изменения текущим сеансом.
    >   
    >````
    > Set\-ExecutionPolicy Bypass \-Scope Process
    >````
    > Выполнение этой команды не приводит к изменению конфигурации.
  
    В зависимости от скорости подключения к Интернету скачивание может занять определенное время.
  
3.  После скачивания всех файлов скрипт PowerShell откроет *DestDir* папки. В командное строке PowerShell выполните приведенную ниже команду и просмотрите скачанные файлы.
  
    ```
    ls
    ```
  
    **Результаты:**
  
    ![Список файлов, скачанных скриптом PowerShell](media/rsql-devtut-filelist.png "Список файлов, скачанных скриптом PowerShell")

## <a name="create-nyctaxisample-database"></a>Создание базы данных NYCTaxi_Sample

Среди скачанных файлов, вы должны увидеть сценарий PowerShell (**RunSQL_SQL_Walkthrough.ps1**), создает базу данных и выполняет массовую загрузку данных. Он выполняет следующие действия:

+ Устанавливает SQL Native Client и служебные программы командной строки SQL, если еще не установлены. Эти программы необходимы для массовой загрузки данных в базу данных с помощью **bcp**.

+ Создание базы данных и таблиц на [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляр и массовую вставку данных из CSV-файл.

+ Создайте несколько функций SQL и хранимые процедуры, используемые в нескольких учебных курсах.

### <a name="modify-the-script-to-use-a-trusted-windows-identity"></a>Изменить сценарий, чтобы использовать удостоверение Windows

По умолчанию в скрипте предполагается имя пользователя базы данных SQL Server и пароль. Если вы являетесь db_owner под учетной записью пользователя Windows, можно использовать свое удостоверение Windows для создания объектов. Чтобы сделать это, откройте `RunSQL_SQL_Walkthrough.ps1` в редакторе кода и добавьте **`-T`** для bcp Массовая вставка команды (строка 238):

```text
bcp $db_tb in $csvfilepath -t ',' -S $server -f taxiimportfmt.xml -F 2 -C "RAW" -b 200000 -U $u -P $p -T
```

### <a name="run-the-script-to-create-objects"></a>Запустите сценарий для создания объектов

Используя командную строку PowerShell с правами администратора в C:\tempRSQL, выполните следующую команду.
  
```ps
.\RunSQL_SQL_Walkthrough.ps1
```
Вам будет предложено ввести следующие данные:

- Экземпляра сервера, на котором [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] установки. На экземпляре по умолчанию это может быть простым, как имя компьютера.

- Имя базы данных. В этом учебнике скрипты предполагают, что `NYCTaxi_Sample`.

- Имя пользователя и пароль пользователя. Введите имя входа базы данных SQL Server для этих значений. Кроме того Если вы изменили сценарий для принятия удостоверение Windows, нажмите клавишу ВВОД, чтобы эти значения не указывайте. Ваше удостоверение Windows, используемого для подключения.

- Полное имя файла для образца данных, загруженных на предыдущем занятии. Например: `C:\tempRSQL\nyctaxi1pct.csv`.

После того как вы укажете эти значения, немедленно выполняется сценарий. Во время выполнения скрипта, все имена заполнителей в [!INCLUDE[tsql](../../includes/tsql-md.md)] скриптов обновляются для использования вами входных данных.

## <a name="review-database-objects"></a>Ознакомьтесь с объектами базы данных
   
По завершении выполнения сценария убедитесь, объекты базы данных существуют в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] экземпляра с помощью [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Вы увидите базы данных, таблиц, функций и хранимых процедур.
  
   ![rsql_devtut_BrowseTables](media/rsql-devtut-browsetables.png "rsql_devtut_BrowseTables")

> [!NOTE]
> Если объекты базы данных уже существуют, их нельзя создать еще раз.
>   
> Если таблица уже существует, данные будут добавляться в нее, а не перезаписываться. Поэтому перед выполнением скрипта удалите все существующие объекты.

### <a name="objects-in-nyctaxisample-database"></a>Объекты в базе данных NYCTaxi_Sample

В следующей таблице перечислены объекты, созданные в демонстрационной базы данных о такси Нью-ЙОРКА. Несмотря на то, что вы только выполнить один скрипт PowerShell (`RunSQL_SQL_Walkthrough.ps1`), этот скрипт вызывает другие скрипты SQL, в свою очередь, для создания объектов в базе данных. Скрипты, используемые для создания каждого объекта указаны в описании.

|**Имя объекта**|**Тип объекта**|**Описание**|
|----------|------------------------|---------------|
|**NYCTaxi_Sample** | База данных |Созданный скрипт create-db ТБ Отправка data.sql. Создает базу данных и две таблицы:<br /><br />таблицу dbo.nyctaxi_sample: содержит основной набор данных о такси Нью-ЙОРКА. К таблице добавляется кластеризованный индекс columnstore для оптимизации хранения данных и производительности запросов. В примере 1% набора данных такси Нью-ЙОРКА вставляется в эту таблицу.<br /><br />таблица dbo.nyc_taxi_models: используется для сохранения обученной модели расширенной аналитики.|
|**fnCalculateDistance** |скалярная функция | Создаваемые сценарием fnCalculateDistance.sql. Вычисляет прямое расстояние между местами посадки и высадки. Эта функция используется в [Создание функций данных](sqldev-create-data-features-using-t-sql.md), [обучение и сохранение модели](../r/sqldev-train-and-save-a-model-using-t-sql.md) и [ввод в эксплуатацию моделей R](sqldev-operationalize-the-model.md).|
|**fnEngineerFeatures** |функция с табличным значением | Создаваемые сценарием fnEngineerFeatures.sql. Формирует новые характеристики данных для обучения модели. Эта функция используется в [Создание функций данных](sqldev-create-data-features-using-t-sql.md) и [ввод в эксплуатацию моделей R](sqldev-operationalize-the-model.md).|
|**PlotHistogram** |хранимая процедура | Создаваемые сценарием PlotHistogram.sql. Вызывает функцию R для построения гистограммы на переменную, а затем возвращает диаграмму в виде двоичного объекта. Эта хранимая процедура используется в [анализ и визуализация данных](sqldev-explore-and-visualize-the-data.md).|
|**PlotInOutputFiles** |хранимая процедура| Создаваемые сценарием PlotInOutputFiles.sql. Создает график с помощью функции R и затем сохраняет результат в виде локального файла PDF. Эта хранимая процедура используется в [анализ и визуализация данных](sqldev-explore-and-visualize-the-data.md).|
|**PersistModel** |хранимая процедура | Создаваемые сценарием PersistModel.sql. Принимает модель, сериализованную как тип данных varbinary и записывает ее в указанную таблицу. |
|**PredictTip**  |хранимая процедура |Создаваемые сценарием PredictTip.sql. Вызывает обученную модель для создания прогнозов с помощью модели. Хранимая процедура принимает запрос в качестве входного параметра и возвращает столбец числовых значений, представляющих оценки для входных строк. Эта хранимая процедура используется в [ввод в эксплуатацию моделей R](sqldev-operationalize-the-model.md).|
|**PredictTipSingleMode**  |хранимая процедура| Создаваемые сценарием PredictTipSingleMode.sql. Вызывает обученную модель для создания прогнозов с помощью модели. Эта хранимая процедура принимает новое наблюдение в качестве входных данных, причем отдельные значения характеристик передаются как встроенные параметры, и возвращает значение, представляющее прогнозируемый результат для нового наблюдения. Эта хранимая процедура используется в [ввод в эксплуатацию моделей R](sqldev-operationalize-the-model.md).|
|**TrainTipPredictionModel**  |хранимая процедура|Создаваемые сценарием TrainTipPredictionModel.sql. Обучает модель логистической регрессии, вызывая пакет r. Модель прогнозирует значение для столбца tipped и обучается на основе случайной выборки, содержащей 70 % данных. Выходными данными хранимой процедуры является обученная модель, которая сохраняется в таблице nyc_taxi_models. Эта хранимая процедура используется в [обучение и сохранение модели](../r/sqldev-train-and-save-a-model-using-t-sql.md).|

## <a name="query-data-for-verification"></a>Запрос данных для проверки подлинности

В качестве шага проверки выполните запрос, чтобы убедиться, что данные были отправлены.

1. В обозревателе объектов в базах данных, разверните **NYCTaxi_Sample** выполнить, а затем откройте папку «таблицы».

2. Щелкните правой кнопкой мыши **dbo.nyctaxi_sample** и выберите **выделить 1000 верхних строк** для возврата некоторые данные.

## <a name="next-steps"></a>Следующие шаги

Образец данных о такси Нью-ЙОРКА теперь доступна пройти Практическое обучение.

+ [Дополнительные аналитические функции в базе данных с помощью языка R в SQL Server](sqldev-in-database-r-for-sql-developers.md)