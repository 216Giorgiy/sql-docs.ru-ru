---
title: Распространенные проблемы со службой панели запуска и выполнения внешнего скрипта в SQL Server | Документы Microsoft
ms.prod: sql
ms.technology: machine-learning
ms.date: 05/31/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 08ab6e2db6d6cde5e41f7ddb88c8afd1da241df7
ms.sourcegitcommit: 2d93cd115f52bf3eff3069f28ea866232b4f9f9e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/01/2018
ms.locfileid: "34706842"
---
# <a name="common-issues-with-launchpad-service-and-external-script-execution-in-sql-server"></a>Распространенные проблемы со службой панели запуска и выполнения внешнего скрипта в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

 Служба запуска доверенные SQL Server поддерживает выполнении внешних скриптов R и Python. В SQL Server 2016 R Services SP1 предоставляет службу. Я панели запуска в процессе установки начальные включает в себя 2017 г. SQL Server.

Несколько проблемы могут препятствовать запуска с начала, включая проблемы конфигурации или изменения или отсутствуют сетевые протоколы. Эта статья содержит рекомендации по устранению неполадок много. Для любого не смогли присутствовать, вы можете опубликовать вопросы на [форум Server обучения машины](https://social.msdn.microsoft.com/Forums/home?category=MicrosoftR).

**Применяется к:** служб R SQL Server 2016, SQL Server 2017 г машинного обучения служб

## <a name="determine-whether-launchpad-is-running"></a>Определить, выполняется ли панель запуска

1. Откройте **служб** панель (Services.msc). Или из командной строки, введите **SQLServerManager13.msc** или **SQLServerManager14.msc** Открытие [диспетчер конфигурации SQL Server](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Зафиксируйте, панели запуска выполняется под учетной записи службы. Каждый экземпляр, активированной R или Python должен иметь собственный экземпляр службы панели запуска. Например, службы для именованного экземпляра может быть примерно _MSSQLLaunchpad$ InstanceName_.

3. Если служба остановлена, перезапустите его. Для перезапуска, если возникли проблемы с конфигурацией, публикации сообщения в журнале системных событий и служба остановлена еще раз. Проверьте журнал событий системы для получения сведений об причину остановки службы.

4. Просмотрите содержимое RSetup.log и убедитесь в отсутствии ошибок в программе установки. Например, сообщение *выход с кодом 0* указывает на сбой службы для запуска.

5. Чтобы найти другие ошибки, просмотрите содержимое rlauncher.log.

## <a name="check-the-launchpad-service-account"></a>Проверка учетной записи службы панели запуска

Учетная запись службы по умолчанию может быть «служба NT\$SQL2016» или «служба NT\$SQL2017». Последняя часть может отличаться в зависимости от вашего имени экземпляра SQL.

Служба панели запуска (Launchpad.exe) выполняется с помощью учетной записи службы с низким уровнем привилегий. Тем не менее чтобы запустить R и Python и взаимодействия с экземпляром базы данных, учетной записи службы запуска требуются следующие права пользователя:

- Вход в систему в качестве службы (SeServiceLogonRight)
- Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)
- Обход проходной проверки (SeChangeNotifyPrivilege)
- Настройка квот памяти для процесса (SeIncreaseQuotaSizePrivilege)

Сведения об этих прав пользователя см. в разделе «права и привилегии Windows» [обновления для Windows, Настройка учетных записей и разрешений](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

> [!TIP]
> Если вы знакомы с использованием средства поддержки диагностики платформы (SDP) для диагностики SQL Server, можно использовать для просмотра выходного файла с именем MachineName_UserRights.txt SDP.

## <a name="user-group-for-launchpad-cannot-log-on-locally"></a>Группы пользователей для запуска Запрет локального входа

Во время установки службы машинного обучения, SQL Server создает группу пользователей Windows **SQLRUserGroup** и затем он настраивает со всеми правами, необходимыми для запуска, чтобы подключиться к SQL Server и запустите задания внешних скриптов. При включении этой группы пользователей также используется для выполнения сценариев Python.

Тем не менее в организациях, где применяются более строгие политики безопасности, прав, необходимых для этой группы был вручную удален, или они могут быть автоматически отозваны политикой. Если права были удалены, панель запуска больше не может подключиться к SQL Server и SQL Server не удается вызвать внешней среды выполнения.

Чтобы устранить проблему, задайте для группы **SQLRUserGroup** разрешение **Локальный вход в систему**.

Дополнительные сведения см. в разделе [обновления для Windows, Настройка учетных записей и разрешений](https://msdn.microsoft.com/library/ms143504.aspx#Windows).

## <a name="permissions-to-run-external-scripts"></a>Разрешения на выполнение внешних скриптов

Даже если запуска настроена правильно, возвращает ошибку, если пользователь не имеет разрешения на выполнение сценариев R или Python.

Если вы являетесь владельцем базы данных SQL Server установлен как администратор базы данных, будут автоматически получает это разрешение. Тем не менее другие пользователи обычно более ограниченные разрешения. При попытке запустить сценарий R, получают сообщение об ошибке запуска.

Чтобы решить эту проблему, в SQL Server Management Studio администратор безопасности можно изменить имя входа SQL или учетная запись пользователя Windows, выполнив следующий сценарий:

```SQL
GRANT EXECUTE ANY EXTERNAL SCRIPT TO <username>
```

Дополнительные сведения см. в разделе [GRANT (Transact-SQL](../t-sql/statements/grant-transact-sql.md).

## <a name="common-launchpad-errors"></a>Распространенные ошибки запуска

В этом разделе перечислены распространенные сообщения об ошибках, возвращаемых панели запуска.

## <a name="unable-to-launch-runtime-for-r-script"></a>«Не удается запустить среду выполнения для R-сценария»

Если группа Windows для пользователей R (используется также для Python) не удается войти в экземпляр, на котором выполняется служб R, возможны следующие ошибки:

- Ошибки, созданные при попытке запуска сценариев R:

    * *Не удается запустить среду выполнения для скрипта R. Проверьте конфигурацию среды выполнения R*.

    * *Возникла ошибка во внешнем скрипте. Не удается запустить среду выполнения*.

- Ошибки, созданные [!INCLUDE[rsql_launchpad](../includes/rsql-launchpad-md.md)] службы:

    * *Не удалось инициализировать средство запуска RLauncher.dll*

    * *Библиотеки DLL средства запуска не зарегистрированы*

    * *Журналы безопасности указывают, что учетная запись NT SERVICE не удалось войти в систему*

Сведения о том, как предоставить необходимые разрешения для этой группы пользователей см. в разделе [установки служб SQL Server 2016 R](install/sql-r-services-windows-install.md).

> [!NOTE]
> Это ограничение не распространяется на тот случай, если вы используете имена входа SQL для выполнения скриптов R с удаленной рабочей станции.

## <a name="logon-failure-the-user-has-not-been-granted-the-requested-logon-type"></a>«Ошибка входа: пользователю не предоставлено режим входа»

По умолчанию [!INCLUDE[rsql_launchpad_md](../includes/rsql-launchpad-md.md)] использует следующую учетную запись во время запуска: `NT Service\MSSQLLaunchpad`. Учетная запись настроена по [!INCLUDE[ssNoVersion_md](../includes/ssnoversion-md.md)] установки необходимо предоставить все необходимые разрешения.

Если назначить другую учетную запись для запуска или удаляется с помощью политики на компьютере с SQL Server, учетной записи нет необходимых разрешений и может отображаться следующая ошибка:

>*ERROR_LOGON_TYPE_NOT_GRANTED 1385 (0x569) Вход в систему не произведен: выбранный режим входа для данного пользователя на этом компьютере не предусмотрен*

Чтобы предоставить необходимые разрешения для учетной записи службы, используется локальная политика безопасности приложения и обновите разрешения на учетную запись, включив следующие разрешения:

+ Назначение квот памяти процессам (SeIncreaseQuotaPrivilege)
+ Обход проходной проверки (SeChangeNotifyPrivilege)
+ Вход в систему в качестве службы (SeServiceLogonRight)
+ Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)

## <a name="unable-to-communicate-with-the-launchpad-service"></a>«Не удалось связаться со службой запуска»

Если вы установили и затем включен машинного обучения, но эту ошибку можно получить при попытке запустить сценарий R или Python, службы панели запуска для экземпляра может остановки выполнения.

1. Запустите диспетчер конфигурации SQL Server из командной строки Windows. Дополнительные сведения см. в разделе [SQL Server Configuration Manager](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Щелкните правой кнопкой мыши панель запуска SQL Server для экземпляра, а затем выберите **свойства**.

3. Выберите **службы** вкладку, а затем убедитесь, что служба запущена. Если она не запущена, измените **режим запуска** для **автоматического**и выберите **применить**.

4. Перезапуск службы обычно решает проблему, для запуска сценариев обучения машины. Если перезапуск не устранит проблему, запишите путь и аргументов в **путь к двоичным файлам** свойство и выполнить следующие:

    A. Просмотрите файл .config средство запуска и проверьте правильность рабочего каталога.

    Б. Убедитесь, что группу Windows, которая используется для запуска можно подключиться к экземпляру SQL Server, как описано в [предыдущего раздела](#bkmk_LaunchpadTS).

    в. Если изменить свойства службы, перезапустите службу запуска.

## <a name="fatal-error-creation-of-tmpfile-failed"></a>«Не удалось создать Неустранимая ошибка tmpFile»

В этом случае функции обучения машины успешно установлены и панели запуска выполняется. При попытке запуска простого кода R или Python, но запуска завершается с ошибкой, следующим образом: 

>*Не удалось соединиться со средой выполнения для R-сценария. Проверьте требования среды выполнения R.*

В то же время выполнения внешнего сценария записывает сообщение как часть сообщения STDERR: 

>*Неустранимая ошибка: создание tmpfile сбой.*

Эта ошибка означает, что учетная запись, пытается использовать панель запуска не имеет разрешения на вход в базу данных. Эта ситуация может произойти при реализации политики безопасности. Чтобы определить, является ли это так, проверьте журналы SQL Server, а для просмотра, запрещен ли MSSQLSERVER01 учетной записи при входе в систему. Те же сведения предоставляются в журналы, характерные для R\_СЛУЖБ или PYTHON\_СЛУЖБ. Найдите ExtLaunchError.log.

По умолчанию настраиваются и связанные с процессом Launchpad.exe, с именами MSSQLSERVER01 через MSSQLSERVER20 20 учетных записей. При внесении активно использовать R или Python можно увеличить количество учетных записей.

Чтобы устранить проблему, убедитесь, что группа имеет *локальный вход в систему* разрешения на локальном экземпляре, где установлены и включены функции обучения компьютера. В некоторых средах этот уровень разрешений может потребоваться исключение в объект групповой Политики администратора сети.

## <a name="not-enough-quota-to-process-this-command"></a>«Недостаточно квот для обработки команды»

Эта ошибка может означать одной из следующих причин:

- Панель запуска могут иметь недостаточно внешних пользователей для запуска внешнего запроса. Например если имеется только 20 пользователей по умолчанию более 20 внешних запросов выполняются одновременно, один или несколько запросов может завершиться ошибкой.

- Недостаточно памяти для выполнения задачи «R». Эта ошибка возникает чаще всего в среде по умолчанию, в котором SQL Server может использоваться до 70 процентов ресурсов компьютера. Сведения о том, как изменить конфигурацию сервера для поддержки более использование ресурсов с помощью R см. в разделе [ввод в эксплуатацию кода R](r/operationalizing-your-r-code.md).

## <a name="cant-find-package"></a>«Не удается найти пакет»

Если запустить код R в SQL Server и появляется сообщение, но не получили сообщение при выполнении один и тот же код вне SQL Server, это означает, что пакет не был установлен в папке библиотеки по умолчанию, используемый сервером SQL Server.

Эта ошибка может произойти несколькими способами:

- Новый пакет установлен на сервере, но было отказано в доступе, поэтому R установлен пакета в библиотеку пользователя.

- Вы установленные службы R и затем установить другое средство R или набор библиотек, в том числе Microsoft R Server (изолированный), клиент Microsoft R, RStudio и т.д.

Для определения расположения, используемые экземпляром библиотеки пакета R, откройте SQL Server Management Studio (или любом другом средстве запросов базы данных), подключитесь к экземпляру и выполните следующую хранимую процедуру:

```SQL
EXEC sp_execute_external_script @language = N'R',  
@script = N' print(normalizePath(R.home())); print(.libPaths());'; 
```

#### <a name="sample-results"></a>Образец результатов

*Сообщения STDOUT из внешнего скрипта:*

*[1]» C:\\программные файлы\\Microsoft SQL Server\\MSSQL13. SQL2016\\R_SERVICES»*

*[1]» C:/Program файлы или Microsoft SQL Server/MSSQL13. SQL2016/R_SERVICES/библиотека»*

Чтобы устранить проблему, необходимо переустановить пакет библиотеку экземпляра SQL Server.

>[!NOTE]
>При обновлении экземпляра SQL Server 2016, чтобы использовать последнюю версию Microsoft R расположение библиотеки по умолчанию отличается. Дополнительные сведения см. в разделе [SqlBindR используется, чтобы обновить экземпляр служб R](r/use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

## <a name="launchpad-shuts-down-due-to-mismatched-dlls"></a>Панель запуска завершает работу из-за несоответствия библиотек DLL

Если установить компонент database engine с другими компонентами, исправление для сервера и затем добавить функцию машинного обучения с помощью исходного носителя, неправильная версия компонентов машинного обучения может быть установлено. После запуска обнаруживается несоответствие версии, она завершает работу и создает файл дампа.

Чтобы избежать этой проблемы, не забудьте установить любые новые функции на том же уровне исправления как экземпляр сервера.

**Неправильный способ обновления:**

1. Установка SQL Server 2016 без R Services.
2. Обновление SQL Server 2016 накопительный пакет обновления 2.
3. Установка служб R (в базе данных) с помощью RTM-версии.

**Правильный способ обновления:**

1. Установка SQL Server 2016 без R Services.
2. Обновление SQL Server 2016 до уровня нужное исправление. Например установите пакет обновления 1, а затем накопительный пакет обновления 2.
3. Добавление функции уровень правильные обновления, снова запустите программу установки (SP1) и накопительным обновлением 2 и выберите R Services (в базе данных). 

## <a name="launchpad-fails-to-start-if-8dot3-notation-is-required"></a>Панель запуска не запускается, если имена в формате 8.3 notation не требуется

> [!NOTE] 
> В старых системах запуска не удается запускается, если потребность в нотации имена в формате 8.3. Это требование было удалено в последующих выпусках. SQL Server 2016 R Services пользователи должны установить одно из следующих:
> * С пакетом обновления 1 для SQL Server 2016 и CU1: [накопительный пакет обновления 1 для SQL Server](https://support.microsoft.com/help/3208177/cumulative-update-1-for-sql-server-2016-sp1).
> * SQL Server 2016 RTM, накопительное обновление 3 и это [исправление](https://support.microsoft.com/help/3210110/on-demand-hotfix-update-package-for-sql-server-2016-cu3), которая доступна по запросу.

Для обеспечения совместимости с R SQL Server 2016 R Services (в базе данных) требуется диск, где установлен компонент для поддержки создания короткие имена файлов с помощью *имена в формате 8.3 нотации*. Также называется именем файла в формате 8.3 *коротким именем файла*, и он используется для совместимости с предыдущими версиями Microsoft Windows или в качестве альтернативы длинные имена файлов.

Если тома, на котором вы устанавливаете R не поддерживает короткие имена файлов, процессы, запускающие R в SQL Server не сможет найти правильный исполняемый файл, и запуска не запустится.

Чтобы избежать этого можно включить нотации имена в формате 8.3 на томе установленным SQL Server и установленным R Services. Затем необходимо указать короткое имя для рабочего каталога в файле конфигурации служб R.

1. Чтобы включить имена в формате 8.3 нотации, запустите служебную программу fsutil с *8dot3name* аргумент, как описано здесь: [fsutil 8dot3name](https://technet.microsoft.com/library/ff621566(v=ws.11).aspx).

2. После включения нотации имена в формате 8.3, откройте файл RLauncher.config и обратите внимание, свойство `WORKING_DIRECTORY`. Сведения о том, как найти этот файл в разделе [сбора данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md).

3. Используйте служебную программу fsutil с *файл* аргумент, чтобы указать путь к папке, указанной в WORKING_DIRECTORY короткий файлу.

4. Измените файл конфигурации для указания, указанной в свойстве WORKING_DIRECTORY тот же рабочий каталог. Кроме того можно указать другой рабочий каталог и выберите существующий путь, совместимые с форматом имена в формате 8.3.


## <a name="next-steps"></a>Следующие шаги

[Устранение неполадок службы обучения машины и известные проблемы](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок соединения с ядром СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
