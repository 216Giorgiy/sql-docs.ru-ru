---
Title: 'Tutorial: Script Objects in SQL Server Management Studio'
description: Учебник по созданию скриптов для объектов в SSMS.
keywords: SQL Server, SSMS, SQL Server Management Studio, скрипты, написание скриптов
author: MashaMSFT
ms.author: mathoma
ms.date: 03/13/2018
ms.topic: Tutorial
ms.suite: sql
ms.prod_service: sql-tools
ms.reviewer: sstein
manager: craigg
helpviewer_keywords:
- projects [SQL Server Management Studio], tutorials
- source controls [SQL Server Management Studio], tutorials
- Help [SQL Server], SQL Server Management Studio
- tutorials [SQL Server Management Studio]
- Transact-SQL tutorials
- solutions [SQL Server Management Studio], tutorials
- SQL Server Management Studio [SQL Server], tutorials
- scripts [SQL Server], SQL Server Management Studio
ms.openlocfilehash: a931ddb3cf3229970de4b301e18002484acbaf53
ms.sourcegitcommit: 7a6df3fd5bea9282ecdeffa94d13ea1da6def80a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="tutorial-script-objects-in-sql-server-management-studio"></a>Учебник: создание скриптов для объектов в среде SQL Server Management Studio
В этом учебнике вы научитесь создавать скрипты Transact-SQL (T-SQL) для различных объектов, доступных в SQL Server Management Studio.  В нем приводятся примеры создания скриптов для следующих объектов: 

> [!div class="checklist"]
> * запросов при выполнении действий в графическом пользовательском интерфейсе;
> * баз данных двумя разными способами ("Сформировать скрипт как" и "Создать скрипт");
> * Таблицы
> * Хранимые процедуры
> * Расширенные события

Краткое изложение учебника: создать скрипт для любого объекта в **обозревателе объектов** можно, щелкнув его правой кнопкой мыши и выбрав пункт **Создать скрипт для объекта как**. 


## <a name="prerequisites"></a>предварительные требования
Для работы с этим учебником требуется среда SQL Server Management Studio, доступ к SQL Server и база данных AdventureWorks. 

- Установите [SQL Server Management Studio](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms).
- Установите выпуск [SQL Server 2017 Developer Edition](https://www.microsoft.com/en-us/sql-server/sql-server-downloads).
- Скачайте [примеры баз данных AdventureWorks2016](https://github.com/Microsoft/sql-server-samples/releases). Инструкции по восстановлению баз данных в SSMS можно найти в статье [Восстановление базы данных](https://docs.microsoft.com/en-us/sql/relational-databases/backup-restore/restore-a-database-backup-using-ssms). 


## <a name="script-queries-from-gui"></a>Создание скриптов для запросов в графическом пользовательском интерфейсе
Каждый раз при выполнении задачи с помощью графического пользовательского интерфейса в SSMS можно также создать код T-SQL, связанный с этой задачей. Ниже приведены примеры выполнения этого действия при создании резервной копии базы данных и сжатии журнала транзакций.  Аналогичные инструкции применимы к любому действию, выполняемому в графическом пользовательском интерфейсе. 

### <a name="script-t-sql-when-backing-up-a-database"></a>Создание скрипта T-SQL при резервном копировании базы данных
1. Подключитесь к серверу SQL Server.
2. Разверните узел **Базы данных** .
3. Щелкните правой кнопкой мыши базу данных **Adventureworks2016** и последовательно выберите пункты **Задачи** > **Архивация**:

    ![Резервное копирование базы данных](media/scripting-ssms/backupdb.png)

4. Настройте резервное копирование требуемым образом. В этом учебнике оставлены все параметры по умолчанию. Все изменения, внесенные в этом окне, также отражаются в скрипте. 
5. Выберите команду **Скрипт** > **Создать скрипт действия в новом окне запроса**.
 
    ![Скрипт для резервного копирования базы данных](media/scripting-ssms/scriptdbbackup.PNG)
6. Просмотрите код T-SQL в окне запроса: 

    ![Скрипт для резервного копирования базы данных](media/scripting-ssms/dbbackupscript.PNG)
7. Выберите команду **Выполнить**, чтобы выполнить запрос на архивацию базы данных с помощью T-SQL. 


### <a name="script-t-sql-when-shrinking-the-transaction-log"></a>Создание скрипта T-SQL при сжатии журнала транзакций
1. Щелкните правой кнопкой мыши базу данных **AdventureWorks2016** и последовательно выберите пункты **Задачи** > **Сжать** > **Файлы**:

     ![Сжатие файлов](media/scripting-ssms/shrinkfiles.png)

2. В раскрывающемся списке **Тип файла** выберите **Журнал**.

    ![Сжатие журнала транзакций](media/scripting-ssms/shrinktlog.png)

3. Выберите параметр **Скрипт** и команду **Добавить скрипт действия в буфер обмена**:

    ![Вывести скрипт в буфер обмена](media/scripting-ssms/scriptactiontoclipboard.png)

4. Откройте окно **Новый запрос** и вставьте текст (щелкните в окне правой кнопкой мыши и выберите команду **Вставить**):

    ![Вставка скрипта](media/scripting-ssms/paste.png)
5. Выберите команду **Выполнить**, чтобы выполнить запрос и сжать журнал транзакций. 


## <a name="script-databases"></a>Создание скриптов для баз данных
В следующем разделе показано, как создать скрипт для базы данных с помощью команды **Сформировать скрипт как** или **Сформировать скрипты**.  Команда **Сформировать скрипт как** повторно создает базу данных и параметры конфигурации для нее. Команда **Создать скрипты** позволит создать скрипт для схемы и данных. В этом разделе вы создадите две новых базы данных. *AdventureWorks2016a* будет создана с помощью команды **Создать скрипт как**. *AdventureWorks2016b* будет создана с помощью команды **Создать скрипты**. 


### <a name="script-database-using-script-option"></a>Создание скрипта для базы данных с помощью команды формирования скрипта
1. Подключитесь к серверу SQL Server.
2. Разверните узел **Базы данных** .
3. Щелкните правой кнопкой мыши базу данных **AdventureWorks2016** и последовательно выберите пункты **Создать скрипт базы данных как** > **Создать в** > **Новое окно запроса**:

    ![Создание скрипта для базы данных](media/scripting-ssms/scriptdb.png)

4. Просмотрите запрос на создание базы данных в окне: 

    ![Скрипт для базы данных](media/scripting-ssms/scriptedoutdb.png)
    - Эта команда включает в скрипт только параметры конфигурации базы данных.
5. Нажмите клавиши **CTRL+F**, чтобы открыть диалоговое окно **Найти**, и щелкните стрелку вниз, чтобы открыть параметр **Заменить**. Вверху, в строке **Найти**, введите *AdventureWorks2016*, а внизу, в строке **Заменить**, введите *AdventureWorks2016a*. 
6. Выберите **Заменить все**, чтобы заменить все значения *AdventureWorks2016* на *AdventureWorks2016a*. 

    ![Найти и заменить](media/scripting-ssms/findandreplace.png)

1. Выберите команду **Выполнить**, чтобы выполнить запрос и создать базу данных *AdventureWorks2016a*. 

### <a name="script-database-using-generate-scripts-option"></a>Создание скрипта для базы данных с помощью команды "Сформировать скрипты"
1. Подключитесь к серверу SQL Server.
2. Разверните узел **Базы данных** .
3. Щелкните правой кнопкой мыши базу данных **AdventureWorks2016** и последовательно выберите пункты **Задачи** > **Создать скрипты**:

    ![Создание скриптов для базы данных](media/scripting-ssms/generatescriptsfordb.png)

4. Откроется страница **Введение**. Нажмите кнопку **Далее**, чтобы открыть страницу **Выбор объектов**. Вы можете выбрать отдельные объекты или всю базу данных. Выберите команду **Внести в скрипт базу данных вместе со всеми объектами** 
 
    ![Создание скриптов для объектов](media/scripting-ssms/scriptobjects.png)
 
5. Нажмите кнопку **Далее**, чтобы открыть страницу **Задание параметров скриптов**. Здесь вы можете указать место сохранения скрипта и некоторые дополнительные параметры. 

    A. Выберите параметр **Сохранить в новом окне запроса**. 

    Б. Выберите пункт **Дополнительно** и убедитесь, что заданы следующие значения параметров: 

      - параметр **Статистика скриптов** имеет значение *Статистика скриптов*;
      - параметр **Типы данных для создания скриптов** имеет значение *Только схема*;
      - параметр **Индексы скриптов** имеет значение *True*.

   ![Объекты скриптов](media/scripting-ssms/advancedscripts.png)

   > [!NOTE]
   > Вы можете создать скрипт данных для базы данных при выборе варианта *Схема и данные* для параметра **Типы данных для создания скриптов**. Однако это решение не подойдет для крупных баз данных, так как оно может потребовать большего объема памяти, чем SSMS сможет выделить. Решение подойдет для маленьких баз данных, но если вы хотите переместить данные в более крупную базу данных, следует использовать [Мастер импорта и экспорта](https://docs.microsoft.com/en-us/sql/integration-services/import-export-data/import-and-export-data-with-the-sql-server-import-and-export-wizard).



1. Нажмите кнопку **ОК** и выберите пункт **Далее**. 
2. Нажмите кнопку **Далее** в окне **Сводка** и снова выберите **Далее**, чтобы создать скрипт в окне **Новый запрос**.  
3. Нажмите клавиши **CTRL+F**, чтобы открыть диалоговое окно **Найти**, и щелкните стрелку вниз, чтобы открыть параметр **Заменить**. Вверху, в строке **Найти**, введите *AdventureWorks2016*, а внизу, в строке **Заменить**, введите *AdventureWorks2016b*. 
    A. Выберите **Заменить все**, чтобы заменить все значения *AdventureWorks2016* на *AdventureWorks2016b*. 

    ![AdventureWorks2016b](media/scripting-ssms/adventureworks2016b.png)
7. Выберите команду **Выполнить**, чтобы выполнить запрос и создать базу данных *AdventureWorks2016b*. 
 
## <a name="script-tables"></a>Создание скриптов для таблиц
В этом разделе описывается, как создать скрипты для таблиц базы данных. С помощью этого параметра вы можете создать таблицу или удалить ее, а затем создать. Он также позволяет создать скрипт T-SQL, связанный с изменением таблицы: вставкой или обновлением. В этом разделе вы сможете удалить таблицу, а затем создать ее. 

1. Подключитесь к серверу SQL Server.
2. Разверните узел **Базы данных**.
3. Разверните узел базы данных **AdventureWorks**. 
4. Разверните узел **Таблицы**.
5. Щелкните правой кнопкой мыши **dbo.ErrorLog** >  **Создать скрипт таблицы как** > **Удалить и создать в** > **Новое окно редактора запросов**:
    
    ![Таблица скрипта](media/scripting-ssms/scripttable.png)

6. Выберите команду **Выполнить**, чтобы выполнить запрос. Таблица *Errorlog* будет удалена и создана повторно. 

    >[!NOTE]
    > Таблица *Errorlog* в базе данных AdventureWorks2016 по умолчанию пуста, поэтому вы не потеряете никаких данных, удалив ее. Однако если в таблице есть данные, при выполнении этих действий они будут потеряны. 
 
## <a name="script-stored-procedures"></a>Создание скриптов для хранимых процедур
В этом разделе вы узнаете, как удалить и создать хранимую процедуру.  

1. Подключитесь к серверу SQL Server.
2. Разверните узел **Базы данных**.
3. Разверните узел **Программируемость**. 
4. Разверните узел **Хранимые процедуры**.
5. Щелкните правой кнопкой мыши хранимую процедуру **dbo.uspGetBillOfMaterials**> **Создать скрипт хранимой процедуры как** > **Удалить и создать в** > **Новое окно запросов**:
    
    ![Создание скриптов для хранимых процедур](media/scripting-ssms/scriptstoredprocedure.PNG)

## <a name="script-extended-events"></a>Создание скриптов для расширенных событий
В этом разделе описывается, как создать скрипты для [расширенных событий](https://docs.microsoft.com/en-us/sql/relational-databases/extended-events/extended-events). 

1. Подключитесь к серверу SQL Server.
2. Разверните узел **Управление**.
3. Разверните узел **Расширенные события**.
4. Разверните узел **Сеансы**.
5. Щелкните правой кнопкой мыши нужный расширенный сеанс и выберите пункты **Создать скрипт для сеанса** > **Новое окно редактора запросов**:

    ![Создание скриптов для расширенных событий](media/scripting-ssms/scriptxevents.png) 
6. В **новом окне запросов** измените имя сеанса с *system_health* на *system_health2* и выберите команду **Выполнить**, чтобы выполнить запрос. 

    A. Щелкните правой кнопкой мыши **Сеансы** в **обозревателе объектов** и нажмите кнопку **Обновить**, чтобы увидеть новый сеанс расширенного события. Зеленый значок рядом с сеансом означает, что сеанс запущен, а красный — что он остановлен. 

    ![Новое событие xEvent](media/scripting-ssms/newxevent.png)

    >[!NOTE]
    > Вы можете запустить сеанс, щелкнув его правой кнопкой мыши и выбрав команду **Запустить**. Поскольку это копия уже запущенного сеанса *system_health*, этот шаг можно пропустить. Вы можете удалить копию расширенного сеанса события, щелкнув его правой кнопкой мыши и выбрав команду **Удалить**. 

## <a name="next-steps"></a>Следующие шаги
В следующей статье описываются готовые шаблоны T-SQL, находящиеся в SSMS. 

Дополнительные сведения см. в следующей статье:
> [!div class="nextstepaction"]
> [Дальнейшие действия](templates-ssms.md)


