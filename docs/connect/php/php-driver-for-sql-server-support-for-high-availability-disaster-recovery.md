---
title: "В драйвере PHP для SQL Server высокой доступности и аварийного восстановления | Документы Microsoft"
ms.custom: 
ms.date: 01/19/2017
ms.prod: sql-non-specified
ms.prod_service: drivers
ms.service: 
ms.component: php
ms.reviewer: 
ms.suite: sql
ms.technology:
- drivers
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 73a80821-d345-4fea-b076-f4aabeb4af3e
caps.latest.revision: 15
author: MightyPen
ms.author: genemi
manager: jhubbard
ms.workload: Inactive
ms.translationtype: MT
ms.sourcegitcommit: f7e6274d77a9cdd4de6cbcaef559ca99f77b3608
ms.openlocfilehash: 24b65a4c4572638cff243bcf46e49a30453f0550
ms.contentlocale: ru-ru
ms.lasthandoff: 09/09/2017

---
# <a name="php-driver-for-sql-server-support-for-high-availability-disaster-recovery"></a>PHP Driver for SQL Server Support for High Availability, Disaster Recovery (Поддержка драйвера PHP для SQL Server для функций высокого уровня доступности и аварийного восстановления)
[!INCLUDE[Driver_PHP_Download](../../includes/driver_php_download.md)]

В этом разделе обсуждаются [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] (добавлена поддержка в версии 3.0) для высокого уровня доступности и аварийного восстановления — [!INCLUDE[ssHADR](../../includes/sshadr_md.md)].  Поддержка [!INCLUDE[ssHADR](../../includes/sshadr_md.md)] была добавлена в [!INCLUDE[ssSQL11](../../includes/sssql11_md.md)]. Дополнительные сведения о среде [!INCLUDE[ssHADR](../../includes/sshadr_md.md)]см. в электронной документации по [!INCLUDE[ssNoVersion](../../includes/ssnoversion_md.md)] .  
  
В версии 3.0 [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)], можно указать прослушиватель группы доступности (высокого уровня доступности, аварийного восстановления) группы доступности (AG) в свойстве соединения. Если [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] подключено приложение базы данных AlwaysOn, которая выполняет отработку отказа, первоначальное соединение разрывается и приложение должно установить новое соединение для продолжения работы после отработки отказа.  
  
Если вы не подключаетесь к прослушивателю группы доступности и несколько IP-адресов связаны с именем узла, [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] будет поочередно для всех IP-адресов, ассоциированных с записью DNS. Это может занять много времени, если первый IP-адрес, возвращенный DNS-сервером, не привязан ни к одной из сетевых интерфейсных плат. При подключении к прослушивателю группы доступности [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] пытается установить соединение для всех IP-адресов в параллельном режиме, и если попытка подключения завершается успешно, то драйвер отменяет все ожидающие попытки подключения.  
  
> [!NOTE]  
> Увеличение времени ожидания соединения и реализация логики повторного соединения позволяют повысить вероятность соединения приложения с группой доступности. Кроме того, в связи с возможностью неудачного подключения при отработке отказа группы доступности следует реализовать логику повторного соединения, обеспечивающую неограниченное число попыток соединения до достижения успеха.  
  
## <a name="connecting-with-multisubnetfailover"></a>Соединение с помощью MultiSubnetFailover  
**MultiSubnetFailover** свойство соединения указывает, что приложение развертывается в группе доступности или экземпляра отказоустойчивого кластера и что [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] попытается соединиться с базой данных на сервере-источнике [!INCLUDE[ssNoVersion](../../includes/ssnoversion_md.md)] экземпляра, пытаясь подключиться ко всем IP-адресов. Когда **MultiSubnetFailover = true** указан для соединения, клиент повторяет попытку соединения по TCP быстрее, чем интервалов повторной передачи TCP операционной системы по умолчанию. Это позволяет ускорить восстановление соединения после отработки отказа в группе доступности AlwaysOn или в экземпляре отказоустойчивого кластера AlwaysOn; метод может применяться к группам доступности и экземплярам отказоустойчивых кластеров как с одной, так и с несколькими подсетями.  
  
Всегда указывайте **MultiSubnetFailover = True** при подключении к прослушивателю группы доступности SQL Server 2012 или экземпляра отказоустойчивого кластера SQL Server 2012. **MultiSubnetFailover** дает возможность группам доступности и экземпляру отказоустойчивого кластера в SQL Server 2012 быстрее выполнить отработку отказа, а также значительно сократить время перехода на другой ресурс для топологий AlwaysOn с одной или несколькими подсетями. При отработке отказа с в нескольких подсетях клиент будет выполнять попытки соединения параллельно. Во время отработки отказа в подсети [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] будет агрессивно повторять попытки соединения по протоколу TCP.  
  
Дополнительные сведения о ключевых словах строки подключения в [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)], в разделе [параметры соединения](../../connect/php/connection-options.md).  
  
Указание **MultiSubnetFailover = true** при соединении с объектом, кроме прослушивателя группы доступности или экземпляра отказоустойчивого кластера может привести к отрицательно влияет на производительность и не поддерживается.  
  
Следуйте приведенным ниже рекомендациям для соединения с сервером в группе доступности.  
  
-   Пользуйтесь свойством соединения **MultiSubnetFailover** при установлении соединения с одной или несколькими подсетями, это благоприятно скажется на производительности в любом случае.  
  
-   Чтобы установить соединение с группой доступности, указывайте ее прослушиватель в строке подключения вместо сервера.  
  
-   При установлении соединения с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion_md.md)], настроенным на работу с более чем 64 IP-адресами, будет возникать ошибка соединения.  
  
-   Режим работы приложения, использующего свойство соединения **MultiSubnetFailover**, не зависит от типа проверки подлинности — [!INCLUDE[ssNoVersion](../../includes/ssnoversion_md.md)], Kerberos или Windows.  
  
-   Увеличьте значение **loginTimeout** чтобы обеспечить отработку отказов и сократить число повторных попыток подключения приложения.  
  
-   Распределенные транзакции не поддерживаются.  
  
Если маршрутизация только для чтения неактивна, то подключение к местоположению вторичной реплики в группе доступности завершится ошибкой в следующих случаях:  
  
1.  Если местоположение вторичных реплик не настроено для приема подключений.  
  
2.  Если приложение использует **ApplicationIntent=ReadWrite** (описано ниже) и расположение вторичных реплик настроено для доступа только для чтения.  
  
При соединении произойдет ошибка, если первичная реплика настроена для отклонения рабочих нагрузок только для чтения, а строка подключения содержит **ApplicationIntent=ReadOnly**.  
  
## <a name="upgrading-to-use-multi-subnet-clusters-from-database-mirroring"></a>Переход с зеркального отображения базы данных на использование кластеров с несколькими подсетями  
Если в строке подключения содержатся ключевые слова **MultiSubnetFailover** и **Failover_Partner**, то при соединении произойдет ошибка. Ошибка возникает также в том случае, если используется **MultiSubnetFailover** и [!INCLUDE[ssNoVersion](../../includes/ssnoversion_md.md)] возвращает ответ партнера по обеспечению отработки отказа, указывающий на то, что он является частью пары зеркальных баз данных.  
  
При обновлении [!INCLUDE[ssDriverPHP](../../includes/ssdriverphp_md.md)] приложения, которое в настоящее время использует зеркальное отображение базы данных в сценарии с несколькими подсетями, необходимо удалить **Failover_Partner** свойства соединения и замените ее на **MultiSubnetFailover**  значение **Да** и заменить имя сервера в строке соединения с прослушивателем группы доступности. Если в строке подключения используются **Failover_Partner** и **MultiSubnetFailover = true**, то драйвер выдаст ошибку. Тем не менее если в строке подключения используются **Failover_Partner** и **MultiSubnetFailover = false** (или **ApplicationIntent = ReadWrite**), приложение будет использовать базу данных зеркальное отображение.  
  
Драйвер возвращает ошибку, если базы данных-источника в группе Доступности используется зеркальное отображение базы данных и **MultiSubnetFailover = true** используется в строке подключения, которая подключается к основной базе данных вместо к группе доступности прослушиватель.  
  
## <a name="specifying-application-intent"></a>Задание намерения приложения  
При указании **ApplicationIntent=ReadOnly** клиент запрашивает рабочую нагрузку чтения при установке соединения с базой данных с поддержкой AlwaysOn. Сервер принудительно реализует намерение в момент соединения и во время выполнения инструкции USE database, но только в базе данных с поддержкой Always On.  
  
Ключевое слово **ApplicationIntent** не работает с базами данных прежних версий, доступными только для чтения.  
  
База данных может допускать или не допускать рабочую нагрузку чтения для целевой базы данных AlwaysOn. (Это выполняется с использованием предложения **ALLOW_CONNECTIONS** инструкций **PRIMARY_ROLE** и **SECONDARY_ROLE**[!INCLUDE[tsql](../../includes/tsql_md.md)].)  
  
Ключевое слово **ApplicationIntent** служит для включения маршрутизации только для чтения.  
  
## <a name="read-only-routing"></a>Маршрутизация только для чтения  
Маршрутизация только для чтения — это функция, которая может обеспечить доступность реплики базы данных, доступной только для чтения. Включение маршрутизации только для чтения  
  
1.  Необходимо установить соединение с прослушивателем группы доступности Always On.  
  
2.  Ключевое слово строки подключения **ApplicationIntent** должно быть установлено в значение **ReadOnly**.  
  
3.  Группа доступности должна быть настроена администратором базы данных на поддержку маршрутизации только для чтения.  
  
Возможно, что не все из нескольких соединений, использующих маршрутизацию только для чтения, будут подключаться к одной и той же реплике только для чтения. Изменения в синхронизации баз данных или в конфигурации маршрутизации сервера могут привести к тому, что клиент будет подключаться к различным репликам только для чтения. Чтобы гарантировать, что все запросы на подключение только для чтения будут соединяться с одной и той же репликой только для чтения, не указывайте прослушиватель группы доступности в ключевом слове строки подключения **Server**. Вместо этого укажите имя экземпляра, доступного только для чтения.  
  
На маршрутизацию только для чтения может потребоваться больше времени, чем на подключение к первичной реплике, поскольку маршрутизация только для чтения предусматривает прежде всего подключение к первичной реплике, а затем поиск наиболее подходящей доступной для чтения вторичной реплики. Учитывая этот факт, следует увеличить время ожидания входа в систему.  
  
## <a name="see-also"></a>См. также:  
[Подключение к серверу](../../connect/php/connecting-to-the-server.md)  
  

