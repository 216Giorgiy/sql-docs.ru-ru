---
title: Использование удержания | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.suite: sql
ms.technology: connectivity
ms.tgt_pltfrm: ''
ms.topic: conceptual
ms.assetid: aa48306c-e7a0-4dcb-af21-9ebb6898e45a
caps.latest.revision: 25
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: 0bf10226926d3c5df21d546de042095defbbe812
ms.sourcegitcommit: e77197ec6935e15e2260a7a44587e8054745d5c2
ms.translationtype: MTE75
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2018
ms.locfileid: "37982096"
---
# <a name="using-holdability"></a>Использование удержания
[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

  По умолчанию результирующий набор, созданный внутри транзакции, сохраняется открытым после фиксации транзакции в базе данных или ее отката. Однако иногда полезно закрыть результирующий набор после фиксации транзакции. Для этого [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] поддерживает возможность ожидания результирующих наборов.  
  
 Возможность ожидания результирующего набора задается при помощи метода [setHoldability](../../connect/jdbc/reference/setholdability-method-sqlserverconnection.md) класса [SQLServerConnection](../../connect/jdbc/reference/sqlserverconnection-class.md). При установке удержания при помощи метода setHoldability, результирующий набор констант удержание ResultSet.HOLD_CURSORS_OVER_COMMIT или ResultSet.CLOSE_CURSORS_AT_COMMIT может использоваться.  
  
 Драйвер JDBC также поддерживает удержание при создании одного из объектов инструкции. При создании объектов инструкции, имеющих перегрузку параметров удержания результирующего набора, удержание объекта инструкции должно соответствовать удержанию подключения. Если они не соответствуют друг другу, возникает исключение. Это происходит потому, что SQL Server поддерживает удержание только на уровне соединения.  
  
 Возможность ожидания результирующего набора соответствует возможности ожидания объекта SQLServerConnection, связанного с результирующим набором, в момент создания результирующего набора только для курсоров на стороне сервера. Это не применяется к курсорам на стороне клиента. Все результирующие наборы с курсорами на стороне клиента всегда будет иметь значение удержания ResultSet.HOLD_CURSORS_OVER_COMMIT.  
  
 Для серверных курсоров при соединении с SQL Server 2005 или более поздней версии параметр возможности сохранения влияет только на новые результирующие наборы, которые будут созданы для этого соединения. Это означает, что настройка удержания не имеет влияния на удержание каких-либо результирующих наборов, которые были созданы ранее и открыты в настоящий момент относительно того соединения. Однако для SQL Server 2000 установка возможности сохранения относится и к существующим результирующим наборам, и к новым, которые пока не созданы для данного соединения.  
  
 В следующем примере возможность ожидания результирующего набора задается при выполнении локальной транзакции, состоящей из двух отдельных инструкций в блоке `try`. Инструкции выполняются с таблицей Production.ScrapReason в образце базы данных [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal_md.md)]. Сначала пример переключается в режим ручных транзакций, задавая для автоматической фиксации значение **false** (ложь). После отключения режима автоматической фиксации инструкции SQL не будут фиксироваться, пока приложение не вызовет явным образом метод [commit](../../connect/jdbc/reference/commit-method-sqlserverconnection.md). Код в блоке catch откатит транзакцию, если возникнет исключение.  
  
 [!code[JDBC#UsingHoldability1](../../connect/jdbc/codesnippet/Java/using-holdability_1.java)]  
  
## <a name="see-also"></a>См. также:  
 [Выполнение транзакций с помощью драйвера JDBC](../../connect/jdbc/performing-transactions-with-the-jdbc-driver.md)  
  
  
