---
title: Шаг 2. Добавление и настройка контейнера "цикл по каждому элементу" | Документы Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: integration-services
ms.component: tutorial
ms.reviewer: ''
ms.suite: sql
ms.technology:
- integration-services
ms.tgt_pltfrm: ''
ms.topic: get-started-article
applies_to:
- SQL Server 2016
ms.assetid: 88a973cc-0f23-4ecf-adb6-5b06279c2df6
caps.latest.revision: 36
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.openlocfilehash: 7b1bff8ae63008a86637927f1547a9d9a8c1f42b
ms.sourcegitcommit: 1740f3090b168c0e809611a7aa6fd514075616bf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="lesson-2-2---adding-and-configuring-the-foreach-loop-container"></a>Занятие 2–2. Добавление и настройка контейнера "цикл по каждому элементу" | Документы Майкрософт
В этой задаче будет добавлена возможность выполнить циклическую обработку папки неструктурированных файлов и применить для каждого из этих неструктурированных файлов одинаковое преобразование потока данных, использованное на занятии 1. Это будет выполнено путем добавления в поток управления и настройки контейнера «цикл по каждому элементу».  
  
Добавленный контейнер «цикл по каждому элементу» должен иметь возможность соединения с каждым неструктурированным файлом в данной папке. Так как все файлы в папке имеют одинаковый формат, контейнер «цикл по каждому элементу» может использовать один и тот же диспетчер соединений с неструктурированными файлами для соединения с каждым из файлов. Контейнер будет использовать диспетчер соединений с неструктурированными файлами, созданный на занятии 1.  
  
В настоящее время диспетчер соединений с неструктурированными файлами занятия 1 соединен только с одним неструктурированным файлом. Чтобы последовательно соединиться с каждым неструктурированным файлом в папке, необходимо настроить контейнер «цикл по каждому элементу» и диспетчер соединений с неструктурированными файлами, как описано ниже.  
  
-   **Контейнер "цикл по каждому элементу".** Необходимо сопоставить перечисляемое значение контейнера с пользовательской переменной пакета. Контейнер будет использовать определенные пользователем переменные, чтобы динамически изменять свойство **ConnectionString** диспетчера соединений с неструктурированными файлами и последовательно соединяться с каждым файлом в папке.  
  
-   **Диспетчер соединений с неструктурированными файлами.** Необходимо изменить настройки диспетчера соединений, созданного в рамках занятия 1, таким образом, чтобы использовать пользовательские переменные для заполнения свойства **ConnectionString** диспетчера соединений.  
  
Процедуры в этом задании показывают, как создавать и изменять контейнер «цикл по каждому элементу» для использования пользовательских переменных пакетов и как добавлять в цикл задачи потока данных. В следующей задаче будет рассмотрено, как изменить настройки диспетчера соединений с неструктурированными файлами таким образом, чтобы использовать в нем пользовательскую переменную.  
  
После внесения этих изменений в пакет при его выполнении контейнер «цикл по каждому элементу» будет применен к коллекции файлов из папки образцов данных. Каждый раз при нахождении отвечающего критериям поиска файла контейнер "цикл по каждому элементу" будет подставлять в пользовательскую переменную имя этого файла, сопоставлять эту переменную со свойством **ConnectionString** диспетчера соединений с неструктурированными файлами SampleCurrencyData, а затем выполнять поток данных по этому файлу. Таким образом, при каждом проходе цикла Foreach для выполнения задачи потока данных будет подставляться другой неструктурированный файл.  
  
> [!NOTE]  
> Так как в службах [!INCLUDE[msCoName](../includes/msconame-md.md)][!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] поток управления и поток данных разделены, любые циклы, добавленные в поток управления, не требуют изменения потока данных. Поэтому поток данных, созданный на занятии 1, не требуется изменять.  
  
### <a name="to-add-a-foreach-loop-container"></a>Добавление контейнера «цикл по каждому элементу»  
  
1.  В **SQL Server Data Tools**перейдите на вкладку **Поток управления** .  
  
2.  На **панели элементов служб SSIS**разверните элемент **Контейнеры**и перетащите **Контейнер "цикл по каждому элементу"** в рабочую область конструктора вкладки **Поток управления** .  
  
3.  Щелкните правой кнопкой мыши добавленный **Контейнер "цикл по каждому элементу"** и выберите команду **Изменить**.  
  
4.  В диалоговом окне **Редактор циклов по каждому элементу** на странице **Общие** в поле **Имя**введите **Цикл по каждому файлу в папке**. Нажмите кнопку **ОК**.  
  
5.  Щелкните правой кнопкой мыши контейнер "цикл по каждому элементу", выберите пункт **Свойства**, а затем убедитесь в том, что в окне "Свойства" свойство **LocaleID** установлено в значение **Английский (США)**.  
  
### <a name="to-configure-the-enumerator-for-the-foreach-loop-container"></a>Настройка перечислителя контейнера «цикл по каждому элементу»  
  
1.  Дважды щелкните "Цикл по каждому файлу в папке", чтобы снова открыть **Редактор циклов по каждому элементу**.  
  
2.  Щелкните **Коллекция**.  
  
3.  На странице **Коллекция** выберите **Перечислитель с циклом по каждому файлу**.  
  
4.  В группе **Конфигурация перечислителя** нажмите кнопку **Обзор**.  
  
5.  В диалоговом окне **Выбор папки** выберите папку на компьютере, в которой находятся файлы Currency_*.txt.  
  
    Образцы данных включаются в состав пакетов занятий по службам [!INCLUDE[ssIS](../includes/ssis-md.md)] . Чтобы загрузить образцы данных и пакеты занятий выполните следующие действия.  
  
    1.  Перейдите к [образцам продуктов служб Integration Services](http://go.microsoft.com/fwlink/?LinkId=275027). 
  
    2.  Перейдите на вкладку **DOWNLOADS** .  
  
    3.  Щелкните файл [SQL2012.Integration_Services.Create_Simple_ETL_Tutorial.Sample.zip](http://msftisprodsamples.codeplex.com/downloads/get/596031).  
  
6.  В поле **Файлы** введите **Currency_\*.txt**.  
  
### <a name="to-map-the-enumerator-to-a-user-defined-variable"></a>Сопоставление перечислителя с пользовательской переменной  
  
1.  Щелкните **Сопоставления переменной**.  
  
2.  На странице **Сопоставления переменной** в столбце **Переменная** щелкните пустую ячейку и выберите пункт **\<Создать переменную…>**.  
  
3.  В диалоговом окне **Добавление переменной** в поле **Имя**введите **varFileName**.  
  
    > [!IMPORTANT]  
    > В именах переменных учитывается регистр.  
  
4.  Нажмите кнопку **ОК**.  
  
5.  Еще раз нажмите кнопку **ОК** , чтобы закрыть диалоговое окно **Редактор циклов по каждому элементу** .  
  
### <a name="to-add-the-data-flow-task-to-the-loop"></a>Добавление задачи потока данных в цикл  
  
-   Перетащите задачу потока данных **Получение валюты образца** в контейнер "цикл по каждому элементу", получивший название **Цикл по каждому файлу в папке**.  
  
## <a name="next-lesson-task"></a>Следующая задача занятия  
[Шаг 3. Изменение диспетчера соединений с неструктурированными файлами](../integration-services/lesson-2-3-modifying-the-flat-file-connection-manager.md)  
  
## <a name="see-also"></a>См. также:  
[Настройка контейнера «цикл по каждому элементу»](http://msdn.microsoft.com/library/519c6f96-5e1f-47d2-b96a-d49946948c25)  
[Использование переменных в пакетах](http://msdn.microsoft.com/library/7742e92d-46c5-4cc4-b9a3-45b688ddb787)  
  
  
  
