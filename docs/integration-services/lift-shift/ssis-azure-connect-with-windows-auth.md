---
title: Подключение к источникам данных и общим папкам с помощью проверки подлинности Windows | Microsoft Docs
description: Узнайте, как настроить каталог служб MSSQL Integration Services в базе данных SQL Azure b Integration Runtime Azure — SSI для запуска пакетов, которые подключаются к источникам данных и общим папкам с применением проверки подлинности Windows.
ms.date: 06/27/2018
ms.topic: conceptual
ms.prod: sql
ms.prod_service: integration-services
ms.custom: ''
ms.technology: integration-services
author: swinarko
ms.author: sawinark
ms.reviewer: douglasl
manager: craigg
ms.openlocfilehash: 4dfe14abd938e456a1b1415226ff6d903e0b5b07
ms.sourcegitcommit: 61381ef939415fe019285def9450d7583df1fed0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47608651"
---
# <a name="connect-to-data-sources-and-file-shares-with-windows-authentication-from-ssis-packages-in-azure"></a>Подключение к источникам данных и общим папкам с помощью проверки подлинности Windows в пакетах MSSQL Integration Services в Azure
С помощью проверки подлинности Windows можно подключаться к источникам данных и общим файловым ресурсам в той же виртуальной сети, в которой размещена среда выполнения интеграции Azure —SSI. Источники могут находиться в локальной среде, в виртуальных машинах Azure и (или) службе файлов Azure. Есть три способа подключения к источникам данных и общим папкам с помощью проверки подлинности Windows из пакетов служб MSSQL Integration Services, выполняющихся в среда выполнения интеграции Azure — SSI:

| Метод подключения | Область действия | Этап настройки | Метод доступа в пакетах | Число наборов учетных данных и подключенных ресурсов | Тип подключенных ресурсов | 
|---|---|---|---|---|---|
| Сохранение учетных данных посредством команды `cmdkey` | Для среды выполнения интеграции Azure — SSI | Выполните команду `cmdkey` в пользовательском скрипте установки (`main.cmd`) при подготовке или перенастройке среды выполнения интеграции Azure — SSI, например, `cmdkey /add:fileshareserver /user:xxx /pass:yyy`.<br/><br/> Дополнительные сведения см. в статье [Пользовательская установка для среды выполнения интеграции Azure–SSI](https://docs.microsoft.com/azure/data-factory/how-to-configure-azure-ssis-ir-custom-setup). | Доступ к ресурсам напрямую из пакетов по UNC-пути, например, `\\fileshareserver\folder`. | Поддержка нескольких наборов учетных данных для разных подключенных ресурсов: | — общие файловые ресурсы в локальной среде и (или) на виртуальных машинах Azure;<br/><br/> — файлы Azure, как описано в [этой статье](https://docs.microsoft.com/azure/storage/files/storage-how-to-use-files-windows); <br/><br/> — SQL Server с проверкой подлинности Windows;<br/><br/> — другие ресурсы с проверкой подлинности Windows. |
| Настройка контекста выполнения на уровне каталога | Для среды выполнения интеграции Azure — SSI | Выполните хранимую процедуру SSISDB `catalog.set_execution_credential`, чтобы настроить контекст "Выполнить как".<br/><br/> Дополнительные сведения см. ниже в этой статье. | Доступ к ресурсам напрямую из пакетов | Поддержка только одного набора учетных данных для всех подключенных ресурсов: | — общие файловые ресурсы в локальной среде и (или) на виртуальных машинах Azure;<br/><br/> — файлы Azure, как описано в [этой статье](https://docs.microsoft.com/azure/storage/files/storage-how-to-use-files-windows); <br/><br/> — SQL Server с проверкой подлинности Windows;<br/><br/> — другие ресурсы с проверкой подлинности Windows. | 
| Подключение дисков во время выполнения пакета (без сохранения состояния) | Для каждого пакета | Выполните команду `net use` в задаче "Выполнение процесса", которая добавляется в начало потока управления в пакетах, например, `net use D: \\fileshareserver\sharename`. | Обращение к общим папкам через подключенные диски. | Поддержка нескольких дисков для разных файловых ресурсов: | — общие файловые ресурсы в локальной среде и (или) на виртуальных машинах Azure;<br/><br/> — файлы Azure, как описано в [этой статье](https://docs.microsoft.com/azure/storage/files/storage-how-to-use-files-windows). |
|||||||

> [!WARNING]
> Если вы не используете указанные выше методы подключения к источникам данных и общим файловым ресурсам с использованием проверки подлинности Windows, зависящие от проверки подлинности Windows пакеты не смогут подключиться к ним и будут возвращать ошибки во время выполнения. 

В оставшейся части этой статье описывается, как настроить для каталога MSSQL Integration Services в базе данных SQL Azure запуск пакетов, которые используют проверку подлинности Windows для подключения к источникам данных и общим папкам. 

## <a name="you-can-only-use-one-set-of-credentials"></a>Можно использовать только один набор учетных данных
Этот метод позволяет использовать только один набор учетных данных для каждого пакета. Учетные данные домена, указываемые при выполнении инструкций в этой статье, применяются ко всем операциям (интерактивным или запланированным) в среде выполнения интеграции Azure — SSI, пока эти данные не будут изменены или удалены. Если пакет должен подключаться к нескольким источникам данных и (или) общим файловым ресурсам с разными наборами учетных данных, следует рассмотреть другие описанные выше методы.

## <a name="provide-domain-credentials-for-windows-authentication"></a>Указание учетных данных домена для проверки подлинности Windows
Чтобы задать учетные данные домена, с помощью которых пакеты смогут подключаться к локальным источникам данных и (или) общим файловым ресурсам, используя проверку подлинности Windows, сделайте следующее:

1.  С помощью SQL Server Management Studio (SSMS) или другого средства подключитесь к базе данных SQL, в которой размещается база данных каталога SSIS (SSISDB). Дополнительные сведения см. в статье [Подключение к каталогу SSIS (SSISDB) в Azure](ssis-azure-connect-to-catalog-database.md).

2.  Откройте окно запроса для текущей базы данных SSISDB.

3.  Выполните следующую хранимую процедуру и укажите соответствующие учетные данные домена:

    ```sql
    catalog.set_execution_credential @user='<your user name>', @domain='<your domain name>', @password='<your password>'
    ```

4.  Запустите пакеты служб SSIS. Пакеты используют предоставленные учетные данные для подключения к локальным источникам данных и (или) общим файловым ресурсам с помощью проверки подлинности Windows.

### <a name="view-domain-credentials"></a>Просмотр учетных данных домена
Чтобы просмотреть активные учетные данные домена, выполните указанные ниже действия.

1.  С помощью SQL Server Management Studio (SSMS) или другого средства подключитесь к базе данных SQL, в которой размещается база данных каталога SSIS (SSISDB).

2.  Откройте окно запроса для текущей базы данных SSISDB.

3.  Выполните следующую хранимую процедуру и просмотрите выходные данные:

    ```sql
    SELECT * 
    FROM catalog.master_properties
    WHERE property_name = 'EXECUTION_DOMAIN' OR property_name = 'EXECUTION_USER'
    ```

### <a name="clear-domain-credentials"></a>Удаление учетных данных домена
Чтобы удалить учетные данные, заданные согласно инструкциям в этой статье, выполните указанные ниже действия.

1.  С помощью SQL Server Management Studio (SSMS) или другого средства подключитесь к базе данных SQL, в которой размещается база данных каталога SSIS (SSISDB).

2.  Откройте окно запроса для текущей базы данных SSISDB.

3.  Выполните следующую хранимую процедуру:

    ```sql
    catalog.set_execution_credential @user='', @domain='', @password=''
    ```

## <a name="connect-to-an-on-premises-sql-server"></a>Подключение к локальному серверу SQL Server
Чтобы проверить возможность подключения к локальному серверу SQL Server, выполните указанные ниже действия.

1.  Чтобы выполнить эту проверку, найдите компьютер, не присоединенный к домену.

2.  На не присоединенном к домену компьютере выполните следующую команду, чтобы запустить среду SQL Server Management Studio (SSMS) с требуемыми учетными данными домена:

    ```cmd
    runas.exe /netonly /user:<domain>\<username> SSMS.exe
    ```

3.  В среде SSMS проверьте возможность подключения к требуемому локальному серверу SQL Server.

### <a name="prerequisites"></a>предварительные требования
Чтобы подключиться к локальному серверу SQL Server, используя пакет, запущенный в Azure, нужно включить следующие необходимые компоненты:

1.  В диспетчере конфигурации SQL Server включите протокол TCP/IP.
2.  Разрешите доступ с помощью брандмауэра Windows. Дополнительные сведения см. в статье [Configure the Windows Firewall to Allow SQL Server Access](https://docs.microsoft.com/sql/sql-server/install/configure-the-windows-firewall-to-allow-sql-server-access) (Настройка брандмауэра Windows для разрешения доступа к SQL Server).
3.  Чтобы подключаться с использованием проверки подлинности Windows, разместите среду выполнения интеграции Azure — SSI в той же виртуальной сети, которая содержит локальный сервер SQL Server.  Дополнительные сведения см. в разделе [Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Затем используйте `catalog.set_execution_credential`, чтобы указать учетные данные, как описано в этой статье.

## <a name="connect-to-an-on-premises-file-share"></a>Подключение к локальной общей папке
Чтобы проверить возможность подключения к локальной общей папке, выполните указанные ниже действия.

1.  Чтобы выполнить эту проверку, найдите компьютер, не присоединенный к домену.

2.  На компьютере, не присоединенном к домену, выполните приведенную ниже команду. Эта команда открывает окно командной строки с требуемыми учетными данными домена, а затем проверяет возможность подключения к общей папке, получая список каталогов.

    ```cmd
    runas.exe /netonly /user:<domain>\<username> cmd.exe
    dir \\fileshare
    ```

3.  Проверьте, возвращен ли список каталогов из локальной общей папки, которую необходимо использовать.

## <a name="connect-to-a-file-share-on-an-azure-vm"></a>Подключение к общей папке на виртуальной машине Azure
Чтобы подключиться к общей папке на виртуальной машине Azure, сделайте следующее:

1.  С помощью SQL Server Management Studio (SSMS) или другого средства подключитесь к базе данных SQL, в которой размещается база данных каталога SSIS (SSISDB).

2.  Откройте окно запроса для текущей базы данных SSISDB.

3.  Выполните хранимую процедуру `catalog.set_execution_credential`, как описано ниже.

    ```sql
    catalog.set_execution_credential @domain = N'.', @user = N'username of local account on Azure virtual machine', @password = N'password'
    ```

## <a name="connect-to-a-file-share-in-azure-files"></a>Подключение к общей папке в службе файлов Azure
Дополнительные сведения о файлах Azure см. в разделе [Файлы Azure](https://azure.microsoft.com/services/storage/files/).

Чтобы подключиться к общей папке в службе файлов Azure, сделайте следующее:

1.  С помощью SQL Server Management Studio (SSMS) или другого средства подключитесь к базе данных SQL, в которой размещается база данных каталога SSIS (SSISDB).

2.  Откройте окно запроса для текущей базы данных SSISDB.

3.  Выполните хранимую процедуру `catalog.set_execution_credential`, как описано ниже.

    ```sql
    catalog.set_execution_credential @domain = N'Azure', @user = N'<storage-account-name>', @password = N'<storage-account-key>'
    ```

## <a name="next-steps"></a>Следующие шаги
- Разверните пакет. Дополнительные сведения см. в разделе [Развертывание проекта служб SSIS с помощью SQL Server Management Studio (SSMS)](../ssis-quickstart-deploy-ssms.md).
- Запустите пакет. Дополнительные сведения см. в разделе [Выполнение пакета служб SSIS с помощью SQL Server Management Studio (SSMS)](../ssis-quickstart-run-ssms.md).
- Создайте расписание для пакета. Дополнительные сведения см. в разделе [Планирование выполнения пакетов служб SSIS в Azure](ssis-azure-schedule-packages.md).
