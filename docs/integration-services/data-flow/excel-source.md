---
title: Источник Excel | Документы Майкрософт
ms.custom: ''
ms.date: 04/02/2018
ms.prod: sql-non-specified
ms.prod_service: integration-services
ms.service: ''
ms.component: data-flow
ms.reviewer: ''
ms.suite: sql
ms.technology:
- integration-services
ms.tgt_pltfrm: ''
ms.topic: article
f1_keywords:
- sql13.dts.designer.excelsource.f1
- sql13.dts.designer.excelsourceadapter.connection.f1
- sql13.dts.designer.excelsourceadapter.columns.f1
- sql13.dts.designer.excelsourceadapter.erroroutput.f1
helpviewer_keywords:
- Excel [Integration Services]
- sources [Integration Services], Excel
ms.assetid: e66349f3-b1b8-4763-89b7-7803541a4d62
caps.latest.revision: 60
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: On Demand
ms.openlocfilehash: 6a9795de30c7d4fbe2ede9a17043a916e5953cd5
ms.sourcegitcommit: 059fc64ba858ea2adaad2db39f306a8bff9649c2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/04/2018
---
# <a name="excel-source"></a>Источник Excel
  Источник Excel извлекает данные из листов или диапазонов в книгах [!INCLUDE[msCoName](../../includes/msconame-md.md)] Excel.  

> [!IMPORTANT]
> Дополнительные сведения о подключении к файлам Excel, а также об ограничениях и известных проблемах, связанных с загрузкой данных в файлы этого приложения и из них, см. в разделе [Загрузка данных в приложение Excel или из него с помощью служб SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md).

## <a name="access-mode"></a>Режим доступа
 Источник Excel предоставляет четыре различных режима доступа к данным для их извлечения:  
  
-   Таблица или представление.  
  
-   Таблица или представление, указанные в переменной.  
  
-   Результат выполнения инструкции SQL. Может использоваться параметризированный запрос.  
  
-   Результат выполнения инструкции SQL хранится в переменной.  
  
 Источник Excel для подключения к источнику данных использует диспетчер соединений Excel, и диспетчер соединений определяет исходный файл книги. Дополнительные сведения см. в статье [Excel Connection Manager](../../integration-services/connection-manager/excel-connection-manager.md).  
  
 Источник Excel имеет один обычный выход и один выход ошибок.  
  
## <a name="usage-considerations"></a>Особенности использования  
 Диспетчер соединений Excel использует поставщик [!INCLUDE[msCoName](../../includes/msconame-md.md)] OLE DB для Jet 4.0, который поддерживает драйвер Excel ISAM (индексированный последовательный метод доступа) для подключения, а также чтения и записи данных в источники данных Excel.  
  
 Во многих имеющихся статьях базы знаний [!INCLUDE[msCoName](../../includes/msconame-md.md)] описывается поведение этого поставщика и драйвера, и хотя эти статьи не относятся к [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] и их предшественникам, службам преобразования данных, вам может быть интересно изучить поведение, которое может привести к неожиданным результатам. Общие сведения об использовании и поведении драйвера Excel см. в разделе [Как использовать ADO с данными Excel из Visual Basic или VBA](http://support.microsoft.com/kb/257819).  
  
 Следующие особенности поведения поставщика данных Jet в сочетании с драйвером Excel при считывании данных из источника данных Excel могут привести к непредвиденным результатам.  
  
-   **Источники данных**. В качестве источника данных в книге Excel может быть указано имя листа, к которому должен быть добавлен знак $ (например, «Лист1$»), или именованного диапазона (например, «Мой_диапазон»). В инструкции SQL имя листа должно быть окружено ограничителями (например, [Лист1$]), чтобы избежать синтаксической ошибки, вызванной знаком $. Построитель запросов автоматически добавляет эти ограничители. Когда указан лист или диапазон, драйвер считывает непрерывный блок ячеек, начиная с первой непустой ячейки в верхнем левом углу листа или диапазона. Поэтому не должно быть пустых строк в исходных данных или пустой строки между заголовком или строками заголовка и строками данных.  
  
-   **Отсутствующие значения**. Драйвер Excel считывает определенное количество строк (по умолчанию 8 строк) в указанный источник для определения типа данных каждого столбца. Если столбец содержит смешанные типы данных, особенно если числовые данные смешаны с текстовыми данными, драйвер принимает решение в пользу того типа данных, которого больше, и возвращает значения NULL в ячейки, содержащие данные другого типа. (В случае равенства преимущество получает числовой тип.) Большинство параметров форматирования ячеек в листе Excel не затрагивает это определение типа данных. Можно изменить поведение драйвера Excel, указав режим импорта. Чтобы указать режим импорта, добавьте **IMEX=1** к значению расширенных свойств в строке соединения диспетчера соединений с Excel в окне **Свойства** . Дополнительные сведения см. в разделе [PRB. Значения Excel, возвращенные как NULL, при использовании DAO OpenRecordset](http://support.microsoft.com/kb/194124).  
  
-   **Усеченный текст**. Когда драйвер определяет, что столбец Excel содержит текстовые данные, он выбирает тип данных (строковый или memo) на основании самого длинного значения. Если драйвер не обнаруживает значений длиннее 255 символов в выбираемых строках, он считает, что столбец является строковым с длиной 255 символов, а не столбцом типа memo. Поэтому значения длиннее 255 символов могут быть усечены. Чтобы импортировать данные из столбца типа memo без усечения, необходимо убедиться, что столбец memo по крайней мере в одной из выбранных строк содержит значение длиннее 255 символов, либо нужно увеличить число строк, выбираемых драйвером, чтобы включить в выборку такую строку. Чтобы увеличить количество строк, включаемых в выборку, достаточно увеличить значение **TypeGuessRows** в разделе реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Excel** . Дополнительные сведения см. в разделе [PRB. Передача данных от источника Jet 4.0 OLEDB заканчивается сбоем с ошибками](http://support.microsoft.com/kb/281517).  
  
-   **Типы данных**. Драйвер Excel распознает только ограниченный набор типов данных. Например, все числовые столбцы воспринимаются как тип double (DT_R8), а все строковые столбцы (кроме столбцов типа memo) воспринимаются как строки в Юникоде длиной 255 символов (DT_WSTR). [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] сопоставляют типы данных Excel следующим образом.  
  
    -   Числовой — с плавающей запятой двойной точности (DT_R8)  
  
    -   Денежный — денежный (DT_CY)  
  
    -   Логический — логический (DT_BOOL)  
  
    -   Дата/время — **datetime** (DT_DATE)  
  
    -   Строковый — строка в Юникоде длиной в 255 символов (DT_WSTR)  
  
    -   Memo — текстовый поток в Юникоде (DT_NTEXT)  
  
-   **Преобразования типов данных и длины по умолчанию**. [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] неявное преобразование типов данных не выполняется. В результате, возможно, потребуется использовать преобразования «Производный столбец» или «Преобразование данных» для явного преобразования данных Excel до их загрузки в назначение, отличное от Excel, либо преобразовать данные, отличные от Excel, до их загрузки в назначение Excel. В этом случае может оказаться полезным создать исходный пакет с помощью мастера импорта и экспорта, который сам настроит необходимые преобразования. Ниже приведены некоторые примеры преобразований, которые могут потребоваться.  
  
    -   Преобразование между строковыми столбцами Excel в Юникоде и строковыми столбцами в формате с конкретными кодовыми страницами, отличными от Юникода.  
  
    -   Преобразование между строковыми столбцами Excel длиной в 255 символов и строковыми столбцами другой длины.  
  
    -   Преобразование между числовыми столбцами Excel с плавающей запятой двойной точности и числовыми столбцами других типов.  
  
## <a name="excel-source-configuration"></a>Настройка источника Excel  
 Значения свойств можно задавать с помощью конструктора [!INCLUDE[ssIS](../../includes/ssis-md.md)] или программными средствами.  
  
 Диалоговое окно **Расширенный редактор** содержит все свойства, которые могут устанавливаться программными средствами. Дополнительные сведения о свойствах, которые вы можете задать в диалоговом окне **Расширенный редактор** или программными средствами, см. в следующих разделах.  
  
-   [Common Properties](http://msdn.microsoft.com/library/51973502-5cc6-4125-9fce-e60fa1b7b796)  
  
-   [Пользовательские свойства Excel](../../integration-services/data-flow/excel-custom-properties.md)  
  
 Дополнительные сведения о переходе между файлами в группе файлов Excel см. в разделе [Просмотр файлов и таблиц Excel с помощью контейнера "Цикл по каждому элементу"](../../integration-services/control-flow/loop-through-excel-files-and-tables-by-using-a-foreach-loop-container.md).  
  
## <a name="related-tasks"></a>Related Tasks  
  
-   [Сопоставления параметров запросов с переменными в компонентах потока данных](../../integration-services/data-flow/map-query-parameters-to-variables-in-a-data-flow-component.md)  
  
-   [Установление свойств компонента потока данных](../../integration-services/data-flow/set-the-properties-of-a-data-flow-component.md)  
  
-   [Сортировка данных для преобразований «Слияние» и «Соединение слиянием»](../../integration-services/data-flow/transformations/sort-data-for-the-merge-and-merge-join-transformations.md)  
  
-   [Просмотр файлов и таблиц Excel с помощью контейнера «цикл по каждому элементу»](../../integration-services/control-flow/loop-through-excel-files-and-tables-by-using-a-foreach-loop-container.md)  
  
## <a name="excel-source-editor-connection-manager-page"></a>Редактор источника Excel (страница «Диспетчер соединений»)
  Используйте раздел **Диспетчер соединений** диалогового окна **Редактор источника «Excel»** , чтобы выбрать используемую рабочую книгу [!INCLUDE[ofprexcel](../../includes/ofprexcel-md.md)] . Источник Excel считывает данные из рабочего листа или из именованного диапазона в существующей рабочей книге.  
  
> [!NOTE]  
>  Свойство **CommandTimeout** источника Excel недоступно в диалоговом окне **Редактор источника «Excel»**, но может быть задано с помощью диалогового окна **Расширенный редактор**. Дополнительные сведения о данном свойстве см. в подразделе «Источник Excel» раздела [Excel Custom Properties](../../integration-services/data-flow/excel-custom-properties.md).  
  
### <a name="static-options"></a>Статические параметры  
 **Диспетчер соединений OLE DB**  
 Выберите из списка существующий диспетчер подключений к Excel или создайте новое соединение, нажав кнопку **Создать**.  
  
 **Создать**  
 Создайте новый диспетчер подключений с помощью диалогового окна **Диспетчер подключений Excel** .  
  
 **Режим доступа к данным**  
 Укажите метод выбора данных из источника.  
  
|Значение|Description|  
|-----------|-----------------|  
|Таблица или представление|Получение данных из электронной таблицы или именованного диапазона файла Excel.|  
|Переменная, содержащая имя таблицы или представления|Укажите переменную, содержащую имя листа или диапазона.<br /><br /> **См. также:** [Использование переменных в пакетах](http://msdn.microsoft.com/library/7742e92d-46c5-4cc4-b9a3-45b688ddb787)|  
|Команда SQL|Получение данных из файла Excel с использованием SQL-запроса. |  
|Команда SQL из переменной|Задайте текст SQL-запроса в переменную.|  
  
 **Предварительный просмотр**  
 Осуществляйте предварительный просмотр результатов в диалоговом окне **Просмотр данных** . В окне «Предварительный просмотр» может отображаться до 200 строк.  
  
### <a name="data-access-mode-dynamic-options"></a>Динамические параметры режима доступа к данным  
  
#### <a name="data-access-mode--table-or-view"></a>Режим доступа к данным = Таблица или представление  
 **Имя листа Excel**  
 Выберите в книге Excel из списка имя листа или именованного диапазона.  
  
#### <a name="data-access-mode--table-name-or-view-name-variable"></a>Режим доступа к данным — переменная, содержащая имя таблицы или представления  
 **Имя переменной**  
 Укажите переменную, содержащую имя листа или именованного диапазона.  
  
#### <a name="data-access-mode--sql-command"></a>Режим доступа к данным — команда SQL  
 **Текст команды SQL**  
 Введите текст SQL-запроса, создайте запрос, нажав кнопку **Создать запрос**, или выберите файл, содержащий текст запроса, нажав кнопку **Обзор**.  
  
 **Параметры**  
 Если введен параметризованный запрос, где в тексте запроса в качестве заполнителя параметра использовался знак ?, воспользуйтесь диалоговым окном **Установка параметров запроса** для сопоставления входных параметров запроса и переменных пакета.  
  
 **Build query**  
 Воспользуйтесь диалоговым окном **Построитель запросов** для визуального конструирования SQL-запроса.  
  
 **Обзор**  
 Воспользуйтесь диалоговым окном **Открыть** для выбора файла, содержащего текст SQL-запроса.  
  
 **Анализ запроса**  
 Проверить синтаксис текста запроса.  
  
#### <a name="data-access-mode--sql-command-from-variable"></a>Режим доступа к данным = Команда SQL из переменной  
 **Имя переменной**  
 Выберите переменную, содержащую текст SQL-запроса.  
  
## <a name="excel-source-editor-columns-page"></a>Редактор источника Excel (страница «Столбцы»)
  Страница **Столбцы** в диалоговом окне **Редактор источника "Excel"** предназначена для сопоставления выходного столбца с каждым внешним (исходным) столбцом.  
  
### <a name="options"></a>Параметры  
 **Доступные внешние столбцы**  
 Просмотр списка доступных внешних столбцов источника данных. В этой таблице нельзя добавлять или удалять столбцы.  
  
 **Внешний столбец**  
 Просмотр внешних (исходных) столбцов в том порядке, в котором их будет считывать задача. Этот порядок можно изменить, вначале очистив выделенные столбцы в таблице, а затем выбрав в списке внешние столбцы, идущие в другом порядке.  
  
 **Выходной столбец**  
 Введите уникальное имя для каждого выходного столбца. По умолчанию используется имя выбранного внешнего (исходного) столбца, однако можно выбрать любое уникальное описательное имя. Выбранное имя будет отображаться в конструкторе служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] .  
  
## <a name="excel-source-editor-error-output-page"></a>Редактор источника Excel (страница «Вывод ошибок»)
  Страница **Вывод ошибок** диалогового окна **Редактор источника «Excel»** используется для выбора параметров обработки ошибок, а также для установки свойств выходных столбцов ошибок.  
  
### <a name="options"></a>Параметры  
 **Вход или выход**  
 Просмотр имени источника данных.  
  
 **Столбец**  
 Позволяет просмотреть внешние (исходные) столбцы, выбранные на странице **Диспетчер соединений** диалогового окна **Редактор источника "Excel"**.  
  
 **Ошибка**  
 Задайте действие, которое необходимо выполнить при возникновении ошибки: пропустить ошибку, перенаправить строку или вызвать сбой компонента.  
  
 **См. также:** [Обработка ошибок в данных](../../integration-services/data-flow/error-handling-in-data.md)  
  
 **Усечение**  
 Укажите, что нужно сделать при усечении: пропустить ошибку, перенаправить строку или вызвать сбой компонента.  
  
 **Описание**  
 Просмотреть описание ошибки.  
  
 **Присвоить указанное значение выбранным ячейкам**  
 Укажите действие, которое необходимо применить ко всем выбранным ячейкам при возникновении ошибки или усечения: пропустить ошибку, перенаправить строку или вызвать сбой компонента.  
  
 **Применить**  
 Применить параметр обработки ошибок к выбранным ячейкам.  
  
## <a name="related-content"></a>См. также  
[Загрузка данных в приложение Excel или из него с помощью служб SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md)
[Назначение "Excel"](excel-destination.md)  
[Диспетчер подключений Excel](../connection-manager/excel-connection-manager.md)
