---
title: "Построение, развертывание и отладка пользовательских объектов | Документы Microsoft"
ms.custom: 
ms.date: 03/14/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- docset-sql-devref
ms.tgt_pltfrm: 
ms.topic: reference
applies_to:
- SQL Server 2016 Preview
helpviewer_keywords:
- custom objects [Integration Services]
ms.assetid: b03685bc-5398-4c3f-901a-1219c1098fbe
caps.latest.revision: 50
author: douglaslMS
ms.author: douglasl
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 1419847dd47435cef775a2c55c0578ff4406cddc
ms.openlocfilehash: 99fdd71403b12cee8ba9f207890268cde2e1d450
ms.contentlocale: ru-ru
ms.lasthandoff: 08/03/2017

---
# <a name="building-deploying-and-debugging-custom-objects"></a>Построение, развертывание и отладка пользовательских объектов
  После написания кода для пользовательского объекта для [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], необходимо построить сборку, развертывать и интегрировать ее в [!INCLUDE[ssIS](../../includes/ssis-md.md)] конструктора, чтобы сделать его доступным для использования в пакетах и тестирования и отладки.  
  
##  <a name="top"></a>Шаги построения, развертывания и отладки пользовательского объекта для служб Integration Services  
 Пользовательская функциональность для объекта уже написана. Теперь необходимо протестировать ее и сделать доступной для пользователей. Эти шаги похожи для всех типов пользовательских объектов, которые могут быть созданы для служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].  
  
 Ниже приведены шаги для построения, развертывания и тестирования.  
  
1.  [Знак](#signing) сборки со строгим именем.  
  
2.  [Построение](#building) сборки.  
  
3.  [Развертывание](#deploying) сборку, переместив или скопировав ее в соответствующую [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] папки.  
  
4.  [Установка](#installing) сборку в глобальный кэш сборок (GAC).  
  
     Объект автоматически добавляется в область элементов.  
  
5.  [Устранение неполадок](#troubleshooting) развертывания, при необходимости.  
  
6.  [Тест](#testing) и отладки кода.  
  
 Вы можно теперь использовать конструктор служб SSIS в SQL Server Data Tools (SSDT) для создания, поддержания и запускать пакеты, которые предназначены для различных версий [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения о влиянии этого улучшения для пользовательских расширений см. в разделе [начало пользовательских расширений служб SSIS для поддержки поддержка нескольких версий 2015 SSDT для SQL Server 2016](https://blogs.msdn.microsoft.com/ssis/2016/04/19/getting-your-ssis-custom-extensions-to-be-supported-by-the-multi-version-support-of-ssdt-2015-for-sql-server-2016/)  
  
##  <a name="signing"></a>Подписи сборки  
 Если сборка предназначена для общего доступа, ее необходимо установить в глобальный кэш сборок. После добавления сборки в глобальный кэш сборок, ее можно использовать в приложениях, например, в среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]. Глобальный кэш сборок предъявляет к добавляемой сборке особое требование: она должна быть подписана строгим именем, что гарантирует глобальную уникальность сборки. Сборка со строгим именем имеет полное имя, включающее имя, культуру, открытый ключ и номер версии сборки. Среда выполнения использует эти сведения, чтобы найти сборку и отличить ее от других сборок с тем же именем.  
  
 Чтобы подписать сборку строгим именем, необходимо иметь или создать пару открытого и закрытого ключей. Такая пара открытого и закрытого криптографических ключей используется во время построения для создания сборки со строгим именем.  
  
 Дополнительные сведения о строгих именах и шагах подписывания сборки см. в следующих разделах документации к пакету SDK платформы [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)]:  
  
-   Сборки со строгими именами  
  
-   Создание пары ключей  
  
-   Подписывание сборки строгим именем  
  
 Можно легко подписать сборку строгим именем в среде [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] во время построения. В **свойства проекта** выберите **подписывание** вкладки. Выберите параметр, чтобы **подписать сборку** и укажите путь к файлу ключа (SNK).  
  
##  <a name="building"></a>Построение сборки  
 После подписывания проекта необходимо построить или перестроить проект или решение с помощью команд, доступных в **построения** меню [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]. Решение может содержать отдельный проект для пользовательского интерфейса, который также должен быть подписан строгим именем и может строиться одновременно со сборкой.  
  
 Наиболее удобным способом выполнения следующих двух шагов — развертывания сборки и установки ее в глобальный кэш сборок — является создание скрипта для этих шагов, запускаемого после построения в [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]. События построения доступны из **компиляции** страницы свойств проекта для [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] проект и из **события построения** страницы для проекта C#. Полный путь является обязательным для программы командной строки, таких как **gacutil.exe**. Пути, содержащие пробелы, и макросы, например, $(TargetPath), которые разворачиваются в пути, содержащие пробелы, необходимо заключать в кавычки.  
  
 Ниже приведен образец командной строки события после построения для пользовательского регистратора.  
  
```  
"C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\bin\NETFX 4.0 Tools\gacutil.exe" -u $(TargetName)  
"C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\bin\NETFX 4.0 Tools\gacutil.exe" -i $(TargetFileName)  
copy $(TargetFileName) "C:\Program Files\Microsoft SQL Server\130\DTS\LogProviders "  
```  
  
##  <a name="deploying"></a>Развертывание сборки  
 [!INCLUDE[ssIS](../../includes/ssis-md.md)] Конструктор находит пользовательских объектов, доступных для использования в пакетах, путем перечисления файлов, найденных в серии папок, которые были созданы при [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] установлен. Если значение по умолчанию [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] используются параметры установки, этот набор папок расположен в разделе **C:\Program Files\Microsoft SQL Server\130\DTS**. Однако при создании программы установки для пользовательского объекта, следует проверить значение **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\130\SSIS\Setup\DtsPath** раздел реестра, чтобы определить размещение этой папки.  
  
> [!NOTE]  
>  Сведения о том, как создавать пользовательские компоненты для работы с поддержка нескольких версий в SQL Server Data Tools см. в разделе [начало пользовательских расширений служб SSIS для поддержки поддержка нескольких версий 2015 SSDT для SQL Server 2016](https://blogs.msdn.microsoft.com/ssis/2016/04/19/getting-your-ssis-custom-extensions-to-be-supported-by-the-multi-version-support-of-ssdt-2015-for-sql-server-2016/).  
  
 Можно поместить сборку в папку двумя способами.  
  
-   Переместить или скопировать скомпилированную сборку в соответствующую папку после ее построения. (Для удобства можно включить команду копирования в событие после построения.)  
  
-   Построить сборку непосредственно в нужной папке.  
  
 Следующие папки развертывания по адресу **C:\Program Files\Microsoft SQL Server\130\DTS** используются для различных типов пользовательских объектов:  
  
|Пользовательский объект|Папка развертывания|  
|-------------------|-----------------------|  
|Задача|Задания|  
|Диспетчер соединений|Соединения|  
|Регистратор|LogProviders|  
|Компонент потока данных|PipelineComponents|  
  
> [!NOTE]  
>  Сборки копируются в эти папки для поддержки перечисления доступных задач, диспетчеров соединений и т. д. Поэтому нет необходимости развертывать сборки, содержащие только пользовательский интерфейс для пользовательских объектов, в этих папках.  
  
##  <a name="installing"></a>Установка сборки в глобальный кэш сборок  
 Чтобы установить сборку задачи в глобальный кэш сборок (GAC), используйте средство командной строки **gacutil.exe**, или перетащите сборки `%system%\assembly` каталога. Для удобства можно включить вызов **gacutil.exe** в событие после построения.  
  
 Следующая команда устанавливает компонент с именем *файл MyTask.dll* в глобальном кэше СБОРОК с помощью **gacutil.exe**.  
  
 `gacutil /iF MyTask.dll`  
  
 После установки новой версии пользовательского объекта необходимо закрыть и заново открыть конструктор служб [!INCLUDE[ssIS](../../includes/ssis-md.md)]. Если устаревшие версии пользовательского объекта были ранее установлены в глобальный кэш сборок, необходимо удалить их перед установкой новой версии. Чтобы удалить сборку, запустите **gacutil.exe** и укажите имя сборки с `/u` параметр.  
  
 Дополнительные сведения о глобальном кэше сборок см. в разделе «Программа глобального кэша сборок (Gactutil.exe)» в документации по средствам платформы [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)].  
  
##  <a name="troubleshooting"></a>Устранение неполадок развертывания  
 Если пользовательский объект отображается в **элементов** или список доступных объектов, но не удается добавить в пакет, попробуйте сделать следующее:  
  
1.  Выполните поиск в глобальном кэше сборок на предмет наличия в нем нескольких версий компонента. При наличии нескольких версий компонента в глобальном кэше сборок конструктор не может загрузить компонент. Удалите все экземпляры сборки из глобального кэша сборок и добавьте сборку заново.  
  
2.  Убедитесь в том, что только один экземпляр сборки существует в папке развертывания.  
  
3.  Обновите панель элементов.  
  
4.  Присоединение [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] для **devenv.exe** и установите точку останова, осуществлять пошаговое выполнение код инициализации, чтобы избежать возникновения исключения.  
  
##  <a name="testing"></a>Тестирование и отладка кода  
 Самым простым подходом к отладке методов времени выполнения пользовательского объекта является запуск **dtexec.exe** из [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] после построения пользовательского объекта и выполнение пакета, использующего данный компонент.  
  
 Если необходимо выполнить отладку методов времени разработки компонента, такие как **проверки** метод, откройте пакет, который используется компонент, во второй экземпляр [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]и присоединить его **devenv.exe** процесса.  
  
 Если вы хотите отладить методы компонента времени выполнения, когда пакет открыт и выполняется [!INCLUDE[ssIS](../../includes/ssis-md.md)] конструктора, необходимо принудительно приостановить выполнение пакета, чтобы вы также можете присоединить **DtsDebugHost.exe** процесса.  
  
#### <a name="to-debug-an-objects-run-time-methods-by-attaching-to-dtexecexe"></a>Отладка методов времени выполнения объекта путем подключения к dtexec.exe  
  
1.  Подпишите и постройте проект в конфигурации отладки, выполните развертывание и установку в глобальный кэш сборок, как описано в этом разделе.  
  
2.  На **отладки** вкладке **свойства проекта**выберите **запуск внешней программы** как **действие при запуске**и найдите **dtexec.exe**, установленный по умолчанию в C:\Program Files\Microsoft SQL Server\130\DTS\Binn.  
  
3.  В **параметры командной строки** текстовое поле в разделе **параметры запуска**, введите аргументы командной строки, необходимые для запуска пакета, который использует компонент. Часто аргумент командной строки содержит параметр /F[ILE], за которым следуют путь и имя DTSX-файла. Дополнительные сведения см. в разделе [dtexec Utility](../../integration-services/packages/dtexec-utility.md).  
  
4.  В исходном коде, где это необходимо, задайте точки останова в методах времени выполнения компонента.  
  
5.  Выполните проект.  
  
#### <a name="to-debug-a-custom-objects-design-time-methods-by-attaching-to-sql-server-data-tools"></a>Отладка методов времени разработки пользовательского объекта путем присоединения к SQL Server Data Tools  
  
1.  Подпишите и постройте проект в конфигурации отладки, выполните развертывание и установку в глобальный кэш сборок, как описано в этом разделе.  
  
2.  В исходном коде, где это необходимо, задайте точки останова в методах времени разработки пользовательского объекта.  
  
3.  Откройте второй экземпляр среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] и загрузите проект служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], содержащий пакет, в котором используется пользовательский объект.  
  
4.  Из первого экземпляра [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)], присоединить второй экземпляр **devenv.exe** в которой загружается пакет, выбрав **присоединиться к процессу** из **отладки** меню первого экземпляра.  
  
5.  Выполните пакет из второго экземпляра среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)].  
  
#### <a name="to-debug-a-custom-objects-run-time-methods-by-attaching-to-sql-server-data-tools"></a>Отладка методов времени выполнения пользовательского объекта путем присоединения к SQL Server Data Tools  
  
1.  После завершения действия, описанные в предыдущей процедуре, принудительно приостановите выполнение пакета, можно прикрепить к **DtsDebugHost.exe**. Можно принудительно приостановить выполнение можно путем добавления точки останова для **OnPreExecute** событий, или путем добавления задачи «скрипт» в проект и ввода скрипта, отображающего модальное окно сообщения.  
  
2.  Запустите пакет. Во время паузы переключитесь в экземпляр [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] проекта кода — откройте и выберите **присоединиться к процессу** из **отладки** меню. Убедитесь, что для присоединения к экземпляру **DtsDebugHost.exe** отметку **управляемое x86** в **тип** столбца, а не к экземпляру, в списке **x86** только.  
  
3.  Вернуться к приостановленному пакету и продолжить выполнение после точки останова или щелкните **ОК** закрыть окно сообщения, вызывается задачей «скрипт», и продолжить выполнение и отладку пакета.  
  
## <a name="see-also"></a>См. также:  
 [Разработка пользовательских объектов для служб Integration Services](../../integration-services/extending-packages-custom-objects/developing-custom-objects-for-integration-services.md)   
 [Сохранение пользовательских объектов](../../integration-services/extending-packages-custom-objects/persisting-custom-objects.md)   
 [Инструменты устранения неполадок при разработке пакета](../../integration-services/troubleshooting/troubleshooting-tools-for-package-development.md)  
  
  
