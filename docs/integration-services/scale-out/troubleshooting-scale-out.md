---
title: "Устранение неполадок SQL Server Integration Services (SSIS) для горизонтального масштабирования | Документы Microsoft"
ms.custom: 
ms.date: 07/18/2017
ms.prod: sql-server-2017
ms.reviewer: 
ms.suite: 
ms.technology:
- integration-services
ms.tgt_pltfrm: 
ms.topic: article
caps.latest.revision: 1
author: haoqian
ms.author: haoqian
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 1419847dd47435cef775a2c55c0578ff4406cddc
ms.openlocfilehash: 41bb853dd08591596f6f5baa918e174d0c26a6b5
ms.contentlocale: ru-ru
ms.lasthandoff: 08/03/2017

---
# <a name="troubleshooting-scale-out"></a>Устранение неполадок для горизонтального масштабирования

SSIS масштабное развертывание включает в себя communtication среди SSISDB шкалы Out Master службы и службы шкалы Out рабочих. В некоторых случаях связи разорвано из-за ошибок конфигурации, отсутствие прав доступа и по другим причинам. Этот документ поможет устранить неисправности в конфигурации масштабное развертывание.

Для изучения проблем, возникающих, выполните описанные ниже по одному, пока проблема не будет устранена.

### <a name="symptoms"></a>**Проблема** 
Масштаб Out Master не удается подключиться к SSISDB. 

Основные свойства не удается отобразить в диспетчере Out шкалы.

Основные свойства не заполнено [SSISDB]. [catalog]. [master_properties]

### <a name="solution"></a>**Решение**
Шаг 1: Проверьте, если масштабное развертывание включен.

Щелкните правой кнопкой мыши **SSISDB** узел в обозревателе объектов SSMS и проверяет **включена функция масштабное развертывание**.

![Масштабное развертывание включен](media\isenabled.PNG)

Если свойство имеет значение False, включение в масштабное развертывание путем вызова хранимой процедуры [SSISDB]. [catalog]. [enable_scaleout].

Шаг 2: Проверьте правильность имя Sql Server, указанную в файле конфигурации шкалы Out главного и перезапустите службу шкалы Out Master.

### <a name="symptoms"></a>**Проблема** 
Масштаб Out работника не удается подключиться к шкалы Out Master

Масштаб Out работника не содержит после его добавления в диспетчере Out шкалы

Масштаб Out работника не отображается в [SSISDB]. [catalog]. [worker_agents]

Масштаб Out рабочих служба запущена, пока шкалы Out работника находится в автономном режиме

### <a name="solutions"></a>**Решения** 
Проверьте сообщения об ошибках в журнале службы шкалы Out работника в разделе \<драйвер\>: \Users\\*[учетной записи службы worker]*\AppData\Local\SSIS\Cluster\Agent.

**Регистр** 

System.ServiceModel.EndpointNotFoundException: Произошла нет конечной точки, прослушивающей https://*[ИмяКомпьютера]: [порт]*/ClusterManagement/, которая могла бы принять сообщение.

Шаг 1: Проверьте правильность номер порта, указанный в файле конфигурации службы шкалы Out главного и перезапустите службу шкалы Out Master. 

Шаг 2: Проверьте правильность основной конечной точкой, заданной в конфигурации службы шкалы ожидания рабочего и перезапустите службу шкалы Out работника.

Шаг 3: Проверьте, открыт ли порт брандмауэра на шкале Out главного узла.

Шаг 4: Устраните другие проблемы соединения между шкалы Out главного узла и масштаб ожидания рабочий узел.

**Регистр**

System.ServiceModel.Security.SecurityNegotiationException: Не удалось установить доверительные отношения для защищенного канала SSL/TLS с полномочиями "*[имя компьютера]: [порт]*". ---> System.Net.WebException: Базовое соединение закрыто: не удалось установить доверительные отношения для защищенного канала SSL/TLS. ---> System.Security.Authentication.AuthenticationException: удаленный сертификат недействителен согласно процедуры проверки.

Шаг 1: Установить масштаб Out главного сертификата в корневое хранилище сертификатов локального компьютера на шкале ожидания рабочий узел в противном случае пока установлен и перезапустите службу шкалы Out рабочих.

Шаг 2: Проверьте, если имя узла в конечной точке master включается в общих имен для масштабирования Out главного сертификата. В противном случае Сброс основной конечной точки в файле конфигурации шкалы ожидания рабочего и перезапустите службу шкалы Out работника. 

> [!Note]
> Если это не невозможно изменить имя узла основной конечной точки из-за параметров DNS, необходимо изменить масштаб Out главного сертификата. В разделе [справиться с сертификатами в SSIS масштабное развертывание](deal-with-certificates-in-ssis-scale-out.md).

Шаг 3: Проверка совпадения master отпечаток, указанный в конфигурации шкалы Out рабочих отпечаток сертификата шкалы Out главного. 

**Регистр**

System.ServiceModel.Security.SecurityNegotiationException: Не удалось установить безопасный канал для SSL/TLS с полномочиями "*[имя компьютера]: [порт]*". ---> System.Net.WebException: запрос был прерван: не удалось создать защищенный канал SSL/TLS.

Шаг 1: Установите флажок, если учетной записи службы шкалы ожидания рабочий доступ к сертификату шкалы Out работника с помощью следующей команды.

```dos
winhttpcertcfg.exe -l -c LOCAL_MACHINE\MY -s {CN of the worker certificate}
```

Учетная запись не имеет доступ, предоставить с помощью команды ниже и перезапустите службу шкалы Out работника.

```dos
winhttpcertcfg.exe -g -c LOCAL_MACHINE\My -s {CN of the worker certificate} -a {the account running Scale Out Worker service}
```

**Регистр**

System.ServiceModel.Security.MessageSecurityException: Запрос HTTP запрещен для схемы проверки подлинности клиента «Anonymous». ---> System.Net.WebException: удаленный сервер вернул ошибку: (403) запрещено.

Шаг 1: Установить масштаб ожидания рабочий сертификат в корневое хранилище сертификатов локального компьютера на шкале Out главного узла в противном случае пока установлен и перезапустите службу шкалы Out рабочих.

Шаг 2: Очистка бесполезными сертификатов в корневом хранилище сертификатов локального компьютера на шкале Out главного узла.

Шаг 3: Настройка Schannel для больше не отправлять список доверенных корневых центров сертификации в процессе подтверждения TLS/SSL, добавив параметр реестра ниже шкалы Out главного узла.

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL

Имя значения: SendTrustedIssuerList 

Тип значения: REG_DWORD 

Данные значения: 0 (False)

**Регистр**

System.ServiceModel.CommunicationException: Произошла ошибка при отправке запроса HTTP к https://*[имя компьютера]: [порт]*  /ClusterManagement /. Это может быть тем, что сертификат сервера не настроена должным образом с HTTP. SYS в случае HTTPS. Это также может быть вызвано несоответствием привязки безопасности между клиентом и сервером. 

Шаг 1: Проверьте, если масштаб Out Master привязанный сертификат к порту в основной конечной точки правильно на главном узле с помощью следующей команды. Проверьте, если отображается значение хэша сертификата соответствует шкалы Out Master отпечаток сертификата.

```dos
netsh http show sslcert ipport=0.0.0.0:{Master port}
```

Если привязка неверны, сбросить его с помощью следующих команд и перезапустите службу шкалы Out работника.

```dos
netsh http delete sslcert ipport=0.0.0.0:{Master port}
netsh http add sslcert ipport=0.0.0.0:{Master port} certhash={Master certificate thumbprint} certstorename=Root appid={random guid}
```

### <a name="symptoms"></a>**Проблема**
Выполнение в масштабное развертывание не происходит.

### <a name="solution"></a>**Решение**

Проверьте состояние компьютеров, выбранных для запуска пакета в [SSISDB]. [catalog]. [worker_agents]. По крайней мере один рабочий процесс должен быть подключен и включен.

### <a name="symptoms"></a>**Проблема** 
Успешное выполнение пакетов, но не сообщения в журнал.

### <a name="solution"></a>**Решение**

Проверьте, если проверка подлинности SQL Server может быть сервером Sql Server размещение SSISDB.

> [!Note]  
> Если вы изменили учетную запись для ведения журнала масштабное развертывание, см. раздел [изменить учетную запись для масштабирования ожидания входа](change-logdb-account.md) и проверьте строку подключения, используемые для ведения журнала.

### <a name="symptoms"></a>**Проблема**
Сообщения об ошибке в отчете выполнения пакета недостаточно для устранения неполадок.

### <a name="solution"></a>**Решение**
Дополнительные журналы выполнения можно найти в разделе TasksRootFolder, настроенные в WorkerSettings.config. По умолчанию — \<драйвер\>: \Users\\*[счет]*\AppData\Local\SSIS\ScaleOut\Tasks. *[Счет]* учетная запись службы шкалы Out работника со значением по умолчанию SSISScaleOutWorker140.

Чтобы найти журнал для выполнения пакета с *[идентификатор выполнения]*, выполнение команды T-SQL получить *[ИД задачи:]*. Затем найдите вложенную папку с именем *[ИД задачи:]* под TasksRootFolder.<sup> 1<sup>

```sql
SELECT [TaskId]
FROM [SSISDB].[internal].[tasks] tasks, [SSISDB].[internal].[executions] executions 
WHERE executions.execution_id = *Your Execution Id* AND tasks.JobId = executions.job_id
```
<sup>1</sup> этот запрос предназначен для устранения неполадок назначение только и открыть для изменения, когда в будущем повышение сценарий ведения журнала и диагностики для масштабирования ожидания рабочего процесса. 
